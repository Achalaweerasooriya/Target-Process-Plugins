define(["Underscore","jQuery","tau/utils/utils.routing"],function(a,b,c){var d=function(){module("[utils.routing.safe] tests",{setup:function(){}}),test("should register routes",function(){var a=!1,d="preved",e=new c({safe:!0,safeParameterName:"route"});e.reset().register({pattern:"task/{id}",callback:function(b){a=b.id}}).register({pattern:"bug/{id}",callback:function(b){a=b.id}}).register("project/{id}",function(b){a=b.id}).start(),e.execute("task/126"),equals(a,!1,"Routing is not executed and processed"),b(window).triggerHandler(b.Event("hashchange",{hash:"route=task/123"})),equals(a,123,"Routing is executed and processed"),b(window).triggerHandler(b.Event("hashchange",{hash:"index=1&route=bug/555&preved=medved"})),equals(a,555,"Routing is executed and processed"),b(window).triggerHandler(b.Event("hashchange",{hash:"#route=project/545||{}"})),equals(a,545,"Routing is executed and processed"),e.stop(),a=null,b(window).triggerHandler(b.Event("hashchange",{hash:"route=project/577"})),equals(a,null,"Routing is executed and processed")}),test("should handle routes with state data",function(){var a=!1,d="preved",e={},f=new c({safe:!0,safeParameterName:"route"});f.reset().register({pattern:"task/{id}",callback:function(b,c){a=b.id,e=c}}),f.start(),b(window).triggerHandler(b.Event("hashchange",{hash:'route=task/555||{"tab":3}'})),equals(a,555,"Extract request parameters"),same(e,{tab:3},"Extract state parameters"),f.stop()}),test("should produce routes with state data",function(){var a=!1,d="preved",e={},f=new c({window:window});f.reset().register({pattern:"task/{id}",callback:function(a,b){}}),f.start();var g=f.generateUrl();equals(g,"","Generate correct url"),b(window).triggerHandler(b.Event("hashchange",{hash:"route=task/555"}));var g=f.generateUrl();equals(g,"route=task/555","Generate correct url"),b(window).triggerHandler(b.Event("hashchange",{hash:'route=task/555||{"tab":3}'})),g=f.generateUrl(),equals(g,'route=task/555||{"tab":3}',"Generate correct url"),f.stop()})};return{run:d}})