define(["Underscore","tau/configurator","tau/models/dataprocessor/model.processor.context","tests/common/service.mock","tests/common/datapoint/test.common.datapoint","tau/components/component.list","tests/common/testData","tests/common/applicationContext","tests/components/common/common.setup","tests/components/component.specs","tests/common/checker","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.groups.user_stories","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=function(){var g=new h({currentProcess:{id:2,name:"Kanban"}}),k=e.entityStates(),n=e.projects(),o=e.userStories(),p={id:15,__type:"feature",userStories:a(o).filter(function(a){return a.id==11||a.id==12||a.id==13})},q=[p].concat(n).concat(k).concat(o),r={context:{type:"feature",id:15,applicationContext:g}},s=function(){var a=this.service=new d;b.setService(a),b.getProxy().markRecordSetAsCompleteLoaded("project"),b.getProxy().markRecordSetAsCompleteLoaded("entityState"),b.getProxy().markRecordSetAsCompleteLoaded("priority")},t=[{preSetup:s,name:"should render valid markup view",test:function(){var b=this.data,c=this.$el;equals(c.find(".tau-list__empty-message").length,0,"No empty message");var d=c.find("[role=group]");equals(d.length,5,"Groups amount");for(var e=0;e<d.length;e++){var f=d.eq(e);equals(f.find("[role=title]").text(),b.groups[e].title,"Group title"),equals(f.find("[role=counter]").text(),b.groups[e].items.length,"Group counter")}var g=c.find("[role=list-inner]");for(var h=0;h<g.length;h++){var i=g.eq(h),j=i.find("> tr");for(var k=0;k<j.length;k++){var l=j.eq(k).find("td"),m=b.groups[h].items[k];equals(l.length,8,"Amount of row cells"),equals(l.eq(1).text(),m.id,"ID Data column");var n=l.eq(2).find("span").eq(0);equals(n.text(),m.name,"Name Data column");if(m.tags.length){var o=l.eq(2).find("span").eq(1);equals(o.text(),m.tags[0],"Tag Data column")}equals(l.eq(3).text(),m.project.abbreviation.toString(),"Project Data column"),equals(l.eq(4).text(),m.priority.name.toString(),"Priority Data column"),equals(l.eq(4).find("span:first").html(),m.effort.estimated+"&nbsp;"+m.effort.unit.shortName,"Estimated Effort Data column"),equals(l.eq(5).find("span:first").html(),m.effort.estimated+"&nbsp;"+m.effort.unit.shortName,"Estimated Effort Data column"),ok(l.eq(6).find(".ui-progressbar__progress").attr("style").match(new RegExp("width:\\s*"+m.effort.percentFromMaximum+"%")),"Column progress width"),ok(l.eq(6).find(".ui-progressbar__progress__indicator").attr("style").match(new RegExp("width:\\s*"+m.effort.percentComplete+"%")),"Column progress width"),equals(l.eq(7).find(".ui-assignment__group").length,m.assignments.groups.length,"Assignments items");var p=l.eq(7).find(".ui-assignment__group");a.forEach(m.assignments.groups,function(b,c){var d=p.eq(c);equals(d.find(".ui-assignment__group__title").text(),b.role.name,"Group title");var e=d.find(".ui-assignment__user");equals(e.length,b.users.length,"Group users length"),a.forEach(b.users,function(a,c){var d=e.eq(c),a=b.users[c];equals(d.find("img").attr("src"),"/TP/Avatar.ashx?UserId="+a.id+"&size=24","User avatar"),equals(d.find("img").prop("title"),a.name,"User name")})})}}}}],u={context:{applicationContext:g},itemsDataProvider:l,groupsDataProvider:m,multiprojects:!0,groupBy:"entityState.name",views:[{type:"grid.entity",group:{dataIndex:"name"}}]};c(u.context);var v=i.create("[component.list][user_stories]",q,f,u,g);j.create(v,r).viewShouldFollowDataComponentLifeCycle(s).viewShouldPassTests(t).done()};return{run:n}})