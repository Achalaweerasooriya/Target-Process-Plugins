define(["Underscore","tau/core/class","tau/configurator","tau/extensions/extension.underscore.async"],function(a,b,c){var d={asyncTest:asyncTest,start:start,stop:stop},e=b.extend({name:null,befores:[],afters:[],expects:[],request:{method:"get",type:null,config:{}},method:function(a){return this.request.method=a,this},type:function(a){return this.request.type=a,this},config:function(a,b){return this.request.config[a]=b,this},expect:function(a){return this.expects.push(a),this},run:function(){var a=this;return test(this.name,{},function(){stop(),c.clear(),c.setApplicationPath("http://localhost/TargetProcess");var b=c.getStore(),d=a.request;b[d.method].call(null,d.type,d.config).done({success:function(b){a._buildExpects(b)(start)},failure:function(a){ok(!1,"Failure during request")}})}),this},_serial:function(b){return function(){stop(),a.series(b,start)}},_buildExpects:function(b){var c=[];return a.forEach(this.expects,function(a){c.push(function(c){a(b),c()})}),function(b){a.series(c,b)}}}),f=b.extend({name:null,testCases:[],init:function(a){this.name=a},test:function(a){var b=new e;return b.name=a,this.testCases.push(b),b},run:function(){module(this.name),a.forEach(this.testCases,function(a){a.run()})}}),g={create:function(a){return new f(a)}};return g})