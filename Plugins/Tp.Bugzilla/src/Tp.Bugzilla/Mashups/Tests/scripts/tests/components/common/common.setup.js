define(["Underscore","jQuery","tests/common/testData","tests/common/model.chainfixture","tests/common/modelConfig","tau/core/termProcessor"],function(a,b,c,d,e,f){return{create:function(c,g,h,i,j){return{setup:function(k){function l(a){this.config=a,a.context.applicationContext&&(this.termProcessor=new f(a.context.applicationContext.processes[0].terms)),this.component.fire("initialize",a)}b.fx.off=!0,module(c,{setup:function(){var b=typeof g=="function"?g():g,c={testData:b};d.setup(this).setInitialData(c),k.preSetup&&k.preSetup.call(this,d),this.component=h.create(a.clone(i||{})),k.setup&&k.setup.call(this,d)},teardown:function(){this.component.fire("destroy"),d.tearDown(this)}});var m={setupFunctions:[],initialize:function(b){var c=b.manualContext!==!0?e[b.context.type](b.context.id,j):a(b.context).clone(),d=a(b.settings||{}).clone();c=a.extend(c,b.context.data),d.context=c;var f=l;arguments.length>1&&(f=arguments[1]||f),this.setupFunctions.push(function(){f.call(this,d)});return m},test:function(a,b){var c=this.setupFunctions;test(a,function(){for(var a=0,d=c.length;a<d;a++)c[a].call(this);b.call(this),this.mockControl.verify()});return m}};return m}}}}})