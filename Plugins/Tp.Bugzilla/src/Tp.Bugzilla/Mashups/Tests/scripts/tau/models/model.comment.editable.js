define(["Underscore","tau/core/model.editable.base","tau/configurator","tau/models/dataprocessor/model.processor.comment"],function(a,b,c,d){var e=b.extend({name:"Editable Comments","bus applyTo":function(a){var b=this.bindedData=a.data.data;this.authorizate(b)},authorizate:function(a){var b=this.bindedData.deleted,c={editable:!b,deletable:!0};this.fire("permissionsReady",c)},_convertDTO:function(b){var c=this.config,e=c.parentCommentId,f=new d(c.context),g=f.convertDTO(a.extend({},b));return g.parentId=e,g},"bus afterInit":function(a){var b=this;this.config=a.data.config;var c={id:null,description:"",owner:b.config.context.applicationContext.loggedUser},d=b._convertDTO(c);b.bindedData=d,b.fire("dataBind",d)},_fireUpdate:function(a,b){var c=this;b.general={id:c.config.context.entity.id},c.fire("save",{id:a,typeName:"comment",$set:b,$include:["id","description","createDate","parentId",{owner:["id","firstName","lastName","kind"]}]})},"bus saveComment":function(a){var b=this,c=a.data,d=this.bindedData.id;b._fireUpdate(d,c)},"bus replyToComment":function(a){var b=this,c=a.data;b._fireUpdate(null,c)},"bus deleteComment":function(){var a=this.bindedData,b=a.id;a.comments&&a.comments.length>0?this._fireUpdate(b,{description:"DELETED"}):this.fire("remove",{id:b,typeName:"comment"})}});return e})