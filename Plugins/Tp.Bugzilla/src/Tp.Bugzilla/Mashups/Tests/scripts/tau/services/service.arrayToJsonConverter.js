define(["Underscore","tau/core/header","tau/services/formatProperties"],function(a,b,c){return{convertArray:function(b,c){var d=this,e=[];if(c.next){var f=c.next;e.getNextUrl=function(){return f}}c=c.items?c.items:c,a.each(c,function(a){e.push(d.convert(b,a))});return e},convert:function(d,e){var f={},g=this;for(var h=0,i=d.header.length;h<i;h++){var j=e[h];a.isUndefined(j)&&(j=null);var k=d.header[h];if(b.header.isSimple(k)){c.hasOwnProperty(k)&&(j=b.formatObject(j)),f[k]=j;continue}var l=b.header.getFieldName(k);if(a.isEmpty(j)&&k.list!==!0){f[l]=null;continue}if(!a.isNull(j)){var m={header:k[l]};if(k.list===!0){var n=[];a.each(j,function(a){n.push(g.convert(m,a))}),j=n}else j=g.convert(m,j)}a.isNull(j)&&k.list===!0&&(j=[]),f[l]=j}return f}}})