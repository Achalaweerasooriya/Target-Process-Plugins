define(["Underscore","jQuery","libs/jquery/jquery.tmpl"],function(a,b){var c={templates:{},initialized:{},get:function(a){var c=this;if(!b.template.hasOwnProperty(a))throw["Template '",a,"' was not found."].join("");return{bind:function(d,e){var f={},g=c.templates[a],h=g.tags||[];for(var i=0;i<h.length;i++){var j=h[i];j.register(d,f)}var k=b.template[a];return b.tmpl(k,e,f)}}},registerRecursively:function(a,c){var d=this;c=c||{tags:[]};var e=null;if(!b.template.hasOwnProperty(a)){e=this.templates[a];if(!e)throw["Template '",a,"' was not found."].join("");e.tags&&(c.tags=c.tags.concat(e.tags)),b.each(e.dependencies,function(a,b){d.registerRecursively(b,c)}),e.tags=c.tags;var f=e.markup;b.isArray(f)&&(f=f.join("")),b.template(a,f)}else e=e||this.templates[a],e.tags&&(c.tags=c.tags.concat(e.tags))},register:function(a){var b=this;return a.dependencies=a.dependencies||[],this.templates[a.name]=a,b.registerRecursively(a.name),{name:a.name,options:a.options||{},get:function(){return b.get(a.name)}}}};return c})