define(["Underscore","tau/core/model-base"],function(a,b){var c=b.extend({name:"Progress Bar",init:function(){this._super.apply(this,arguments);var a=this;a.store.on({eventName:"beforeSave",type:"roleEffort",listener:this},function(){a.beforeSaveRoleEffort.apply(a,arguments)}),a.store.on({eventName:"afterSave",type:"roleEffort",listener:this},function(){a.afterSaveRoleEffort.apply(a,arguments)})},beforeSaveRoleEffort:function(a){var b=a.data.cmd.config;b.fields=b.fields||[],b.fields.push({assignable:["id","effortCompleted","effortToDo","timeSpent","timeRemain"]})},afterSaveRoleEffort:function(a){var b=this;b.store.get("roleEffort",{id:a.data.obj.id,fields:[{assignable:["id"]}]},{success:function(a){a.data.assignable.id===b.config.context.assignable.id&&b.fire("roleEffortChanged")}}).done()},floatToString:function(a){return a.toFixed(2).replace(".00","")},_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},onInit:function(){var a=this.config.context,b=a.entity.entityType.name,c=a.entity.id,d=[{userStories:["effortToDo","effortCompleted"]},{bugs:["effortToDo","effortCompleted"]}];this.store.get(b,{id:c,fields:d},{success:this.setEntity,scope:this}).done({success:this.done,scope:this})},setEntity:function(b){var c=0,d=0,e=function(a){c+=a.effortToDo,d+=a.effortCompleted};a.each(b.data.userStories,e),a.each(b.data.bugs,e);var f=Math.round(100*parseFloat(c)+100*parseFloat(d))/100,g=Math.round(1e4*(d/f))/100;g=isNaN(g)?0:g,g=g>100?100:g,this.effortToDo=c,this.effortCompleted=d,this.percentCompleted=g},done:function(){this.fire("dataBind",{effortToDo:this.floatToString(this.effortToDo),effortCompleted:this.floatToString(this.effortCompleted),percentCompleted:this.percentCompleted,totalEffort:this.floatToString(this.effortToDo+this.effortCompleted),point:this._getEffortPoints()})},"bus evictState":function(){delete this.entity.entityState}});return c})