define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(a,b,c){var d=c.extend({category:"edit","bus initialize":function(a){this.config=a.data},"bus afterRender+permissionsReady+dataBind":function(a){this.element=a.afterRender.data.element;var b=a.permissionsReady.data;this.data=a.dataBind.data,this.initializeAddCommentLink()},initializeAddCommentLink:function(){this.$addLink=b("<span class='ui-comments-add-link'>Add Comment</span>").click(b.proxy(this.addNewComment,this)).insertAfter(this.element.find(".ui-all-comments"))},onSave:function(a){var b=this;b.fire("save",{id:null,typeName:"comment",$set:{description:a,general:{id:b.config.context.entity.id}},$include:["id","description","createDate","parentId",{owner:["id","firstName","lastName","kind"]}]}),b.closeEditor()},onCloseEditor:function(a){this.$addLink.show()},addNewComment:function(){var a=this;a.$addLink.hide();var c={components:[{type:"comment.new.editor"}],context:a.config.context};a.createComponents(c,function(c){var d=c[0].component;d.on("afterRender",function(b){var c=b.data.element;c.insertAfter(a.$addLink)}),d.on("close",b.proxy(a.onCloseEditor,a)),d.initialize()})}});return d})