define(["Underscore","tau/core/model-base","tau/utils/utils.htmlConverter"],function(a,b,c){var d=function(a){this.model=a};d.prototype={onGetDescription:function(a){var b=a.data;this.id=b.id,this.description=b.description},done:function(a){var b={description:c.fromSourceToHtml(this.description)};this.model.bus.fire("dataBind",b)}};var e=b.extend({name:"Description",bindCurrentEntityChanges:function(b,c){b=a.isArray(b)?b:[b],c=c||{before:"beforePropertyChanged",after:"afterPropertyChanged"};var d=this.config.context.entity.id;this.listenedEntities=this.listenedEntities||{};if(this.listenedEntities[d])return;this.listenedEntities[d]=!0;var e=this,f=function(a){var d=a.data;e.isPropertyChanged(b,d)&&e.fire(c.after,d)},g=function(a){var d=a.data;e.isPropertyChanged(b,d)&&e.fire(c.before,d)},h="general";e.store.on({eventName:"beforeSave",type:h,listener:this,filter:{id:d}},g),e.store.on({eventName:"afterSave",type:h,listener:this,filter:{id:d}},f)},onInit:function(){var a=new d(this),b=this.config.context,c=b.entity.entityType.name,e=b.entity.id;this.bindCurrentEntityChanges("description",{before:"prepareChanges",after:"applyChanges"});var f={id:e,fields:["id","description"]};this.store.get(c,f,{scope:a,success:a.onGetDescription}).done({success:a.done,scope:a})},destroy:function(){this.listenedEntities={},this._super()}});return e})