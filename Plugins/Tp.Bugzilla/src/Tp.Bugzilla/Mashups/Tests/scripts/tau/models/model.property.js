define(["tau/core/model.editable.base","tau/configurator"],function(a,b){return a.extend({init:function(a){this._super.apply(this,arguments);if(!a.propertyName)throw"PropertyName was not configured";this.propertyName=a.propertyName,this.displayField=a.displayField||"name",this.valueField=a.valueField||"id"},getEntityTypeName:function(){return this.config.context.entity.entityType.name},getEntityId:function(){return this.config.context.entity.id},onInit:function(){var a={};a[this.propertyName]=[this.displayField,this.valueField],this.attachToChangePropertiesOfCurrentEntity(this.propertyName),this.store.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",a]}).done({success:this.onEntityRetrieved,scope:this})},onEntityRetrieved:function(a){var c=this.property=a[0].data[this.propertyName]||{},d={id:c[this.valueField],text:c[this.displayField]};this.config.showUrl&&c.id&&(d.hasUrl=!0,d.externalUrl=[b.getApplicationPath(),"/View.aspx?id=",c.id].join(""),d.applicationUrl="#"+c.__type+"/"+c.id),this.fire("dataBind",d)},entityBelongCurrentContext:function(a){return a.changes.hasOwnProperty(this.config.propertyName)&&a.cmd.config.id==this.config.context.entity.id},onEntityAfterSave:function(a){var b=a.data;this.entityBelongCurrentContext(b)&&this.fire("changed",b)},onEntityBeforeSave:function(a){var b=a.data;this.entityBelongCurrentContext(b)&&this.fire("beforeChanged",b)}})})