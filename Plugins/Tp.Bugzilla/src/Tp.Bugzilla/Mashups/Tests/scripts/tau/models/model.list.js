define(["Underscore","tau/core/model-base","tau/models/dataProviders/model.provider.groups.default","tau/extensions/extension.underscore"],function(a,b,c){var d=b.extend({onInit:function(){var a=this,b=new this.config.itemsDataProvider(this.config);b.fetch(function(b){a.fire("afterItemsProvided",{data:b})})},"bus afterItemsProvided":function(b){var d=this,e=null;this.config.groupsDataProvider?RealGroupsProvider=this.config.groupsDataProvider:RealGroupsProvider=c;var f=b.data.data,g=a.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,h=new RealGroupsProvider(this.config);h.fetch(g,f,function(a){d.fireAfterGroupsProvided(a)})},fireAfterGroupsProvided:function(a){this.fire("afterGroupsProvided",{data:a})},"bus afterItemsProvided+afterGroupsProvided":function(a){var b=a.afterItemsProvided.data.data,c=a.afterGroupsProvided.data.data,d={items:[],groups:[],isEmpty:b.length?!1:!0};c!==!1?d.groups=this.innerGroupBy(b,c):d.items=b,this.fire("afterDataProvided",{data:d})},"bus afterDataProvided":function(a){var b=this.preProcess(a.data.data);this.fire("preDataBind",b),this.fire("dataBind",b)},preProcess:function(b){var c=this.config.views[0];a.forEach(b.groups,function(b){b.title||(a.isObject(b.key)?b.title=a.complexKey(b.key,c.group.dataIndex):b.title=b.key)}),b.config={views:this.config.views,currentView:c};return b},innerGroupBy:function(b,c){var d=a.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,e=this;a.forEach(c,function(c){a.forEach(b,function(b){var e=a.complexKey(b,d);a.isArray(c.key)&&a.indexOf(c.key,e)>-1?c.items.push(b):a.isEqual(c.key,e)&&c.items.push(b)})});return c}});return d})