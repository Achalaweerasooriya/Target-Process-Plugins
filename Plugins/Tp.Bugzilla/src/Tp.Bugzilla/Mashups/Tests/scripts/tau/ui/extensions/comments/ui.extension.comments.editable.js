define(["Underscore","jQuery","tau/configurator","tau/components/extensions/component.extension.base","tau/ui/templates/comments/ui.template.comments.comment"],function(a,b,c,d,e){var f=d.extend({category:"edit","bus dataBind+afterRender":function(a){var b=this,c={comments:a.dataBind.data.items},d=this.element=a.afterRender.data.element,e=".ui-all-comments",f=d.find(e),g={components:{type:"commentList"},context:this.config.context};this.createComponents(g,function(a){var b=a[0].component,d={element:f,data:c,config:g};b.fire("applyTo",d)})},getGUIDSelector:function(a){return"guid-comment-"+a},getCommentIdClass:function(a){return"comment-id-"+a},"bus prepareUpdate":function(a){var c=a.data.cmd,d=null,e=c.config.$set.parentId,f=".ui-all-comments"+(e?" ."+this.getCommentIdClass(e)+" .ui-comments":""),g=this.getGUIDSelector(c.guid);if(!c.config.id)d=b("<div class='ui-comment "+g+"'><div class='ui-comment-body'>Adding new comment. Please wait...</div></div>").appendTo(this.element.find(f));else{var h=this.getCommentIdClass(c.config.id);d=this.element.find(".ui-all-comments ."+h)}this.fire("markElementToBeUpdated",{element:d})},"bus applyUpdate":function(a){var b=this,c=a.data.cmd,d=c.guid,e=this.getCommentIdClass(a.data.id);if(!c.config.id){var f=this.getGUIDSelector(d),g=this.element.find(".ui-all-comments").find("."+f);g.addClass(e).removeClass(f)}this.on("afterRender",function(a){a.removeListener();var c=a.data.element,d=c.find("."+e+" > .ui-comment-body");b.fire("updateElement",{element:d})}),this.fire("refresh")},"bus prepareRemove":function(a){var b=a.data.cmd,c=this.getCommentIdClass(b.config.id),d=this.element.find(".ui-all-comments ."+c);this.fire("markElementToBeDeleted",{element:d})},"bus applyRemove":function(a){var b=this,c=a.data.cmd,d=this.getCommentIdClass(c.config.id),e=this.element.find(".ui-all-comments ."+d);this.fire("deleteElement",{element:e,callback:function(){b.fire("refresh")}})}});return f})