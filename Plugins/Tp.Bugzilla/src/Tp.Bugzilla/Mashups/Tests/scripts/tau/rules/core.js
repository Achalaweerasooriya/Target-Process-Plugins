define(["Underscore","tau/core/class","tau/rules/auto-include-beforeSave"],function(a,b,c){return b.extend({init:function(b){var d=this;d.store=b.store||{},b.ruleImplemenations=b.ruleImplemenations||{},a.extend(d,c),a.extend(d,b.ruleImplemenations),d.register(b.rules||[])},register:function(b){var d=this;a.isArray(b)||(b=[b]),a(b).each(function(b){a.defaults(b,{name:a(c).keys()[0],fields:[],changes:[]});if(!b.hasOwnProperty("type"))throw"type should be configured for rule";b.fields.length!==0&&a.each(b.changes,function(a){var c=function(a){d[b.name](a,b)},e=b.name.split(" ");d.store.on({eventName:e[e.length-1],type:b.type,listener:d,hasChanges:[a]},c)})})},destroy:function(){var a=this.store;delete this.store,a.unbind(this)}})})