define(["Underscore","tau/core/model-base","tau/configurator","tau/core/termProcessor"],function(a,b,c,d){var e=function(a,b){this.model=a,this.appContext=b;var c=b.processes[0].terms;this.termProcessor=new d(c)};e.prototype={convertToItem:function(b){var d=a.bind(function(a){var b=a,c=this.termProcessor.getTerms(b.__type).name,d=c+" #"+b.id+" "+b.name;return d},this),e=c.getRouting().getUrl().source;return{id:b.id,url:e.length&&e.match(/\//)?e:"#"+b.__type.toLowerCase()+"/"+b.id,title:d(b)}},onGetEntity:function(a){this.entity=a.data},done:function(){this.model.fire("currentFound",this.convertToItem(this.entity))}};var f=b.extend({onInit:function(){var a=this,b=a.config.context,c=b.entity.entityType.name,d=b.entity.id,f=b.applicationContext.processes[0],g=new e(a,b.applicationContext),h=function(b){b.data.changes.hasOwnProperty("name")&&a.store.get(c,{id:d,fields:["id","name"]},{success:function(b){a.bus.fire("currentUpdated",g.convertToItem(b.data))}}).done()};a.store.on({eventName:"afterSave",type:c,listener:this},h),a.store.get(c,{id:d,fields:["id","name"]},{scope:g,success:g.onGetEntity}).done({scope:g,success:g.done})}});return f})