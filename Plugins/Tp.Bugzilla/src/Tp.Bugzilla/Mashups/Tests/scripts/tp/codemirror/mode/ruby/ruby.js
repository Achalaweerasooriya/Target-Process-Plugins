CodeMirror.defineMode("ruby",function(a,b){function n(a,b){a.sol()&&a.match("=end")&&a.eol()&&b.tokenize.pop(),a.skipToEnd();return"comment"}function m(a){return function(b,c){b.match(a)?c.tokenize.pop():b.skipToEnd();return"string"}}function l(a,b,c,d){return function(e,f){var g=!1,h;while((h=e.next())!=null){if(h==a&&(d||!g)){f.tokenize.pop();break}if(c&&h=="#"&&!g&&e.eat("{")){f.tokenize.push(k(arguments.callee));break}g=!g&&h=="\\"}return b}}function k(){var a=1;return function(b,c){if(b.peek()=="}"){a--;if(a==0){c.tokenize.pop();return c.tokenize[c.tokenize.length-1](b,c)}}else b.peek()=="{"&&a++;return j(b,c)}}function j(a,b){h=null;if(a.sol()&&a.match("=begin")&&a.eol()){b.tokenize.push(n);return"comment"}if(a.eatSpace())return null;var c=a.next();if(c=="`"||c=="'"||c=='"'||c=="/")return i(l(c,"string",c=='"'),a,b);if(c=="%"){var d,e=!1;a.eat("s")?d="atom":a.eat(/[WQ]/)?(d="string",e=!0):a.eat(/[wxqr]/)&&(d="string");var f=a.eat(/[^\w\s]/);if(!f)return"operator";g.propertyIsEnumerable(f)&&(f=g[f]);return i(l(f,d,e,!0),a,b)}if(c=="#"){a.skipToEnd();return"comment"}if(c=="<"&&a.eat("<")){a.eat("-"),a.eat(/[\'\"\`]/);var j=a.match(/^\w+/);a.eat(/[\'\"\`]/);return j?i(m(j[0]),a,b):null}if(c=="0"){a.eat("x")?a.eatWhile(/[\da-fA-F]/):a.eat("b")?a.eatWhile(/[01]/):a.eatWhile(/[0-7]/);return"number"}if(/\d/.test(c)){a.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return"number"}if(c=="?"){while(a.match(/^\\[CM]-/));a.eat("\\")?a.eatWhile(/\w/):a.next();return"string"}if(c==":"){if(a.eat("'"))return i(l("'","atom",!1),a,b);if(a.eat('"'))return i(l('"',"atom",!0),a,b);a.eatWhile(/[\w\?]/);return"atom"}if(c=="@"){a.eat("@"),a.eatWhile(/[\w\?]/);return"variable-2"}if(c=="$"){a.next(),a.eatWhile(/[\w\?]/);return"variable-3"}if(/\w/.test(c)){a.eatWhile(/[\w\?]/);return a.eat(":")?"atom":"ident"}if(c!="|"||!b.varList&&b.lastTok!="{"&&b.lastTok!="do"){if(/[\(\)\[\]{}\\;]/.test(c)){h=c;return null}if(c=="-"&&a.eat(">"))return"arrow";if(/[=+\-\/*:\.^%<>~|]/.test(c)){a.eatWhile(/[=+\-\/*:\.^%<>~|]/);return"operator"}return null}h="|";return null}function i(a,b,c){c.tokenize.push(a);return a(b,c)}function c(a){var b={};for(var c=0,d=a.length;c<d;++c)b[a[c]]=!0;return b}var d=c(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload"]),e=c(["def","class","case","for","while","do","module","then","unless","catch","loop","proc"]),f=c(["end","until"]),g={"[":"]","{":"}","(":")"},h;return{startState:function(){return{tokenize:[j],indented:0,context:{type:"top",indented:-a.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(a,b){a.sol()&&(b.indented=a.indentation());var c=b.tokenize[b.tokenize.length-1](a,b),g;if(c=="ident"){var i=a.current();c=d.propertyIsEnumerable(a.current())?"keyword":/^[A-Z]/.test(i)?"tag":b.lastTok=="def"||b.lastTok=="class"||b.varList?"def":"variable",e.propertyIsEnumerable(i)?g="indent":f.propertyIsEnumerable(i)?g="dedent":i=="if"&&a.column()==a.indentation()&&(g="indent")}if(h||c&&c!="comment")b.lastTok=i||h||c;h=="|"&&(b.varList=!b.varList),g=="indent"||/[\(\[\{]/.test(h)?b.context={prev:b.context,type:h||c,indented:b.indented}:(g=="dedent"||/[\)\]\}]/.test(h))&&b.context.prev&&(b.context=b.context.prev),a.eol()&&(b.continuedLine=h=="\\"||c=="operator");return c},indent:function(b,c){if(b.tokenize[b.tokenize.length-1]!=j)return 0;var d=c&&c.charAt(0),e=b.context,f=e.type==g[d]||e.type=="keyword"&&/^(?:end|until|else|elsif|when)\b/.test(c);return e.indented+(f?0:a.indentUnit)+(b.continuedLine?a.indentUnit:0)}}}),CodeMirror.defineMIME("text/x-ruby","ruby")