require(["tp/plugins/profileRepository"],function(a){(function(){module("profile repository tests",{setup:function(){this.profile={name:"test"},this.failResponse={responseText:'[{"FieldName":"Url", "Message":"Url should not be empty"},{"FieldName":"Login", "Message":"Login should not be empty"}]',status:400},this.publishedMessages=[],this.profileRepository=a;var b=this;this.profileRepository.bus={publish:function(a,c){b.publishedMessages.push({message:a,data:c})}}},teardown:function(){}}),test("should publish ProfileSaveSucceed message when new profile saved successfully",function(){expect(2),this.profileRepository.gateway={postJSON:function(a,b,c){c()}},this.profileRepository.create(this.profile),equal(this.publishedMessages.length,1,"One message published"),equal(this.publishedMessages[0].message,"ProfileSaveSucceed","ProfileSaveSucceed message published")}),test("should publish ProfileSaveSucceed message when profile updated successfully",function(){expect(2),this.profileRepository.gateway={postJSON:function(a,b,c){c()}},this.profileRepository.update(this.profile),equal(this.publishedMessages.length,1,"One message published"),equal(this.publishedMessages[0].message,"ProfileSaveSucceed","ProfileSaveSucceed message published")}),test("should publish ProfileSaveFailed when profile save failed",function(){expect(4);var a=this;this.profileRepository.gateway={postJSON:function(b,c,d,e){e(a.failResponse)}},this.profileRepository.update(this.profile),equal(this.publishedMessages.length,1,"One message published"),equal(this.publishedMessages[0].message,"ProfileSaveFailed","ProfileSaveFailed message published"),deepEqual(this.publishedMessages[0].data[0].data,JSON.parse(this.failResponse.responseText),"Response data parsed"),equal(this.publishedMessages[0].data[0].rawResponse,this.failResponse,"Raw response provided")}),test("should publish ProfileSaveFailed when profile save finished with error",function(){expect(3);var a=this;this.profileRepository.gateway={postJSON:function(b,c,d,e,f){f(a.failResponse)}},this.profileRepository.update(this.profile),equal(this.publishedMessages.length,1,"One message published"),equal(this.publishedMessages[0].message,"ProfileSaveFailed","ProfileSaveFailed message published"),equal(this.publishedMessages[0].data[0].rawResponse,this.failResponse,"Raw response provided")}),test("should get current profile during profile edit",function(){expect(1);var a=this;this.profileRepository.profileNameSource={getProfileName:function(){return"test"}},this.profileRepository.gateway={getJSON:function(b,c){c(a.profile)}},this.profileRepository.getCurrentProfile(function(b){equal(b,a.profile,"Profile retrieved")})}),test("should get current profile during new profile creation",function(){expect(1);var a=this;this.profileRepository.profileNameSource={getProfileName:function(){return""}},this.profileRepository.gateway={getJSON:function(b,c){c(a.profile)}},this.profileRepository.getCurrentProfile(function(b){notEqual(b,a.profile,"Profile not retrived")})})})()})