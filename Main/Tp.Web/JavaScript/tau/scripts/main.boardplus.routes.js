define(["require","app.path","tp/reports/service.chart.size","jQuery"],function(e){function t(e,t,r){var o=null,n=!1,i={fields:["acid"],callback:function(r){o=r.acid,n=!1,taus.context({"@":"--app-context-core",host:a.get(),version:e.getSystemInfo().version,path:t,user:e.getLoggedUser(),acid:r.acid})}};e.getAppStateStore().bind(i),e.getAppStateStore().get({fields:i.fields,callback:function(e){i.callback(e),r()}}),e.getApplicationContextService().onApplicationContextRetrieved.add(function(e){e.acid!==o||n||(n=!0,taus.track("appContext",{"@":"--app-context-teams-projects",projects:e.selectedProjectIds,teams:e.selectedTeamIds}))},!0)}var a=e("app.path"),r=e("tp/reports/service.chart.size"),o=e("jQuery");return{createApplicationRoutes:function(){return[{pattern:/start/,host:{name:"board_startScreen_h",type:"board.startScreen"},type:{name:"board_startScreen",type:"board.startScreen"}},{name:"process-setup-workflow",pattern:/process-setup\/(\d+)\/workflows\/([a-z]+)/,adapter:function(e,t){this.resolve({processId:parseInt(e,10),optionGroupId:"workflows",entityType:t})},host:{name:"board_host",type:"master.board"},type:{name:"setup workflow",type:"setup.workflow"}},{name:"process-setup-terms",pattern:/process-setup\/(\d+)\/terms/,host:{name:"board_host",type:"master.board"},adapter:function(e){this.resolve({processId:parseInt(e,10),optionGroupId:"terms"})},type:{name:"terms",type:"terms"}},{name:"process-setup-general",pattern:/process-setup\/(\d+)\/([a-z\-]+)/,adapter:function(e,t){this.resolve({processId:parseInt(e,10),optionGroupId:t})},host:{name:"board_host",type:"master.board"},type:{name:"setup process",type:"setup.process"}},{pattern:/invite/,adapter:function(){var e=this.configurator,t=e.getHelpScenarioService(),a=t.getAvailableFlows().scratch;t.setCurrentFlow(a.id),t.setState(t.stateTypes.ToBeStarted),e.getRouting().redirect(e.getUrlBuilder().getRelativeBoardUrl("current"))},host:{name:"board_host",type:"master.board"},type:{name:"board_page",type:"page.board"}},{pattern:/report\/(\d+)/,adapter:function(e){var t=this.configurator;
t.registerService("chart.size",new r),this.resolve({id:e,entity:"report"})},host:{name:"board_host",type:"master.board"},type:{name:"report_page",type:"page.report"}},{pattern:/board\/last/,adapter:function(){var e=this.configurator,t=e.getRouting().restoreReferer(),a=e.getUrlBuilder();if(t&&t.id){var r=e.getBoardDefinitionFactory();r.findLast(t.id).done(function(t){var r;r=t?a.getRelativeBoardUrl(t.id,t.acid||void 0):a.getRelativeBoardUrl("current"),e.getRouting().redirect(r)})}else e.getRouting().redirect(a.getRelativeBoardUrl("current"))},host:{name:"board_host",type:"master.board"},type:{name:"board_page",type:"page.board"}},{pattern:/board\/current/,adapter:function(){var e=this.configurator;e.getGlobalBus().fire("applicationStart");var t=e.getAppStateStore().settings.acid||void 0,a=e.getBoardDefinitionFactory();a.findDefaultForLoggedUser().done(function(r){var n=o.Deferred();r?n.resolve(r):a.createBoard().done(function(e){n.resolve(e)}),n.done(function(a){var r=e.getUrlBuilder();e.getRouting().redirect(r.getRelativeBoardUrl(a.id,a.acid||t))})})},host:{name:"board_host",type:"master.board"},type:{name:"board_page",type:"page.board"}},{pattern:/board\/([\w|0-9]+)/,adapter:function(e){var a=this,r=this.configurator,o=r.getBoardDefinitionFactory();r.getRestStorage()._cache={};var n={id:["board",e].join("/"),type:"board",args:e},i=function(){o.getById(e).done(function(e){a.resolve({id:e.id,entity:"board"})}).fail(function(){r.getRouting().redirect(r.getUrlBuilder().getRelativeBoardUrl("current"))})};t(r,n,i)},host:{name:"board_host",type:"master.board"},type:{name:"board_page",type:"page.board"}},{pattern:/finish-(\w+)\/([0-9]+)/,adapter:function(e,t){this.resolve({entity:{id:parseInt(t,10),type:e}})},host:{name:"board_host",type:"master.board"},type:{name:"entity component",type:"page.finish-iteration"}},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,adapter:function(e,a){var r=this,o=this.configurator,n=taus.start("statistics_view",{"@":["--add-last-view-entity-context",function(e){var t="@timing";
return e.loadTime=e[t],delete e[t],e}],entity:{id:a,type:e.toLowerCase()}}),i={id:[e,a].join("/"),type:e,args:a},s=function(){taus.track({"@":["--save-last-view-entity-context"],action:"view entity",name:"view "+e+" #"+a,tags:["view entity"],type:e,id:a}),r.resolve({entity:{id:parseInt(a,10),type:e},action:"show",cssClass:"tau-app tau-page-single tau-page-entity i-role-bubble-holder",handlers:{onPageLoaded:function(){n.stop()}}})};t(o,i,s)},host:{name:"board_host",type:"master.board"},type:{name:"entity component",type:"page.entity",comet:{enabled:!0}}},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,adapter:function(e,t,a){this.resolve({entity:{id:parseInt(t,10),type:e},action:a,cssClass:"tau-app tau-page-single tau-page-entity i-role-bubble-holder"})},host:{name:"board_host",type:"master.board"},type:{name:"entity component",type:"page.entity"}}]}}});