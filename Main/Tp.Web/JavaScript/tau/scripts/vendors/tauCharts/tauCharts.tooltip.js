!function(t){if("function"==typeof define&&define.amd)define(["tauCharts"],function(e){return t(e)});else if("object"==typeof module&&module.exports){{require("tauCharts")}module.exports=t()}else t(this.tauCharts)}(function(t){function e(t){return t=t||{},{template:['<div class="i-role-content graphical-report__tooltip__content"></div>','<div class="i-role-exclude graphical-report__tooltip__exclude">','<div class="graphical-report__tooltip__exclude__wrap">','<span class="tau-icon-close-gray"></span>Exclude',"</div>","</div>"].join(""),itemTemplate:['<div class="graphical-report__tooltip__list__item">','<div class="graphical-report__tooltip__list__elem"><%=label%></div>','<div class="graphical-report__tooltip__list__elem"><%=value%></div>',"</div>"].join(""),onExcludeData:function(){},_drawPoint:function(t,e,i,n){this.circle&&this.circle.remove(),this.circle=t.append("circle").attr("cx",e).attr("cy",i).attr("class",n).attr("r",4),this.circle.node().addEventListener("mouseover",function(){clearTimeout(this._timeoutHideId)}.bind(this),!1),this.circle.node().addEventListener("mouseleave",function(){this._hide()}.bind(this),!1)},formatters:{},_getFormatter:function(t){return this.formatters[t]||i.identity},init:function(e){this._chart=e,this._dataFields=t.fields,this._getDataFields=t.getFields,i.extend(this,i.omit(t,"fields","getFields")),this._timeoutHideId=null,this._dataWithCoords={},this._unitMeta={},this._templateItem=i.template(this.itemTemplate),this._tooltip=e.addBalloon({spacing:3,auto:!0,effectClass:"fade"}),this._elementTooltip=this._tooltip.getElement();var n=this._elementTooltip;n.addEventListener("mouseover",function(){clearTimeout(this._timeoutHideId)}.bind(this),!1),n.addEventListener("mouseleave",function(){this._hide()}.bind(this),!1),n.addEventListener("click",function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.classList.contains("i-role-exclude")&&(this._exclude(),this._hide()),e=e.parentNode}.bind(this),!1),n.insertAdjacentHTML("afterbegin",this.template)
},onUnitReady:function(t,e){if(e.type&&0===e.type.indexOf("ELEMENT")){var i=this._generateKey(e.$where);this._unitMeta[i]=e;var n=e.partition();this._dataWithCoords[i]=n.map(function(t){return{x:e.options.xScale(t[e.x.scaleDim]),y:e.options.yScale(t[e.y.scaleDim]),item:t}},this)}},render:function(t,e){return e=i.unique(e),e.map(function(e){var n=t[e],o=i.isNull(n)||i.isUndefined(n)?"No "+e:n;return this._templateItem({label:e,value:this._getFormatter(e)(o)})},this).join("")},onRender:function(t){i.isFunction(this._getDataFields)&&(this._dataFields=this._getDataFields(t)),this._hide()},_exclude:function(){this._chart.addFilter({tag:"exclude",predicate:function(t){return function(e){return JSON.stringify(e)!==JSON.stringify(t)}}(this._currentElement)}),this.onExcludeData(this._currentElement)},_calculateLength:function(t,e,i,n){return(i-t)*(i-t)+(n-e)*(n-e)},_calculateLengthToLine:function(t,e,i,n,s,r){var a={x:i-t,y:n-e},l={x:s-t,y:r-e},c=a.x*l.x+a.y*l.y;if(0>c)return o(t,s,e,r);var u={x:t-i,y:e-n},d={x:s-i,y:r-n},h=u.x*d.x+u.y*d.y;return 0>h?o(i,s,n,r):Math.abs(((i-t)*(r-e)-(n-e)*(s-t))/o(t,i,e,n))},_generateKey:function(t){return JSON.stringify(t)},_getFields:function(t){if(this._dataFields)return this._dataFields;for(var e=[t.size&&t.size.scaleDim,t.color&&t.color.scaleDim],n=[],o=[];t=t.parentUnit;)n.push(t.x.scaleDim),o.push(t.y.scaleDim);return i.compact(e.concat(o,n).reverse())},isLine:function(t){return t.elementData.key&&Array.isArray(t.elementData.values)},_onElementMouseOver:function(t,e,o,s){clearTimeout(this._timeoutHideId);var r=this._generateKey(e.cellData.$where),a=e.elementData,l=this.isLine(e);if(l){var c=this._dataWithCoords[r],u=c.filter(function(t){return i.contains(a.values,t.item)}),d=i.reduce(u,function(t,e,i,n){var s;if(i+1===n.length){var r=e;e=n[i-1],s=r}else s=n[i+1];var a=this._calculateLengthToLine(e.x,e.y,s.x,s.y,o[0],o[1]);return a<t.h&&(t.h=a,t.points={point1:e,point2:s}),t}.bind(this),{h:1/0,points:{}}),h=i.min(d.points,function(t){return this._calculateLength(t.x,t.y,o[0],o[1])
},this);a=h.item,this._drawPoint(n.select(e.element.parentNode),h.x,h.y,this._unitMeta[r].options.color.get(e.elementData.key))}if(this._currentElement!==a){var _=this._elementTooltip.querySelectorAll(".i-role-content");if(_[0]){var m=this._getFields(this._unitMeta[r]);_[0].innerHTML=this.render(a,m)}else console.log("template should contain i-role-content class");this._show(s),this._currentElement=a}},onElementMouseOver:function(t,e){var o=n.mouse(document.body),s=n.mouse(e.element);clearTimeout(this._timeoutShowId),this._timeoutShowId=i.delay(this._onElementMouseOver.bind(this),200,t,e,s,o)},onElementMouseOut:function(){this._hide()},_show:function(t){this._tooltip.show(t[0],t[1]).updateSize()},_hide:function(){clearTimeout(this._timeoutShowId),this._timeoutHideId=setTimeout(function(){this._currentElement=null,this._tooltip.hide(),this.circle&&this.circle.remove()}.bind(this),300)},_destroyTooltip:function(){this.circle&&this.circle.remove(),this._tooltip.destroy()},destroy:function(){this._destroyTooltip()}}}var i=t.api._,n=t.api.d3,o=function(t,e,i,n){return Math.sqrt((e-t)*(e-t)+(n-i)*(n-i))};return t.api.plugins.add("tooltip",e),e});