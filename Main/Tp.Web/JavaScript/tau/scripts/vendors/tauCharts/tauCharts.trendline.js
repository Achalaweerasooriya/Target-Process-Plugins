!function(e){if("function"==typeof define&&define.amd)define(["tauCharts"],function(t){return e(t)});else if("object"==typeof module&&module.exports){{require("tauCharts")}module.exports=e()}else e(this.tauCharts)}(function(e){function t(e){var t=n.defaults(e||{},{type:"linear",showPanel:!0,showTrend:!0});return{init:function(e){this._chart=e,t.showPanel&&(this._container=e.insertToRightSidebar(this.containerTemplate),this.isApplicable=!0,this.uiChangeEventsDispatcher=function(e){var r=e.target,n=r.classList;n.contains("i-role-show-trend")&&(t.showTrend=r.checked),n.contains("i-role-change-model")&&(t.type=r.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1))},onUnitReady:function(e,s){if(t.showTrend&&l(s)){if(!o(s))return this.error="Trend line can't be computed for categorical data. Each axis should be either a measure or a date.",void(this.isApplicable=!1);var h=s.options,c=s.x.scaleDim,p=s.y.scaleDim,u=s.color.scaleDim,d=s.scaleMeta(p,s.guide.y).values,f=n.min(d),g=n.max(d),v=s.groupBy(s.partition(),u);v.forEach(function(e,a){var o=e.key,l=e.values,s=l.map(function(e){var t=n.isDate(e[c])?e[c].getTime():e[c],r=n.isDate(e[p])?e[p].getTime():e[p];return[t,r]}),u=r(t.type,s),d=n(u.points).chain().sortBy(function(e){return e[0]}).filter(function(e){return f<=e[1]&&e[1]<=g}).value();d.length>1&&i("i-trendline-"+a,d,h.xScale,h.yScale,h.color.get(o),h.container)});var _=function(e){return function(){var t=a.select(this);t.classed({active:e,"graphical-report__line-width-1":!e,"graphical-report__line-width-2":e})}};h.container.selectAll(".graphical-report__trendline").on("mouseenter",_(!0)).on("mouseleave",_(!1))}},containerTemplate:'<div class="graphical-report__trendlinepanel"></div>',template:n.template(['<label class="graphical-report__trendlinepanel__title graphical-report__checkbox">','<input type="checkbox" class="graphical-report__checkbox__input i-role-show-trend" <%= showTrend %> />','<span class="graphical-report__checkbox__icon"></span>','<span class="graphical-report__checkbox__text">',"<%= title %>","</span>","</label>","<div>",'<select class="i-role-change-model graphical-report__select graphical-report__trendlinepanel__control">',"<%= models %> />","</select>","</div>",'<div class="graphical-report__trendlinepanel__error-message"><%= error %></div>'].join("")),onRender:function(){if(this._container){var e=this.isApplicable?"applicable-true":"applicable-false",r=this.isApplicable?"applicable-false":"applicable-true";
this._container.classList.add(e),this._container.classList.remove(r),this._container.innerHTML=this.template({title:"Trend line",error:this.error,showTrend:t.showTrend&&this.isApplicable?"checked":"",models:["linear","exponential","logarithmic"].map(function(e){var r=t.type===e?"selected":"";return"<option "+r+' value="'+e+'">'+e+"</option>"})})}}}}var r=function(){"use strict";var e=function(e,t){var r=0,n=0,a=0,i=0,o=0,l=e.length-1,s=new Array(t);for(r=0;l>r;r++){for(i=r,n=r+1;l>n;n++)Math.abs(e[r][n])>Math.abs(e[r][i])&&(i=n);for(a=r;l+1>a;a++)o=e[a][r],e[a][r]=e[a][i],e[a][i]=o;for(n=r+1;l>n;n++)for(a=l;a>=r;a--)e[a][n]-=e[a][r]*e[r][n]/e[r][r]}for(n=l-1;n>=0;n--){for(o=0,a=n+1;l>a;a++)o+=e[a][n]*s[a];s[n]=(e[l][n]-o)/e[n][n]}return s},t={linear:function(e){for(var t=[0,0,0,0,0],r=0,n=[];r<e.length;r++)e[r][1]&&(t[0]+=e[r][0],t[1]+=e[r][1],t[2]+=e[r][0]*e[r][0],t[3]+=e[r][0]*e[r][1],t[4]+=e[r][1]*e[r][1]);var a=(r*t[3]-t[0]*t[1])/(r*t[2]-t[0]*t[0]);a=isNaN(a)?0:a;for(var i=t[1]/r-a*t[0]/r,o=0,l=e.length;l>o;o++){var s=[e[o][0],e[o][0]*a+i];n.push(s)}var h="y = "+Math.round(100*a)/100+"x + "+Math.round(100*i)/100;return{equation:[a,i],points:n,string:h}},exponential:function(e){var t=[0,0,0,0,0,0],r=0,n=[];for(s=e.length;s>r;r++)e[r][1]&&(t[0]+=e[r][0],t[1]+=e[r][1],t[2]+=e[r][0]*e[r][0]*e[r][1],t[3]+=e[r][1]*Math.log(e[r][1]),t[4]+=e[r][0]*e[r][1]*Math.log(e[r][1]),t[5]+=e[r][0]*e[r][1]);for(var a=t[1]*t[2]-t[5]*t[5],i=Math.pow(Math.E,(t[2]*t[3]-t[5]*t[4])/a),o=(t[1]*t[4]-t[5]*t[3])/a,l=0,s=e.length;s>l;l++){var h=[e[l][0],i*Math.pow(Math.E,o*e[l][0])];n.push(h)}var c="y = "+Math.round(100*i)/100+"e^("+Math.round(100*o)/100+"x)";return{equation:[i,o],points:n,string:c}},logarithmic:function(e){var t=[0,0,0,0],r=0,n=[];for(l=e.length;l>r;r++)e[r][1]&&(t[0]+=Math.log(e[r][0]),t[1]+=e[r][1]*Math.log(e[r][0]),t[2]+=e[r][1],t[3]+=Math.pow(Math.log(e[r][0]),2));for(var a=(r*t[1]-t[2]*t[0])/(r*t[3]-t[0]*t[0]),i=(t[2]-a*t[0])/r,o=0,l=e.length;l>o;o++){var s=[e[o][0],i+a*Math.log(e[o][0])];
n.push(s)}var h="y = "+Math.round(100*i)/100+" + "+Math.round(100*a)/100+" ln(x)";return{equation:[i,a],points:n,string:h}},power:function(e){var t=[0,0,0,0],r=0,n=[];for(l=e.length;l>r;r++)e[r][1]&&(t[0]+=Math.log(e[r][0]),t[1]+=Math.log(e[r][1])*Math.log(e[r][0]),t[2]+=Math.log(e[r][1]),t[3]+=Math.pow(Math.log(e[r][0]),2));for(var a=(r*t[1]-t[2]*t[0])/(r*t[3]-t[0]*t[0]),i=Math.pow(Math.E,(t[2]-a*t[0])/r),o=0,l=e.length;l>o;o++){var s=[e[o][0],i*Math.pow(e[o][0],a)];n.push(s)}var h="y = "+Math.round(100*i)/100+"x^"+Math.round(100*a)/100;return{equation:[i,a],points:n,string:h}},polynomial:function(t,r){"undefined"==typeof r&&(r=2);for(var n=[],a=[],i=[],o=0,l=0,s=0,h=r+1;h>s;s++){for(var c=0,p=t.length;p>c;c++)t[c][1]&&(o+=Math.pow(t[c][0],s)*t[c][1]);n.push(o),o=0;for(var u=[],d=0;h>d;d++){for(var c=0,p=t.length;p>c;c++)t[c][1]&&(l+=Math.pow(t[c][0],s+d));u.push(l),l=0}a.push(u)}a.push(n);for(var f=e(a,h),s=0,p=t.length;p>s;s++){for(var g=0,v=0;v<f.length;v++)g+=f[v]*Math.pow(t[s][0],v);i.push([t[s][0],g])}for(var _="y = ",s=f.length-1;s>=0;s--)_+=s>1?Math.round(100*f[s])/100+"x^"+s+" + ":1==s?Math.round(100*f[s])/100+"x + ":Math.round(100*f[s])/100;return{equation:f,points:i,string:_}},lastvalue:function(e){for(var t=[],r=null,n=0;n<e.length;n++)e[n][1]?(r=e[n][1],t.push([e[n][0],e[n][1]])):t.push([e[n][0],r]);return{equation:[r],points:t,string:""+r}}};return function(e,r,n){return"string"==typeof e?t[e](r,n):void 0}}(),n=e.api._,a=e.api.d3,i=function(e,t,r,n,i,o){var l=["graphical-report__trendline","graphical-report__line","i-role-element","graphical-report__line-width-1","graphical-report__line-opacity-1",e,i].join(" "),s=a.svg.line().x(function(e){return r(e[0])}).y(function(e){return n(e[1])}),h=function(){this.attr("d",s)},c=function(){this.attr("class",l);var e=this.selectAll("path").data(function(e){return[e]});e.call(h),e.enter().append("path").call(h),e.exit().remove()},p=o.selectAll("."+e).data([t]);p.call(c),p.enter().append("g").call(c),p.exit().remove()
},o=function(e){var t=e.type&&0===e.type.indexOf("ELEMENT.");if(!t)return!1;var r=e.x.dimType,a=e.y.dimType;return n.every([r,a],function(e){return e&&"category"!=e})},l=function(e){return e.type&&0===e.type.indexOf("ELEMENT.")};return e.api.plugins.add("trendline",t),t});