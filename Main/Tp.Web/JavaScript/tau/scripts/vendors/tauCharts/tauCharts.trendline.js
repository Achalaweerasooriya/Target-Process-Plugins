!function(t){if("function"==typeof define&&define.amd)define(["tauCharts"],function(e){return t(e)});else if("object"==typeof module&&module.exports){var e=require("tauCharts");module.exports=t(e)}else t(this.tauCharts)}(function(t){function e(t){var e=n.defaults(t||{},{type:"linear",hideError:!1,showPanel:!0,showTrend:!0,models:["linear","exponential","logarithmic"]});return{init:function(t){this._chart=t;var r=t.getConfig();if(this._isApplicable=h(r.spec.unit,s(r.spec.dimensions)),e.showPanel){this._container=t.insertToRightSidebar(this.containerTemplate);var n=this._isApplicable?"applicable-true":"applicable-false";this._isApplicable||(this._error="Trend line can't be computed for categorical data. Each axis should be either a measure or a date."),this._container.classList.add(n),e.hideError&&this._container.classList.add("hide-trendline-error"),this.uiChangeEventsDispatcher=function(t){var r=t.target,n=r.classList;n.contains("i-role-show-trend")&&(e.showTrend=r.checked),n.contains("i-role-change-model")&&(e.type=r.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1)}},onUnitReady:function(t,l){if(e.showTrend&&o(l)&&this._isApplicable){var s=l.options,h=l.x.scaleDim,c=l.y.scaleDim,u=l.color.scaleDim,p=l.scaleMeta(c,l.guide.y).values,f=n.min(p),d=n.max(p),v=l.groupBy(l.partition(),u);v.forEach(function(t,a){var o=t.key,l=t.values,u=l.map(function(t){var e=n.isDate(t[h])?t[h].getTime():t[h],r=n.isDate(t[c])?t[c].getTime():t[c];return[e,r]}),p=r(e.type,u),v=n(p.points).chain().sortBy(function(t){return t[0]}).filter(function(t){return f<=t[1]&&t[1]<=d}).value();v.length>1&&i("i-trendline-"+a,v,s.xScale,s.yScale,s.color(o),s.container,l)});var g=function(t){return function(){var e=a.select(this);e.classed({active:t,"graphical-report__line-width-1":!t,"graphical-report__line-width-2":t})}};s.container.selectAll(".graphical-report__trendline").on("mouseenter",g(!0)).on("mouseleave",g(!1))}},containerTemplate:'<div class="graphical-report__trendlinepanel"></div>',template:n.template(['<label class="graphical-report__trendlinepanel__title graphical-report__checkbox">','<input type="checkbox" class="graphical-report__checkbox__input i-role-show-trend" <%= showTrend %> />','<span class="graphical-report__checkbox__icon"></span>','<span class="graphical-report__checkbox__text">',"<%= title %>","</span>","</label>","<div>",'<select class="i-role-change-model graphical-report__select graphical-report__trendlinepanel__control">',"<%= models %> />","</select>","</div>",'<div class="graphical-report__trendlinepanel__error-message"><%= error %></div>'].join("")),onRender:function(){this._container&&(this._container.innerHTML=this.template({title:"Trend line",error:this._error,showTrend:e.showTrend&&this._isApplicable?"checked":"",models:e.models.map(function(t){var r=e.type===t?"selected":"";
return"<option "+r+' value="'+t+'">'+t+"</option>"})}))}}}var r=function(){"use strict";var t=function(t,e){var r=0,n=0,a=0,i=0,o=0,l=t.length-1,s=new Array(e);for(r=0;l>r;r++){for(i=r,n=r+1;l>n;n++)Math.abs(t[r][n])>Math.abs(t[r][i])&&(i=n);for(a=r;l+1>a;a++)o=t[a][r],t[a][r]=t[a][i],t[a][i]=o;for(n=r+1;l>n;n++)for(a=l;a>=r;a--)t[a][n]-=t[a][r]*t[r][n]/t[r][r]}for(n=l-1;n>=0;n--){for(o=0,a=n+1;l>a;a++)o+=t[a][n]*s[a];s[n]=(t[l][n]-o)/t[n][n]}return s},e={linear:function(t){for(var e=[0,0,0,0,0],r=0,n=[];r<t.length;r++)t[r][1]&&(e[0]+=t[r][0],e[1]+=t[r][1],e[2]+=t[r][0]*t[r][0],e[3]+=t[r][0]*t[r][1],e[4]+=t[r][1]*t[r][1]);var a=(r*e[3]-e[0]*e[1])/(r*e[2]-e[0]*e[0]);a=isNaN(a)?0:a;for(var i=e[1]/r-a*e[0]/r,o=0,l=t.length;l>o;o++){var s=[t[o][0],t[o][0]*a+i];n.push(s)}var h="y = "+Math.round(100*a)/100+"x + "+Math.round(100*i)/100;return{equation:[a,i],points:n,string:h}},exponential:function(t){var e=[0,0,0,0,0,0],r=0,n=[];for(s=t.length;s>r;r++)t[r][1]&&(e[0]+=t[r][0],e[1]+=t[r][1],e[2]+=t[r][0]*t[r][0]*t[r][1],e[3]+=t[r][1]*Math.log(t[r][1]),e[4]+=t[r][0]*t[r][1]*Math.log(t[r][1]),e[5]+=t[r][0]*t[r][1]);for(var a=e[1]*e[2]-e[5]*e[5],i=Math.pow(Math.E,(e[2]*e[3]-e[5]*e[4])/a),o=(e[1]*e[4]-e[5]*e[3])/a,l=0,s=t.length;s>l;l++){var h=[t[l][0],i*Math.pow(Math.E,o*t[l][0])];n.push(h)}var c="y = "+Math.round(100*i)/100+"e^("+Math.round(100*o)/100+"x)";return{equation:[i,o],points:n,string:c}},logarithmic:function(t){var e=[0,0,0,0],r=0,n=[];for(l=t.length;l>r;r++)t[r][1]&&(e[0]+=Math.log(t[r][0]),e[1]+=t[r][1]*Math.log(t[r][0]),e[2]+=t[r][1],e[3]+=Math.pow(Math.log(t[r][0]),2));for(var a=(r*e[1]-e[2]*e[0])/(r*e[3]-e[0]*e[0]),i=(e[2]-a*e[0])/r,o=0,l=t.length;l>o;o++){var s=[t[o][0],i+a*Math.log(t[o][0])];n.push(s)}var h="y = "+Math.round(100*i)/100+" + "+Math.round(100*a)/100+" ln(x)";return{equation:[i,a],points:n,string:h}},power:function(t){var e=[0,0,0,0],r=0,n=[];for(l=t.length;l>r;r++)t[r][1]&&(e[0]+=Math.log(t[r][0]),e[1]+=Math.log(t[r][1])*Math.log(t[r][0]),e[2]+=Math.log(t[r][1]),e[3]+=Math.pow(Math.log(t[r][0]),2));
for(var a=(r*e[1]-e[2]*e[0])/(r*e[3]-e[0]*e[0]),i=Math.pow(Math.E,(e[2]-a*e[0])/r),o=0,l=t.length;l>o;o++){var s=[t[o][0],i*Math.pow(t[o][0],a)];n.push(s)}var h="y = "+Math.round(100*i)/100+"x^"+Math.round(100*a)/100;return{equation:[i,a],points:n,string:h}},polynomial:function(e,r){"undefined"==typeof r&&(r=2);for(var n=[],a=[],i=[],o=0,l=0,s=0,h=r+1;h>s;s++){for(var c=0,u=e.length;u>c;c++)e[c][1]&&(o+=Math.pow(e[c][0],s)*e[c][1]);n.push(o),o=0;for(var p=[],f=0;h>f;f++){for(var c=0,u=e.length;u>c;c++)e[c][1]&&(l+=Math.pow(e[c][0],s+f));p.push(l),l=0}a.push(p)}a.push(n);for(var d=t(a,h),s=0,u=e.length;u>s;s++){for(var v=0,g=0;g<d.length;g++)v+=d[g]*Math.pow(e[s][0],g);i.push([e[s][0],v])}for(var _="y = ",s=d.length-1;s>=0;s--)_+=s>1?Math.round(100*d[s])/100+"x^"+s+" + ":1==s?Math.round(100*d[s])/100+"x + ":Math.round(100*d[s])/100;return{equation:d,points:i,string:_}},lastvalue:function(t){for(var e=[],r=null,n=0;n<t.length;n++)t[n][1]?(r=t[n][1],e.push([t[n][0],t[n][1]])):e.push([t[n][0],r]);return{equation:[r],points:e,string:""+r}},loess:function(t){function e(t,e){var n=t.map(function(t){return t[0]}),a=t.map(function(t){return t[1]}),i=r(n,a,e);return n.map(function(t,e){return[t,i[e]]})}function r(t,e,r){function n(t){var e=1-t*t*t;return e*e*e}for(var a=[],i=0,o=Math.floor(r*t.length)-1,l=0;l<t.length;l++){var s=t[l];l>0&&o<t.length-1&&t[o+1]-t[l]<t[l]-t[i]&&(i++,o++);var h;h=t[l]-t[i]>t[o]-t[l]?i:o;for(var c=Math.abs(1/(t[h]-s)),u=0,p=0,f=0,d=0,v=0,g=i;o>=g;){var _,M=t[g],m=e[g];_=l>g?s-M:M-s;var y=n(_*c),x=M*y;u+=y,p+=x,f+=M*x,d+=m*y,v+=m*x,g++}var w,b=p/u,T=d/u,E=v/u,A=f/u;w=A==b*b?0:(E-b*T)/(A-b*b);var k=T-w*b;a[l]=w*s+k}return a}return{equation:"loess",points:e(t,.5),string:"loess"}}};return function(t,r,n){return"string"==typeof t?e[t](r,n):void 0}}(),n=t.api._,a=t.api.d3,i=function(t,e,r,n,i,o,l){var s=["graphical-report__trendline","graphical-report__line","i-role-element","graphical-report__line-width-1","graphical-report__line-opacity-1",t,i].join(" "),h=a.svg.line().interpolate("basis").x(function(t){return r(t[0])
}).y(function(t){return n(t[1])}),c=function(){this.attr("d",h)},u=function(){this.attr("class",s);var t=this.selectAll("path").data(function(t){return[t.dots]});t.call(c),t.enter().append("path").call(c),t.exit().remove()},p=o.selectAll("."+t).data([{dots:e,values:l}]);p.call(u),p.enter().append("g").call(u),p.exit().remove()},o=function(t){return t.type&&0===t.type.indexOf("ELEMENT.")},l=function(t){return n.any(t,function(t){return o(t)})},s=function(t){return function(e){var r=e.type&&0===e.type.indexOf("COORDS.")&&l(e.unit);if(!r)return!1;var a=t[e.x].type,i=t[e.y].type;return n.every([a,i],function(t){return t&&"category"!==t})}},h=function(t,e){if(e(t))return t;var r,n,a,i=t.unit||[];for(r=0;r<i.length;r+=1)if(n=i[r],a=h(n,e))return a};return t.api.plugins.add("trendline",e),e});