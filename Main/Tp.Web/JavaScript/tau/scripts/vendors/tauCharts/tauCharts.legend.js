!function(e){if("function"==typeof define&&define.amd)define(["tauCharts"],function(t){return e(t)});else if("object"==typeof module&&module.exports){{require("tauCharts")}module.exports=e()}else e(this.tauCharts)}(function(e){var t=function(e){if(e.color)return e;var i,n,r,l=e.unit||[];for(i=0;i<l.length;i+=1)if(n=l[i],r=t(n))return r},i=e.api._,n=e.api.d3,r=function(){return{_delegateEvent:function(e,t,i,n){e.addEventListener(t,function(e){for(var t=e.target;t!==e.currentTarget&&null!==t;)t.classList.contains(i)&&n(e,t),t=t.parentNode})},init:function(e){this._isNeedLegend(e)&&(this._currentFilters={},this._container=e.insertToRightSidebar(this._containerTemplate),this._delegateEvent(this._container,"click","graphical-report__legend__item",function(t,i){this._toggleLegendItem(i,e)}.bind(this)),this._delegateEvent(this._container,"mouseover","graphical-report__legend__item",function(t,i){this._highlightToggle(i,e,!0)}.bind(this)),this._delegateEvent(this._container,"mouseout","graphical-report__legend__item",function(t,i){this._highlightToggle(i,e,!1)}.bind(this)))},_highlightToggle:function(e,t,i){var r=t.getSVG(),l=n.select(r);if(e.classList.contains("disabled")&&(i=!1),i){var a=JSON.parse(e.getAttribute("data-value")),s=a.color;l.selectAll(".i-role-element").classed({"graphical-report__highlighted":!1}),l.selectAll(".i-role-element."+s).classed({"graphical-report__highlighted":!0}),l.classed({"graphical-report__highlighted_chart":!0})}else l.selectAll(".i-role-element").classed({"graphical-report__highlighted":!1}),l.classed({"graphical-report__highlighted_chart":!1})},_toggleLegendItem:function(e,t){var i=e.getAttribute("data-value"),n=this._currentFilters[i];if(n)this._currentFilters[i]=null,e.classList.remove("disabled"),t.removeFilter(n);else{this._currentFilters[i]=1;var r=JSON.parse(i),l={tag:"legend",predicate:function(e){return e[r.dimension]!=r.value}};e.classList.add("disabled"),this._currentFilters[i]=t.addFilter(l)}},_isNeedLegend:function(e){var i=e.getConfig();
return Boolean(t(i.spec.unit))},onUnitReady:function(e,t){-1!==t.type.indexOf("ELEMENT")&&(this._unit=t)},_getColorMap:function(e,t,n){var r=e.getData({excludeFilter:["legend"]}),l=i.map(r,function(e){return e[n]});return i.unique(l).reduce(function(e,i){return e[i]=t.get(i),e},{})},_containerTemplate:'<div class="graphical-report__legend"></div>',_template:i.template('<div class="graphical-report__legend__title"><%=name%></div><%=items%>'),_itemTemplate:i.template(["<div data-value='<%=value%>' class=\"graphical-report__legend__item <%=classDisabled%>\">",'<div class="graphical-report__legend__guide <%=color%>" ></div><%=label%>',"</div>"].join("")),onRender:function(e){if(this._container){var n=this._unit.options.color,r=n.dimension,l=this._getColorMap(e,n,r),a=e.getConfig(),s=t(a.spec.unit);s.guide=s.guide||{},s.guide.color=this._unit.guide.color,s.guide.color.brewer=l;var o=i.map(l,function(e,t){var n=JSON.stringify({dimension:r,value:t,color:e});return this._itemTemplate({color:e,classDisabled:this._currentFilters[n]?"disabled":"",label:i.escape(t),value:n})},this).join("");this._container.innerHTML=this._template({items:o,name:this._unit.guide.color.label.text||this._unit.options.color.dimension})}}}};return e.api.plugins.add("legend",r),r});