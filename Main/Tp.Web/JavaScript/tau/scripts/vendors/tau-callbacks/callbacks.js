!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["underscore"],e):"object"==typeof exports?module.exports=e(require("underscore")):t.Callbacks=e(_)}(this,function(t){"use strict";var e=function(){this._subscriptions=[],this._bufferEntries=0,this._bufferArguments=null};return e.prototype={_subscriptions:null,add:function(t,e){var r=this._findHandlerIndex(t,e);return 0>r&&this._subscriptions.push({handler:t,scope:e}),this},once:function(t,e){var r=this._findHandlerIndex(t,e);return 0>r&&this._subscriptions.push({handler:function(t,e,r){t.call(e,r),this._removeHandler(t,e)}.bind(this,t,e),originalHandler:t,scope:e}),this},fire:function(e){if(this._subscriptions.length){if(e=t.toArray(arguments),this._bufferEntries>0)return this._bufferArguments=e,this;for(var r=this._subscriptions.slice(),n=0,i=r.length;i>n;n++){var s=r[n];s.handler.apply(s.scope,e)}}return this},remove:function(e,r){return t.isFunction(e)?this._removeHandler(e,r):(r=e,this._removeScope(r)),this},removeAll:function(){return this._subscriptions=[],this},buffer:function(t,e){this._bufferEntries++;try{return t.call(e)}finally{this._bufferEntries--,0===this._bufferEntries&&(this.fire.apply(this,this._bufferArguments),this._bufferArguments=null)}},_findHandlerIndex:function(e,r){return t.findIndex(this._subscriptions,function(t){return t.scope===r&&(t.handler===e||t.originalHandler===e)})},_removeHandler:function(t,e){var r=this._findHandlerIndex(t,e);r>=0&&this._subscriptions.splice(r,1)},_removeScope:function(e){this._subscriptions=t.reject(this._subscriptions,function(t){return t.scope===e})}},e.prototype.empty=e.prototype.removeAll,e.prototype.on=e.prototype.add,e.prototype.one=e.prototype.once,e.prototype.off=e.prototype.remove,e.prototype.trigger=e.prototype.fire,e});