require(["all.components"],function(){require(["Modernizr","jQuery","Underscore","tau/app.resolver","tau/service.container","tau/configurator","tau/services/service.navigator","tau/components/component.application.generic","tau/ui/extensions/application.generic/ui.extension.application.generic.boardSpecific"],function(Modernizr,$,_,appResolver,ServiceContainer,configuratorGlobal,ServiceNavigator,ApplicationComponent,BoardSpecificExtension){configuratorGlobal.isBoardEdition=!0;var routes=[{pattern:/start/,host:{name:"board_startScreen_h",type:"board.startScreen"},type:{name:"board_startScreen",type:"board.startScreen"}},{pattern:/board\/last/,adapter:function(){var configurator=this.configurator,referer=configurator.getRouting().restoreReferer();if(referer&&referer.id){var user=configurator.getLoggedUser(),boardFactory=configurator.getBoardDefinitionFactory();boardFactory.findLast(referer.id,user).done(function(board){var url=board?configurator.getUrlBuilder().getRelativeBoardUrl(board.key,board.acid||undefined):configurator.getUrlBuilder().getRelativeBoardUrl("current");configurator.getRouting().redirect(url)})}else configurator.getRouting().redirect(configurator.getUrlBuilder().getRelativeBoardUrl("current"))},host:{name:"board_host",type:"master.board"},type:{name:"board_page",type:"page.board"}},{pattern:/board\/current/,adapter:function(){var configurator=this.configurator,boardFactory=configurator.getBoardDefinitionFactory();boardFactory.findDefaultForLoggedUser().done(function(board){var def=$.Deferred();board?def.resolve(board):boardFactory.createBoard().done(function(definition){def.resolve(definition)}),def.done(function(board){configurator.getRouting().redirect(configurator.getUrlBuilder().getRelativeBoardUrl(board.id,board.acid||undefined))})})},host:{name:"board_host",type:"master.board"},type:{name:"board_page",type:"page.board"}},{pattern:/board\/([\w|0-9]+)/,adapter:function(id){var configurator=this.configurator,boardFactory=configurator.getBoardDefinitionFactory(),user=configurator.getLoggedUser();boardFactory.getById(id,user).done(_.bind(function(board){this.resolve({id:board.id,entity:"board"})},this)).fail(function(){configurator.getRouting().redirect(configurator.getUrlBuilder().getRelativeBoardUrl("current"))})},host:{name:"board_host",type:"master.board"},type:{name:"board_page",type:"page.board"}},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,adapter:function(entityType,entityId,tail){this.resolve({entity:{id:parseInt(entityId,10),type:entityType},action:"show"})},host:{name:"board_host",type:"master.board"},type:{name:"entity_page",type:"page.entity"}},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,adapter:function(entityType,entityId,action){this.resolve({entity:{id:parseInt(entityId,10),type:entityType},action:action})},host:{name:"board_host",type:"master.board"},type:{name:"entity_page",type:"page.entity"}}];$(function(){var applicationId="page",configurator=new ServiceContainer;configurator._id=_.uniqueId("board_"),configurator.isBoardEdition=!0,configurator.setWindow(window),configurator.setFeaturesService(configurator.getWindow().tauFeatures),configurator.setLoggedUser(configurator.getWindow().loggedUser),configurator.registerService("navigator",new ServiceNavigator(configurator,{parameterName:applicationId}));var hashService=configurator.getHashService();!hashService.getHash()&&_.has(hashService.getHrefParsed().queryKey,"start")?configurator.getHashService().setHash(applicationId+"=start/start"):configurator.getHashService().getHash()=="start"?configurator.getHashService().setHash(applicationId+"=start/start"):appResolver.resolvePageInfo({appId:applicationId,configurator:configurator},{type:"board",id:"last"},function(d){var external=this;external.setHashParam(applicationId,d.type+"/"+d.id,!0)});var config={name:"application board",options:{applicationId:applicationId},routes:routes,context:{configurator:configurator},extensions:[BoardSpecificExtension]},app=ApplicationComponent.create(config);app.initialize(config)})})})