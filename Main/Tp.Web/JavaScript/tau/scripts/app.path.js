define(["jQuery","tau/core/class"],function($,clazz){var appRoot=null,getAppPath=function(t){var e=window.location,i=e.protocol+"//"+e.host+e.pathname,r=i.split("/");r.pop();var s=window.pathToRequire?window.pathToRequire:$(document).find('script[src*="/require.js"]').attr("src"),n=s.split("/");n.pop();for(var o=t.split("/");".."===n[0];)n.shift(),r.pop();if(0===n.length)for(var h=0;h<o.length;h++)r.pop();else if(n.join("/").toLowerCase()!==o.join("/").toLowerCase())throw"Can't determine application root";return r.join("/")},api={get:function(){return appRoot||(appRoot=getAppPath("javascript/tau/scripts"))},tp:{}},tp=api.tp;return tp.UrlParameterCollection=clazz.extend({query:null,_parameters:null,init:function(t){this.query=t;var e=[],i=this.query.split("&"),r="";if(i.length<1)return e;for(var s=0;s<i.length;s++)r=i[s].split("="),r[0].length>0&&(e[s]=[r[0],1==r.length?r[0]:r[1]]);this._parameters=e},get:function(t){var e=this._findParameter(t);return e?e[1]:void 0},_findParameter:function(t){for(var e=0;e<this._parameters.length;e++)if(this._parameters[e][0]==t)return this._parameters[e]},set:function(t,e){var i=this._findParameter(t);return i?void(i[1]=e):void this._parameters.push([t,e])},remove:function(t){for(var e=0;e<this._parameters.length;e++)this._parameters[e][0]==t&&this._parameters.splice(e,1)}}),tp.UrlParameterCollection.prototype.toString=function(){if(0==this._parameters.length)return"";for(var t="?",e=0;e<this._parameters.length;e++)e>0&&(t+="&"),t+=this._parameters[e][0]+"="+this._parameters[e][1];return t},tp.URL=clazz.extend({init:function(url){0==url.length&&eval('throw "Invalid URL ['+url+']"'),this.url=url,this.port=-1,this.query=this.url.indexOf("?")>=0?this.url.substring(this.url.indexOf("?")+1):"",this.query.indexOf("#")>=0&&(this.query=this.query.substring(0,this.query.indexOf("#"))),this.protocol="",this.host="",this.protocolSep="",this.portSep="";var protocolSepIndex=this.url.indexOf("://");if(protocolSepIndex>=0){this.protocolSep="://",this.protocol=this.url.substring(0,protocolSepIndex).toLowerCase(),this.host=this.url.substring(protocolSepIndex+3),this.host.indexOf("/")>=0&&(this.host=this.host.substring(0,this.host.indexOf("/")));
var atIndex=this.host.indexOf("@");if(atIndex>=0){var credentials=this.host.substring(0,atIndex),colonIndex=credentials.indexOf(":");colonIndex>=0?(this.username=credentials.substring(0,colonIndex),this.password=credentials.substring(colonIndex)):this.username=credentials,this.host=this.host.substring(atIndex+1)}var portColonIndex=this.host.indexOf(":");portColonIndex>=0&&(this.portSep=":",this.port=this.host.substring(portColonIndex),this.host=this.host.substring(0,portColonIndex)),this.file=this.url.substring(protocolSepIndex+3),this.file=this.file.substring(this.file.indexOf("/"))}else this.file=this.url;this.file.indexOf("?")>=0&&(this.file=this.file.substring(0,this.file.indexOf("?")));var refSepIndex=url.indexOf("#");refSepIndex>=0?(this.file=this.file.substring(0,refSepIndex),this.reference=this.url.substring(this.url.indexOf("#"))):this.reference="",this.path=this.file,this.query.length>0&&(this.file+="?"+this.query),this.reference.length>0&&(this.file+="#"+this.reference),this._parameters=new tp.UrlParameterCollection(this.query)},getPort:function(){return this.port},getQuery:function(){return this._parameters.toString()},getProtocol:function(){return this.protocol},getHost:function(){return this.host},getUserName:function(){return this.username},getPassword:function(){return this.password},getFile:function(){return this.file},getReference:function(){return this.reference},getPath:function(){return this.path},getAcid:function(){return this.getArgumentValue("acid")},setAcid:function(t){this.setArgumentValue("acid",t)},setArgumentValue:function(t,e){this._parameters.set(t,e)},removeArgument:function(t){this._parameters.remove(t)},getArgumentValue:function(t){var e=this._parameters.get(t);return null!=e?e.replace(/\+/g," "):null}}),tp.URL.prototype.toString=function(){var t=[this.getProtocol(),this.protocolSep,this.getHost(),this.getPort(),this.getPath(),this.getQuery()],e="";return $.each(t,function(){this&&-1!=this&&(e+=this)}),e},tp.AcidURL=tp.URL.extend({init:function(t){this._super(t)
},toString:function(){var t=new tp.URL(document.location.href).getAcid();return this.setAcid(t),this._super()}}),tp.WebServiceURL=tp.AcidURL.extend({init:function(t){this._super(api.get()+t)}}),api});