define(["Underscore","tau/core/external"],function(_,a){var b=function(){module("[external]",{setup:function(){var b=this;b.originalHash='board/5&route={"collapsed":true,"hide":true}&key2={"innerKey":1}',b.external=new a({location:{hash:"#"+b.originalHash}})},teardown:function(){delete this.external,delete this.originalHash}}),test("should allow to get hash",function(){var a=this.external.getHash();equals(a,this.originalHash,"valid")}),test("should allow to set hash",function(){var a=this.originalHash+'&key3={"x":1}';this.external.setHash(a),equals(a,this.external.getHash(),"valid")}),test("should allow to get named hash params",function(){var a=this.external.hashParams(),b={route:{collapsed:!0,hide:!0},key2:{innerKey:1}};same(a,b,"valid")}),test("should allow to get particular named hash parameter",function(){var a=this.external.getHashParam("route"),b={collapsed:!0,hide:!0};same(a,b,"valid")}),test("should allow to set particular named hash parameter",function(){var a=null,b=null;this.external.setHashParam("key3",{x:77}),a=this.external.getHash(),b=this.originalHash+'&key3={"x":77}',same(a,b,"add new state"),this.external.setHashParam("key2",{innerKey:2,z:"test"}),a=this.external.getHash(),b='board/5&route={"collapsed":true,"hide":true}&key2={"innerKey":2,"z":"test"}&key3={"x":77}',same(a,b,"change existing state"),this.external.setHashParam("key2",null),a=this.external.getHash(),b='board/5&route={"collapsed":true,"hide":true}&key3={"x":77}',same(a,b,"remove existing state"),this.external.setHashParam("key3",null),a=this.external.getHash(),b='board/5&route={"collapsed":true,"hide":true}',same(a,b,"remove state from the last of the hash string")}),test("should allow to subscribe to state changes",function(){var a=null;this.external.onHashChange(function(b){a=b.getHash()}),this.external.triggerHashChange(),equals(a,this.originalHash,"valid")})};return{run:b}})