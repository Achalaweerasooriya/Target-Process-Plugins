define(["Underscore","tau/core/event","tau/components/extensions/comet/extension.comet.rest"],function(_,Event,CometRestExtension){var innerRun=function(){module("[comet]",{setup:function(){var self=this;self.cometExtension=new CometRestExtension({bus:{fire:function(){},on:function(){}}})},teardown:function(){delete this.cometExtension}}),test("should resolve data-conflicts by timestamp",function(){var actualState={},stubConfigurator={getStore:function(){return{registerWithEvents:function(data){actualState=data}}}},resolver=this.cometExtension.createResourceCometHandler(stubConfigurator);resolver({timestamp:10,data:{id:1,type:"Bug",reason:["p0","p1"],modification:"Updated",data:{p0:"p0-10",p1:"p1-10"}}}),same(actualState,{p0:"p0-10",p1:"p1-10",__type:"Bug"},"timestamp = 10"),resolver({timestamp:13,data:{id:1,type:"Bug",reason:["p1","p2"],modification:"Updated",data:{z0:"unused Z0",z1:"unused Z1",p1:"p1-13",p2:"p2-13"}}}),same(actualState,{p1:"p1-13",p2:"p2-13",__type:"Bug"},"timestamp = 13: override p1 from TS-10"),resolver({timestamp:12,data:{id:1,type:"Bug",reason:["p0","p1"],modification:"Updated",data:{p0:"p0-12",p1:"p1-12",p2:"p2-12"}}}),same(actualState,{p0:"p0-12",__type:"Bug"},"timestamp = 12: reject p1 and p2 since they were updated on TS-13"),resolver({timestamp:11,data:{id:1,type:"Bug",reason:["p0","p1","p2"],modification:"Updated",data:{p0:"p0-11",p1:"p1-11",p2:"p2-11"}}}),same(actualState,{__type:"Bug"},"timestamp = 11: reject p0, p1 and p2 since they were updated previously"),resolver({timestamp:14,data:{id:1,type:"Bug",reason:["p0","p1","p2"],modification:"Updated",data:{p0:"p0-14",p1:"p1-14",p2:"p2-14"}}}),same(actualState,{p0:"p0-14",p1:"p1-14",p2:"p2-14",__type:"Bug"},"timestamp = 14: override p0, p1 and p2 as the latest update")})};return{run:innerRun}})