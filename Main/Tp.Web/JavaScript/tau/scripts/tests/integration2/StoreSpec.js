define(["Underscore","tau/core/class","tau/configurator"],function(_,a,b){var c={asyncTest:asyncTest,start:start,stop:stop},d=a.extend({name:null,befores:[],afters:[],expects:[],request:{method:"get",type:null,config:{}},method:function(a){return this.request.method=a,this},type:function(a){return this.request.type=a,this},config:function(a,b){return this.request.config[a]=b,this},expect:function(a){return this.expects.push(a),this},run:function(){var a=this;return test(this.name,{},function(){stop(),b.clear(),b.setApplicationPath("http://localhost/TargetProcess");var c=b.getStore(),d=a.request;c[d.method].call(null,d.type,d.config).done({success:function(b){a._buildExpects(b)(start)},failure:function(a){ok(!1,"Failure during request")}})}),this},_serial:function(a){return function(){stop(),_.series(a,start)}},_buildExpects:function(a){var b=[];return _.forEach(this.expects,function(c){b.push(function(b){c(a),b()})}),function(a){_.series(b,a)}}}),e=a.extend({name:null,testCases:[],init:function(a){this.name=a},test:function(a){var b=new d;return b.name=a,this.testCases.push(b),b},run:function(){module(this.name),_.forEach(this.testCases,function(a){a.run()})}}),f={create:function(a){return new e(a)}};return f})