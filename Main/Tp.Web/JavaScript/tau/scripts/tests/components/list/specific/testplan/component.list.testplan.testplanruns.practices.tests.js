define(["Underscore","tests/components/list/specific/component.list.spec.base","tau/models/dataProviders/testplan/testplan.model.provider.testplanruns.items","tau/models/dataProviders/testplan/testplan.model.provider.testplanruns.groups","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity"],function(a,b,c,d){var e=function(){var e=b.Testcase.create("[list.testplan.testplanruns.practices]",c,d,function(){this.componentConfig={itemsDataProvider:this.providers.items,groupsDataProvider:this.providers.groups,groupBy:"entityState.name",views:[{rowTemplateName:"list-grid-entity__rowtestplanrun",type:"grid.entity",group:{dataIndex:"name"}}]};var a={tpr:"TestPlanRun"},b={kanban:"Kanban",scrum:"Scrum"},c={p1:"Good"},d={s1:"Good"},e={p_kanban:{name:"Project Kanban",process:"kanban"},p_scrum:{name:"Project Scrum",process:"scrum"}},f={r1:"Release1",r2:"R2"},g={i1:"Iter1",i2:"Iter2"},h={b1:"Build1",b2:"Build2"},i={kanban_tpr_new:{name:"New",entityType:"tpr",process:"kanban",nextStates:["kanban_tpr_inprogress"],isInitial:!0},kanban_tpr_inprogress:{name:"In Progress",entityType:"tpr",nextStates:["kanban_tpr_done"],process:"kanban"},kanban_tpr_done:{name:"Done",entityType:"tpr",process:"kanban",isFinal:!0},scrum_tpr_open:{name:"Open",entityType:"tpr",process:"scrum",nextStates:["scrum_tpr_planned"],isInitial:!0},scrum_tpr_planned:{name:"Planned",entityType:"tpr",nextStates:["scrum_tpr_indevelopment","scrum_tpr_closed"],process:"scrum"},scrum_tpr_indevelopment:{name:"In Development",entityType:"tpr",nextStates:["scrum_tpr_intesting"],isCommentRequired:!0,process:"scrum"},scrum_tpr_intesting:{name:"In Testing",entityType:"tpr",nextStates:["scrum_tpr_closed"],process:"scrum"},scrum_tpr_closed:{name:"Closed",entityType:"tpr",process:"scrum",isFinal:!0}},j={tp1:{name:"Test Plan",testPlanRuns:["tpr1","tpr2"],project:"p_kanban",process:"kanban"}},k={tpr1:{name:"TPR1",entityState:"kanban_tpr_inprogress",priority:"p1",project:"p_kanban",release:"r1",build:"b2",passedCount:42,failedCount:888},tpr2:{name:"TPR2",entityState:"scrum_tpr_planned",priority:"p1",project:"p_scrum",iteration:"i1",notRunCount:666}};this.loadFixtures({entityType:a,projects:e,entityStates:i,testPlanRuns:k,priority:c,severity:d,processes:b,testPlans:j,releases:f,iterations:g,builds:h}),this.setProject(this.data.project.p_kanban,["iterations"]),this.setEntity(this.data.testPlan.tp1)});e.add(new b.Test({name:"should render valid markup view",test:function(){var b=this.data,c=this.$el,d=[{title:"New, Open",items:[]},{title:"In Progress",items:["TPR1"]},{title:"Planned",items:["TPR2"]},{title:"In Development",items:[]},{title:"In Testing",items:[]},{title:"Done, Closed",items:[]}],e=c.find("[role=group]");equals(e.length,d.length,"Groups amount");for(var f=0;f<e.length;f++){var g=e.eq(f);equals(g.find("[role=title]").text(),d[f].title,"Group title"),equals(g.find("[role=counter]").text(),d[f].items.length,"Group counter")}var h=c.find("[role=list]");for(var i=0;i<h.length;i++){var j=h.eq(i),k=j.find("[role=item]");for(var l=0;l<k.length;l++){var m=k.eq(l).find(".tau-list__table__cell"),n=b.groups[i].items[l];equals(a.trim(m.eq(1).text()),n.id,"ID Data column");var o=m.eq(1).find(".tau-entitylink").attr("title"),p=d[i].items[l];equals(o,p,"Name Data column");var q=m.filter(".tau-list__table__cell-iteration");equals(q.length,0,"No iteration"),a.forEach(["release","build"],function(b){var c=m.filter(".tau-list__table__cell-"+b);equals(c.length,1,b+" output"),equals(a.trim(c.text()),n[b]?n[b].name:"",b+" output")});var r=m.filter(".tau-list__table__cell-stat");equals(r.length,1,"Stat cell"),equals(a.trim(r.text()),(n.passedCount||0)+""+(n.failedCount||0)+""+(n.notRunCount||0),"Stat cell");var s=m.filter(".tau-list__table__cell-assignments");equals(s.length,1,"Assignemtn output");var t=s.find(".ui-assignment__group");equals(t.length,n.assignments.groups.length,"Assignments items"),a.forEach(n.assignments.groups,function(b,c){var d=t.eq(c);equals(d.find(".ui-assignment__group__title").text(),b.role.name,"Group title");var e=d.find(".ui-assignment__user");equals(e.length,b.users.length,"Group users length"),a.forEach(b.users,function(a,c){var d=e.eq(c),a=b.users[c];equals(d.find("img").attr("src"),"/TP/Avatar.ashx?UserId="+a.id+"&size=24","User avatar"),equals(d.find("img").prop("title"),a.name,"User name")})});var u=m.filter(".tau-list__table__cell-additionalactions");equals(u.length,1,"Additional actions cell")}}}})),e.run()};return{run:e}})