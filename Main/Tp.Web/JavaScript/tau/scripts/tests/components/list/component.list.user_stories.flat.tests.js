define(["Underscore","tau/configurator","tau/models/dataprocessor/model.processor.context","tau/components/component.list","tests/common/testData","tests/common/applicationContext","tests/components/common/common.setup","tests/components/component.specs","tests/common/checker","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.groups.user_stories","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(){function p(a,b,c){var d={id:b,nested:!0,fields:["id"]},e={};e[c]=["id","name","tags",Similar.to({priority:["id","name"]}),"effort","effortCompleted","effortToDo","timeSpent","timeRemain",Similar.to({entityState:["id","name","isInitial","isFinal"]}),Similar.to({roleEfforts:["id",Like.is({role:["id","name"]})]}),Similar.to({assignments:["id",Like.is({role:["id"]}),Similar.to({generalUser:["id","firstName","lastName"]})]})],d.fields.push(Similar.to(e));var f=Similar.to({name:"get",type:a,config:Similar.to(d)});return f}var i=new f,k=e.registerTestDataForUserStoriesListModel(),l=e.getStatesForProcess(),m=k.userStories,n=k.data,o={context:{type:"feature",id:15}},q={groups:[],items:[{id:1,name:"US1",__type:"userStory",entityState:{id:1,name:"Open",isInitial:!0,isFinal:!1},tags:["us1","epic"],priority:{id:1,name:"Low"},effort:{estimated:56,spent:8,remain:48,total:56,percentComplete:14,percentFromMaximum:100,timeSpent:9,timeRemain:41,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309,avatarUrl:"/TP/Avatar.ashx?UserId=1&size=24"},{id:2,name:"Ivan V.",assignmentId:310,avatarUrl:"/TP/Avatar.ashx?UserId=2&size=24"}]}]}},{id:2,name:"US2",__type:"userStory",entityState:{id:24,name:"Closed",isInitial:!1,isFinal:!0},tags:[],priority:{id:1,name:"Low"},effort:{estimated:12,spent:6,remain:6,total:12,percentComplete:50,percentFromMaximum:21,timeSpent:3,timeRemain:18,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309,avatarUrl:"/TP/Avatar.ashx?UserId=1&size=24"},{id:2,name:"Ivan V.",assignmentId:310,avatarUrl:"/TP/Avatar.ashx?UserId=2&size=24"}]}]}},{id:3,name:"US3",__type:"userStory",entityState:{id:23,name:"In Progress",isInitial:!1,isFinal:!1},tags:["us3","wow"],priority:{id:1,name:"Low"},effort:{estimated:16,spent:8,remain:8,total:16,percentComplete:50,percentFromMaximum:29,timeSpent:5,timeRemain:7,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[]}]}}],config:{views:[{type:"grid.entity"}],currentView:{type:"grid.entity"}}},r=p("feature",15,"userStories"),s=function(){b.getProxy().markRecordSetAsCompleteLoaded("priority")},t=[{name:"should render valid markup view",preSetup:s,test:function(){var b=this.data,c=this.$el,d=c.find("[role=group]");equals(d.length,0,"Groups amount");var e=c.find("[role=list-inner]");for(var f=0;f<e.length;f++){var g=e.eq(f),h=g.find("> tr");for(var i=0;i<h.length;i++){var j=h.eq(i).find("td"),k=b.groups[f].items[i];equals(j.length,7,"Amount of row cells"),equals(j.eq(1).text(),k.id,"ID Data column");var l=j.eq(2).find("span").eq(0);equals(l.text(),k.name,"Name Data column");if(k.tags.length){var m=j.eq(2).find("span").eq(1);equals(m.text(),k.tags[0],"Tag Data column")}equals(j.eq(3).text(),k.priority.name.toString(),"Priority Data column"),equals(j.eq(4).find("span:first").html(),k.effort.estimated+"&nbsp;"+k.effort.unit.shortName,"Estimated Effort Data column"),ok(j.eq(5).find(".ui-progressbar__progress").attr("style").match(new RegExp("width:\\s*"+k.effort.percentFromMaximum+"%")),"Column progress width"),ok(j.eq(5).find(".ui-progressbar__progress__indicator").attr("style").match(new RegExp("width:\\s*"+k.effort.percentComplete+"%")),"Column progress width"),equals(j.eq(6).find(".ui-assignment__group").length,k.assignments.groups.length,"Assignments items");var n=j.eq(6).find(".ui-assignment__group");a.forEach(k.assignments.groups,function(b,c){var d=n.eq(c);equals(d.find(".ui-assignment__group__title").text(),b.role.name,"Group title");var e=d.find(".ui-assignment__user");equals(e.length,b.users.length,"Group users length"),a.forEach(b.users,function(a,c){var d=e.eq(c),a=b.users[c];equals(d.find("img").attr("src"),"/TP/Avatar.ashx?UserId="+a.id+"&size=24","User avatar"),equals(d.find("img").prop("title"),a.name,"User name")})})}}}}],u={context:{applicationContext:i},itemsDataProvider:j,views:[{type:"grid.entity"}]};c(u.context);var v=g.create("[component.list][user_stories_flat]",[n,l],d,u);h.create(v,o).viewShouldFollowDataComponentLifeCycle(s).viewShouldPassTests(t).done()};return{run:l}})