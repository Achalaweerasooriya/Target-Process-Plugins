define(["Underscore","tau/components/component.list","tests/common/testData","tests/common/applicationContext","tests/components/common/common.setup","tests/components/component.specs","tests/common/checker","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.groups.user_stories","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity"],function(_,a,b,c,d,e,f,g,h){var i=function(){function n(a,b,c){var d={id:b,nested:!0,fields:["id"]},e={};e[c]=["id","name","tags",Similar.to({priority:["id","name"]}),"effort","effortCompleted","effortToDo","timeSpent","timeRemain",Similar.to({entityState:["id","name","isinitial","isfinal"]}),Similar.to({roleEfforts:["id",Like.is({role:["id","name"]})]}),Similar.to({assignments:["id",Like.is({role:["id"]}),Similar.to({generalUser:["id","firstName","lastName"]})]})],d.fields.push(Similar.to(e));var f=Similar.to({name:"get",type:a,config:Similar.to(d)});return f}function o(){var a=f.processes[0],b={id:a.id,fields:["id",Similar.to({entityStates:["id","name","isinitial","isfinal","isplanned",Similar.to({entityType:["id","name"]})]})]},c=Similar.to({name:"get",type:"process",config:Similar.to(b)});return c}var f=new c,i=b.registerTestDataForUserStoriesListModel(),j=b.getStatesForProcess(),k=i.userStories,l=i.data,m={context:{type:"feature",id:15}},p={items:[],groups:[{key:"Open",items:[{id:1,name:"US1",__type:"userStory",entityState:{id:1,name:"Open",isInitial:!0,isFinal:!1},tags:["us1","epic"],priority:{id:1,name:"Low"},effort:{estimated:56,spent:8,remain:48,total:56,percentComplete:14,percentFromMaximum:100,timeSpent:9,timeRemain:41,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309,avatarUrl:"/TP/Avatar.ashx?UserId=1&size=24"},{id:2,name:"Ivan V.",assignmentId:310,avatarUrl:"/TP/Avatar.ashx?UserId=2&size=24"}]}]}}],collapsed:!1,title:"Open"},{key:"Done",items:[],collapsed:!1,title:"Done"},{key:"In Progress",items:[{id:3,name:"US3",__type:"userStory",entityState:{id:23,name:"In Progress",isInitial:!1,isFinal:!1},tags:["us3","wow"],priority:{id:1,name:"Low"},effort:{estimated:16,spent:8,remain:8,total:16,percentComplete:50,percentFromMaximum:29,timeSpent:5,timeRemain:7,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[]}]}}],collapsed:!1,title:"In Progress"},{key:"Closed",items:[{id:2,name:"US2",__type:"userStory",entityState:{id:24,name:"Closed",isInitial:!1,isFinal:!0},tags:[],priority:{id:1,name:"Low"},effort:{estimated:12,spent:6,remain:6,total:12,percentComplete:50,percentFromMaximum:21,timeSpent:3,timeRemain:18,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309,avatarUrl:"/TP/Avatar.ashx?UserId=1&size=24"},{id:2,name:"Ivan V.",assignmentId:310,avatarUrl:"/TP/Avatar.ashx?UserId=2&size=24"}]}]}}],collapsed:!0,title:"Closed"}],config:{views:[{type:"grid.entity",group:{dataIndex:"name"}}],currentView:{type:"grid.entity",group:{dataIndex:"name"}}}},q=n("feature",15,"userStories"),r=o(),s=[{name:"should render valid markup view",test:function(){var a=this.data,b=this.$el,c=b.find("[role=group]");equals(c.length,4,"Groups amount");for(var d=0;d<c.length;d++){var e=c.eq(d);equals(e.find("[role=title]").text(),a.groups[d].title,"Group title"),equals(e.find("[role=counter]").text(),a.groups[d].items.length,"Group counter")}var f=b.find("[role=list-inner]");for(var g=0;g<f.length;g++){var h=f.eq(g),i=h.find("> tr");for(var j=0;j<i.length;j++){var k=i.eq(j).find("td"),l=a.groups[g].items[j];equals(k.length,7,"Amount of row cells"),equals(k.eq(1).text(),l.id,"ID Data column");var m=k.eq(2).find("span").eq(0);equals(m.text(),l.name,"Name Data column");if(l.tags.length){var n=k.eq(2).find("span").eq(1);equals(n.text(),l.tags[0],"Tag Data column")}equals(k.eq(3).text(),l.priority.name.toString(),"Priority Data column"),equals(k.eq(4).find("span:first").html(),l.effort.estimated+"&nbsp;"+l.effort.unit.shortName,"Estimated Effort Data column"),ok(k.eq(5).find(".ui-progressbar__progress").attr("style").match(new RegExp("width:\\s*"+l.effort.percentFromMaximum+"%")),"Column progress width"),ok(k.eq(5).find(".ui-progressbar__progress__indicator").attr("style").match(new RegExp("width:\\s*"+l.effort.percentComplete+"%")),"Column progress width"),equals(k.eq(6).find(".ui-assignment__group").length,l.assignments.groups.length,"Assignments items");var o=k.eq(6).find(".ui-assignment__group");_.forEach(l.assignments.groups,function(a,b){var c=o.eq(b);equals(c.find(".ui-assignment__group__title").text(),a.role.name,"Group title");var d=c.find(".ui-assignment__user");equals(d.length,a.users.length,"Group users length"),_.forEach(a.users,function(b,c){var e=d.eq(c),b=a.users[c];equals(e.find("img").attr("src"),"/TP/Avatar.ashx?UserId="+b.id+"&size=24","User avatar"),equals(e.find("img").prop("title"),b.name,"User name")})})}}}}],t={context:{applicationContext:f},itemsDataProvider:g,groupsDataProvider:h,groupBy:"entityState.name",views:[{type:"grid.entity",group:{dataIndex:"name"}}]},u=d.create("[component.list][user_stories_tree]",[l,j],a,t);e.create(u,m).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(p,[[r],[q],[q],[q],[q]]).viewShouldPassTests(s).done()};return{run:i}})