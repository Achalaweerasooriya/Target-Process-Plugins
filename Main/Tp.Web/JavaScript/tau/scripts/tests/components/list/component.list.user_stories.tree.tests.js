define(["Underscore","tau/components/component.list","tests/common/testData","tests/common/applicationContext","tests/components/common/common.setup","tests/components/component.specs","tests/common/checker","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.groups.user_stories","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity"],function(a,b,c,d,e,f,g,h,i){var j=function(){function p(){var a=g.processes[0],b={id:a.id,fields:["id",Similar.to({entityStates:["id","name","isinitial","isfinal","isplanned",Similar.to({entityType:["id","name"]})]})]},c=Similar.to({name:"get",type:"process",config:Similar.to(b)});return c}function o(a,b,c){var d={id:b,nested:!0,fields:["id"]},e={};e[c]=["id","name","tags",Similar.to({priority:["id","name"]}),"effort","effortCompleted","effortToDo","timeSpent","timeRemain",Similar.to({entityState:["id","name","isinitial","isfinal"]}),Similar.to({roleEfforts:["id",Like.is({role:["id","name"]})]}),Similar.to({assignments:["id",Like.is({role:["id"]}),Similar.to({generalUser:["id","firstName","lastName"]})]})],d.fields.push(Similar.to(e));var f=Similar.to({name:"get",type:a,config:Similar.to(d)});return f}var g=new d,j=c.registerTestDataForUserStoriesListModel(),k=c.getStatesForProcess(),l=j.userStories,m=j.data,n={context:{type:"feature",id:15}},q={items:[],groups:[{key:"Open",items:[{id:1,name:"US1",__type:"userStory",entityState:{id:1,name:"Open",isInitial:!0,isFinal:!1},tags:["us1","epic"],priority:{id:1,name:"Low"},effort:{estimated:56,spent:8,remain:48,total:56,percentComplete:14,percentFromMaximum:100,timeSpent:9,timeRemain:41,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309,avatarUrl:"/TP/Avatar.ashx?UserId=1&size=24"},{id:2,name:"Ivan V.",assignmentId:310,avatarUrl:"/TP/Avatar.ashx?UserId=2&size=24"}]}]}}],collapsed:!1,title:"Open"},{key:"Done",items:[],collapsed:!1,title:"Done"},{key:"In Progress",items:[{id:3,name:"US3",__type:"userStory",entityState:{id:23,name:"In Progress",isInitial:!1,isFinal:!1},tags:["us3","wow"],priority:{id:1,name:"Low"},effort:{estimated:16,spent:8,remain:8,total:16,percentComplete:50,percentFromMaximum:29,timeSpent:5,timeRemain:7,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[]}]}}],collapsed:!1,title:"In Progress"},{key:"Closed",items:[{id:2,name:"US2",__type:"userStory",entityState:{id:24,name:"Closed",isInitial:!1,isFinal:!0},tags:[],priority:{id:1,name:"Low"},effort:{estimated:12,spent:6,remain:6,total:12,percentComplete:50,percentFromMaximum:21,timeSpent:3,timeRemain:18,unit:{name:"Hour",shortName:"h"}},assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309,avatarUrl:"/TP/Avatar.ashx?UserId=1&size=24"},{id:2,name:"Ivan V.",assignmentId:310,avatarUrl:"/TP/Avatar.ashx?UserId=2&size=24"}]}]}}],collapsed:!0,title:"Closed"}],config:{views:[{type:"grid.entity",group:{dataIndex:"name"}}],currentView:{type:"grid.entity",group:{dataIndex:"name"}}}},r=o("feature",15,"userStories"),s=p(),t=[{name:"should render valid markup view",test:function(){var b=this.data,c=this.$el,d=c.find("[role=group]");equals(d.length,4,"Groups amount");for(var e=0;e<d.length;e++){var f=d.eq(e);equals(f.find("[role=title]").text(),b.groups[e].title,"Group title"),equals(f.find("[role=counter]").text(),b.groups[e].items.length,"Group counter")}var g=c.find("[role=list-inner]");for(var h=0;h<g.length;h++){var i=g.eq(h),j=i.find("> tr");for(var k=0;k<j.length;k++){var l=j.eq(k).find("td"),m=b.groups[h].items[k];equals(l.length,7,"Amount of row cells"),equals(l.eq(1).text(),m.id,"ID Data column");var n=l.eq(2).find("span").eq(0);equals(n.text(),m.name,"Name Data column");if(m.tags.length){var o=l.eq(2).find("span").eq(1);equals(o.text(),m.tags[0],"Tag Data column")}equals(l.eq(3).text(),m.priority.name.toString(),"Priority Data column"),equals(l.eq(4).find("span:first").html(),m.effort.estimated+"&nbsp;"+m.effort.unit.shortName,"Estimated Effort Data column"),ok(l.eq(5).find(".ui-progressbar__progress").attr("style").match(new RegExp("width:\\s*"+m.effort.percentFromMaximum+"%")),"Column progress width"),ok(l.eq(5).find(".ui-progressbar__progress__indicator").attr("style").match(new RegExp("width:\\s*"+m.effort.percentComplete+"%")),"Column progress width"),equals(l.eq(6).find(".ui-assignment__group").length,m.assignments.groups.length,"Assignments items");var p=l.eq(6).find(".ui-assignment__group");a.forEach(m.assignments.groups,function(b,c){var d=p.eq(c);equals(d.find(".ui-assignment__group__title").text(),b.role.name,"Group title");var e=d.find(".ui-assignment__user");equals(e.length,b.users.length,"Group users length"),a.forEach(b.users,function(a,c){var d=e.eq(c),a=b.users[c];equals(d.find("img").attr("src"),"/TP/Avatar.ashx?UserId="+a.id+"&size=24","User avatar"),equals(d.find("img").prop("title"),a.name,"User name")})})}}}}],u={context:{applicationContext:g},itemsDataProvider:h,groupsDataProvider:i,groupBy:"entityState.name",views:[{type:"grid.entity",group:{dataIndex:"name"}}]},v=e.create("[component.list][user_stories_tree]",[m,k],b,u);f.create(v,n).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(q,[[s],[r],[r],[r],[r]]).viewShouldPassTests(t).done()};return{run:j}})