define(["tau/components/component.list","tests/common/testData","tests/components/common/common.setup","tests/components/component.specs","tests/common/checker","tau/models/dataProviders/model.provider.items.bugs_tasks","tau/models/dataProviders/model.provider.groups.bugs_tasks","tau/ui/templates/list_/grid/ui.template.list.grid"],function(a,b,c,d,e,f){var g=function(){function l(a,b,c){var d={id:b,nested:!0,fields:["id"]},e={};e[c]=["id","name","effort",Similar.to({entityState:["id","name","isinitial","isfinal"]}),Similar.to({roleEfforts:["id",Like.is({role:["id","name"]})]}),Similar.to({assignments:["id",Like.is({role:["id"]}),Similar.to({generalUser:["id","firstName","lastName"]})]})],d.fields.push(Similar.to(e));var f=Similar.to({name:"get",type:a,config:Similar.to(d)});return f}var e=b.registerTestDataForEntityListModel().userStory,g=e[0],h=e.id,i=[Similar.to({name:"get",type:e.__type,config:Like.is({id:h,fields:["id","effort","effortToDo","tasks-count","tasks-effort-sum","tasks-effortToDo-sum",Like.is({owner:["id","firstName","lastName"]}),Like.is({roleEfforts:["id","effort","effortToDo",Like.is({role:["id","name"]})],list:!0}),Like.is({assignments:["id",Like.is({role:["id","name"]}),Like.is({generalUser:["id","firstName","lastName"]})],list:!0})]})})],j={id:1,name:"Dev."},k={context:{type:"story",id:15}},m=[{id:31,name:"Task Name1",__type:"task",entityState:{id:1,name:"Open"},effort:1,assignments:{groups:[{role:j,users:[{id:1,name:"Vasili I.",assignmentId:309},{id:2,name:"Ivan V.",assignmentId:310}]}]}},{id:41,name:"Bug Name1",__type:"bug",entityState:{id:1,name:"Open"},effort:5,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:3,name:"Alex P.",assignmentId:311},{id:4,name:"Petr I.",assignmentId:312}]}]}},{id:32,name:"Task Name2",__type:"task",entityState:{id:2,name:"In Progress"},effort:22,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309},{id:2,name:"Ivan V.",assignmentId:310}]}]}},{id:43,name:"Bug Name3",__type:"bug",entityState:{id:2,name:"In Progress"},effort:5,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:3,name:"Alex P.",assignmentId:311},{id:4,name:"Petr I.",assignmentId:312}]}]}},{id:33,name:"Task Name3",__type:"task",entityState:{id:3,name:"Done"},effort:8,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309},{id:2,name:"Ivan V.",assignmentId:310}]}]}},{id:42,name:"Bug Name2",__type:"bug",entityState:{id:3,name:"Done"},effort:5,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:3,name:"Alex P.",assignmentId:311},{id:4,name:"Petr I.",assignmentId:312}]}]}}],n={items:[],groups:[{key:{id:1,name:"Open"},items:[{id:31,name:"Task Name1",__type:"task",entityState:{id:1,name:"Open"},effort:1,assignments:{groups:[{role:j,users:[{id:1,name:"Vasili I.",assignmentId:309},{id:2,name:"Ivan V.",assignmentId:310}]}]}},{id:41,name:"Bug Name1",__type:"bug",entityState:{id:1,name:"Open"},effort:5,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:3,name:"Alex P.",assignmentId:311},{id:4,name:"Petr I.",assignmentId:312}]}]}}]},{key:{id:2,name:"In Progress"},items:[{id:32,name:"Task Name2",__type:"task",entityState:{id:2,name:"In Progress"},effort:22,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309},{id:2,name:"Ivan V.",assignmentId:310}]}]}},{id:43,name:"Bug Name3",__type:"bug",entityState:{id:2,name:"In Progress"},effort:5,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:3,name:"Alex P.",assignmentId:311},{id:4,name:"Petr I.",assignmentId:312}]}]}}]},{key:{id:3,name:"Done"},items:[{id:33,name:"Task Name3",__type:"task",entityState:{id:3,name:"Done"},effort:8,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:1,name:"Vasili I.",assignmentId:309},{id:2,name:"Ivan V.",assignmentId:310}]}]}},{id:42,name:"Bug Name2",__type:"bug",entityState:{id:3,name:"Done"},effort:5,assignments:{groups:[{role:{id:1,name:"Dev."},users:[{id:3,name:"Alex P.",assignmentId:311},{id:4,name:"Petr I.",assignmentId:312}]}]}}]}],config:{views:[{type:"grid",group:{dataIndex:"name"},fields:[{dataIndex:"id",cssClass:"tau-list__cell-id"},{dataIndex:"name",cssClass:"tau-list__cell-name"},{dataIndex:"entityState.name",cssClass:"tau-list__cell-stateName"}]}]}},o=[],p=l("userStory",15,"tasks");o.push(p),p=l("userStory",15,"bugs"),o.push(p);var q=[{name:"should render valid markup view",test:function(){var a=this.data,b=this.$el,c=b.find(".tau-list__group");equals(c.length,3,"Groups amount");for(var d=0;d<c.length;d++){var e=c.eq(d);equals(e.find("h2").text(),a.groups[d].key.name,"Group title"),equals(e.find("table").length,1,"Inner table"),equals(e.find("table tr").length,2,"Inner table rows");var f=e.find("table tr");for(var g=0;g<f.length;g++){var h=f.eq(g).find("td");equals(h.length,3,"Inner table td");for(var i=0;i<h.length;i++){var j=r.views[0].fields[i].dataIndex,k=_.complexKey(a.groups[d].items[g],j);k=(new String(k||"")).toString(),equals(h.eq(i).text(),k,"Cell content");var l=r.views[0].fields[i].cssClass;equals(h.hasClass(l),!0,"Cell CSS class")}}}}}],r={dataProvider:f,groupBy:"entityState",orderBy:["entityState.id"],views:[{type:"grid",group:{dataIndex:"name"},fields:[{dataIndex:"id",cssClass:"tau-list__cell-id"},{dataIndex:"name",cssClass:"tau-list__cell-name"},{dataIndex:"entityState.name",cssClass:"tau-list__cell-stateName"}]}]},s=c.create("[component.list][with.grouping]",e,a,r);d.create(s,k).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(n,[o]).viewShouldPassTests(q).done();var t={items:m,groups:[],config:{views:[{type:"grid",fields:[{dataIndex:"id",cssClass:"tau-list__cell-id"},{dataIndex:"name"},{dataIndex:"entityState.name"}]}]}},u={dataProvider:f,orderBy:["entityState.id"],views:[{type:"grid",fields:[{dataIndex:"id",cssClass:"tau-list__cell-id"},{dataIndex:"name"},{dataIndex:"entityState.name"}]}]},v=[{name:"should render valid markup view",test:function(){var a=this.data,b=this.$el,c=b.find(".tau-list__group");equals(c.length,0,"Groups amount"),equals(b.find("table").length,1,"Inner table");var d=b.find("table");equals(d.find("tr").length,6,"Inner table rows");var e=d.find("tr");for(var f=0;f<e.length;f++){var g=e.eq(f).find("td");equals(g.length,3,"Inner table td");for(var h=0;h<g.length;h++){var i=r.views[0].fields[h].dataIndex,j=_.complexKey(a.items[f],i);equals(g.eq(h).text(),(new String(a.items[f][i]?a.items[f][i]:"")).toString(),"Cell content")}}}}];setupWithoutGrouping=c.create("[component.list][without.grouping]",e,a,u),d.create(setupWithoutGrouping,k).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(t,[o]).viewShouldPassTests(v).done()};return{run:g}})