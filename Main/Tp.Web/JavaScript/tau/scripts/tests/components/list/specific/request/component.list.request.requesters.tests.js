define(["Underscore","tests/components/list/specific/component.list.spec.base","tau/models/dataProviders/request/request.model.provider.requesters.items","tau/ui/extensions/list/request/extension.requesters.action.detach","tau/configurator","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity"],function(_,Spec,ItemsProvider,RequestersActionDetachExtension,configurator){var innerRun=function(){var tests=Spec.Testcase.create("[list.request.requesters]",ItemsProvider,null,function(){this.componentConfig={itemsDataProvider:this.providers.items,sortable:!1,extensions:[RequestersActionDetachExtension],views:[{rowTemplateName:"list-grid-entity__row_requester",type:"grid.entity"}]};var types={request:"Request"},processes={kanban:"Kanban",scrum:"Scrum"},projects={p_kanban:{name:"Project Kanban",process:"kanban"},p_scrum:{name:"Project Scrum",process:"scrum"}},requests={r1:{name:"Do something",requesters:["u1","u2","u3"],project:"p_kanban",process:"kanban"}},requesters={u1:{firstName:"Bree",lastName:"Olson",email:"bree@olson.com",login:"bbrree"},u2:{firstName:"Ron",lastName:"Jeremy",email:"25@inches.com",login:"ron"},u3:{firstName:"Annabel",lastName:"Chong",email:"251@10hours.com",login:"grace"}};this.loadFixtures({entityType:types,processes:processes,projects:projects,requests:requests,generalUsers:requesters}),this.setProject(this.data.project.p_kanban),this.setEntity(this.data.request.r1)});tests.add(new Spec.Test({name:"should render valid markup view",test:function(){var data=tests.data,$el=this.$el,groupsConfig=[{items:["Bree Olson","Ron Jeremy","Annabel Chong"]}],$groups=$el.find("[role=group]");equals($groups.length,groupsConfig.length,"Groups amount");var $itemsGroups=$el.find("[role=list]");for(var i=0;i<$itemsGroups.length;i++){var $group=$itemsGroups.eq(i),$trs=$group.find("[role=item]");equals($trs.length,3,"Items correct");for(var j=0;j<$trs.length;j++){var $cells=$trs.eq(j).find(".tau-list__table__cell");equals($cells.eq(1).find("img").length,1,"Show userpic"),equals($cells.eq(2).find("a").length,1,"Show link");var outputName=_.trim($cells.eq(2).text()),itemName=groupsConfig[i].items[j];equals(outputName,itemName,"Name Data column")}}}})),tests.add(new Spec.Test({name:"should allow to detach",test:function(){var data=tests.data,$el=this.$el;equals($el.find("[role=item]").length,3,"Yip");var $item=$el.find("[role=item]:eq(0)"),$detach=$item.find("[role=action-detach]");equals($detach.length,1,"Has detach button"),configurator.getService().registerRemoveFromListCommand({config:{id:data.request.r1.id,$set:{requesters:{id:data.generalUser.u1.id}},fields:["id"]}}),configurator.getService().registerGetCommand({config:{id:data.request.r1.id,nested:!0,fields:["id",{requesters:["id","firstName","lastName","deleteDate","email","login","kind"],list:!0}]},returnedData:[{id:data.request.r1.id,requesters:[data.generalUser.u2,data.generalUser.u3]}]}),$detach.click(),ok($el!==this.$el,"Refresh"),equals(this.$el.find("[role=item]").length,2,"Detached")}})),tests.run()};return{run:innerRun}})