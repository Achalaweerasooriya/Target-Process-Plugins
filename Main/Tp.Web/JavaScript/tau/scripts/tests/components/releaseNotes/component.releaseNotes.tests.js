define(["Underscore","jQuery","tau/configurator","tests/common/applicationContext.simple","tau/models/dataprocessor/model.processor.context","tests/components/common/common.setup","tests/components/component.specs","tests/common/service.mock","tau/utils/utils.fixturesLoader","tau/components/component.releaseNotes"],function(_,$,a,b,c,d,e,f,g,h){var i=new g({generateId:!0,setType:!0}),j=function(a,b,c){var d=b.release[c.release],e={};_.forEach(["bug","userStory","feature"],function(a){e[a]=[],_.forEach(b[a],function(b,d){_.indexOf(c.willReturn[a],d)>-1&&e[a].push(b)})}),a.registerFindCommand({config:{fields:["id","name"],$query:{"Release.Id":d.id,"EntityState.isFinal":1},$orderBy:"id"},returnedData:e.bug}),a.registerFindCommand({config:{fields:["id","name",{release:["id"]},{entityState:["id","isFinal"]},{userStories:["id","name",{release:["id"]},{entityState:["id","isFinal"]}],list:!0}],$query:{"Release.Id":d.id},$orderBy:"id"},returnedData:e.feature}),a.registerFindCommand({config:{fields:["id","name",{release:["id"]},{feature:["id"]},{entityState:["id","isFinal"]}],$query:{"Release.Id":d.id,"EntityState.isFinal":1},$orderBy:"id"},returnedData:e.userStory})},k=function(b,c){var d=b.release[c.release];return function(){this.service=new f,this.sourceData=b,this.entity=d,a.setService(this.service),j(this.service,b,c),_.forEach(_.keys(this.sourceData),function(b){a.getProxy().markRecordSetAsCompleteLoaded(b)});var e=[];_.forEach(this.sourceData,function(a,b){e=e.concat(_.values(a))}),a.setInitialData(e)}},l=function(a){return function(){var b=this.$el;equals(b.length,1,"Rendered");var c=b.find(".tau-releaseNotes__inner");equals(c.length,1,"Rendered");var d=b.find(".tau-releaseNotes__title");ok(d.text().match(this.entity.name),"Release name"),(a.userStories.length||_.keys(a.features).length)&&equals(c.find('.tau-releaseNotes__subtitle:contains("Added features")').length,1,"Title rendered");var e=c.find(".tau-releaseNotes__feature");equals(e.length,_.keys(a.features).length,"Rendered features");var f=0;_.forEach(a.features,function(a,b){var c=e.eq(f);equals(c.length,1,"Render item"),equals(c.data("name"),b,"Output ok");var d=c.find(".tau-releaseNotes__userstory");equals(d.length,a.length,"Rendered user stories"),_.forEach(a,function(a,b){equals(d.eq(b).length,1,"Render item"),equals(d.eq(b).data("name"),a,"Output ok")}),f++});var g=c.find(".tau-releaseNotes__userstory_separate_true");equals(g.length,a.userStories.length,"Rendered user stories"),_.forEach(a.userStories,function(a,b){equals(g.eq(b).length,1,"Render item"),equals(g.eq(b).data("name"),a,"Output ok")}),a.bugs.length&&equals(c.find('.tau-releaseNotes__subtitle:contains("Fixed Bugs")').length,1,"Title rendered");var h=c.find(".tau-releaseNotes__bug");equals(h.length,a.bugs.length,"Rendered bugs"),_.forEach(a.bugs,function(a,b){equals(h.eq(b).length,1,"Render item"),equals(h.eq(b).data("name"),a,"Output ok")}),this.service.verify()}},m=function(a,b,c,d){var e=i.load(b),f=e.release[c.release];return{name:a,context:{id:f.id,type:"release"},preSetup:k(e,c),test:l(d)}},n=function(){var a={us:"User Story",feature:"Feature",bug:"Bug"},b={prototype:"Prototype"},c={proto:"Proto Iter",release:"prototype"},d={bug_closed:{name:"Closed",isFinal:!0,entityType:"bug"}},e={b1:{name:"Critical Bug",release:"prototype",iteration:"proto",entityState:"bug_closed"}},f={entityTypes:a,releases:b,entityStates:d,bugs:e,iterations:c},g={bugs:["Critical Bug"],features:[],userStories:[]};return m("test39909",f,{release:"prototype",willReturn:{bug:["b1"],feature:[],userStory:[]}},g)},o=function(){var a={us:"User Story",feature:"Feature",bug:"Bug"},b={prototype:"Prototype"},c={bug_closed:{name:"Closed",isFinal:!0,entityType:"bug"}},d={b1:{name:"Critical Bug",release:"prototype",entityState:"bug_closed"}},e={entityTypes:a,releases:b,entityStates:c,bugs:d},f={bugs:["Critical Bug"],features:[],userStories:[]};return m("test39908",e,{release:"prototype",willReturn:{bug:["b1"],feature:[],userStory:[]}},f)},p=function(){var a={us:"User Story",feature:"Feature"},b={prototype:"Prototype",first:"Fist Release"},c={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},d={f1:{name:"F#1",release:"first",entityState:"feature_open",userStories:["us1_1"]}},e={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_closed"}},f={entityTypes:a,releases:b,entityStates:c,features:d,us:e},g={bugs:[],features:[],userStories:["US#1.1"]};return m("test39907",f,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:["us1_1"]}},g)},q=function(){var a={us:"User Story",feature:"Feature"},b={prototype:"Prototype",first:"Fist Release"},c={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},d={f1:{name:"F#1",release:"prototype",entityState:"feature_open",userStories:["us1_1"]}},e={us1_1:{name:"US#1.1",release:"first",entityState:"us_closed"}},f={entityTypes:a,releases:b,entityStates:c,features:d,us:e},g={bugs:[],features:[],userStories:[]};return m("test39902",f,{release:"prototype",willReturn:{bug:[],feature:[],userStory:[]}},g)},r=function(){var a={us:"User Story",feature:"Feature"},b={prototype:"Prototype"},c={proto:"Proto Iteration"},d={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},e={f1:{name:"F#1",release:"prototype",entityState:"feature_open",userStories:["us1_1"]}},f={us1_1:{name:"US#1.1",release:"prototype",iteration:"proto",entityState:"us_closed"}},g={entityTypes:a,releases:b,entityStates:d,features:e,iterations:c,us:f},h={bugs:[],features:{"F#1":["US#1.1"]},userStories:[]};return m("test39901",g,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},h)},s=function(){var a={us:"User Story",feature:"Feature"},b={prototype:"Prototype"},c={proto:"Proto Iteration"},d={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},e={f1:{name:"F#1",release:"prototype",entityState:"feature_open",userStories:["us1_1"]}},f={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_closed"}},g={entityTypes:a,releases:b,entityStates:d,features:e,iterations:c,us:f},h={bugs:[],features:{"F#1":["US#1.1"]},userStories:[]};return m("test39899",g,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},h)},t=function(){var a={us:"User Story",feature:"Feature"},b={prototype:"Prototype"},c={proto:"Proto Iteration"},d={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},e={f1:{name:"F#1",release:"prototype",entityState:"feature_open"},f2:{name:"F#2",release:"prototype",entityState:"feature_closed"}},f={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_closed"}},g={entityTypes:a,releases:b,entityStates:d,features:e,iterations:c,us:f},h={bugs:[],features:[],userStories:[]};return m("test39897",g,{release:"prototype",willReturn:{bug:[],feature:["f2"],userStory:[]}},h)},u=function(){var a={us:"User Story",feature:"Feature"},b={prototype:"Prototype"},c={proto:"Proto Iteration"},d={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_open:{name:"Open",isFinal:!1,entityType:"us"}},e={f1:{name:"F#1",release:"prototype",entityState:"feature_open"}},f={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_open"}},g={entityTypes:a,releases:b,entityStates:d,features:e,iterations:c,us:f},h={bugs:[],features:[],userStories:[]};return m("test39898",g,{release:"prototype",willReturn:{bug:[],feature:[],userStory:[]}},h)},v=function(){var a={us:"User Story",feature:"Feature"},b={prototype:"Prototype"},c={proto:"Proto Iteration"},d={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_open:{name:"Open",isFinal:!1,entityType:"us"}},e={f1:{name:"F#1",release:"prototype",entityState:"feature_closed",userStories:["us1_1"]}},f={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_open"}},g={entityTypes:a,releases:b,entityStates:d,features:e,iterations:c,us:f},h={bugs:[],features:{"F#1":[]},userStories:[]};return m("test39903",g,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},h)},w=function(){var a={us:"User Story",feature:"Feature",bug:"Bug"},b={prototype:"Prototype"},c={proto:"Proto Iteration"},d={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},bug_open:{name:"Open",isFinal:!1,entityType:"bug"}},e={f1:{name:"F#1",release:"prototype",entityState:"feature_closed",userStories:["us1_1"]}},f={bug1:{name:"Critical Bug",release:"prototype",entityState:"bug_open"}},g={entityTypes:a,releases:b,entityStates:d,iterations:c,bug:f},h={bugs:[],features:[],userStories:[]};return m("test39910",g,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},h)},x=function(){var a={us:"User Story",feature:"Feature",bug:"Bug"},b={prototype:"Prototype"},c={proto:"Proto Iteration"},d={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"},bug_open:{name:"Open",isFinal:!1,entityType:"bug"}},e={us1_1:{name:"Test Story",release:"prototype",entityState:"us_closed"}},f={f1:{name:"F#1",release:"prototype",entityState:"feature_closed"}},g={bug1:{name:"Critical Bug",release:"prototype",entityState:"bug_open"}},h={entityTypes:a,releases:b,entityStates:d,userStories:e,iterations:c,bug:g},i={bugs:[],features:[],userStories:["Test Story"]};return m("test39905",h,{release:"prototype",willReturn:{bug:[],feature:[],userStory:["us1_1"]}},i)},y=function(){var a=new b,f={context:{applicationContext:a}};c(f.context);var g=[],i=d.create("[component.releaseNotes]",g,h,f,a),j={context:null},k=e.create(i,j);k.viewShouldPassTests([n(),o(),p(),q(),r(),s(),t(),u(),v(),w(),x()]).done()};return{run:y}})