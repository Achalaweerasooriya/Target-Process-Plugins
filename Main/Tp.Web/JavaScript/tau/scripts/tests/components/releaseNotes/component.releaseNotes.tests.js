define(["Underscore","jQuery","tau/configurator","tests/common/applicationContext.simple","tau/models/dataprocessor/model.processor.context","tests/components/common/common.setup","tests/components/component.specs","tests/common/service.mock","tau/utils/utils.fixturesLoader","tau/components/component.releaseNotes"],function(_,$,configurator,AppContext,ContextProcessor,CommonSetup,CommonSpec,ServiceMock,FixturesLoader,Component){var loader=new FixturesLoader({generateId:!0,setType:!0}),generateCommands=function(service,data,config){var entity=data.release[config.release],returnedData={};_.forEach(["bug","userStory","feature"],function(name){returnedData[name]=[],_.forEach(data[name],function(value,key){_.indexOf(config.willReturn[name],key)>-1&&returnedData[name].push(value)})}),service.registerFindCommand({config:{fields:["id","name"],$query:{"Release.Id":entity.id,"EntityState.isFinal":1},$orderBy:"id"},returnedData:returnedData.bug}),service.registerFindCommand({config:{fields:["id","name",{release:["id"]},{entityState:["id","isFinal"]},{userStories:["id","name",{release:["id"]},{entityState:["id","isFinal"]}],list:!0}],$query:{"Release.Id":entity.id},$orderBy:"id"},returnedData:returnedData.feature}),service.registerFindCommand({config:{fields:["id","name",{release:["id"]},{feature:["id"]},{entityState:["id","isFinal"]}],$query:{"Release.Id":entity.id,"EntityState.isFinal":1},$orderBy:"id"},returnedData:returnedData.userStory})},generatePreSetup=function(sourceData,config){var entity=sourceData.release[config.release];return function(){this.service=new ServiceMock,this.sourceData=sourceData,this.entity=entity,configurator.setService(this.service),generateCommands(this.service,sourceData,config),_.forEach(_.keys(this.sourceData),function(collectionName){configurator.getProxy().markRecordSetAsCompleteLoaded(collectionName)});var data=[];_.forEach(this.sourceData,function(collection,name){data=data.concat(_.values(collection))}),configurator.setInitialData(data)}},generateTest=function(output){return function(){var $parent=this.$el;equals($parent.length,1,"Rendered");var $el=$parent.find(".tau-releaseNotes__inner");equals($el.length,1,"Rendered");var $title=$parent.find(".tau-releaseNotes__title");ok($title.text().match(this.entity.name),"Release name"),(output.userStories.length||_.keys(output.features).length)&&equals($el.find('.tau-releaseNotes__subtitle:contains("Added features")').length,1,"Title rendered");var $features=$el.find(".tau-releaseNotes__feature");equals($features.length,_.keys(output.features).length,"Rendered features");var i=0;_.forEach(output.features,function(userStories,s){var $feature=$features.eq(i);equals($feature.length,1,"Render item"),equals($feature.data("name"),s,"Output ok");var $userStories=$feature.find(".tau-releaseNotes__userstory");equals($userStories.length,userStories.length,"Rendered user stories"),_.forEach(userStories,function(s,k){equals($userStories.eq(k).length,1,"Render item"),equals($userStories.eq(k).data("name"),s,"Output ok")}),i++});var $userStories=$el.find(".tau-releaseNotes__userstory_separate_true");equals($userStories.length,output.userStories.length,"Rendered user stories"),_.forEach(output.userStories,function(s,k){equals($userStories.eq(k).length,1,"Render item"),equals($userStories.eq(k).data("name"),s,"Output ok")}),output.bugs.length&&equals($el.find('.tau-releaseNotes__subtitle:contains("Fixed Bugs")').length,1,"Title rendered");var $bugs=$el.find(".tau-releaseNotes__bug");equals($bugs.length,output.bugs.length,"Rendered bugs"),_.forEach(output.bugs,function(s,k){equals($bugs.eq(k).length,1,"Render item"),equals($bugs.eq(k).data("name"),s,"Output ok")}),this.service.verify()}},createTest=function(name,fixtures,config,output){var data=loader.load(fixtures),entity=data.release[config.release];return{name:name,context:{id:entity.id,type:"release"},preSetup:generatePreSetup(data,config),test:generateTest(output)}},test39909=function(){var entityTypes={us:"User Story",feature:"Feature",bug:"Bug"},releases={prototype:"Prototype"},iterations={proto:"Proto Iter",release:"prototype"},entityStates={bug_closed:{name:"Closed",isFinal:!0,entityType:"bug"}},bugs={b1:{name:"Critical Bug",release:"prototype",iteration:"proto",entityState:"bug_closed"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,bugs:bugs,iterations:iterations},output={bugs:["Critical Bug"],features:[],userStories:[]};return createTest("test39909",fixtures,{release:"prototype",willReturn:{bug:["b1"],feature:[],userStory:[]}},output)},test39908=function(){var entityTypes={us:"User Story",feature:"Feature",bug:"Bug"},releases={prototype:"Prototype"},entityStates={bug_closed:{name:"Closed",isFinal:!0,entityType:"bug"}},bugs={b1:{name:"Critical Bug",release:"prototype",entityState:"bug_closed"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,bugs:bugs},output={bugs:["Critical Bug"],features:[],userStories:[]};return createTest("test39908",fixtures,{release:"prototype",willReturn:{bug:["b1"],feature:[],userStory:[]}},output)},test39907=function(){var entityTypes={us:"User Story",feature:"Feature"},releases={prototype:"Prototype",first:"Fist Release"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},features={f1:{name:"F#1",release:"first",entityState:"feature_open",userStories:["us1_1"]}},us={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_closed"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,features:features,us:us},output={bugs:[],features:[],userStories:["US#1.1"]};return createTest("test39907",fixtures,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:["us1_1"]}},output)},test39902=function(){var entityTypes={us:"User Story",feature:"Feature"},releases={prototype:"Prototype",first:"Fist Release"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_open",userStories:["us1_1"]}},us={us1_1:{name:"US#1.1",release:"first",entityState:"us_closed"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,features:features,us:us},output={bugs:[],features:[],userStories:[]};return createTest("test39902",fixtures,{release:"prototype",willReturn:{bug:[],feature:[],userStory:[]}},output)},test39901=function(){var entityTypes={us:"User Story",feature:"Feature"},releases={prototype:"Prototype"},iterations={proto:"Proto Iteration"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_open",userStories:["us1_1"]}},us={us1_1:{name:"US#1.1",release:"prototype",iteration:"proto",entityState:"us_closed"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,features:features,iterations:iterations,us:us},output={bugs:[],features:{"F#1":["US#1.1"]},userStories:[]};return createTest("test39901",fixtures,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},output)},test39899=function(){var entityTypes={us:"User Story",feature:"Feature"},releases={prototype:"Prototype"},iterations={proto:"Proto Iteration"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_open",userStories:["us1_1"]}},us={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_closed"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,features:features,iterations:iterations,us:us},output={bugs:[],features:{"F#1":["US#1.1"]},userStories:[]};return createTest("test39899",fixtures,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},output)},test39897=function(){var entityTypes={us:"User Story",feature:"Feature"},releases={prototype:"Prototype"},iterations={proto:"Proto Iteration"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_open"},f2:{name:"F#2",release:"prototype",entityState:"feature_closed"}},us={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_closed"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,features:features,iterations:iterations,us:us},output={bugs:[],features:[],userStories:[]};return createTest("test39897",fixtures,{release:"prototype",willReturn:{bug:[],feature:["f2"],userStory:[]}},output)},test39898=function(){var entityTypes={us:"User Story",feature:"Feature"},releases={prototype:"Prototype"},iterations={proto:"Proto Iteration"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_open:{name:"Open",isFinal:!1,entityType:"us"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_open"}},us={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_open"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,features:features,iterations:iterations,us:us},output={bugs:[],features:[],userStories:[]};return createTest("test39898",fixtures,{release:"prototype",willReturn:{bug:[],feature:[],userStory:[]}},output)},test39903=function(){var entityTypes={us:"User Story",feature:"Feature"},releases={prototype:"Prototype"},iterations={proto:"Proto Iteration"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_open:{name:"Open",isFinal:!1,entityType:"us"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_closed",userStories:["us1_1"]}},us={us1_1:{name:"US#1.1",release:"prototype",entityState:"us_open"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,features:features,iterations:iterations,us:us},output={bugs:[],features:{"F#1":[]},userStories:[]};return createTest("test39903",fixtures,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},output)},test39910=function(){var entityTypes={us:"User Story",feature:"Feature",bug:"Bug"},releases={prototype:"Prototype"},iterations={proto:"Proto Iteration"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},bug_open:{name:"Open",isFinal:!1,entityType:"bug"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_closed",userStories:["us1_1"]}},bug={bug1:{name:"Critical Bug",release:"prototype",entityState:"bug_open"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,iterations:iterations,bug:bug},output={bugs:[],features:[],userStories:[]};return createTest("test39910",fixtures,{release:"prototype",willReturn:{bug:[],feature:["f1"],userStory:[]}},output)},test39905=function(){var entityTypes={us:"User Story",feature:"Feature",bug:"Bug"},releases={prototype:"Prototype"},iterations={proto:"Proto Iteration"},entityStates={feature_open:{name:"Open",isFinal:!1,entityType:"feature"},feature_closed:{name:"Closed",isFinal:!0,entityType:"feature"},us_closed:{name:"Closed",isFinal:!0,entityType:"us"},bug_open:{name:"Open",isFinal:!1,entityType:"bug"}},us={us1_1:{name:"Test Story",release:"prototype",entityState:"us_closed"}},features={f1:{name:"F#1",release:"prototype",entityState:"feature_closed"}},bug={bug1:{name:"Critical Bug",release:"prototype",entityState:"bug_open"}},fixtures={entityTypes:entityTypes,releases:releases,entityStates:entityStates,userStories:us,iterations:iterations,bug:bug},output={bugs:[],features:[],userStories:["Test Story"]};return createTest("test39905",fixtures,{release:"prototype",willReturn:{bug:[],feature:[],userStory:["us1_1"]}},output)},innerRun=function(){var appContext=new AppContext,config={context:{applicationContext:appContext}};ContextProcessor(config.context);var data=[],setup=CommonSetup.create("[component.releaseNotes]",data,Component,config,appContext),specConfig={context:null},spec=CommonSpec.create(setup,specConfig);spec.viewShouldPassTests([test39909(),test39908(),test39907(),test39902(),test39901(),test39899(),test39897(),test39898(),test39903(),test39910(),test39905()]).done()};return{run:innerRun}})