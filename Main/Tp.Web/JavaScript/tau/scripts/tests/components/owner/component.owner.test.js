define(["jQuery","tests/common/testkit","tau/components/component.property.owner"],function($,ComponentTestKit,Component){var run=function(){var TestCase=new ComponentTestKit("[component.property.owner]",Component),projects={pr1:{name:"Proj",projectMembers:["pm1","pm2","pm4"]}},projectMembers={pm1:{role:"admin",user:"u1"},pm2:{role:"developer",user:"u2"},pm3:{role:"developer",user:"u3"},pm4:{role:"qa",user:"u4"}},bugs={b1:{name:"Bug",owner:"gu1",project:"pr1"}},generalUsers={gu1:{id:1,firstName:"Ron",lastName:"Jeremy",role:"admin",isActive:!0,kind:"User"},gu2:{id:2,firstName:"Sasha",lastName:"Grey",role:"developer",isActive:!0,deleteDate:"12-Dec-2012",kind:"User"},gu3:{id:3,firstName:"Max",lastName:"Hardcore",role:"developer",isActive:!0,kind:"User"},gu4:{id:4,firstName:"Bree",lastName:"Olson",role:"qa",isActive:!0,kind:"User"},gu5:{id:5,firstName:"Jenna",lastName:"Jameson",isActive:!0,kind:"Requester"},gu6:{id:6,firstName:"",lastName:"",email:"kingsize@example.com",isActive:!0,kind:"Requester"}},users={u1:{id:1,firstName:"Ron",lastName:"Jeremy",role:"admin",isActive:!0},u2:{id:2,firstName:"Sasha",lastName:"Grey",role:"developer",isActive:!0,deleteDate:"12-Dec-2012"},u3:{id:3,firstName:"Max",lastName:"Hardcore",role:"developer",isActive:!0},u4:{id:4,firstName:"Bree",lastName:"Olson",role:"qa",isActive:!0}},roles={admin:"Admin",developer:"Developer",qa:"QA"},data=TestCase.loadFixtures({generalUsers:generalUsers,users:users,projects:projects,projectMembers:projectMembers,roles:roles,bugs:bugs});return TestCase.setData(data),TestCase.setEntity(data.bug.b1),TestCase.selectProject(data.project.pr1),TestCase.addTest({name:"should render valid markup",test:function(){var $el=this.$el;equal($el.find("[role=avatar]").length,1,"Avatar src"),equal($el.find("[role=username]").text(),"Ron Jeremy","User name")}}),TestCase.addTest({name:"should change owner",test:function(){var $el=this.$el,$trigger=$el.find("[role=username]");$trigger.click();var $bubble=$trigger.parents(".owner:first").tauBubble("widget");equal($bubble.size(),1,"Count of bubbles");var $options=$bubble.find("[role=user]");equals($options.length,2,"Options correct");var $groups=$bubble.find("[role=user-group]");equals($groups.length,2,"Options correct"),equals($groups.eq(0).text(),"Developer"),equals($groups.eq(1).text(),"QA");var $option=$options.eq(0);equals(_.trim($option.text()),"Sasha Grey"),equals(_.trim($options.eq(1).text()),"Bree Olson");var newOwner=data.generalUser.gu2,entity=data.bug.b1;TestCase.getService().registerSaveCommand({config:{$set:{owner:{id:newOwner.id}},fields:["id",{owner:["id","firstName","lastName","email"]}],id:entity.id},returnedData:{id:entity.id,owner:newOwner}}),$option.click(),equal(this.$el.find("[role=username]").text(),"Sasha Grey","Owner was changed"),TestCase.getService().verify()}}),TestCase.run()};return{run:run}})