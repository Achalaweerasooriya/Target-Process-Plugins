define(["Underscore","jQuery","tau/core/tau","tau/components/component.attachmentsPreview","tests/common/testData","tests/components/common/common.setup","tests/components/component.specs"],function(a,b,c,d,e,f,g){var h=function(){function n(a){var b=this.$el,c=j.items[a],d=b.find(".thumbnail-nav > li > .selected");equal(d.length,1,"Count of selected items is valid"),ok(b.find(".thumbnail-nav > li > img").eq(a).is(".selected"),"Attachment was selected"),equal(b.find(".ui-attachment-view-image").attr("src"),c.uri,"Main image url was changed")}function m(a){var b=this.$el.find("> .thumbnail-nav > li > img.ui-attach-thumbnail");ok(b.eq(a).is(".selected"),"Selected image is highlighted")}function k(a,b){var c=a.attr("src");equal(c,b.thumbnailUri,"Style is valid")}var a=e.getDataForAttachments(),c=a[0],h={context:{type:"bug",id:c.id},settings:{selected:{id:c.attachments[0].id}}},i=[Similar.to({name:"get",type:"bug",config:Like.is({id:c.id,fields:["id",Similar.to({attachments:["id","date","name","mimeType","uri","thumbnailUri",Similar.to({owner:["id","firstName","lastName"]})]})]})})],j={items:[{id:550,name:"Attachment1",mimeType:"image/jpg",ownerName:"John Brown",date:"4/12/2011",thumbnailUri:"#../../images/thumbnail_1.jpg",uri:"#../../images/1.jpg",selected:!0},{id:552,name:"Attachment3",mimeType:"image/jpg",ownerName:"Andrew Gray",date:"6/9/2011",thumbnailUri:"#../../images/thumbnail_3.jpg",uri:"#../../images/3.jpg"},{id:553,name:"Attachment4",mimeType:"image/jpg",ownerName:"Andrew Gray",date:"6/9/2011",thumbnailUri:"#../../images/thumbnail_4.jpg",uri:"#../../images/4.jpg"}],selected:{id:550,name:"Attachment1",mimeType:"image/jpg",ownerName:"John Brown",date:"4/12/2011",thumbnailUri:"#../../images/thumbnail_1.jpg",uri:"#../../images/1.jpg",selected:!0}},l=function(){var a=this;this.component.on("afterRender",function(c){var d=a.$el=c.data.element;a.$container=b("<div></div>").append(d),a.onContainerClickCount=0,a.onContainerClickHandler=function(){a.onContainerClickCount++},a.$container.bind("click",a.onContainerClickHandler)})},o=[{name:"should render valid markup",test:function(){var a=this.$el,b=j.selected,c=0,d=a.find("> .swap-view > .image-view img.ui-attachment-view-image"),e=a.find("> .thumbnail-nav > li > img.ui-attach-thumbnail"),f=a.find(".ui-attachments-preview-control > *"),g=a.find(".toolbar .close");ok(g.size()==1,'"Close" control is found'),equal(g.text().trim(),"X","Close button text is valid");var h=a.find(".toolbar .prev");ok(h.size()==1,'"Prev" control is found'),equal(h.text(),"←","Prev button text is valid");var i=a.find(".toolbar .next");ok(i.size()==1,'"Next" control is found'),equal(i.text(),"→","Next button text is valid"),equal(d.attr("src"),b.uri,"Selected image src is valid"),equal(e.length,j.items.length,"Count of attachments is valid");for(var l=0;l<j.items.length;l++)k(e.eq(l),j.items[l]);m.call(this,c)}},{name:"should select image when thumbnail click",test:function(){var a=this,c=a.$el,d=!1,e=c.find(".thumbnail-nav >li img.ui-attach-thumbnail");e.each(function(c){d=!1;var e=b(this);e.is(".selected")||(e.click(),n.call(a,c))}),equal(a.onContainerClickCount,0,"Count of body click is zero")}},{name:"should close when user click on close button ",test:function(){var a,b=function(){a=!0};this.component.on("closed",b),this.$el.find(".toolbar .close").click(),ok(a,"closed event was fired"),equal(this.$container.children().length,0,"Attachment preview was removed from container")}},{name:"should close when user click on empty space",test:function(){var a,b=function(){a=!0};this.component.on("closed",b),this.$el.click(),ok(a,"closed event was fired"),equal(this.$container.children().length,0,"Attachment preview was removed from container")}},{name:"should  closeClick when user esc button press",test:function(){var a,c=function(){a=!0};this.component.on("closed",c),b(document).simulate("keydown",{keyCode:b.ui.keyCode.ESCAPE}),ok(a,"closed event was fired")}},{name:"should handle prev button click",test:function(){var a=this.$el,b={},c=a.find(".toolbar .prev");c.click(),n.call(this,2),c.click(),n.call(this,1),c.click(),n.call(this,0),equal(this.onContainerClickCount,0,"Count of body click is zero")}},{name:"should handle next button click",test:function(){var a=this.$el,b={},c=a.find(".toolbar .next");c.click(),n.call(this,1),c.click(),n.call(this,2),c.click(),n.call(this,0),equal(this.onContainerClickCount,0,"Count of body click is zero")}}],p=f.create("[component.attachmentsPreview]",a,d);g.create(p,h).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(j,[i]).viewShouldPassTests(o,l).done()};return{run:h}})