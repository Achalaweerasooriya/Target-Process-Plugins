define(["Underscore","jQuery","tau/core/tau","tau/components/component.attachmentsPreview","tests/common/testData","tests/components/common/common.setup","tests/components/component.specs"],function(_,$,a,b,c,d,e){var f=function(){function j(a,b){var c=a.attr("src");equal(c,b.thumbnailUri,"Style is valid")}function l(a){var b=this.$el.find("> .thumbnail-nav > li > img.ui-attach-thumbnail");ok(b.eq(a).is(".selected"),"Selected image is highlighted")}function m(a){var b=this.$el,c=i.items[a],d=b.find(".thumbnail-nav > li > .selected");equal(d.length,1,"Count of selected items is valid"),ok(b.find(".thumbnail-nav > li > img").eq(a).is(".selected"),"Attachment was selected"),equal(b.find(".ui-attachment-view-image").attr("src"),c.uri,"Main image url was changed")}var a=c.getDataForAttachments(),f=a[0],g={context:{type:"bug",id:f.id},settings:{selected:{id:f.attachments[0].id}}},h=[Similar.to({name:"get",type:"bug",config:Like.is({id:f.id,fields:["id",Similar.to({attachments:["id","date","name","mimeType","uri","thumbnailUri",Similar.to({owner:["id","firstName","lastName"]})]})]})})],i={items:[{id:550,name:"Attachment1",mimeType:"image/jpg",ownerName:"John Brown",date:"12-Apr-2011",thumbnailUri:"#../../images/thumbnail_1.jpg",uri:"#../../images/1.jpg",selected:!0},{id:552,name:"Attachment3",mimeType:"image/jpg",ownerName:"Andrew Gray",date:"9-Jun-2011",thumbnailUri:"#../../images/thumbnail_3.jpg",uri:"#../../images/3.jpg"},{id:553,name:"Attachment4",mimeType:"image/jpg",ownerName:"Andrew Gray",date:"9-Jun-2011",thumbnailUri:"#../../images/thumbnail_4.jpg",uri:"#../../images/4.jpg"}],selected:{id:550,name:"Attachment1",mimeType:"image/jpg",ownerName:"John Brown",date:"12-Apr-2011",thumbnailUri:"#../../images/thumbnail_1.jpg",uri:"#../../images/1.jpg",selected:!0}},k=function(){var a=this;this.component.on("afterRender",function(b){var c=a.$el=b.data.element;a.$container=$("<div></div>").append(c),a.onContainerClickCount=0,a.onContainerClickHandler=function(){a.onContainerClickCount++},a.$container.bind("click",a.onContainerClickHandler)})},n=[{name:"should render valid markup",test:function(){var a=this.$el,b=i.selected,c=0,d=a.find("> .swap-view > .image-view img.ui-attachment-view-image"),e=a.find("> .thumbnail-nav > li > img.ui-attach-thumbnail"),f=a.find(".ui-attachments-preview-control > *"),g=a.find(".toolbar .close");ok(g.size()==1,'"Close" control is found'),equal(g.text().trim(),"X","Close button text is valid");var h=a.find(".toolbar .prev");ok(h.size()==1,'"Prev" control is found'),equal(h.text(),"←","Prev button text is valid");var k=a.find(".toolbar .next");ok(k.size()==1,'"Next" control is found'),equal(k.text(),"→","Next button text is valid"),equal(d.attr("src"),b.uri,"Selected image src is valid"),equal(e.length,i.items.length,"Count of attachments is valid");for(var m=0;m<i.items.length;m++)j(e.eq(m),i.items[m]);l.call(this,c)}},{name:"should select image when thumbnail click",test:function(){var a=this,b=a.$el,c=!1,d=b.find(".thumbnail-nav >li img.ui-attach-thumbnail");d.each(function(b){c=!1;var d=$(this);d.is(".selected")||(d.click(),m.call(a,b))}),equal(a.onContainerClickCount,0,"Count of body click is zero")}},{name:"should close when user click on close button ",test:function(){var a,b=function(){a=!0};this.component.on("closed",b),this.$el.find(".toolbar .close").click(),ok(a,"closed event was fired"),equal(this.$container.children().length,0,"Attachment preview was removed from container")}},{name:"should close when user click on empty space",test:function(){var a,b=function(){a=!0};this.component.on("closed",b),this.$el.click(),ok(a,"closed event was fired"),equal(this.$container.children().length,0,"Attachment preview was removed from container")}},{name:"should  closeClick when user esc button press",test:function(){var a,b=function(){a=!0};this.component.on("closed",b),$(document).simulate("keydown",{keyCode:$.ui.keyCode.ESCAPE}),ok(a,"closed event was fired")}},{name:"should handle prev button click",test:function(){var a=this.$el,b={},c=a.find(".toolbar .prev");c.click(),m.call(this,2),c.click(),m.call(this,1),c.click(),m.call(this,0),equal(this.onContainerClickCount,0,"Count of body click is zero")}},{name:"should handle next button click",test:function(){var a=this.$el,b={},c=a.find(".toolbar .next");c.click(),m.call(this,1),c.click(),m.call(this,2),c.click(),m.call(this,0),equal(this.onContainerClickCount,0,"Count of body click is zero")}}],o=d.create("[component.attachmentsPreview]",a,b);e.create(o,g).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(i,[h]).viewShouldPassTests(n,k).done()};return{run:f}})