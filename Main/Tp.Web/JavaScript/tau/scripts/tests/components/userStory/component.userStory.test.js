define(["jQuery","Underscore","tau/components/component.property.userStory","tests/components/component.specs","tests/common/testData.Generator","tests/common/service.mock","tau/configurator","tests/components/common/common.setup"],function(a,b,c,d,e,f,g,h){var i=function(){var i=new e;i.initDefaultData();var j=i.getData(),k=i.getProjects(),l=i.getBugs()[0],m=i.getUserStories(),n=k[1],o={manualContext:!0,context:{entity:{entityType:{name:l.__type},id:l.id},applicationContext:{selectedProjects:[n],culture:{name:"en-US",timePattern:"g:i A",shortDateFormat:"M/d/yyyy",longDateFormat:"dddd, MMMM dd, yyyy",decimalSeparator:".",__type:"culture"},processes:i.getProcesses()}}},p=l.userStory,q=m[2],r=h.create("[component.userStory]",j,c,o),s=[{name:"should render valid markup",test:function(){var a=this.$el;equal(a.find(".property-text").text(),p.name,"Release name"),equal(a.find(".external-view").attr("href"),["/TP/View.aspx?id=",p.id].join(""),"Release name")}},{name:"should change user story",preSetup:function(){var a=this.service=new f;g.setService(a),g.getProxy().markRecordSetAsCompleteLoaded("userStory")},test:function(){var b=this.$el,c=b;c.click();var d=a(".tau-bubble");equal(d.size(),1,"Count of bubbles");var e=d.find(".drop-down-group.i-group");equal(e.size(),1,"Count of projects"),equal(e.eq(0).find(".i-group-name").text(),k[0].name,"Order of first project");var f=d.eq(0).find('.drop-down-option:contains("'+q.name+'")');this.service.registerSaveCommand({config:{$set:{userStory:{id:q.id}},fields:["id"],id:l.id},returnedData:{id:l.id,UserStory:{Id:q.id,Name:q.name}}}),equal(d.find(".action-link.clear").text(),"reset","Reset button is  available"),f.click(),equal(this.$el.find(".property-text").text(),q.name,"Release was changed")}}];d.create(r,o).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests(s).done();var t=i.getBugs()[1],u={manualContext:!0,context:{entity:{entityType:{name:t.__type},id:t.id},applicationContext:{selectedProjects:[n],culture:{name:"en-US",timePattern:"g:i A",shortDateFormat:"M/d/yyyy",longDateFormat:"dddd, MMMM dd, yyyy",decimalSeparator:".",__type:"culture"},processes:i.getProcesses()}}},v=h.create("[component.userStory] empty",j,c,u);d.create(v,u).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests([{name:"should render valid markup for empty UserStory",preSetup:function(){g.getProxy().markRecordSetAsCompleteLoaded("userStory")},test:function(){var b=this.$el;equal(b.find(".property-text").text(),"","UserStory name"),b.click();var c=a(".tau-bubble");equal(c.size(),1,"Tau bubble is visible");var d=c.eq(0).find(".drop-down-option");equal(c.find(".action-link.clear").size(),0,"Reset button is not available")}}]).done(),i.clear(),i.initDefaultData(),i.removeUserStoriesFromProject();var j=b.select(i.getData(),function(a){return a.__type!=="userStory"}),w=h.create("[component.userStory] not user stories ",j,c,u);d.create(w,u).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests([{name:"should show no user stories found",preSetup:function(){g.getProxy().markRecordSetAsCompleteLoaded("userStory")},test:function(){var b=this.$el;b.click();var c=a(".tau-bubble");equal(c.find(".empty-message").text(),"No user stories found","Empty message is valid")}}]).done()};return{run:i}})