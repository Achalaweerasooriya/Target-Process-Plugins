define(["tau/components/extensions/context.convert.extension","tau/core/bus","tests/common/applicationContext.simple","tau/service.container"],function(Extension,Bus,Context,ServiceContainer){var innerRun=function(){var createComponentContext=function(){var c=new ServiceContainer;c.isBoardEdition=!1;var config={configurator:c};return config};module("[context.convert.extension]"),test("on create config event configuration is converted",function(){var bus=new Bus({"queue.bus":!0}),extension=new Extension({bus:bus,context:createComponentContext()}),context=new Context;context.selectDefaultProject(),context.excludePractices(["Test Cases"]),context=context.process();var config={children:[{type:"testCaseList",practices:["Test Cases"]}]};config.context=context,bus.fire("onConfigContainerCreated",config),equals(config.children.length,0,"convert is performed"),config={children:[{type:"tabs",tabs:[{items:[{type:"testCaseList",practices:["Test Cases"]}]}]}]},config.context=context,bus.fire("onConfigContainerCreated",config),equals(config.children.length,0,"convert is performed"),config={children:[{type:"tab",items:[{type:"testCaseList",practices:["Planning"]},{type:"testCaseList",practices:["Test Cases"]}]}]},config.context=context,bus.fire("onConfigContainerCreated",config),equals(config.children.length,1,"convert is performed"),equals(config.children[0].items.length,1,"convert is performed"),config={children:[{type:"tabs",tabs:[{type:"tab",header:[{type:"label",text:[{value:"planning",practices:["Planning"]},{value:"test",practices:["Test Cases"]}]}],items:[{type:"testCaseList",practices:["Planning"]},{type:"testCaseList",practices:["Test Cases"]}]}]}]},config.context=context,bus.fire("onConfigContainerCreated",config),equals(config.children[0].tabs[0].header[0].text.length,1,"convert is performed"),equals(config.children[0].tabs[0].header[0].text[0].value,"planning","convert is performed"),config={children:[{type:"tabs",tabs:[{type:"tab",items:[{type:"label"}]}],additionalHeaders:[{type:"menu.actions",items:[{label:"hi"},{label:"preved",practices:["Planning"]},{label:"medved",practices:["Test Cases"]},{label:"zzz",practices:["Test Cases","Planning"]}]}]}]},config.context=context,bus.fire("onConfigContainerCreated",config);var items=config.children[0].additionalHeaders[0].items;equals(items.length,3,"convert is performed"),equals(items[0].label,"hi","convert is performed"),equals(items[1].label,"preved","convert is performed"),equals(items[2].label,"zzz","convert is performed"),config={children:[{type:"tabs",tabs:[{type:"tab",items:[{type:"additionalInfo",children:[{label:{type:"label",text:"Owner"},field:{type:"owner"},practices:["Test Cases"]},{label:{type:"label",text:"Priority"},field:{type:"priority"}}]},{type:"testCaseList",practices:["Test Cases"]}]}]}]},config.context=context,bus.fire("onConfigContainerCreated",config);var info=config.children[0].tabs[0].items[0];equals(info.children.length,1,"convert is performed"),equals(info.children[0].field.type,"priority","convert is performed")}),test("should allow special syntax",function(){var bus=new Bus,extension=new Extension({bus:bus,context:createComponentContext()}),context=new Context;context.selectDefaultProject(),context.excludePractices(["Test Cases"]),context=context.process();var config={children:[{type:"testCaseList",practices:["~Test Cases"]}]};config.context=context,bus.fire("onConfigContainerCreated",config),equals(config.children.length,1,"convert is performed"),config={children:[{type:"tabs",tabs:[{items:[{type:"testCaseList",practices:["~Planning"]}]}]}]},config.context=context,bus.fire("onConfigContainerCreated",config),equals(config.children.length,0,"convert is performed")}),test("should filter edition",function(){var bus=new Bus,extension=new Extension({bus:bus,context:createComponentContext()}),context,config={children:[{type:"testCaseList",editions:["Lite"]},{type:"testCaseList2",editions:["Pro"]},{type:"testCaseList3"},{type:"testCaseList4",editions:["Lite","Pro"]}]};context=new Context,context.selectDefaultProject(),context.setEdition(["Pro"]),context.setEntity({id:435345,type:"TEST something"}),context=context.process(),config.context=context,bus.fire("onConfigContainerCreated",config),equals(config.children.length,3,"convert is performed"),equals(config.children[0].type,"testCaseList2","convert is performed")})};return{run:innerRun}})