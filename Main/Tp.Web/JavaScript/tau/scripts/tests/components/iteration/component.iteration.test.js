define(["jQuery","tau/components/component.property.iteration","tests/components/component.specs","tests/common/testData.Generator","tests/common/service.mock","tau/configurator","tests/components/common/common.setup"],function($,a,b,c,d,e,f){var g=function(){var g=new c;g.initDefaultData();var h=g.getData(),i=g.getProjects(),j=g.getBugs()[0],k=g.getIterations(),l={manualContext:!0,context:{entity:{entityType:{name:j.__type},id:j.id},applicationContext:{selectedProjects:[i[0]],culture:{name:"en-US",timePattern:"g:i A",shortDateFormat:"M/d/yyyy",longDateFormat:"dddd, MMMM dd, yyyy",decimalSeparator:".",__type:"culture"},processes:g.getProcesses()}}},m=j.iteration,n=k[4],o=f.create("[component.iteration]",h,a,l),p=[{name:"should render valid markup",test:function(){var a=this.$el;equal(a.find(".property-text").text(),m.name,"Release name"),equal(a.find("a").attr("href"),["#iteration",m.id].join("/"),"Iteration id")}},{name:"should change iteration",preSetup:function(){var a=this.service=new d;e.setService(a)},test:function(){var a=this.$el,b=a.find(".property-text");b.click();var c=$(".tau-bubble");equal(c.size(),1,"Count of bubbles");var d=c.eq(0).find('.drop-down-option:contains("'+n.name+'")');this.service.registerSaveCommand({config:{$set:{iteration:{id:n.id}},fields:["id",{release:["id","name"]}],id:j.id},returnedData:{id:j.id,iteration:{id:n.id,name:n.name}}}),equal(c.find(".action-link.clear").text(),"backlog","Backlog button is  available"),d.click(),equal(this.$el.find(".property-text").text(),n.name,"Release was changed"),this.service.verify()}}];b.create(o,l).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests(p).done();var q=g.getBugs()[1],r={manualContext:!0,context:{entity:{entityType:{name:q.__type},id:q.id},applicationContext:{selectedProjects:[i[0]],culture:{name:"en-US",timePattern:"g:i A",shortDateFormat:"M/d/yyyy",longDateFormat:"dddd, MMMM dd, yyyy",decimalSeparator:".",__type:"culture"},processes:g.getProcesses()}}};g.clear(),g.initDefaultData(),g.removeBugsFromIteration();var s=g.getData(),t=f.create("[component.iteration] empty",s,a,r);b.create(t,r).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests([{name:"should render valid markup for empty iteration",test:function(){var a=this.$el;equal(a.find(".property-text").text(),"","Iteration name"),a.find(".property-text").click();var b=$(".tau-bubble");equal(b.find(".action-link.clear").size(),0,"Backlog button is not available")}}]).done(),g.clear(),g.initDefaultData(),g.removeReleases(),g.removeBugsFromIteration(),g.removeIterations(),h=g.getData();var u=f.create("[component.iteration] not iterations",h,a,r);b.create(u,r).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests([{name:"should show no releases found",test:function(){var a=this.$el.find(".property-text");a.click();var b=$(".tau-bubble");equal(b.find(".empty-message").text(),"No iterations found","Empty message is valid")}}]).done()};return{run:g}})