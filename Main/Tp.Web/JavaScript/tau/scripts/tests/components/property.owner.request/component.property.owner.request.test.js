define(["jQuery","tests/common/testkit","tau/components/component.property.owner.request"],function($,a,b){var c=function(){var c=new a("[component.property.owner.request]",b),d={pr1:{name:"Proj",projectMembers:["pm1","pm2","pm4"]}},e={pm1:{role:"admin",user:"u1"},pm2:{role:"developer",user:"u2"},pm3:{role:"developer",user:"u3"},pm4:{role:"qa",user:"u4"}},f={r1:{name:"Req",owner:"gu1",requesters:["gu1","gu3","gu5","gu6"],project:"pr1"}},g={gu1:{id:1,firstName:"Ron",lastName:"Jeremy",role:"admin",isActive:!0,kind:"User"},gu2:{id:2,firstName:"Sasha",lastName:"Grey",role:"developer",isActive:!0,deleteDate:"12-Dec-2012",kind:"User"},gu3:{id:3,firstName:"Max",lastName:"Hardcore",role:"developer",isActive:!0,kind:"User"},gu4:{id:4,firstName:"Bree",lastName:"Olson",role:"qa",isActive:!0,kind:"User"},gu5:{id:5,firstName:"Jenna",lastName:"Jameson",isActive:!0,kind:"Requester"},gu6:{id:6,firstName:"",lastName:"",email:"kingsize@example.com",isActive:!0,kind:"Requester"}},h={u1:{id:1,firstName:"Ron",lastName:"Jeremy",role:"admin",isActive:!0},u2:{id:2,firstName:"Sasha",lastName:"Grey",role:"developer",isActive:!0,deleteDate:"12-Dec-2012"},u3:{id:3,firstName:"Max",lastName:"Hardcore",role:"developer",isActive:!0},u4:{id:4,firstName:"Bree",lastName:"Olson",role:"qa",isActive:!0}},i={admin:"Admin",developer:"Developer",qa:"QA"},j=c.loadFixtures({generalUsers:g,users:h,projects:d,projectMembers:e,roles:i,requests:f});return c.setData(j),c.setEntity(j.request.r1),c.selectProject(j.project.pr1),c.addTest({name:"should render valid markup",test:function(){var a=this.$el;equal(a.find("[role=avatar]").length,1,"Avatar src"),equal(a.find("[role=username]").text(),"Ron Jeremy","User name")}}),c.addTest({name:"should change owner",test:function(){var a=this.$el,b=a.find("[role=username]");b.click();var d=b.parents(".owner:first").tauBubble("widget");equal(d.size(),1,"Count of bubbles");var e=d.find("[role=user]");equals(e.length,4,"Options correct");var f=d.find("[role=user-group]");equals(f.length,2,"Options correct"),equals(f.eq(0).text(),"Requesters"),equals(f.eq(1).text(),"QA");var g=e.eq(0);equals(_.trim(g.text()),"Jenna Jameson");var h=j.generalUser.gu5,i=j.request.r1;c.getService().registerSaveCommand({config:{$set:{owner:{id:h.id}},fields:["id",{owner:["id","firstName","lastName","email"]}],id:i.id},returnedData:{id:i.id,owner:h}}),g.click(),equal(this.$el.find("[role=username]").text(),"Jenna Jameson","Owner was changed"),c.getService().verify()}}),c.addTest({name:"should change owner if empty",test:function(){var a=this.$el,b=a.find("[role=username]");b.click();var d=b.parents(".owner:first").tauBubble("widget");equal(d.size(),1,"Count of bubbles");var e=d.find("[role=user]");equals(e.length,4,"Options correct");var f=d.find("[role=user-group]");equals(f.length,2,"Options correct"),equals(f.eq(1).text(),"QA"),equals(f.eq(0).text(),"Requesters");var g=e.eq(1);equals(_.trim(g.text()),"kingsize@example.com");var h=j.generalUser.gu6,i=j.request.r1;c.getService().registerSaveCommand({config:{$set:{owner:{id:h.id}},fields:["id",{owner:["id","firstName","lastName","email"]}],id:i.id},returnedData:{id:i.id,owner:h}}),g.click(),equal(this.$el.find("[role=username]").text(),"kingsize@example.com","Owner was changed"),c.getService().verify()}}),c.run()};return{run:c}})