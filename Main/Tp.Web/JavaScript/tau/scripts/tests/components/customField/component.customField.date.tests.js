define(["Underscore","jQuery","tests/common/testkit","tau/components/component.customField.date","tau/utils/utils.date"],function(a,b,c,d,e){var f=function(){var a=new c("[component.customField.date]",d),e={us1:{name:"US1",customFields:[{name:"Birthday",type:"Date",value:"12-Dec-2012"}]}},f=a.loadFixtures({userStories:e});return a.setData(f),a.setEntity(f.userStory.us1),a.selectDefaultProject(),a.appContext.processes[0].customFields=[{name:"Birthday",type:"Date",required:!1,listed:!1,value:null}],a.addTest({name:"should render valid markup",test:function(){var a=this.$el;equals(a.find(".ui-customfield__label").text().trim(),"Birthday","Name is valid"),equals(a.find(".ui-customfield__value").text().trim(),"12-Dec-2012","Value is valid")}}),a.addTest({name:"should allow to edit",test:function(){var c=this.$el,d=f.userStory.us1;ok(this.$el.hasClass("ui-customfield_editable_true"),"Editable highlighting is applied");var e=this.$el.find(".ui-customfield__value");e.click(),equals(b(".ui-datepicker").length,1,"Datepicker created");var g=e.next(".ui-dateeditor").find(":input");a.getService().registerSaveCommand({config:{$set:{customFields:[{name:"Birthday",type:"Date",value:"22-Dec-2012"}]},fields:["id","customFields"],id:d.id},returnedData:{id:d.id,customFields:[{name:"Birthday",type:"Date",value:"22-Dec-2012"}]}}),g.val("12/22/2012"),b("body").click(),equals(e.hasClass("ui-validationerror"),!1,"correct date");var e=this.$el.find(".ui-customfield__value");equals(e.text(),"22-Dec-2012","Value saved")}}),a.addTest({name:"validation",test:function(){function d(d,e){var f=this.$el.find(".ui-customfield__value"),g=f.next(".ui-dateeditor").find(":input"),h=!!e;h&&a.getService().registerSaveCommand({config:{$set:{customFields:[{name:"Birthday",type:"Date",value:e}]},fields:["id","customFields"],id:c.id},returnedData:{id:c.id,customFields:[{name:"Birthday",type:"Date",value:e}]}}),g.val(d),b("body").click(),equals(f.hasClass("ui-validationerror"),!h,d+" is "+(h?"correct date":"invalid date"));if(h){var f=this.$el.find(".ui-customfield__value");equals(f.text(),e,"Converted as")}}var c=f.userStory.us1}}),a.addTest({name:"should allow to save empty",test:function(){var c=this.$el,d=f.userStory.us1;a.getService().registerSaveCommand({config:{$set:{customFields:[{name:"Birthday",type:"Date",value:null}]},fields:["id","customFields"],id:d.id},returnedData:{id:d.id,customFields:[{name:"Birthday",type:"Date",value:null}]}});var e=this.$el.find(".ui-customfield__value");e.click();var g=e.next(".ui-dateeditor").find(":input");g.val(""),b("body").click(),e=this.$el.find(".ui-customfield__value"),equals(e.text(),"","Save value")}}),a.run({customField:{type:"Date",name:"Birthday"}})};return{run:f}})