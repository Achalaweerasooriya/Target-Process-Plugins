define(["Underscore","jQuery","tests/common/testkit","tau/components/component.customField.date","tau/utils/utils.date"],function(_,$,a,b,c){var d=function(){var c=new a("[component.customField.date]",b),d={us1:{name:"US1",customFields:[{name:"Birthday",type:"Date",value:"12-Dec-2012"}]}},e=c.loadFixtures({userStories:d});return c.setData(e),c.setEntity(e.userStory.us1),c.selectDefaultProject(),c.appContext.processes[0].customFields=[{name:"Birthday",type:"Date",required:!1,listed:!1,value:null}],c.addTest({name:"should render valid markup",test:function(){var a=this.$el;equals(a.find(".ui-customfield__label").text().trim(),"Birthday","Name is valid"),equals(a.find(".ui-customfield__value").text().trim(),"12-Dec-2012","Value is valid")}}),c.addTest({name:"should allow to edit",test:function(){var a=this.$el,b=e.userStory.us1;ok(this.$el.hasClass("ui-customfield_editable_true"),"Editable highlighting is applied");var d=this.$el.find(".ui-customfield__value");d.click(),equals($(".ui-datepicker").length,1,"Datepicker created");var f=d.next(".ui-dateeditor").find(":input");c.getService().registerSaveCommand({config:{$set:{customFields:[{name:"Birthday",type:"Date",value:"22-Dec-2012"}]},fields:["id","customFields"],id:b.id},returnedData:{id:b.id,customFields:[{name:"Birthday",type:"Date",value:"22-Dec-2012"}]}}),f.val("12/22/2012"),$("body").click(),equals(d.hasClass("ui-validationerror"),!1,"correct date");var d=this.$el.find(".ui-customfield__value");equals(d.text(),"22-Dec-2012","Value saved")}}),c.addTest({name:"validation",test:function(){function b(b,d){var e=this.$el.find(".ui-customfield__value"),f=e.next(".ui-dateeditor").find(":input"),g=!!d;g&&c.getService().registerSaveCommand({config:{$set:{customFields:[{name:"Birthday",type:"Date",value:d}]},fields:["id","customFields"],id:a.id},returnedData:{id:a.id,customFields:[{name:"Birthday",type:"Date",value:d}]}}),f.val(b),$("body").click(),equals(e.hasClass("ui-validationerror"),!g,b+" is "+(g?"correct date":"invalid date"));if(g){var e=this.$el.find(".ui-customfield__value");equals(e.text(),d,"Converted as")}}var a=e.userStory.us1}}),c.addTest({name:"should allow to save empty",test:function(){var a=this.$el,b=e.userStory.us1;c.getService().registerSaveCommand({config:{$set:{customFields:[{name:"Birthday",type:"Date",value:null}]},fields:["id","customFields"],id:b.id},returnedData:{id:b.id,customFields:[{name:"Birthday",type:"Date",value:null}]}});var d=this.$el.find(".ui-customfield__value");d.click();var f=d.next(".ui-dateeditor").find(":input");f.val(""),$("body").click(),d=this.$el.find(".ui-customfield__value"),equals(d.text(),"","Save value")}}),c.run({customField:{type:"Date",name:"Birthday"}})};return{run:d}})