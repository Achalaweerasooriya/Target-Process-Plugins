define(["tau/core/class","tests/components/customField/component.customField.specification.base","tau/components/component.customField.dropdown","tau/components/component.customField.dropdown.list"],function(Class,baseSpecification,customFieldComponent){var innerRun=function(){var opts=["Atos","Portos","Aramis"];baseSpecification.run("dropdown.editable",customFieldComponent,{name:"CF DropDownList",type:"dropdown",required:!1,listed:!0,value:opts,options:opts},"Atos",[{name:"Should show popup",test:function(){var dataItem=this.data,$el=this.$el;ok(this.$el.hasClass("ui-customfield_editable_true"),"Editable highlighting is applied");var $value=$el.find(".ui-customfield__value");$value.click();var $popup=$value.parents("tr:first").tauBubble("widget");equals($popup.length,1,"Has bubble");var $list=$popup.find(".drop-down-list");equals($list.length,1,"Has bubble with choices");var $opts=$list.find(".drop-down-option");equals($opts.length,2,"Render correct options without existing"),equals($opts.eq(0).text(),opts[1],"Render correct options"),equals($opts.eq(1).text(),opts[2],"Render correct options")}},{name:"Should allow to change and save",preSetup:baseSpecification.shouldSave("CF DropDownList",opts[2]),test:function(){var dataItem=this.data,$el=this.$el,$value=$el.find(".ui-customfield__value");$value.click();var $popup=$value.parents("tr:first").tauBubble("widget"),$list=$popup.find(".drop-down-list"),$opts=$list.find(".drop-down-option");$opts.eq(1).click()}},{name:"Should show popup with clear link for non-required data",preSetup:baseSpecification.shouldSave("CF DropDownList",null),test:function(){var self=this,dataItem=this.data,$el=this.$el;this.executeStub=function(cmd){self.repositoryMock.expects().unbind(TypeOf.isA(Class)),self.repositoryMock.expects().unbind(TypeOf.isA(Class));var c=cmd[0];c.callbacks.success({command:c})};var $value=$el.find(".ui-customfield__value");$value.click();var $popup=$value.parents("tr:first").tauBubble("widget");equals($popup.length,1,"Has bubble");var $actions=$popup.find(".drop-down-actions");equals($actions.find(".clear").length,1,"Has clear action"),$actions.find(".clear").click(),$value=$el.find(".ui-customfield__value"),$value.click(),$popup=$value.parents("tr:first").tauBubble("widget"),$actions=$popup.find(".drop-down-actions"),equals($actions.find(".clear").length,0,"Has no clear action if value is empty")}}]),baseSpecification.run("dropdown.editable.required",customFieldComponent,{name:"CF DropDownList",type:"dropdown",required:!0,listed:!0,value:opts,options:opts},"Atos",[{name:"Should show popup with no clear link for required data",test:function(){var dataItem=this.data,$el=this.$el,$value=$el.find(".ui-customfield__value");$value.click();var $popup=$value.parents("tr:first").tauBubble("widget");equals($popup.length,1,"Has bubble");var $actions=$popup.find(".drop-down-actions");equals($actions.find(".clear").length,0,"Has no clear action")}}])};return{run:innerRun}})