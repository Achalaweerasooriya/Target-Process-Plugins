define(["Underscore","jQuery","tau/core/tau","tau/components/component.tags","tests/common/testData","tests/components/common/common.setup","tests/components/component.specs"],function(_,$,a,b,c,d,e){var f=function(){function k(a){return function(b){b.mockRepository(this);var c=a.length;for(var d=0;d<c;d++){var e=a[d],f=e.command,g=e.stub||this.repository.execute.tauCreateDelegate(this.repository);g._test=this,this.repositoryMock.expects().execute(f).andStub(g)}}}var a=c.tags,f={context:{type:a.__type,id:a.id}},g={tags:["tag1","tag2","tag3","duplicateOf#21"]},h=[Similar.to({name:"get",type:"bug",config:Similar.to({id:a.id,fields:["id","tags"]})})],i=function(a,b){var c=b.children(".ui-tags__editor");c.find("a:first").trigger("click"),c.find(":text").val(a),c.find(".ui-tags__editor__button-submit").trigger("click")},j=function(a){return a.children(".ui-tags__tag")},l=function(b){return k([{command:h},{command:[Similar.to({name:"save",type:"bug",config:Similar.to({id:a.id,$set:Similar.to({tags:b.join(",")})})})],stub:function(a){arguments.callee._test.executeStub&&arguments.callee._test.executeStub(a)}}])},m=[{name:"should render valid markup",test:function(){var a=this.$el,b=a.children(".ui-tags__tag");equal(b.length,g.tags.length,"Elements count is valid");for(var c=0,d=b.length;c<d;c++){var e=g.tags[c];if(e.indexOf("duplicateOf#")===-1)equal($.trim(b.eq(c).find("span:eq(0)").text()),e,"Tag test is valid");else{var f=b.eq(c).find("a.ui-tags__duplicateBug");equal($.trim(f.text()),e,"Tag test is valid"),equal(f.attr("href"),"#bug/21","Href is valid")}}}},{name:"should render valid markup (for empty tags)",preSetup:function(b){var c=_.clone(a);c.tags="",this.data=c,b.setInitialData({testData:c})},test:function(){var a=this.$el,b=a.children(".ui-tags__tag");equal(b.length,0,"Elements count is valid")}},{name:"should allow to remove tag",preSetup:function(a){l(["tag2","tag3","duplicateOf#21"]).call(this,a)},test:function(){var a=this.$el,b=j(a);b.first().find("[class*=delete]").trigger("click"),b=j(this.$el),equal(b.length,g.tags.length-1,"Tag is deleted")}}],n=d.create("[component.tags]",a,b);e.create(n,f).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(g,[h]).viewShouldPassTests(m).done()};return{run:f}})