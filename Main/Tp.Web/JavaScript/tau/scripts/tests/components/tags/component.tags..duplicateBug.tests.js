define(["Underscore","jQuery","tau/core/tau","tau/components/component.tags","tests/common/testData","tests/common/testCase","tests/common/componentConfigCreator","tests/common/testData.Generator"],function(a,b,c,d,e,f,g,h){var i=function(){function o(b,c,d){var e=arguments[arguments.length-1];a.isFunction(e)||(e=null);var f=a.map(b.split(","),function(a){return a.trim()});f=a.select(f,function(a){return a.length>0});var g=(a.isString(d)?d:j.tags+",")+f.join(",");this.serviceMock.registerSaveCommand({config:{$set:{tags:g},fields:["id","tags"],id:j.id},returnedData:{id:j.id,tags:g}});var c=this.element;c.children(".ui-tags__editor").find("a:first").trigger("click"),c.children(".ui-tags__editor").find(":text").val(b),e?e():c.children(".ui-tags__editor").find(".ui-tags__editor__button-submit").trigger("click");var h=this.element.children(".ui-tags__tag").last();return h}var c=new h;c.clear(),c.initDefaultData();var e=c.getData(),i=c.getUserStories()[3],j=i,k=new g;k.setEntityIDAndType(j.id,j.__type),k.setSelectedProjects([e.selectByType("project")[0]]),k.setProcesses(e.selectByType("process"));var l=k.getConfig(),m=new f("[component.tags]");m.initModule({componentConfig:l,data:e},d),m.test("should refresh if duplicateOf# tag added",function(){var a=this.element,b="duplicateOf#25",c=o.call(this,b);equal(c.last().find("span > a").text(),b,"Tag is added"),equal(c.last().find("span > a").attr("href"),"#bug/25","href is valid")}),m.test("should allow to add tag",function(){var a="porn",b=this.element,c=b.find(".ui-tags__editor");equal(c.length,1,"Have possibility to add tag");var d=o.call(this,a,b);equal(d.last().find("span").text(),a,"Tag is added")}),m.test("should allow to add tags with html and show it as text",function(){var a="<h1>porn</h1>",b=this.element,c=b.find(".ui-tags__editor");equal(c.length,1,"Have possibility to add tag");var d=o.call(this,a,b);equal(d.last().find("span").text(),a,"Tag is added")}),m.test("should allow to use key buttons",function(){var a="<h1>porn</h1>",b=this.element,c=b.find(".ui-tags__editor");equal(c.length,1,"Have possibility to add tag");var d=o.call(this,a,b);equal(d.last().find("span").text(),a,"Tag is added")}),m.test("should allow to add several tags by comma and trim them",function(){var a="porn, sex,  lesbian, ",b=this.element,c=b.find(".ui-tags__editor");equal(c.length,1,"Have possibility to add tag");var d=o.call(this,a,b);equal(d.last().find("span").text(),"lesbian","Tag is added"),d=d.last().prev(),equal(d.find("span").text(),"sex","Tag is added"),d=d.last().prev(),equal(d.find("span").text(),"porn","Tag is added")}),m.test("should cancel edit of user press Esc",function(){var a="porn",c=this.element,d=c.find(".ui-tags__editor");equal(d.length,1,"Have possibility to add tag"),d.find("a:first").trigger("click"),d.find(":text").val(a);var e=b.Event("keydown",{keyCode:27,which:27});d.find(":text").trigger(e),equal(this.element.children(".ui-tags__tag").filter(".ui-tags__tag-new").length,0,"Not new tags on esc")}),m.test("should add tag of user press Enter",function(){function f(){d.find(":text").trigger(e)}var a="porn",c=this.element,d=c.find(".ui-tags__editor");equal(d.length,1,"Have possibility to add tag"),d.find("a:first").trigger("click"),d.find(":text").val(a);var e=b.Event("keydown",{keyCode:13,which:13}),g=o.call(this,a,c,f);equal(g.last().find("span").text(),a,"Tag is added")});var m=new f("[component.tags]"),n=a.clone(e);a.each(n,function(b,c){b.hasOwnProperty("tags")&&(n[c]=a.clone(b),n[c].tags="")}),m.initModule({componentConfig:l,data:n},d),m.test("should allow to add tag when list empty",function(){var a="porn",b=this.element,c=b.find(".ui-tags__editor");equal(c.length,1,"Have possibility to add tag");var d=o.call(this,a,b,"");equal(d.last().find("span").text(),a,"Tag is added")})};return{run:i}})