define(["jQuery","tau/components/component.property.release","tests/components/component.specs","tests/common/testData.Generator","tests/common/service.mock","tau/configurator","tests/components/common/common.setup"],function($,a,b,c,d,e,f){var g=function(){var g=new c;g.initDefaultData();var h=g.getData(),i=g.getProjects(),j=g.getBugs()[0],k=g.getReleases(),l={manualContext:!0,context:{entity:{entityType:{name:j.__type},id:j.id},applicationContext:{selectedProjects:[i[0]],culture:{name:"en-US",timePattern:"g:i A",shortDateFormat:"M/d/yyyy",longDateFormat:"dddd, MMMM dd, yyyy",decimalSeparator:".",__type:"culture"},processes:g.getProcesses()}}},m=j.release,n=k[3],o=f.create("[component.release]",h,a,l),p=[{name:"should render valid markup",test:function(){var a=this.$el;equal(a.find(".property-text span").text(),m.name,"Release name"),equal(a.find("a").attr("href"),["#release",m.id].join("/"),"Release id")}},{name:"should change release",preSetup:function(){var a=this.service=new d;e.setService(a)},test:function(){var a=this.$el,b=a.find(".property-text");b.click();var c=$(".tau-bubble");equal(c.size(),1,"Count of bubbles");var d=c.eq(0).find('.drop-down-option:contains("'+n.name+'")');equal(c.find(".action-link.clear").size(),1,"Backlog button is available"),this.service.registerSaveCommand({config:{$set:{release:{id:n.id}},fields:["id",{iteration:["id","name"]}],id:j.id},returnedData:{id:j.id,release:n}}),equal(c.find(".action-link.more").text(),"show old","Show old is  available"),equal(c.find(".action-link.clear").text(),"backlog","Backlog button is  available"),d.click(),equal(this.$el.find(".property-text span").text(),n.name,"Release was changed")}}];b.create(o,l).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests(p).done();var q=g.getBugs()[1],r={manualContext:!0,context:{entity:{entityType:{name:q.__type},id:q.id},applicationContext:{selectedProjects:[i[0]],culture:{name:"en-US",timePattern:"g:i A",shortDateFormat:"M/d/yyyy",longDateFormat:"dddd, MMMM dd, yyyy",decimalSeparator:".",__type:"culture"},processes:g.getProcesses()}}},s=f.create("[component.release] empty",h,a,r);b.create(s,r).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests([{name:"should render valid markup for empty release",test:function(){var a=this.$el;equal(a.find(".property-text span").text(),"","Release name"),a.click();var b=$(".tau-bubble");equal(b.find(".action-link.clear").size(),0,"Backlog button is not available")}}]).done(),g.clear(),g.initDefaultData(),g.removeReleases();var h=g.getData(),t=f.create("[component.release] not releases",h,a,r);b.create(t,r).viewShouldFollowBasicComponentLifeCycle().viewShouldPassTests([{name:"should show no releases found",test:function(){var a=this.$el;equal(a.find(".property-text span").text(),"","Release name"),a.find(".property-text").click();var b=$(".tau-bubble");equal(b.find(".action-link.clear").size(),0,"Backlog button is not available"),equal(b.find(".empty-message").text(),"No releases found","Empty message is valid")}}]).done();var g=new c,i=g.getProjects(),u=g.getBugs();i[0].releases=[u[0].release],g.getProjects(),g.registerData(u),g.registerData(i);var v=g.getData(),o=f.create("[component.release]",v,a,l);b.create(o,l).viewShouldPassTests([{name:"show old should be hidden",test:function(){var a=this.$el,b=a;b.click();var c=$(".tau-bubble");equal(c.find(".action-link.more").size(),0,"Show old is not visible")}}]).done();var g=new c,i=g.getProjects(),u=g.getBugs();u[0].release=null,i[0].releases=[i[0].releases[0],i[0].releases[1]],g.getProjects(),g.registerData(u),g.registerData(i);var w=g.getData(),o=f.create("[component.release]",w,a,l);b.create(o,l).viewShouldPassTests([{name:"show old should be visible",test:function(){var a=this.$el,b=a.find(".property-text");b.click();var c=$(".tau-bubble");equal(c.find(".action-link.more").size(),1,"Show old is visible")}}]).done()};return{run:g}})