define(["Underscore","jQuery","tau/configurator","tau/utils/utils.htmlConverter"],function(_,$,configurator,converter){configurator.setApplicationPath("/TP");var innerRun=function(){module("[utils.htmlConverter] tests"),test("should convert source text to html",function(){var source='<div>Curabitur ac nisl arcu. Praesent et neque sit amet lectus volutpat vulputate. Pellentesque libero magna, aliquet vitae semper sed, pulvinar at massa. Proin sed velit lorem, eu pretium ipsum. Fusce nunc massa, tempor nec faucibus non, luctus ut augue. Suspendisse ultrices ultrices elit eu suscipit. Aenean vulputate nisl sed semaliquet quis dapibus metus <img src="~/porn/gallery5/image.jpg"> laoreet. Phasellus a enim nec justo pharetra ultrices vitae sed lectus. Mauris cursus tempus dictum. Nulla enim lorem, porta et iaculis vel, hendrerit in nibh. Morbi vel sem nunc, a iaculis lacus. Sed lorem turpis, elementum in tristique at, sagittis vitae enim. Aenean molestie eleifend lacus in gravida.</div>',html=converter.fromSourceToHtml(source);equals($(html).find("img").eq(0).attr("src"),"/TP/porn/gallery5/image.jpg","Correct convert img src"),html=converter.fromSourceToHtml(null),equals(html,"","Safe for unexpected input")}),test("should convert html to souce text",function(){var html='<div>Curabitur ac nisl arcu. Praesent et neque sit amet lectus volutpat vulputate. Pellentesque libero magna, aliquet vitae semper sed, pulvinar at massa. Proin sed velit lorem, eu pretium ipsum. Fusce nunc massa, tempor nec faucibus non, luctus ut augue. Suspendisse ultrices ultrices elit eu suscipit. Aenean vulputate nisl sed semaliquet quis dapibus metus <img src="/TP/porn/gallery5/image.jpg"> laoreet. Phasellus a enim nec justo pharetra ultrices vitae sed lectus. Mauris cursus tempus dictum. Nulla enim lorem, porta et iaculis vel, hendrerit in nibh. Morbi vel sem nunc, a iaculis lacus. Sed lorem turpis, elementum in tristique at, sagittis vitae enim. Aenean molestie eleifend lacus in gravida.</div>',source=converter.fromHtmlToSource(html);equals($(source).find("img").eq(0).attr("src"),"~/porn/gallery5/image.jpg"),source=converter.fromHtmlToSource(null),equals(source,"","Safe for unexpected input")}),test("should convert plain text urls to HTML links and images",function(){var cases=[{input:"http://img.com#",asserts:['<a href="http://img.com#" target="_blank">http://img.com#</a>']},{input:'http://img.com/$+:;=?@"&{}[]|\\^~`,*',asserts:['<a href="http://img.com/$+:;=?@&quot;&{}[]|\\^~`,*" target="_blank">http://img.com/$+:;=?@"&{}[]|\\^~`,*</a>']},{input:"<div>http://img.com/dir/file.txt</div>",asserts:['<a href="http://img.com/dir/file.txt" target="_blank">http://img.com/dir/file.txt</a>']},{input:" http://htmlka.com/ssylki/#anch ",asserts:['<a href="http://htmlka.com/ssylki/#anch" target="_blank">http://htmlka.com/ssylki/#anch</a>']},{input:'<a href="http://img.com/dir/file.txt">http://img.com/dir/file.txt</a>',asserts:['<a href="http://img.com/dir/file.txt">http://img.com/dir/file.txt</a>']},{input:'&lt;a href="http://img.com/dir/file.txt"&gt;',asserts:['&lt;a href="http://img.com/dir/file.txt"&gt;']},{input:'&lt;a href=http://img.com/dir/file.txt"&gt;',asserts:['&lt;a href=http://img.com/dir/file.txt"&gt;']},{input:"&lt;a href='http://img.com/dir/file.txt'&gt;",asserts:["&lt;a href='http://img.com/dir/file.txt'&gt;"]},{input:"http://img.com/dir/file.jpg",asserts:['<img style="max-width: 600px" src="http://img.com/dir/file.jpg">']},{input:"http://www.opennet.ru/man.shtml?topic=expr&category=1&russian=0",asserts:['<a href="http://www.opennet.ru/man.shtml?topic=expr&category=1&russian=0" target="_blank">http://www.opennet.ru/man.shtml?topic=expr&category=1&russian=0</a>']}];for(var i=0;i<cases.length;i++){var testCase=cases[i],output=converter.replacePlainTextUrlWithHTML(testCase.input);for(var j=0;j<testCase.asserts.length;j++){var assert=testCase.asserts[j];ok(output.indexOf(assert)>-1,'Input Case: "'+testCase.input+'"; assertion: "'+assert+'"; output: "'+output+'"')}}})};return{run:innerRun}})