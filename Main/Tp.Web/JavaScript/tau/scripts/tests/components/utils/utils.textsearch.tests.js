define(["Underscore","tau/utils/utils.textsearch"],function(_,Textsearch){var innerRun=function(){module("[utils.textsearch]",{setup:function(){}}),test("should build index and do search",function(){var index=new Textsearch;index.load([{_id:1,data:"Lorem ipsum"},{_id:2,data:"Preved medved"}]);var result=index.search("preved");same(result,[{_id:2,data:"Preved medved",entry:{from:0,len:6}}],"search data: preved"),index.load([{_id:1,data:"Preved    medved"},{_id:2,data:"[Preved] medved"},{_id:3,data:"Abra PREved: medved cadabra"},{_id:4,data:"Sim Salabim"},{_id:5,data:"preved-medved"}]),result=index.search("preved medved"),same(result,[{_id:1,data:"Preved    medved",entry:{from:0,len:16}},{_id:2,data:"[Preved] medved",entry:{from:1,len:14}},{_id:3,data:"Abra PREved: medved cadabra",entry:{from:5,len:14}},{_id:5,data:"preved-medved",entry:{from:0,len:13}}],"search data: preved medved"),result=index.search("medved!!!"),same(result,[],"zero result: medved!!!"),index.load([{_id:1,data:"колесо  сансары"},{_id:2,data:"карма!!"},{_id:3,data:"харе кришна"}]),result=index.search("харе"),same(result,[{_id:3,data:"харе кришна",entry:{from:0,len:4}}],"Search non latin: харе")}),test("should build index and do strong search",function(){var index=new Textsearch;index.load([{_id:1,data:"Lorem ipsum"},{_id:2,data:"Preved medved"},{_id:3,data:"Preved  super medved"}]);var result=index.search("preved medved");same(result,[{_id:2,data:"Preved medved",entry:{from:0,len:13}},{_id:3,data:"Preved  super medved",entry:{from:0,len:20}}],"search data: preved medved")}),test("should allow simple match",function(){var index=new Textsearch,match=index.match("preved medved","ved");same(match,{from:3,len:3},"find match: ved"),match=index.match("preved medved","bzz"),same(match,null,"find match: bzz"),match=index.match("preved medved"," eve  "),same(match,{from:2,len:3},"find match:  eve  ")}),test("match tuning",function(){var index=new Textsearch,list=[["Kanban for Program area","Kanban area",0,23],["Kanban for Program area","Kanban program",0,18],["Kanban for Program area","Kan are",null],["TP 1.7 - 2.0 Migration","1.",3,2],["TP 1.7 - 2.0 Migration","1?2",null],["TP 1 1!!","1!!",5,3],["[SVN] Auto-mapping SVN to TP Users","auto-",6,5]];for(var i=0;i<list.length;i++){var data=list[i],match=index.match(data[0],data[1]),res=data[2]===null?null:{from:data[2],len:data[3]};same(match,res,"find match: "+data[1])}})};return{run:innerRun}})