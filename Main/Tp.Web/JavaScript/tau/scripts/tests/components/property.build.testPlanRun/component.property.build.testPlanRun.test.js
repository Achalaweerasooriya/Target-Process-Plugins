define(["jQuery","tests/common/testkit","tau/configurator","tau/components/component.property.build.testPlanRun","tau/components/component.finder"],function(a,b,c,d){var e=function(){var e=new b("[component.property.build.testPlanRun]",d),f={p1:"Preved",p2:"Medved"},g={r1:"Release",r2:"Release2",r3:"Release3"},h={i1:"Iter1",i2:"Iter2"},i={b1:{name:"Build1",project:"p1",release:"r1"},b2:{name:"Build2",project:"p1",release:"r2",iteration:"i1"}},j={tpr1:{name:"TPR1",project:"p1",release:"r2",build:"b2"},tpr2:{name:"TPR2",project:"p1"},tpr3:{name:"TPR3",project:"p1",release:"r2",iteration:"i1"}},k=e.loadFixtures({projects:f,iterations:h,releases:g,testPlanRuns:j,builds:i});return e.setData(k),e.setEntity(k.testPlanRun.tpr1),e.selectProject(k.project.p1),e.addTest({name:"should render valid markup",test:function(){var a=this.$el;equal(a.find(".tau-property__value").text(),"Build2")}}),e.addTest({name:"should change property",test:function(){var b=k.testPlanRun.tpr1;e.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{"Project.Id":k.project.p1.id,"Release.Id":k.release.r2.id}},returnedData:[k.build.b1,k.build.b2]});var c=this.$el,d=c.find(".tau-property__value");d.click();var f=a(".tau-bubble");equal(f.size(),1,"Count of bubbles");var g=f.find(".tau-result-list-row");equals(g.length,2,"Options");var h=f.find(":text.filter-field");e.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{name:{$contains:"preved"},"Project.Id":k.project.p1.id,"Release.Id":k.release.r2.id}},returnedData:[]}),h.val("preved"),h.trigger(jQuery.Event("keyup",{keyCode:jQuery.ui.keyCode.ENTER})),e.getService().verify()}}),e.addTest({name:"should change property, correct find",context:{type:"testPlanRun",id:k.testPlanRun.tpr2.id},test:function(){var b=k.testPlanRun.tpr2;e.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{"Project.Id":k.project.p1.id,"Release.Id":null}},returnedData:[k.build.b1,k.build.b2]});var c=this.$el,d=c.find(".tau-property__value");d.click();var f=a(".tau-bubble");equal(f.size(),1,"Count of bubbles");var g=f.find(".tau-result-list-row");equals(g.length,2,"Options");var h=f.find(":text.filter-field");e.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{name:{$contains:"preved"},"Project.Id":k.project.p1.id,"Release.Id":null}},returnedData:[]}),h.val("preved"),h.trigger(jQuery.Event("keyup",{keyCode:jQuery.ui.keyCode.ENTER})),e.getService().verify()}}),e.addTest({name:"should change property, correct find3",context:{type:"testPlanRun",id:k.testPlanRun.tpr3.id},test:function(){var b=k.testPlanRun.tpr3;e.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{"Project.Id":k.project.p1.id,"Release.Id":k.release.r2.id,"Iteration.Id":k.iteration.i1.id}},returnedData:[k.build.b1,k.build.b2]});var c=this.$el,d=c.find(".tau-property__value");d.click();var f=a(".tau-bubble");equal(f.size(),1,"Count of bubbles");var g=f.find(".tau-result-list-row");equals(g.length,2,"Options");var h=f.find(":text.filter-field");e.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{name:{$contains:"preved"},"Project.Id":k.project.p1.id,"Release.Id":k.release.r2.id,"Iteration.Id":k.iteration.i1.id}},returnedData:[]}),h.val("preved"),h.trigger(jQuery.Event("keyup",{keyCode:jQuery.ui.keyCode.ENTER})),e.getService().verify()}}),e.addTest({name:"should refresh on every iteration-release change",context:{type:"testPlanRun",id:k.testPlanRun.tpr1.id},test:function(){var a=k.testPlanRun.tpr1,b=this.$el;equal(b.find(".tau-property__value").text(),"Build2"),e.getService().registerSaveCommand({config:{id:a.id,$set:{release:{id:k.release.r2.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]},returnedData:{id:a.id,release:k.release.r2,iteration:null,build:null}}),c.getStore().save("testplanrun",{id:a.id,$set:{release:{id:k.release.r2.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]}).done(),b=this.$el,equal(b.find(".tau-property__value").text(),"","Empty after refresh"),b.find(".tau-property__value").text("bzzz"),e.getService().registerSaveCommand({config:{id:a.id,$set:{release:{id:k.release.r3.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]},returnedData:{id:a.id,release:k.release.r3,iteration:null,build:null}}),c.getStore().save("testplanrun",{id:a.id,$set:{release:{id:k.release.r3.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]}).done(),b=this.$el,equal(b.find(".tau-property__value").text(),"","Still refresh"),e.getService().verify()}}),e.run()};return{run:e}})