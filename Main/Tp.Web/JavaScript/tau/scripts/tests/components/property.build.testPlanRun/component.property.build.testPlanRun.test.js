define(["jQuery","tests/common/testkit","tau/configurator","tau/components/component.property.build.testPlanRun","tau/components/component.finder"],function($,a,b,c){var d=function(){var d=new a("[component.property.build.testPlanRun]",c),e={p1:"Preved",p2:"Medved"},f={r1:"Release",r2:"Release2",r3:"Release3"},g={i1:"Iter1",i2:"Iter2"},h={b1:{name:"Build1",project:"p1",release:"r1"},b2:{name:"Build2",project:"p1",release:"r2",iteration:"i1"}},i={tpr1:{name:"TPR1",project:"p1",release:"r2",build:"b2"},tpr2:{name:"TPR2",project:"p1"},tpr3:{name:"TPR3",project:"p1",release:"r2",iteration:"i1"}},j=d.loadFixtures({projects:e,iterations:g,releases:f,testPlanRuns:i,builds:h});return d.setData(j),d.setEntity(j.testPlanRun.tpr1),d.selectProject(j.project.p1),d.addTest({name:"should render valid markup",test:function(){var a=this.$el;equal(a.find(".tau-property__value").text(),"Build2")}}),d.addTest({name:"should change property",test:function(){var a=j.testPlanRun.tpr1;d.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{"Project.Id":j.project.p1.id,"Release.Id":j.release.r2.id}},returnedData:[j.build.b1,j.build.b2]});var b=this.$el,c=b.find(".tau-property__value");c.click();var e=$(".tau-bubble");equal(e.size(),1,"Count of bubbles");var f=e.find(".tau-result-list-row");equals(f.length,2,"Options");var g=e.find(":text.filter-field");d.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{name:{$contains:"preved"},"Project.Id":j.project.p1.id,"Release.Id":j.release.r2.id}},returnedData:[]}),g.val("preved"),g.trigger(jQuery.Event("keyup",{keyCode:jQuery.ui.keyCode.ENTER})),d.getService().verify()}}),d.addTest({name:"should change property, correct find",context:{type:"testPlanRun",id:j.testPlanRun.tpr2.id},test:function(){var a=j.testPlanRun.tpr2;d.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{"Project.Id":j.project.p1.id,"Release.Id":null}},returnedData:[j.build.b1,j.build.b2]});var b=this.$el,c=b.find(".tau-property__value");c.click();var e=$(".tau-bubble");equal(e.size(),1,"Count of bubbles");var f=e.find(".tau-result-list-row");equals(f.length,2,"Options");var g=e.find(":text.filter-field");d.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{name:{$contains:"preved"},"Project.Id":j.project.p1.id,"Release.Id":null}},returnedData:[]}),g.val("preved"),g.trigger(jQuery.Event("keyup",{keyCode:jQuery.ui.keyCode.ENTER})),d.getService().verify()}}),d.addTest({name:"should change property, correct find3",context:{type:"testPlanRun",id:j.testPlanRun.tpr3.id},test:function(){var a=j.testPlanRun.tpr3;d.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{"Project.Id":j.project.p1.id,"Release.Id":j.release.r2.id,"Iteration.Id":j.iteration.i1.id}},returnedData:[j.build.b1,j.build.b2]});var b=this.$el,c=b.find(".tau-property__value");c.click();var e=$(".tau-bubble");equal(e.size(),1,"Count of bubbles");var f=e.find(".tau-result-list-row");equals(f.length,2,"Options");var g=e.find(":text.filter-field");d.getService().registerFindCommand({config:{$skip:0,$limit:20,fields:["id","name",{project:["id","abbreviation"]}],$query:{name:{$contains:"preved"},"Project.Id":j.project.p1.id,"Release.Id":j.release.r2.id,"Iteration.Id":j.iteration.i1.id}},returnedData:[]}),g.val("preved"),g.trigger(jQuery.Event("keyup",{keyCode:jQuery.ui.keyCode.ENTER})),d.getService().verify()}}),d.addTest({name:"should refresh on every iteration-release change",context:{type:"testPlanRun",id:j.testPlanRun.tpr1.id},test:function(){var a=j.testPlanRun.tpr1,c=this.$el;equal(c.find(".tau-property__value").text(),"Build2"),d.getService().registerSaveCommand({config:{id:a.id,$set:{release:{id:j.release.r2.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]},returnedData:{id:a.id,release:j.release.r2,iteration:null,build:null}}),b.getStore().save("testplanrun",{id:a.id,$set:{release:{id:j.release.r2.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]}).done(),c=this.$el,equal(c.find(".tau-property__value").text(),"","Empty after refresh"),c.find(".tau-property__value").text("bzzz"),d.getService().registerSaveCommand({config:{id:a.id,$set:{release:{id:j.release.r3.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]},returnedData:{id:a.id,release:j.release.r3,iteration:null,build:null}}),b.getStore().save("testplanrun",{id:a.id,$set:{release:{id:j.release.r3.id}},fields:["id",{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]}).done(),c=this.$el,equal(c.find(".tau-property__value").text(),"","Still refresh"),d.getService().verify()}}),d.run()};return{run:d}})