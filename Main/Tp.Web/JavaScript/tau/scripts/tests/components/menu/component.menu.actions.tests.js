define(["tau/core/tau","tau/components/component.menu.actions","tests/components/component.specs","tests/common/testData","tests/components/common/common.setup","tests/common/applicationContext","tau/configurator"],function(tau,component,componentSpecs,testData,commonSetup,AppContext,configurator){var innerRun=function(){var menuaction,isConfirmed,context={context:{type:"bug",id:15},configurator:configurator},testDataForTitle=testData.getTestDataForTitle(),actions=[{label:"Add Task",command:function(){menuaction="Alarm"}},{label:"Add Bug",command:function(){menuaction="Upyachka"}},"-",{label:"Add Time",confirmation:"Are you sure?",command:function(){menuaction="My vse umrem"}}],conf={items:actions,context:{configurator:configurator}},setup=commonSetup.create("[component.menu.actions]",testDataForTitle,component,conf),appContext=new AppContext(context),process=appContext.processes[0],project=appContext.selectedProjects[0],expected={entity:{__type:"bug",id:15,name:"BugName"},process:process,project:project,subPath:"Project/QA/Bug",appPath:"/TP"},expectedPermissions={editable:!0,deletable:!0},viewTests=[{name:"should render valid markup",test:function(){var $el=this.$el,$trigger=$el.find(".ui-menu__trigger"),$popup=$el.find(".ui-menu__popup");$trigger.click(),ok($popup.css("display")!=="none","Menu is visible after click")}},{name:"should render valid markup from config",test:function(){var $el=this.$el,$trigger=$el.find(".ui-menu__trigger"),$popup=$el.find(".ui-menu__popup"),$actions=$popup.find(".ui-menu__item-action");equals($actions.length,3,"Render valid actions from config"),equals($actions.eq(0).text().trim(),actions[0].label,"Render valid actions from config"),equals($actions.eq(1).text().trim(),actions[1].label,"Render valid actions from config"),equals($actions.eq(2).text().trim(),actions[3].label,"Render valid actions from config")}},{name:"should process clicks",test:function(){var tmp=window.confirm;window.confirm=function(){isConfirmed=!0};var $el=this.$el,$trigger=$el.find(".ui-menu__trigger"),$popup=$el.find(".ui-menu__popup"),$actions=$popup.find(".ui-menu__item-action"),globals=window;equals(menuaction,undefined,"No actions"),$actions.eq(0).click(),equals(menuaction,"Alarm","Execute first action"),$actions.eq(1).click(),equals(menuaction,"Upyachka","Execute second action"),$actions.eq(2).click(),equals(isConfirmed,!0,"Execute third action"),window.confirm=tmp}}];componentSpecs.create(setup,context).viewShouldFollowDataComponentLifeCycle().viewShouldPassTests(viewTests).done()};return{run:innerRun}})