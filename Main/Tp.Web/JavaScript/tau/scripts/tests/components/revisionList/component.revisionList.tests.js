define(["jQuery","tau/configurator","tests/common/testCase","tests/common/componentConfigCreator","tau/components/component.revisionList","tests/common/testData.Generator","tp/plugins/pluginsRepository","tau/utils/utils.date/utils.date.wrapper"],function($,configurator,TestCase,ComponentConfigCreator,ComponentCreateDate,TestDataGenerator,pluginsRepository,Date){var innerRun=function(){var testDataGenerator=new TestDataGenerator;testDataGenerator.initDefaultData();var data=testDataGenerator.getData(),bugData=testDataGenerator.getBugs()[0],configCreator=new ComponentConfigCreator;configCreator.setEntityIDAndType(bugData.id,bugData.__type),configCreator.setSelectedProjects([data.selectByType("project")[0]]),configCreator.setProcesses(data.selectByType("process"));var config=configCreator.getConfig();config.editable=!0;var testCase=new TestCase("[component.revisionList]");testCase.initModule({componentConfig:config,data:data},ComponentCreateDate,function(){this.old=pluginsRepository.pluginStartedAndHasAtLeastOneProfile,pluginsRepository.pluginStartedAndHasAtLeastOneProfile=function(){}},function(){pluginsRepository.pluginStartedAndHasAtLeastOneProfile=this.old}),testCase.test("should render valid markup",function(){var $el=this.element,$tbodies=$el.find("table.ui-revisionList > tbody");equal($tbodies.size(),5,"Count of revisions");var revisions=_.sortBy(testDataGenerator.getRevisions(),function(rev){return-rev.id}),spaceChar=String.fromCharCode(160),date=new Date(1309542300192),text=(new Date(1309542300192)).toString("d-MMM-yyyy")+String.fromCharCode(32)+date.toString("HH:mm"),infos=[[text,"by","unknown"].join(spaceChar),[text,"by","Andrew Gray"].join(spaceChar),[text,"by","Tod Black"].join(spaceChar),[text,"by","John Brown"].join(spaceChar),[text,"by","Administrator Administrator"].join(spaceChar)];$tbodies.each(function(index){var $tb=$(this),$firstRow=$tb.children("tr").eq(0),$filesRow=$tb.children("tr").eq(1),$commitInfo=$firstRow.children("td");equal(_.trim($commitInfo.eq(1).text()),"#"+spaceChar+revisions[index].sourceControlId.toString(),"SourceControlId id"),equal($commitInfo.eq(2).text(),infos[index],"Info text"),equal($commitInfo.eq(3).text(),revisions[index].description,"Info text");var $files=$filesRow.find("td.files"),$actions=$filesRow.find("td.actions"),revisionFiles=revisions[index].revisionFiles,fileNames=_.pluck(revisionFiles,"fileName"),fileActions=_.map(_.pluck(revisionFiles,"fileAction"),function(action){return action==="Add"?"Added":action==="Delete"?"Deleted":"Modified"});equal($files.size(),revisionFiles.length,"Files count"),$files.each(function(i){equal(_.trim($(this).text()),fileNames[i],"File Name")}),equal($actions.size(),revisionFiles.length,"Files count"),$actions.each(function(i){equal(_.trim($(this).text()),fileActions[i],"File Action")})})})};return{run:innerRun}})