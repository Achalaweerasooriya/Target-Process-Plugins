define(["Underscore","tau/components/component.entityStateList","tests/components/common/common.setup","tests/components/component.specs","tests/common/modelConfig","tests/common/testData"],function(a,b,c,d,e,f){var g=function(){function o(a){return function(b){b.mockRepository(this);var c=a.length;for(var d=0;d<c;d++){var e=a[d],f=e.command,g=e.stub||this.repository.execute.tauCreateDelegate(this.repository);g._test=this,this.repositoryMock.expects().execute(f).andStub(g)}}}var g=f.getTestDataForState(),h=f.getStatesForProcess(),i=[g,h],j={manualContext:!0,context:e.bug(g.id)};j.context.assignable=g;var k=a.extend(a.clone(g)),l=h.entityStates[4];k.entityState.nextStates=l.nextStates;var m={states:[{id:6,name:"Fixed",isCommentRequired:!1},{id:7,name:"Invalid",isCommentRequired:!1},{id:8,name:"Closed",isCommentRequired:!0}],completed:!0,nullableValue:!1},n=[[Similar.to({name:"get",type:"bug",config:Similar.to({id:g.id,fields:["id",Similar.to({entityState:["id"]})]})})],[Similar.to({name:"get",type:"entityState",config:Similar.to({id:l.id,fields:["id","name","isCommentRequired",Similar.to({nextStates:["id","name","isCommentRequired"]})]})})]],p=[{name:"should render valid markup",preSetup:o([{command:n[0]},{command:n[1]}]),test:function(){var a=this.$el;ok(a.find(".drop-down-list").length===1,"state-list container added"),ok(a.find(".drop-down-option").length===3,"state options count is correct"),ok(a.find(".drop-down-option:contains('Closed')").length===1,"state option name formed correctly")}},{name:"should save state on click",preSetup:o([{command:n[0]},{command:n[1]},{command:[Similar.to({name:"save",type:"bug",config:Similar.to({id:g.id,$set:Similar.to({entityState:Similar.to({id:7})})})})],stub:function(){}}]),test:function(){var a=this.$el;a.find(".drop-down-option").eq(1).click()}},{name:"should save state with comment",preSetup:o([{command:n[0]},{command:n[1]},{command:[Similar.to({name:"save",type:"comment",config:Similar.to({id:null,$set:Similar.to({description:"Test comment",general:Similar.to({id:g.id})})})})],stub:function(){}},{command:[Similar.to({name:"save",type:"bug",config:Similar.to({id:g.id,$set:Similar.to({entityState:Similar.to({id:8})})})})],stub:function(){}}]),test:function(){var a=this.$el;equals(a.find(".ui-entity-state-comment").size(),0,"No comments"),a.find(".drop-down-option").eq(2).click(),equals(a.find(".ui-entity-state-comment").size(),1,"Comment input is open"),a.find(".drop-down-option").eq(2).click(),equals(a.find(".ui-entity-state-comment").size(),1,"Comment input is open and only one");var b=a.find(".ui-entity-state-comment .ui-state-comment-field");equals(b.size(),1,"Comment field is presented"),b.val("Test comment");var c=a.find(".ui-entity-state-comment .button-group .save");equals(c.size(),1,"Save button is presented"),c.click()}}],q=c.create("[component.state]",i,b,{listType:"entityState"});d.create(q,j).viewShouldFollowDataComponentLifeCycle().modelShouldReturnData(m,n).viewShouldPassTests(p).done()};return{run:g}})