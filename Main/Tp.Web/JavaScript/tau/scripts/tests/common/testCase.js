define(["Underscore","tau/configurator","tau/core/class","tests/common/service.mock","tau/models/dataprocessor/model.processor.context"],function(_,configurator,Class,ServiceMock,fnCtx){return Class.extend({init:function(name){this.name=name},initModule:function(config,component,setup,teardown){module(this.name,{setup:function(){this.initialData=config.data||[],this.serviceMock=new ServiceMock,configurator.clear(),configurator.disableRules(),configurator.setApplicationPath(config.applicationPath||"/TP"),configurator.setCurrentDate(config.currentDate||new Date(1307600546192)),configurator.setService(this.serviceMock),configurator.setInitialData(this.initialData),setup&&setup.call(this);var componentConfig=config.componentConfig,cloneConfig=_.clone(componentConfig);cloneConfig.context=fnCtx(cloneConfig.context),this.component=component.create(cloneConfig),this.component.on("afterRender",function(evtArgs){this.element=evtArgs.data.element},this),this.component.initialize(config.componentConfig)},teardown:function(){configurator.clear(),teardown&&teardown(),this.component.destroy(),this.serviceMock.verify(),delete this.initialData}})},test:function(name,func){test(name,func)}})})