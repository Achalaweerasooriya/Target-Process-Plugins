define(["Underscore","jQuery"],function(_,$){function formatCall(pCall,percent,stackTotal){var $el=$("<div></div>");$el.css("width",Math.round(percent*100)+"%");if(pCall.stack.length===0||pCall.value>4+stackTotal){var msg=pCall.value+"ms / "+pCall.name;$el.css("margin","10px 0 4px 1px").css("border","1px #000 solid").css("color","#FFF").css("font-size","12px").css("font-family","Tahoma").css("background-color","#2F4F4F").css("overflow","hidden").css("white-space","nowrap").css("text-overflow","ellipsis").attr("title",msg),$el.html("<span>"+msg+"</span>")}return $el}function formatProfileResults($container,r){var total=r.value;return _(r.stack).each(function(pCall){var percent=pCall.value/total,stackTotal=0;_(pCall.stack).each(function(c){stackTotal+=c.value});if(percent>.05){var $call=formatCall(pCall,percent,stackTotal);formatProfileResults($call,pCall),$container.append($call)}}),$container}return{build:function(r){var $profile=$("<div></div>");return $profile.css("width",1e3).css("margin-top","5px").css("background-color","#F0FFF0").css("border","1px #000 solid"),formatProfileResults($profile,r.tree)}}})