define(["Underscore","tau/configurator","tests/common/testData.Generator","tests/common/service.mock"],function(a,b,c,d){var e=new c;module("[store] rules ",{setup:function(){b.clear(),this.serviceMock=new d,b.setService(this.serviceMock),e.clear(),this.store=b.getStore(),b.clear(),e.initDefaultData();var a=this.data=e.getData();b.setInitialData(a),b.setService(this.serviceMock),this.store=b.getStore()},teardown:function(){this.serviceMock.verify(),b.clear()}}),test("should include endDate if state was changed",function(){var a=this.data.selectByType("bug")[0];this.store.get(a.__type,{id:a.id,fields:["endDate"]}),this.serviceMock.registerSaveCommand({config:{id:a.id,$set:{entityState:{id:1}},fields:["id","endDate"]},returnedData:{id:a.id,__type:a.__type,endDate:5}}),this.store.save(a.__type,{id:a.id,$set:{entityState:{id:1}}}).done();var b=this.data.selectByType("userStory")[0];this.store.get(a.__type,{id:b.id,fields:["endDate"]}),this.serviceMock.registerSaveCommand({config:{id:b.id,$set:{entityState:{id:1}},fields:["id","endDate"]},returnedData:{id:b.id,__type:b.__type,endDate:5}}),this.store.save(b.__type,{id:b.id,$set:{entityState:{id:1}}}).done()})})