define(["Underscore","./extension.tracking.base","libs/json2"],function(_,Extension){return Extension.extend({slice:null,"global slice.ready":function(evtHash,data){var slice=data.slice,self=this;if(self.slice===slice)return;self.slice&&self.slice.removeAllListeners(self),self.slice=slice,self.slice.on("request.completed",function(evt,data){var time=data.time;if(!data.command||!data.response||!time||!time.start||!time.end)return;try{var serverTime=parseInt(data.response.getResponseHeader("X-Stopwatch")),contentLength=(data.response.responseText||"").length,totalTime=time.end-time.start,evtData={method:(data.command||{}).method,totalTime:totalTime,netTime:totalTime-serverTime,serverTime:serverTime,contentSize:contentLength};this.makePlainCleanObject(evtData,data.request.definition,"",["global","data"]),self.fire("track.node",{slice:evtData})}catch(e){}},self)}})})