define(["jQuery","app.path","Underscore","libs/schedule","./extension.tracking.base","tau/configurator","./session","tp/mashups","./host.info","tp/mashups/failed"],function(e,t,i,s,n,r,a,o,d,c){var h=new o,u=function(e,t){if(!e)return"";var i=e.toLowerCase().split("/mashups/");return i.length?(i[i.length-1]||"").replace("/","").replace(t,"").replace(".js",""):""};return n.extend({init:function(e){var t=e.scheduler;this._super.apply(this,arguments),this.global.on("application.context.data",function(e){e.removeListener(),t.onceADay(function(){this.getSessionData(e.data,function(e){this.fire("data.track",e)}.bind(this))}.bind(this)),window.performance&&window.performance.memory&&window.performance.memory.usedJSHeapSize&&t.eachXMins(30,function(e){var t={date:e.date,"live-minutes":30*e.i,"schedule-shift":e["schedule-shift"],memory:window.performance.memory};taus.track("browser-memory",t)})}.bind(this),this)},"global boardsSet.selected":function(e,t){var i=this.getHost(),s=this.getUser(),n={userProcess:{_id:s._id,user:{id:s._id},host:{id:i},process:t}};this.fire("data.track",n)},getUser:function(e){var t=this.getHost();e=e||{};var s=[window.loggedUser,r.getLoggedUser(),e.loggedUser,{id:0,role:"N/A"}],n=i.find(s,i.identity);return n=i.deepClone(n),n._id=t+"/user/"+n.id,n.host={id:t},n.tau_keep_date=!0,delete n.id,n},getSessionData:function(t,s){var n=this,r=n.getHost(),o=this.getUser(t);a.done(function(t){var n=t.location||{address:{}},a=new Date,l=a.getDate()+"_"+(a.getMonth()+1)+"_"+a.getFullYear(),p=o._id+"/"+l;delete n.latitude,delete n.longitude,delete n.source,o.location=n;var g=[],f=h.getRegisteredMashups();i.each(i.keys(f),function(e){var t=u(e,r);t.length&&g.push({_id:r+"/"+t+"/"+l,name:i.trim(t),host:{id:r},files:f[e]})});var m={user:o,mashup:g,host:{_id:r},visit:{_id:p,user:{id:o._id},host:{id:r},browser:t.browser,device:t.device,locale:t.locale,location:n}},v=i.keys(c);if(v.length>0){var w=[];i.each(v,function(e){var t=u(e,r);t.length&&w.push({_id:r+"/"+t+"/"+l,name:t,path:e,host:{id:r}})}),m.failedMashup=w}d.get().done(function(t){if("string"===e.type(t.createdOn)){var n=t.createdOn.split("/");t.createdOn=new Date(parseInt(n[2],10),parseInt(n[0],10)-1,parseInt(n[1],10))}i.extend(m.host,t),i.extend(m.visit.host,t),i.extend(m.user.host,t),s(m)})})}})});