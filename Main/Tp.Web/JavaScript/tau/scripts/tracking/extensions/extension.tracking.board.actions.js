define(["Underscore","./extension.tracking.base","libs/json2"],function(a,t){var e=function(t){try{return JSON.stringify(t)}catch(e){try{var r={};return a.each(t,function(a,t){try{JSON.stringify(a)&&(r[t]=a)}catch(e){r[t]=a+"[cyclic reference]"}}),JSON.stringify(r)}catch(i){return"[object "+i.message+"]"}}};return t.extend({bs_id:0,"global boardSettings.ready":function(a,t){var e=t.boardSettings;this.bs_id!==e.__objectId&&(this.bs_id=e.__objectId,this.boardSettings&&this.boardSettings.onChange.remove(this.trackBoardSettingsDiff),this.boardSettings=e,this.boardSettings.onChange.remove(this.trackBoardSettingsDiff).add(this.trackBoardSettingsDiff))},"global add.board":function(t,e){this.fire("track.action",a.extend({name:"add board"},e))},"global remove.board":function(t,e){this.fire("track.action",a.extend({name:"remove board"},e))},"global help.flow.action":function(a,t){var e={name:t.name,area:"help flow",tags:["help flow","help"]};t.tags&&(e.tags=e.tags.concat(t.tags)),t.progress&&(e.progress=t.progress),this.fire("track.action",e)},"global quick.add.popup.rendered":function(){this.fire("track.action",{name:"show quick add popup",tags:["board","quick add"]})},"global relatedQuickAdd.afterShow":function(){this.fire("track.action",{name:"show related quick add popup",tags:["board","quick add"]})},"global paging.cell.show.more":function(){this.fire("track.action",{name:"show more cards",tags:["board","show more"]})},"global board.configurator.ready:last + model.data.item.did.add":function(a,t,e){var r=e.message;if(r&&r.dataItem&&r.dataItem.type&&r.dataItem.data){var i=r.dataItem.data.cardData,o=i.type.toLowerCase();this.fire("track.action",{action:"entity added",name:o+" #"+i.id+" added using quick add",type:o,tags:["add "+o,"add card","board"]})}},"global error":function(t,r){var i;r?a.isString(r)?i=r:r.message?i=r.message+(r.details||""):r.$node?(i=r.$node.text&&r.$node.text(),i=i||"unknown issue: unknown $node"):i="unknown issue: "+e(r):i="unknown issue: unspecified global error",this.fire("track.error",{message:i})
},"global model.data.item.did.fail.add":function(a,t){t.Message&&(this.fire("track.error",{name:"quick add error",message:t.Message}),this.fire("track.action",{name:"quick add error",tags:["error","board","quick add"],message:t.Message}))},"global view.card.batch.move.completed":function(t,e){var r=[],i={};a.each(e,function(a){if(a.data){var t=a.data("entity-type");r.push({type:t,id:a.data("entity-id")}),i[t]||(i[t]=0),i[t]++}}),this.fire("track.action",{action:"move cards",name:r.length+" card(s) moved "+JSON.stringify(i),cards:r,tags:["board","business action","move cards"]})},"global board.template.selected":function(a,t){t=t||{name:"not defined"},this.fire("track.action",{action:"apply template",name:"apply template ["+t.name+"]",template:t,tags:["board","templates","customize","settings"]})},trackBoardSettingsDiff:function(t){if(t){var e=[],r={};a.each(t,function(a,t){var i=t;"isdraft"!==i.toLowerCase()&&(i="user"===t?"user filter":"edit"===t?"switch "+(a?"on":"off")+" board edit mode":"name"==t?"boardName":t,r[i]=a,e.push(i))}),e.length>0&&taus.track({"@":["--update-board-context"],action:"customize board",name:"change board settings ["+e.join(",")+"]",tags:["customize","board"].concat(e),changes:r})}}})});