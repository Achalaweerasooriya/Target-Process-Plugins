define(["Underscore","jQuery","tau/comet/comet.api","./testcase.api","./data.comet"],function(_,$,api,TestCaseApi,fixtures){var testCase=new TestCaseApi("comet",{fixtures:fixtures});return testCase.create({name:"smoke test of slice notifications",method:["x","y"],asserts:function(test,r,slice){var $deferred=$.Deferred(),store=test.get("store"),stories=_.values(test.get("data").userStory),moveStoriesToBacklog=function(){var $set=[];_.each(stories,function(story){$set.push({id:story.id,feature:null,release:null}),$set.push({name:"double "+_.uniqueId(),feature:{id:story.feature.id},release:{id:story.release.id},project:{id:story.project.id}})}),store.save("story",{$set:$set}).done()},parameters=slice.getSliceParams(),cometCallback=function(r){test.ok(!0,"Has at least one comet notification"),testedComet.stop(function(){$deferred.resolve()})},testedComet=api.listen("slice",{parameters:parameters}).on({callback:cometCallback}).start(moveStoriesToBacklog);return $deferred}}),testCase.get()})