define(["tests.async/testkit/testkit.store","tau/configurator","tau/service.container","tau/utils/utils.fixturesLoader.store","tau/core/bus","tau/core/event","tau/utils/utils.process","libs.tests/Sinon","tau/slice/api","tests/common/remoteConstants"],function(TestKit,globalConfigurator,ServiceContainer,DumpLoader,Bus,Event,process,sinon,slice,Constants){slice.prototype.__cache=!1;var ComponentTestKit=TestKit.extend({extendBusEvents:function(componentBus){var testBus=new Bus,eventsCount={},originalFire=componentBus.fire;return componentBus.fire=function(eventName){var params=Array.prototype.slice.call(arguments);process.nextTick(function(){testBus.fire.apply(testBus,params),eventsCount.hasOwnProperty(eventName)||(eventsCount[eventName]=0),params[0]+="["+eventsCount[eventName]+"]",testBus.fire.apply(testBus,params),eventsCount[eventName]=eventsCount[eventName]+1}),originalFire.apply(componentBus,params)},testBus},init:function(componentClass){this._super(),this.componentClass=componentClass;var self=this;this.registerSetup("options",function(test,next){test.set("constants",Constants),test.set("real",globalConfigurator.getConfig("real")),test.set("componentClass",self.componentClass),next()}),this.registerSetup("componentBus",function(test,next){var componentConfig={context:{configurator:test.get("configurator")}};test.set("componentBus",test.get("componentClass").create(componentConfig)),next()}),this.registerSetup("listeners",function(test,next){var componentBus=test.get("componentBus"),testBus=self.extendBusEvents(componentBus);test.set("bus",testBus),next()}),this.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus");componentBus.initialize({store:test.get("configurator").getStore(),customField:{name:"Tttext",type:"RichText"},context:{entity:testData.userStory.us1,applicationContext:{processes:[testData.process.scrum],selectedProjects:[testData.project.p_scrum]},getCustomFields:function(){return[{name:"Tttext",type:"RichText"},{name:"Lnk",type:"URL"},{name:"NumberOfGod",type:"Number"}]}}}),next()}),this.registerTeardown("component.destroy",function(test,next){test.get("componentBus").fire("destroy"),next()}),this.registerTeardown("configurator.destroy",function(test,next){test.get("configurator").clear(),next()})},flow:function(test,flow){flow=_.extend({bus:test.get("bus")},flow),Event.subscribeOn(flow)}});return ComponentTestKit})