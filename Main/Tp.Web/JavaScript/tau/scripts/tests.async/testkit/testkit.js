define(["tau/core/class","Underscore"],function(a,_){var b=a.extend({init:function(){this.setups={},this.teardowns={}},registerSetup:function(a,b){this.setups[a]=b},registerTeardown:function(a,b){this.teardowns[a]=b},unique:function(a){return _.uniqueId(a+" ")+" "+ +(new Date)},test:function(a){var b=_.values(this.setups),c=_.values(this.teardowns);return function(){return function(d){var e=[];_.forEach(b,function(a){e.push(function(b){a.call(null,d,b)})});var f=[];_.forEach(c,function(a){f.push(function(b){a.call(null,d,b)})}),_.series(e,function(b,e){if(b)d.done(b);else{if(c.length){var g=d.done;d.done=function(a){_.series(f,function(b){if(a||b)return g(a||b);g()})}}try{a(d)}catch(h){d.fail("failure:"+h.message),d.done()}}})}}()}});return b})