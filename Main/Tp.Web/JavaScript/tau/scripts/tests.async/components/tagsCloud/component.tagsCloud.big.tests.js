define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.tagsCloud","tests/common/remoteConstants"],function($,TestKit,Component,Constants){var testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){if(!test.get("real")){test.done();return}var entityTypes={us:{id:Constants.EntityTypes.USERSTORY.id,name:"userStory"}},practices={planning:{id:Constants.Practices.PLANNING.id}},customFields={},processes={scrum:{name:"scream"+parseInt(Math.random()*1e11),practices:["planning"]}},projects={p_scrum:{name:"Project Scrum"+parseInt(Math.random()*1e11),process:"scrum"}},getTags=function(start,num){var t=["bizarre","sex","lesbian","amateur"],ts=[];for(var i=0;i<num;i++)ts.push(_.shuffle(t)[0]+(start+i));return ts.join(", ")},userStories={us1:{name:"US1",entityType:"us",project:"p_scrum",tags:getTags(100,55)},us2:{name:"US2",entityType:"us",project:"p_scrum",tags:getTags(200,25)},us3:{name:"US3",entityType:"us",project:"p_scrum",tags:getTags(300,30)}},fixtures={practices:practices,entityTypes:entityTypes,processes:processes,projects:projects,customFields:customFields,userStories:userStories};test.set("fixtures",fixtures),next()}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus");componentBus.initialize({context:{entity:testData.userStory.us1,configurator:test.get("configurator")}}),next()});var testcase={name:"component.tagsCloud"},checkTag=function($tag,val,rank,test){test.equals($tag.text(),val,"render tag text"),test.equals($tag.hasClass("tau-tag-rank-"+rank),!0,"render tag class")};return testcase["should render valid markup using all tags and show filter"]=testKit.test(function(test){return testKit.flow(test,{"bus afterRender[0]":function(evt,renderData){var $el=renderData.element,$tags=$el.find(".i-role-tag");test.equals($tags.length,110,"render a lot of tags in order of size and name");var $visible=$tags.filter(":not(.tau-tags-cloud__item_hidden_true)"),$hidden=$tags.filter(".tau-tags-cloud__item_hidden_true");test.equals($visible.length,100,"first 100 visible"),test.equals($hidden.length,10,"other 10 hidden");var $filter=$el.find("[name=filter]");test.equals($filter.length,1,"have filter"),$filter.val("e"),$filter.trigger("keyup"),test.equals($tags.filter(".tau-tags-cloud__item_filtered_true").length,110,"all are shown"),test.equals($tags.filter(".tau-tags-cloud__item_filtered_false").length,0,"all are shown"),$filter.val("xz"),$filter.trigger("keyup"),test.equals($tags.filter(".tau-tags-cloud__item_filtered_true").length,0,"all are hidden"),test.equals($tags.filter(".tau-tags-cloud__item_filtered_false").length,110,"all are hidden"),$filter.val(""),$filter.trigger("keyup"),test.equals($tags.filter(".tau-tags-cloud__item_filtered_true").length,0,"reset"),test.equals($tags.filter(".tau-tags-cloud__item_filtered_false").length,0,"reset"),test.done()}})}),testcase})