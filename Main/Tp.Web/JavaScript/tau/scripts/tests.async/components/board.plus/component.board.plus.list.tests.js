define(["Underscore","jQuery","tau/core/event","tau/ui/extensions/board.plus/ui.board.plus.utils","tests.async/testkit/testkit.component.board","tau/components/component.board.plus.list"],function(_,$,Event,BoardPlusUtils,TestKit,ComponentBoardPlus){var testKit=new TestKit(ComponentBoardPlus,{viewMode:"list",x:{types:["release"],filter:"?It is not None"},y:{types:["feature"],filter:"?It is not None"}}),testcase={name:"component.board.plus.list"};return testcase["should render skeleton"]=testKit.test(function(test){var bus=test.get("bus"),EXPECTED_TESTS_COUNT=test.get("real")?398:394;test.expect(EXPECTED_TESTS_COUNT);var testFlow={bus:bus,"bus view.build.skeleton[0]":function(evt){var actualData=evt.data,mX=actualData.marksX,mY=actualData.marksY;test.equals(_.isArray(mX),!0,"X axis length"),test.equals(mX.length,0,"X axis length"),test.equals(_.isArray(mY),!0,"Y axis length"),test.equals(mY.length,0,"Y axis length")},"bus view.skeleton.built[0]":function(evt){var $skeleton=evt.data.element;test.equals($skeleton.find("[role=header]").size(),0,"Board without headers");var $grid=$skeleton.find("[role=grid]");test.ok($grid.hasClass("tau-entity-list"),"grid css class");var $cell=$grid.find("[role=cell]");test.equals($cell.size(),1,"Single cell board");var expectedCellData={x:null,y:null};test.same($cell.data(),expectedCellData,"Cell data")},"bus view.build.skeleton[0]+view.skeleton.built[0]+view.cell.skeleton.built[0]":function(evt){var evtBoardSkeleton=evt["view.skeleton.built[0]"].data,evtCellSkeleton=evt["view.cell.skeleton.built[0]"].data,$skeletonCellNode=evtCellSkeleton.element,$skeletonCell=evtBoardSkeleton.element.find("[role=cell]");test.equals($skeletonCellNode[0],$skeletonCell[0],"Built cell inserted into the board skeleton");var registeredData=test.get("data"),expectedCardsCount=_(registeredData.userStory).keys().length,$cards=$skeletonCell.find("[role=card]");test.equals($cards.size(),expectedCardsCount,expectedCardsCount+" cards on the board");var cellStories=_(registeredData.userStory).values();for(var i=0;i<cellStories.length;i++){var us=cellStories[i],type=us.entityType.name,cardId=BoardPlusUtils.getCardIds({id:us.id})[0],$card=$skeletonCell.find("#"+cardId),$cardId=$card.find(".tau-id");test.equal($cardId.text(),us.id,"Card id "+us.id),test.equal($cardId.attr("href").indexOf("#"+type.toLowerCase()+"/"+us.id)>=0,!0,"Card id reference "+us.id),test.equal($cardId.attr("href").indexOf("TpView.aspx?acid=")>=0,!0,"Card id reference "+us.id),test.equal($card.find(".tau-name").text(),us.name,"Card name "+us.name);var cardData=$card.data();cardData.entityType=cardData.entityType.toLowerCase(),test.equal(cardData.entityId,us.id,"Card data"),test.equal(cardData.entityType,type.toLowerCase(),"Card data")}test.get("real")||test.done()},"bus view.cell.skeleton.built[0]+view.cardDetails.loaded[0]":function(evt){var $listCell=evt["view.cell.skeleton.built[0]"].data.element,$detailsView=evt["view.cardDetails.loaded[0]"].data.element,$titleIcon=$detailsView.find(".ui-title .ui-type-icon"),$titleId=$detailsView.find(".ui-title .entity-id .ui-link"),$cards=$listCell.find("[role=card]"),cardData=$cards.eq(0).data();test.ok($titleIcon.hasClass("ui-type-icon-"+cardData.entityType.toLowerCase()),"Entity details view is opened"),test.equal($titleId.text(),"#"+cardData.entityId,"Entity id is valid"),$cards.eq(1).trigger("mousedown"),$cards.eq(1).trigger("mouseup")},"bus view.cell.skeleton.built[0]+view.cardDetails.loaded[1]":function(evt){var $listCell=evt["view.cell.skeleton.built[0]"].data.element,$detailsView=evt["view.cardDetails.loaded[1]"].data.element,$titleIcon=$detailsView.find(".ui-title .ui-type-icon"),$titleId=$detailsView.find(".ui-title .entity-id .ui-link"),$cards=$listCell.find("[role=card]"),cardData=$cards.eq(1).data();test.ok($titleIcon.hasClass("ui-type-icon-"+cardData.entityType.toLowerCase()),"Another entity details view is opened"),test.equal($titleId.text(),"#"+cardData.entityId,"Entity id is valid"),test.done()}};Event.subscribeOn(testFlow)}),testcase})