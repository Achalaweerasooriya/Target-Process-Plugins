define(["Underscore","jQuery","tau/configurator","tau/core/external.fake","tau/configurations/definitions/board.definition.factory","tests.async/testkit/testkit.component.board","tau/components/component.board.add"],function(_,$,configurator,FakeExternalService,BoardDefinitionFactory,TestKit,Component){var testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){var fixtures={};test.set("fixtures",fixtures),next()}),testKit.registerSetup("component.initialize",function(test,next){var configuratorInstance=test.get("configurator"),fakeWindow={document:{title:""},location:{hash:"#",href:""}},fakeExternal=new FakeExternalService(fakeWindow);configuratorInstance.setWindow(fakeWindow),configuratorInstance.setExternalService(fakeExternal),configuratorInstance.boardDefinitionFactory=new BoardDefinitionFactory(configuratorInstance,{groupName:test.get("board.definition").groupName}),configuratorInstance.getBoardDefinitionFactory=function(){return this.boardDefinitionFactory},configuratorInstance.setLoggedUser({id:555});var componentBus=test.get("componentBus"),componentConfig={context:{configurator:configuratorInstance}};componentBus.initialize(componentConfig);var boardSettings=configuratorInstance.getBoardSettingsFactory().createInstance(test.get("board.definition"));componentBus.fire("boardSettings.ready",{boardSettings:boardSettings}),next()});var testcase={name:"component.board.add"};return testcase["should render button"]=testKit.test(function(test){testKit.flow(test,{"bus afterRender[0]":function(evt){var $el=evt.data.element,$button=$el,service=test.get("configurator").getRestStorage(),spy=sinon.spy(service,"data"),routing=test.get("configurator").getRouting();sinon.stub(routing,"redirect",function(location){test.equals(spy.calledOnce,!0,"save called");var call=spy.getCall(0);test.equals(call.args[0],test.get("board.definition").groupName);var data=call.args[2].publicData;test.equals("createdAt"in data,!0,"set creation date"),test.equals(data.edit,!0,"set edit after create"),test.equals(data.isDraft,!0,"set no draft"),test.equals(data.name,"New Board","set name"),test.equals(data.zoomLevel,3,"zoom level"),test.equals(data.ownerId,555,"Owner"),test.equals(data.menuIsVisible,!0,"Menu"),test.done()}),test.equals($el.find("[role=action-add]").length,1,"has button"),$el.find("[role=action-add]").click()}})}),testcase})