define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.customField.templatedUrl","tests/common/remoteConstants"],function($,TestKit,Component,Constants){var testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){var entityTypes={us:{id:Constants.EntityTypes.USERSTORY.id,name:"userStory"}},practices={planning:{id:Constants.Practices.PLANNING.id}},customFields={},processes={scrum:{name:"scream"+parseInt(Math.random()*1e11),practices:["planning"],customFields:[{name:"some url",fieldType:"TemplatedURL",entityType:{id:Constants.EntityTypes.USERSTORY.id},value:"http://www.{0}.com"},{name:"NumberOfBeast",fieldType:"Number",entityType:{id:Constants.EntityTypes.USERSTORY.id}},{name:"NumberOfGod",fieldType:"Number",entityType:{id:Constants.EntityTypes.USERSTORY.id}}]}},projects={p_scrum:{name:"Project Scrum"+parseInt(Math.random()*1e11),process:"scrum"}},userStories={us1:{name:"US1",entityType:"us",project:"p_scrum",customFields:[{name:"some url",type:"TemplatedURL",value:"preved, medved, zzz.zzz"},{name:"NumberOfBeast",type:"Number",value:666},{name:"NumberOfGod",type:"Number",value:null}]}},fixtures={practices:practices,entityTypes:entityTypes,processes:processes,projects:projects,customFields:customFields,userStories:userStories};test.set("fixtures",fixtures),next()}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data");test.get("componentBus").initialize({store:test.get("configurator").getStore(),customField:{name:"some url",type:"TemplatedURL",value:"http://www.{0}.com"},context:{entity:testData.userStory.us1,applicationContext:{processes:[testData.process.scrum],selectedProjects:[testData.project.p_scrum]},getCustomFields:function(){return[{name:"some url",type:"TemplatedURL",value:"http://www.{0}.com"},{name:"NumberOfBeast",type:"Number"},{name:"NumberOfGod",type:"Number"}]}}}),next()});var testcase={name:"component.customField.templatedUrl"};return testcase["should render valid markup"]=testKit.test(function(test){var bus=test.get("bus");bus.on("afterRender[0]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"some url","Name is valid");var $val=$el.find(".ui-customfield__value"),$links=$val.find("a");test.equals($links.length,3,"links");var checkLink=function($link,text,href){test.equals($link.attr("title"),text,"link text"),test.equals($link.attr("href"),href,"link href")};checkLink($links.eq(0),"preved","http://www.preved.com"),checkLink($links.eq(1),"medved","http://www.medved.com"),checkLink($links.eq(2),"zzz.zzz","http://www.zzz.zzz.com"),test.done()})}),testcase["allow to edit"]=testKit.test(function(test){var bus=test.get("bus"),checkLink=function($link,text,href){test.equals($link.attr("title"),text,"link text"),test.equals($link.attr("href"),href,"link href")};bus.on("afterRender[0]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"some url","Name is valid");var $val=$el.find(".ui-customfield__value"),$links=$val.find("a");test.equals($links.length,3,"links"),checkLink($links.eq(0),"preved","http://www.preved.com"),checkLink($links.eq(1),"medved","http://www.medved.com"),checkLink($links.eq(2),"zzz.zzz","http://www.zzz.zzz.com"),$val.click(),test.equals($val.prop("contenteditable"),"true","ready to edit"),test.equals($val.text(),"preved, medved, zzz.zzz","ready to edit"),$val.focus(),$val.text("preved, wwwww"),$val.blur(),$("body").click()}),bus.on("afterRender[1]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"some url","Name is valid");var $val=$el.find(".ui-customfield__value"),$links=$val.find("a");test.equals($links.length,2,"links"),checkLink($links.eq(0),"preved","http://www.preved.com"),checkLink($links.eq(1),"wwwww","http://www.wwwww.com"),test.done()})}),testcase})