define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.customField.dropdown","tests/common/remoteConstants"],function($,TestKit,Component,Constants){var testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){var entityTypes={us:{id:Constants.EntityTypes.USERSTORY.id,name:"userStory"}},practices={planning:{id:Constants.Practices.PLANNING.id}},customFields={},processes={scrum:{name:"scream"+parseInt(Math.random()*1e11),practices:["planning"],customFields:[{name:"Who are you",entityFieldName:"Who are you",fieldType:"DropDown",entityType:{id:Constants.EntityTypes.USERSTORY.id},value:["A","B","C","D"].join("\r\n"),enabledForFilter:!1,required:!1},{name:"Who are you req",entityFieldName:"Who are you req",fieldType:"DropDown",entityType:{id:Constants.EntityTypes.USERSTORY.id},value:["A","B","C","D"].join("\r\n"),enabledForFilter:!1,required:!0},{name:"NumberOfGod",fieldType:"Number",entityType:{id:Constants.EntityTypes.USERSTORY.id}}]}},projects={p_scrum:{name:"Project Scrum"+parseInt(Math.random()*1e11),process:"scrum"}},userStories={us1:{name:"US1",entityType:"us",project:"p_scrum",customFields:[{name:"Who are you",type:"DropDown",value:null},{name:"Who are you req",type:"DropDown",value:null},{name:"NumberOfGod",type:"Number",value:null}]}},fixtures={practices:practices,entityTypes:entityTypes,processes:processes,projects:projects,customFields:customFields,userStories:userStories};test.set("fixtures",fixtures),next()}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus");componentBus.initialize({store:test.get("configurator").getStore(),customField:{name:"Who are you",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},context:{entity:testData.userStory.us1,applicationContext:{processes:[testData.process.scrum],selectedProjects:[testData.project.p_scrum]},getCustomFields:function(){return[{name:"Who are you",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},{name:"Who are you req",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},{name:"NumberOfGod",type:"Number"}]}}}),next()});var testcase={name:"component.customField.dropdown"};return testcase["should render valid markup and allow to edit"]=testKit.test(function(test){var bus=test.get("bus");bus.on("afterRender[0]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Who are you","Name is valid"),test.equals($el.find(".ui-customfield__value").text(),"","Correct process and output");var $val=$el.find(".ui-customfield__value");test.ok($val.tauBubble,"Can be editable");var $tr=$el.find("tr");$tr.bind("taububbleloadcontent",function(){var $popup=$tr.tauBubble("widget"),$options=$popup.find("[role=option]");test.equals($options.length,4,"Output options to render");var $reset=$popup.find("[role=action-reset]");test.equals($reset.length,0,"No reset action"),$options.eq(1).click()}),$val.click()}),bus.on("afterRender[1]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Who are you","Name is valid"),test.equals($el.find(".ui-customfield__value").text(),"B","Correct process and output");var $tr=$el.find("tr");$tr.bind("taububbleloadcontent",function(){var $popup=$tr.tauBubble("widget"),$options=$popup.find("[role=option]");test.equals($options.length,3,"Output options to render except current");var $reset=$popup.find("[role=action-reset]");test.equals($reset.length,1,"Show reset action"),$reset.click()});var $val=$el.find(".ui-customfield__value");test.ok($val.tauBubble,"Can be editable"),$val.click()}),bus.on("afterRender[2]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Who are you","Name is valid"),test.equals($el.find(".ui-customfield__value").text(),"","Correct process and output"),test.done()})}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus");componentBus.initialize({store:test.get("configurator").getStore(),customField:{name:"Who are you req",type:"Dropdown",value:["A","B","C","D"].join("\r\n"),required:!0},context:{entity:testData.userStory.us1,applicationContext:{processes:[testData.process.scrum],selectedProjects:[testData.project.p_scrum]},getCustomFields:function(){return[{name:"Who are you",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},{name:"Who are you req",type:"Dropdown",value:["A","B","C","D"].join("\r\n"),required:!0},{name:"NumberOfGod",type:"Number"}]}}}),next()}),testcase["should render valid markup and allow to edit for required"]=testKit.test(function(test){var bus=test.get("bus");bus.on("afterRender[0]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Who are you req","Name is valid"),test.equals($el.find(".ui-customfield__value").text(),"","Correct process and output");var $val=$el.find(".ui-customfield__value");test.ok($val.tauBubble,"Can be editable");var $tr=$el.find("tr");$tr.bind("taububbleloadcontent",function(){var $popup=$tr.tauBubble("widget"),$options=$popup.find("[role=option]");test.equals($options.length,4,"Output options to render");var $reset=$popup.find("[role=action-reset]");test.equals($reset.length,0,"No reset action"),$options.eq(1).click()}),$val.click()}),bus.on("afterRender[1]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Who are you req","Name is valid"),test.equals($el.find(".ui-customfield__value").text(),"B","Correct process and output");var $tr=$el.find("tr");$tr.bind("taububbleloadcontent",function(){var $popup=$tr.tauBubble("widget"),$options=$popup.find("[role=option]");test.equals($options.length,3,"Output options to render except current");var $reset=$popup.find("[role=action-reset]");test.equals($reset.length,0,"Show no reset action"),$options.eq(1).click()});var $val=$el.find(".ui-customfield__value");test.ok($val.tauBubble,"Can be editable"),$val.click()}),bus.on("afterRender[2]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Who are you req","Name is valid"),test.equals($el.find(".ui-customfield__value").text(),"C","Correct process and output"),test.get("configurator").getStore().save("userStory",{id:test.get("data").userStory.us1.id,$set:{customFields:[{name:"Who are you req",type:"Dropdown",value:null}]}}).done({success:function(){test.done()},failure:function(){test.done()}})})}),testcase})