define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.customField.dropdown","tests/common/remoteConstants"],function($,a,b,c){var d=new a(b);d.registerSetup("fixtures",function(a,b){var d={us:{id:c.EntityTypes.USERSTORY.id,name:"userStory"}},e={planning:{id:c.Practices.PLANNING.id}},f={},g={scrum:{name:"scream"+parseInt(Math.random()*1e11),practices:["planning"],customFields:[{name:"Who are you",entityFieldName:"Who are you",fieldType:"DropDown",entityType:{id:c.EntityTypes.USERSTORY.id},value:["A","B","C","D"].join("\r\n"),enabledForFilter:!1,required:!1},{name:"Who are you req",entityFieldName:"Who are you req",fieldType:"DropDown",entityType:{id:c.EntityTypes.USERSTORY.id},value:["A","B","C","D"].join("\r\n"),enabledForFilter:!1,required:!0},{name:"NumberOfGod",fieldType:"Number",entityType:{id:c.EntityTypes.USERSTORY.id}}]}},h={p_scrum:{name:"Project Scrum"+parseInt(Math.random()*1e11),process:"scrum"}},i={us1:{name:"US1",entityType:"us",project:"p_scrum",customFields:[{name:"Who are you",type:"DropDown",value:null},{name:"Who are you req",type:"DropDown",value:null},{name:"NumberOfGod",type:"Number",value:null}]}},j={practices:e,entityTypes:d,processes:g,projects:h,customFields:f,userStories:i};a.set("fixtures",j),b()}),d.registerSetup("component.initialize",function(a,b){var c=a.get("data"),d=a.get("componentBus");d.initialize({store:a.get("configurator").getStore(),customField:{name:"Who are you",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},context:{entity:c.userStory.us1,applicationContext:{processes:[c.process.scrum],selectedProjects:[c.project.p_scrum]},getCustomFields:function(){return[{name:"Who are you",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},{name:"Who are you req",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},{name:"NumberOfGod",type:"Number"}]}}}),b()});var e={name:"component.customField.dropdown"};return e["should render valid markup and allow to edit"]=d.test(function(a){var b=a.get("bus");b.on("afterRender[0]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Who are you","Name is valid"),a.equals(c.find(".ui-customfield__value").text(),"","Correct process and output");var d=c.find(".ui-customfield__value");a.ok(d.tauBubble,"Can be editable");var e=c.find("tr");e.bind("taububbleloadcontent",function(){var b=e.tauBubble("widget"),c=b.find("[role=option]");a.equals(c.length,4,"Output options to render");var d=b.find("[role=action-reset]");a.equals(d.length,0,"No reset action"),c.eq(1).click()}),d.click()}),b.on("afterRender[1]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Who are you","Name is valid"),a.equals(c.find(".ui-customfield__value").text(),"B","Correct process and output");var d=c.find("tr");d.bind("taububbleloadcontent",function(){var b=d.tauBubble("widget"),c=b.find("[role=option]");a.equals(c.length,3,"Output options to render except current");var e=b.find("[role=action-reset]");a.equals(e.length,1,"Show reset action"),e.click()});var e=c.find(".ui-customfield__value");a.ok(e.tauBubble,"Can be editable"),e.click()}),b.on("afterRender[2]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Who are you","Name is valid"),a.equals(c.find(".ui-customfield__value").text(),"","Correct process and output"),a.done()})}),d.registerSetup("component.initialize",function(a,b){var c=a.get("data"),d=a.get("componentBus");d.initialize({store:a.get("configurator").getStore(),customField:{name:"Who are you req",type:"Dropdown",value:["A","B","C","D"].join("\r\n"),required:!0},context:{entity:c.userStory.us1,applicationContext:{processes:[c.process.scrum],selectedProjects:[c.project.p_scrum]},getCustomFields:function(){return[{name:"Who are you",type:"Dropdown",value:["A","B","C","D"].join("\r\n")},{name:"Who are you req",type:"Dropdown",value:["A","B","C","D"].join("\r\n"),required:!0},{name:"NumberOfGod",type:"Number"}]}}}),b()}),e["should render valid markup and allow to edit for required"]=d.test(function(a){var b=a.get("bus");b.on("afterRender[0]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Who are you req","Name is valid"),a.equals(c.find(".ui-customfield__value").text(),"","Correct process and output");var d=c.find(".ui-customfield__value");a.ok(d.tauBubble,"Can be editable");var e=c.find("tr");e.bind("taububbleloadcontent",function(){var b=e.tauBubble("widget"),c=b.find("[role=option]");a.equals(c.length,4,"Output options to render");var d=b.find("[role=action-reset]");a.equals(d.length,0,"No reset action"),c.eq(1).click()}),d.click()}),b.on("afterRender[1]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Who are you req","Name is valid"),a.equals(c.find(".ui-customfield__value").text(),"B","Correct process and output");var d=c.find("tr");d.bind("taububbleloadcontent",function(){var b=d.tauBubble("widget"),c=b.find("[role=option]");a.equals(c.length,3,"Output options to render except current");var e=b.find("[role=action-reset]");a.equals(e.length,0,"Show no reset action"),c.eq(1).click()});var e=c.find(".ui-customfield__value");a.ok(e.tauBubble,"Can be editable"),e.click()}),b.on("afterRender[2]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Who are you req","Name is valid"),a.equals(c.find(".ui-customfield__value").text(),"C","Correct process and output"),a.get("configurator").getStore().save("userStory",{id:a.get("data").userStory.us1.id,$set:{customFields:[{name:"Who are you req",type:"Dropdown",value:null}]}}).done({success:function(){a.done()},failure:function(){a.done()}})})}),e})