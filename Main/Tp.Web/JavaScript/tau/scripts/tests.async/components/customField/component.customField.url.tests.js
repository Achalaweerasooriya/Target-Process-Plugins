define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.customField.url","tests/common/remoteConstants"],function($,a,b,c){var d=new a(b);d.registerSetup("fixtures",function(a,b){var d={us:{id:c.EntityTypes.USERSTORY.id,name:"userStory"}},e={planning:{id:c.Practices.PLANNING.id}},f={},g={scrum:{name:"scream"+parseInt(Math.random()*1e11),practices:["planning"],customFields:[{name:"Lnk",fieldType:"URL",entityType:{id:c.EntityTypes.USERSTORY.id}},{name:"Other Lnk",fieldType:"URL",entityType:{id:c.EntityTypes.USERSTORY.id}},{name:"NumberOfGod",fieldType:"Number",entityType:{id:c.EntityTypes.USERSTORY.id}}]}},h={p_scrum:{name:"Project Scrum"+(new Date).getTime(),process:"scrum"}},i={us1:{name:"US1",entityType:"us",project:"p_scrum",customFields:[{name:"Lnk",type:"URL",value:{label:"Best Pnor",url:"http://pnor.com/"}},{name:"Other Lnk",type:"URL",value:null},{name:"NumberOfGod",type:"Number",value:null}]}},j={practices:e,entityTypes:d,processes:g,projects:h,customFields:f,userStories:i};a.set("fixtures",j),b()}),d.registerSetup("component.initialize",function(a,b){var c=a.get("data"),d=a.get("componentBus");d.initialize({store:a.get("configurator").getStore(),customField:{name:"Lnk",type:"URL",value:null},context:{entity:c.userStory.us1,applicationContext:{processes:[c.process.scrum],selectedProjects:[c.project.p_scrum]},getCustomFields:function(){return[{name:"Lnk",type:"URL"},{name:"Lnk",type:"URL"},{name:"NumberOfGod",type:"Number"}]}}}),b()});var e={name:"component.customField.url"};return e["should render valid markup and allow to edit"]=d.test(function(a){var b=a.get("bus");b.on("afterRender[0]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var d=c.find(".ui_custom_field_value_container");a.equals(_.trim(d.text()),"Best Pnor","Correct value"),a.equals(_.trim(d.find("a").attr("href")),"http://pnor.com/","Correct value");var e=c.find("tr");a.ok(e.data().tauBubble,"Can edit"),e.bind("taububbleloadcontent",function(){var b=e.tauBubble("widget");a.equals(b.find(":text").length,2,"form"),a.equals(b.find(":text:eq(0)").val(),"http://pnor.com/"),a.equals(b.find(":text:eq(1)").val(),"Best Pnor"),a.equals(b.find(":button").length,2),b.find(":text:eq(0)").val("http://bestpnor.org/"),b.find(":text:eq(1)").val("Megabest Pnor"),b.find(":button:eq(0)").click()}),e.click()}),b.on("afterRender[1]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var d=c.find(".ui_custom_field_value_container");a.equals(_.trim(d.text()),"Megabest Pnor","Correct value"),a.equals(_.trim(d.find("a").attr("href")),"http://bestpnor.org/","Correct value"),a.done()})}),e["should process empty"]=d.test(function(a){var b=a.get("bus");b.on("afterRender[0]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var d=c.find(".ui_custom_field_value_container");a.equals(_.trim(d.text()),"Best Pnor","Correct value"),a.equals(_.trim(d.find("a").attr("href")),"http://pnor.com/","Correct value");var e=c.find("tr");a.ok(e.data().tauBubble,"Can edit"),e.bind("taububbleloadcontent",function(){var b=e.tauBubble("widget");a.equals(b.find(":text").length,2,"form"),a.equals(b.find(":button").length,2),b.find(":text:eq(0)").val(""),b.find(":text:eq(1)").val(""),b.find(":button:eq(0)").click()}),e.click()}),b.on("afterRender[1]",function(b){var c=b.data.element;a.equals(c.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var d=c.find(".ui_custom_field_value_container");a.equals(_.trim(d.text()),"","Correct value"),a.equals(_.trim(d.find("a").attr("href")),"","Correct value"),a.done()})}),e})