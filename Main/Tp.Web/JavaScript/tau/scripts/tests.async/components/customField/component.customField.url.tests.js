define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.customField.url","tests/common/remoteConstants"],function($,TestKit,Component,Constants){var testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){var entityTypes={us:{id:Constants.EntityTypes.USERSTORY.id,name:"userStory"}},practices={planning:{id:Constants.Practices.PLANNING.id}},customFields={},processes={scrum:{name:"scream"+parseInt(Math.random()*1e11),practices:["planning"],customFields:[{name:"Lnk",fieldType:"URL",entityType:{id:Constants.EntityTypes.USERSTORY.id}},{name:"Other Lnk",fieldType:"URL",entityType:{id:Constants.EntityTypes.USERSTORY.id}},{name:"NumberOfGod",fieldType:"Number",entityType:{id:Constants.EntityTypes.USERSTORY.id}}]}},projects={p_scrum:{name:"Project Scrum"+(new Date).getTime(),process:"scrum"}},userStories={us1:{name:"US1",entityType:"us",project:"p_scrum",customFields:[{name:"Lnk",type:"URL",value:{label:"Best Pnor",url:"http://pnor.com/"}},{name:"Other Lnk",type:"URL",value:null},{name:"NumberOfGod",type:"Number",value:null}]}},fixtures={practices:practices,entityTypes:entityTypes,processes:processes,projects:projects,customFields:customFields,userStories:userStories};test.set("fixtures",fixtures),next()}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus");componentBus.initialize({store:test.get("configurator").getStore(),customField:{name:"Lnk",type:"URL",value:null},context:{entity:testData.userStory.us1,applicationContext:{processes:[testData.process.scrum],selectedProjects:[testData.project.p_scrum]},getCustomFields:function(){return[{name:"Lnk",type:"URL"},{name:"Lnk",type:"URL"},{name:"NumberOfGod",type:"Number"}]}}}),next()});var testcase={name:"component.customField.url"};return testcase["should render valid markup and allow to edit"]=testKit.test(function(test){var bus=test.get("bus");bus.on("afterRender[0]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var $val=$el.find(".ui_custom_field_value_container");test.equals(_.trim($val.text()),"Best Pnor","Correct value"),test.equals(_.trim($val.find("a").attr("href")),"http://pnor.com/","Correct value");var $tr=$el.find("tr");test.ok($tr.data().tauBubble,"Can edit"),$tr.bind("taububbleloadcontent",function(){var $popup=$tr.tauBubble("widget");test.equals($popup.find(":text").length,2,"form"),test.equals($popup.find(":text:eq(0)").val(),"http://pnor.com/"),test.equals($popup.find(":text:eq(1)").val(),"Best Pnor"),test.equals($popup.find(":button").length,2),$popup.find(":text:eq(0)").val("http://bestpnor.org/"),$popup.find(":text:eq(1)").val("Megabest Pnor"),$popup.find(":button:eq(0)").click()}),$tr.click()}),bus.on("afterRender[1]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var $val=$el.find(".ui_custom_field_value_container");test.equals(_.trim($val.text()),"Megabest Pnor","Correct value"),test.equals(_.trim($val.find("a").attr("href")),"http://bestpnor.org/","Correct value"),test.done()})}),testcase["should process empty"]=testKit.test(function(test){var bus=test.get("bus");bus.on("afterRender[0]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var $val=$el.find(".ui_custom_field_value_container");test.equals(_.trim($val.text()),"Best Pnor","Correct value"),test.equals(_.trim($val.find("a").attr("href")),"http://pnor.com/","Correct value");var $tr=$el.find("tr");test.ok($tr.data().tauBubble,"Can edit"),$tr.bind("taububbleloadcontent",function(){var $popup=$tr.tauBubble("widget");test.equals($popup.find(":text").length,2,"form"),test.equals($popup.find(":button").length,2),$popup.find(":text:eq(0)").val(""),$popup.find(":text:eq(1)").val(""),$popup.find(":button:eq(0)").click()}),$tr.click()}),bus.on("afterRender[1]",function(evt){var $el=evt.data.element;test.equals($el.find(".ui-customfield__label").text().trim(),"Lnk","Name is valid");var $val=$el.find(".ui_custom_field_value_container");test.equals(_.trim($val.text()),"","Correct value"),test.equals(_.trim($val.find("a").attr("href")),"","Correct value"),test.done()})}),testcase})