define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.board.general.quick.add","tests/common/remoteConstants"],function($,TestKit,Component,Constants){var testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){var practices={planning:{id:Constants.Practices.PLANNING.id},requirements:{id:Constants.Practices.REQUIREMENTS.id},helpDesk:{id:Constants.Practices["HELP DESK"].id},bugTracking:{id:Constants.Practices["BUG TRACKING"].id}},processes={scrum:{name:"scrum"+ +(new Date),practices:["planning","requirements","helpDesk","bugTracking"]}},projects={p_scrum:{name:"Project Scrum"+(new Date).getTime(),process:"scrum"},p_scrum1:{name:"Project Scrum"+(new Date).getTime()+1,process:"scrum"}},fixtures={practices:practices,processes:processes,projects:projects};test.set("fixtures",fixtures),test.get("configurator").getFeaturesService().setEnabled("quick.add"),next()}),testKit.registerSetup("component.initialize",function(test,next){var configurator=test.get("configurator"),testData=test.get("data"),selectedProjectsIds=[];_.each(testData.project,function(value){selectedProjectsIds.push(value.id)}),selectedProjectsIds.pop();var appContextService=configurator.getApplicationContextService();appContextService.getApplicationContext({projectId:selectedProjectsIds},{success:function(success){configurator.getAppStateStore(),configurator.acidStore.set({set:{acid:success.acid},callback:function(){var componentBus=test.get("componentBus");componentBus.initialize(),next()}})}})});var testcase={name:"component.board.quick.add.general"};return testcase["should render valid markup and add entity"]=testKit.test(function(test){var bus=test.get("bus"),testData=test.get("data");testKit.flow(test,{"bus childComponentCreated":function(data){var bus=data.data;bus.on("model.data.item.did.add",function(){test.ok(!0,"Entity Add"),test.done()})},"bus afterRender[0]":function(evt,renderData){var $el=renderData.element;test.equals($el.length,1,"element rendered");var $button=$el.find("[role=action-quick-add]");$button.click(),$button.bind("taububbleloadcontent",function(){var p=this,$popup=$(p).tauBubble("widget"),form=$popup.find("form").eq(0),name=form.find(".Name"),project=form.find(".project");test.equals(project.find("option").length,1,"one project in context"),project.val(testData.project.p_scrum.id),name.val("test"),form.submit()})}})}),testcase})