define(["Underscore","jQuery","tau/core/event","tests.async/testkit/testkit.component.board","tau/components/component.board.plus","tests/common/remoteConstants","tau/slice/api","tests.async/slice/data","tests.async/slice/client.slice","tau/models/boardSettings/factory.board.settings"],function(_,$,a,b,c,d,e,f,g,h){var i=new b(c),j=new g({x:"release",y:"feature",cells:"userStory"}),k={x:{types:["Release"]},y:{types:["Feature"]},cells:{types:["UserStory"]}};i.registerSetup("fixtures",function(a,b){var c={us:d.EntityTypes.USERSTORY,release:d.EntityTypes.RELEASE,feature:d.EntityTypes.FEATURE},e={planning:{id:d.Practices.PLANNING.id},requirements:{id:d.Practices.REQUIREMENTS.id}},f={scrum:{name:"scrum"+ +(new Date),practices:["planning","requirements"]}},g={p_scrum:{name:"Project Scrum"+ +(new Date),process:"scrum"}},h={},i={};for(var j=0;j<4;j++){var k="release"+j;h[k]={name:"Release_"+j+"_"+ +(new Date),entityType:"release",project:"p_scrum"};var l="feature"+j;i[l]={name:"Feature_"+j+"_"+ +(new Date),entityType:"feature",project:"p_scrum",release:k}}var m={};_(h).chain().keys().each(function(a){_(i).chain().keys().each(function(b){for(var c=0;c<4;c++){var d=["us",a,b,c].join("_");m[d]={name:d,entityType:"us",project:"p_scrum",release:a,feature:b}}})});var n={entityTypes:c,practices:e,processes:f,projects:g,releases:h,features:i,userStories:m};a.set("fixtures",n),b()}),i.registerSetup("component.initialize",function(a,b){var c=a.get("configurator"),d=c.getStore(),e=a.get("data"),f=e.project.p_scrum.id,g=null;a.get("real")===!1&&(g=function(a){var b=$.Deferred(),c=decodeURI(a.url);if(c.indexOf("/cells")>0)return b.resolve(j.getCells(e,a)),b;if(c.indexOf("/xaxis")>0)return b.resolve(j.getXResponse(e,a)),b;if(c.indexOf("/yaxis")>0)return b.resolve(j.getYResponse(e,a)),b;throw"not defined call for "+JSON.stringify(c)},sinon.stub(d.config.proxy.service,"get",function(a){a.callbacks.success({id:a.config.id,acid:"345"})})),d.get("context",{id:f,fields:["acid"]},{success:function(f){_.extend(k,{global:{acid:f.data.acid}});var i=a.get("componentBus"),j={store:d,definition:k,testData:e};g!==null&&(j.sliceService=g),i.initialize(j),c.setExternal({});var l=h.createInstance(c,{id:"xzch"});i.fire("boardSettings.ready",{boardSettings:l}),b()}}).done()});var l={name:"component.board.plus.dnd"};return l["should allow dnd"]=i.test(function(b){var c=b.get("bus"),d=b.get("componentBus"),e={bus:c,"bus afterRender[0]":function(a){var c=a.data.element,d=c.find("[role=grid]");b.equals(d.length,1,"has grid");var e=d.find("[role=cell]");b.ok(e.length>6,"has cells");var f=e.eq(0),g=f.find("[role=card]").eq(1);b.equals(g.length,1,"has card");var h=e.eq(5);g.trigger("mouseenter"),b.ok(g.data("draggable"),"card draggable"),b.done()},"bus view.card.drag.stop.after":function(a){}};a.subscribeOn(e)}),l})