define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.container","tests/common/remoteConstants","tau/core/extension.base"],function($,TestKit,Component,Constants,ExtensionBase){var Ext=function(conf){return ExtensionBase.extend(conf)},testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){test.set("fixtures",{}),next()}),testKit.registerSetup("componentBus",function(test,next){var componentConfig={context:{configurator:test.get("configurator")},extensions:[Ext({"bus componentsCreated":function(evt,data){var childBuses=_.pluck(data,"component");childBuses[1].on("tabs.switched.completed",_.bind(function(){this.fire("tabs.switched.completed")},this))}})]};test.set("componentBus",test.get("componentClass").create(componentConfig)),next()}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus"),configurator=test.get("configuratorInstance"),Tmpl=function(conf){return configurator.getTemplateFactory().register(conf)};componentBus.initialize({context:{configurator:configurator},name:"commoncontainer",type:"container",children:[{name:"zzz",type:"tabsHeader",options:{tabsContainerBusName:"zzz_tabs"},template:Tmpl({name:"tabsHeader.modern",engine:"jqote2",markup:['<div class="box table">','<ul class="entity-tabs i-role-tabheaders">','<li class="i-role-tabheader tab-item selected" data-label="tab1">TAB1</li>','<li class="i-role-tabheader tab-item" data-label="tab2">TAB2</li>','<li class="i-role-tabheader tab-item" data-label="tab3">TAB3</li>',"</ul>","</div>"]})},{name:"zzz_tabs",type:"container",options:{tabsHeaderBusName:"zzz"},layout:"selectable",extensions:[Ext({"bus beforeInit":function(evt,initConfig){initConfig.config.context.configurator.getComponentBusRegistry().getByName(initConfig.config.options.tabsHeaderBusName).done(_.bind(function(bus){this.fire("tabsHeaderBus.ready",bus)},this))},"bus componentsCreated":function(evt,data){var tabsBuses=_.pluck(data,"component");this.fire("tabsBuses.ready",tabsBuses)},"bus tabsBuses.ready + tabsHeaderBus.ready":function(evt,tabsBuses,tabsHeaderBus){var fire=_.bind(this.fire,this);tabsHeaderBus.on("switched",function(evt,name){var busToShow=_.find(tabsBuses,function(v){return v.name==name});busToShow&&(busToShow.once("show.completed",function(){fire("tabs.switched.completed")}),_.forEach(tabsBuses,function(bus){bus===busToShow?bus.fire("show"):bus.fire("hide")}),tabsHeaderBus.fire("switched.after",name))})}})],template:Tmpl({name:"tabs.modern",engine:"jqote2",markup:['<div class="i-role-tabsholder">',"</div>"]}),children:[{name:"tab1",type:"container",selector:".i-role-tabsholder",visible:!0,children:[{type:"label",text:"TAB1 text"},{type:"label",text:"TAB1 text too"}]},{name:"tab2",type:"container",selector:".i-role-tabsholder",visible:!1,children:[{type:"label",text:"TAB2 text"},{type:"label",text:"TAB2 text too"}]},{name:"tab3",type:"container",selector:".i-role-tabsholder",visible:!1,children:[{type:"label",text:"TAB3 text"},{type:"label",text:"TAB3 text too"}]}]}]}),next()});var testcase={name:"component.tabs.modern.asClassic"};return testcase["should render valid default markup"]=testKit.test(function(test){testKit.flow(test,{"bus afterRender[0]":function(evt,renderData){var $el=renderData.element;test.equals($el.length,1,"Render el"),test.equals($el.hasClass("tau-container"),!0,"Valid markup");var $ch=$el.children(),$tabheaders=$ch.eq(0);test.equals($tabheaders.length,1,"Headers"),test.equals($tabheaders.is("div.box.table"),!0,"Headers"),test.equals($tabheaders.children().length,1,"Headers");var $hlist=$tabheaders.children();test.equals($hlist.is("ul.entity-tabs"),!0,"Headers"),$tabheaders=$hlist.children(),test.equals($tabheaders.length,3,"Three Headers"),test.equals($tabheaders.eq(0).is("li.tab-item.selected"),!0,"first header is selected");var checkLabel=function($t1,txt,test){test.equals($t1.text(),txt,"header text"),test.equals($t1.children().length,0,"header render in itself")};checkLabel($tabheaders.eq(0),"TAB1",test),test.equals($tabheaders.eq(1).is("li.tab-item"),!0,"second header is not selected"),test.equals($tabheaders.eq(1).is(":not(.selected)"),!0,"second header is not selected"),checkLabel($tabheaders.eq(1),"TAB2",test),test.equals($tabheaders.eq(2).is("li.tab-item"),!0,"second header is not selected"),test.equals($tabheaders.eq(2).is(":not(.selected)"),!0,"third header is not selected"),checkLabel($tabheaders.eq(2),"TAB3",test);var $tabs=$ch.not($ch.eq(0)).children();test.equals($tabs.is("div.tau-container"),!0,"tabs itself");var $tab=$tabs.eq(0);test.equals($tab.css("display")!="none",!0,"selected visible");var $cont=$tab.children();test.equals($cont.length,2,"content"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB1 text","content"),test.equals($sp.eq(1).text(),"TAB1 text too","content");var $tab=$tabs.eq(1);test.equals($tab.css("display"),"none","non selected hidden");var $cont=$tab.children();test.equals($cont.length,0,"content");var $tab=$tabs.eq(2);test.equals($tab.css("display"),"none","non selected hidden");var $cont=$tab.children();test.equals($cont.length,0,"content"),$tabheaders.eq(2).click()},"bus afterRender[0] + tabs.switched.completed[0]":function(evt,renderData,switched){var $el=renderData.element;test.equals($el.length,1,"Render el"),test.equals($el.hasClass("tau-container"),!0,"Valid markup");var $tabheaders=$el.find("ul.entity-tabs").children();test.equals($tabheaders.length,3,"Three Headers"),test.equals($tabheaders.eq(0).is("li.tab-item"),!0,"first header"),test.equals($tabheaders.eq(0).is(":not(.selected)"),!0,"first header is not selected"),test.equals($tabheaders.eq(1).is("li.tab-item"),!0,"second header"),test.equals($tabheaders.eq(1).is(":not(.selected)"),!0,"second header is not selected"),test.equals($tabheaders.eq(2).is("li.tab-item"),!0,"third header"),test.equals($tabheaders.eq(2).is(".selected"),!0,"third header is selected");var $ch=$el.children(),$tabs=$ch.not($ch.eq(0)).children();test.equals($tabs.eq(0).css("display"),"none","first tab hidden");var $tab=$tabs.eq(0),$cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB1 text","content"),test.equals($sp.eq(1).text(),"TAB1 text too","content"),$sp.eq(1).text("TAB1 Deliberately changed"),test.equals($tabs.eq(1).css("display"),"none","second tab hidden"),$tab=$tabs.eq(1);var $cont=$tab.children();test.equals($cont.length,0,"no content still"),test.equals($tabs.eq(2).css("display")!="none",!0,"third tab show"),$tab=$tabs.eq(2);var $cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB3 text","content"),test.equals($sp.eq(1).text(),"TAB3 text too","content"),$tabheaders.eq(0).click(),$tabheaders.eq(1).click()},"bus afterRender[0] + tabs.switched.completed[1]":function(evt,renderData,switched){var $el=renderData.element;test.equals($el.length,1,"Render el"),test.equals($el.hasClass("tau-container"),!0,"Valid markup");var $tabheaders=$el.find("ul.entity-tabs").children();test.equals($tabheaders.length,3,"Three Headers"),test.equals($tabheaders.eq(0).is("li.tab-item"),!0,"first header"),test.equals($tabheaders.eq(0).is(":not(.selected)"),!0,"first header is not selected"),test.equals($tabheaders.eq(1).is("li.tab-item"),!0,"second header"),test.equals($tabheaders.eq(1).is(".selected"),!0,"second header is selected now"),test.equals($tabheaders.eq(2).is("li.tab-item"),!0,"third header"),test.equals($tabheaders.eq(2).is(":not(.selected)"),!0,"third header is not selected");var $ch=$el.children(),$tabs=$ch.not($ch.eq(0)).children();test.equals($tabs.eq(0).css("display"),"none","first tab hidden");var $tab=$tabs.eq(0),$cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB1 text","content"),test.equals($sp.eq(1).text(),"TAB1 Deliberately changed","content here and not changed"),test.equals($tabs.eq(1).css("display")!="none",!0,"second tab show"),$tab=$tabs.eq(1);var $cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB2 text","content"),test.equals($sp.eq(1).text(),"TAB2 text too","content"),test.equals($tabs.eq(2).css("display"),"none","third tab hidden"),$tab=$tabs.eq(2);var $cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB3 text","content"),test.equals($sp.eq(1).text(),"TAB3 text too","content"),$tabheaders.eq(2).click()},"bus afterRender[0] + tabs.switched.completed[2]":function(evt,renderData,switched){var $el=renderData.element;test.equals($el.length,1,"Render el"),test.equals($el.hasClass("tau-container"),!0,"Valid markup");var $tabheaders=$el.find("ul.entity-tabs").children();test.equals($tabheaders.length,3,"Three Headers"),test.equals($tabheaders.eq(0).is("li.tab-item"),!0,"first header"),test.equals($tabheaders.eq(0).is(":not(.selected)"),!0,"first header is not selected"),test.equals($tabheaders.eq(1).is("li.tab-item"),!0,"second header"),test.equals($tabheaders.eq(1).is(":not(.selected)"),!0,"second header is not selected"),test.equals($tabheaders.eq(2).is("li.tab-item"),!0,"third header"),test.equals($tabheaders.eq(2).is(".selected"),!0,"third header is selected");var $ch=$el.children(),$tabs=$ch.not($ch.eq(0)).children();test.equals($tabs.eq(0).css("display"),"none","first tab hidden");var $tab=$tabs.eq(0),$cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB1 text","content"),test.equals($sp.eq(1).text(),"TAB1 Deliberately changed","content"),test.equals($tabs.eq(1).css("display"),"none","second tab hidden again"),$tab=$tabs.eq(1);var $cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB2 text","content"),test.equals($sp.eq(1).text(),"TAB2 text too","content"),test.equals($tabs.eq(2).css("display")!="none",!0,"third tab show"),$tab=$tabs.eq(2);var $cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB3 text","content"),test.equals($sp.eq(1).text(),"TAB3 text too","content"),test.done()}})}),testcase})