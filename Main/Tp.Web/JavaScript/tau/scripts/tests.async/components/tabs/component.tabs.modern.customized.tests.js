define(["jQuery","tests.async/testkit/testkit.component","tau/components/component.container","tests/common/remoteConstants","tau/core/extension.base"],function($,TestKit,Component,Constants,ExtensionBase){var Ext=function(conf){return ExtensionBase.extend(conf)},testKit=new TestKit(Component);testKit.registerSetup("fixtures",function(test,next){test.set("fixtures",{}),next()}),testKit.registerSetup("componentBus",function(test,next){var componentConfig={context:{configurator:test.get("configurator")},extensions:[Ext({"bus componentsCreated":function(evt,data){var childBuses=_.pluck(data,"component");childBuses[1].on("tabs.switched.completed",_.bind(function(){this.fire("tabs.switched.completed")},this))}})],template:{name:"container.boardSettings",engine:"jqote2",markup:['<div class="tau-board-settings i-role-main">','<div class="tau-board-settings-header i-role-tabheaders"></div>',"</div>"]}};test.set("componentBus",test.get("componentClass").create(componentConfig)),next()}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus"),configurator=test.get("configuratorInstance"),Tmpl=function(conf){return configurator.getTemplateFactory().register(conf)};componentBus.initialize({context:{configurator:configurator},name:"commoncontainer",type:"container",layout:"selectable",children:[{name:"zzz",type:"tabsHeader",selector:".i-role-tabheaders",options:{selectedClassName:"tau-active"},template:Tmpl({name:"tabsHeader.modern",engine:"jqote2",markup:['<ul class="tau-board-settings-groups-tags i-role-tabheaders">','<li class="tau-active i-role-tabheader" data-label="board.editor">Setup</li>','<li class="i-role-tabheader" data-label="board.templates.selector">Templates</li>','<li class="i-role-tabheader" data-label="board.limits">Limits</li>',"</ul>"]})},{name:"zzz_tabs",type:"container",selector:".i-role-main",options:{tabsHeaderBusName:"zzz"},layout:"selectable",extensions:[Ext({"bus beforeInit":function(evt,initConfig){initConfig.config.context.configurator.getComponentBusRegistry().getByName(initConfig.config.options.tabsHeaderBusName).done(_.bind(function(bus){this.fire("tabsHeaderBus.ready",bus)},this))},"bus componentsCreated":function(evt,data){var tabsBuses=_.pluck(data,"component");this.fire("tabsBuses.ready",tabsBuses)},"bus tabsBuses.ready + tabsHeaderBus.ready":function(evt,tabsBuses,tabsHeaderBus){var fire=_.bind(this.fire,this);tabsHeaderBus.on("switched",function(evt,name){var busToShow=_.find(tabsBuses,function(v){return v.name==name});busToShow&&(busToShow.once("show.completed",function(){fire("tabs.switched.completed")}),_.forEach(tabsBuses,function(bus){bus===busToShow?bus.fire("show"):bus.fire("hide")}),tabsHeaderBus.fire("switched.after",name))})}})],template:Tmpl({name:"tabs.modern",engine:"jqote2",markup:['<div class="i-role-tabsholder">',"</div>"]}),children:[{name:"board.editor",type:"container",selector:".i-role-tabsholder",visible:!0,visibilityClassName:"tau-active",children:[{type:"label",text:"TAB1 text"},{type:"label",text:"TAB1 text too"}],template:Tmpl({name:"1111",engine:"jqote2",markup:['<div class="tau-board-settings-group tau-active">',"</div>"]})},{name:"board.templates.selector",type:"container",selector:".i-role-tabsholder",visible:!1,visibilityClassName:"tau-active",children:[{type:"label",text:"TAB2 text"},{type:"label",text:"TAB2 text too"}],template:Tmpl({name:"222",engine:"jqote2",markup:['<div class="tau-board-settings-group">',"</div>"]})},{name:"board.limits",type:"container",selector:".i-role-tabsholder",visible:!1,visibilityClassName:"tau-active",children:[{type:"label",text:"TAB3 text"},{type:"label",text:"TAB3 text too"}],template:Tmpl({name:"333",engine:"jqote2",markup:['<div class="tau-board-settings-group">',"</div>"]})}]}]}),next()});var testcase={name:"component.tabs.modern.customized"};return testcase["should render valid default markup"]=testKit.test(function(test){testKit.flow(test,{"bus afterRender[0]":function(evt,renderData){var $el=renderData.element;test.equals($el.length,1,"Render el"),test.equals($el.hasClass("tau-board-settings"),!0,"Valid markup");var $ch=$el.children(),$tabheaders=$ch.eq(0);test.equals($tabheaders.length,1,"Headers"),test.equals($tabheaders.is("div.tau-board-settings-header"),!0,"Headers"),test.equals($tabheaders.children().length,1,"Headers");var $hlist=$tabheaders.children();test.equals($hlist.is("ul.tau-board-settings-groups-tags"),!0,"Headers"),$tabheaders=$hlist.children(),test.equals($tabheaders.length,3,"Three Headers"),test.equals($tabheaders.eq(0).is("li.tau-active"),!0,"first header is selected");var checkLabel=function($t1,txt,test){test.equals($t1.text(),txt,"header text"),test.equals($t1.children().length,0,"header render in itself")};checkLabel($tabheaders.eq(0),"Setup",test),test.equals($tabheaders.eq(1).is("li"),!0,"second header is not selected"),test.equals($tabheaders.eq(1).is(":not(.tau-active)"),!0,"second header is not selected"),checkLabel($tabheaders.eq(1),"Templates",test),test.equals($tabheaders.eq(2).is("li"),!0,"second header is not selected"),test.equals($tabheaders.eq(2).is(":not(.tau-active)"),!0,"third header is not selected"),checkLabel($tabheaders.eq(2),"Limits",test);var $tabs=$ch.not($ch.eq(0)).children();test.equals($tabs.is("div.tau-board-settings-group"),!0,"tabs itself");var $tab=$tabs.eq(0);test.equals($tab.css("display")!="none",!0,"selected visible"),test.equals($tab.hasClass("tau-active"),!0,"selected visible");var $cont=$tab.children();test.equals($cont.length,2,"content"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB1 text","content"),test.equals($sp.eq(1).text(),"TAB1 text too","content");var $tab=$tabs.eq(1);test.equals($tab.css("display")!="none",!0,"non selected hidden"),test.equals($tab.hasClass("tau-active"),!1,"non selected hidden");var $cont=$tab.children();test.equals($cont.length,0,"content");var $tab=$tabs.eq(2);test.equals($tab.css("display")!="none",!0,"non selected hidden"),test.equals($tab.hasClass("tau-active"),!1,"non selected hidden");var $cont=$tab.children();test.equals($cont.length,0,"content"),$tabheaders.eq(2).click()},"bus afterRender[0] + tabs.switched.completed[0]":function(evt,renderData,switched){var $el=renderData.element;test.equals($el.length,1,"Render el"),test.equals($el.hasClass("tau-board-settings"),!0,"Valid markup");var $ch=$el.children(),$tabheaders=$ch.eq(0);test.equals($tabheaders.length,1,"Headers"),test.equals($tabheaders.is("div.tau-board-settings-header"),!0,"Headers"),test.equals($tabheaders.children().length,1,"Headers");var $hlist=$tabheaders.children();test.equals($hlist.is("ul.tau-board-settings-groups-tags"),!0,"Headers"),$tabheaders=$hlist.children(),test.equals($tabheaders.length,3,"Three Headers"),test.equals($tabheaders.eq(0).is("li.tau-active"),!1,"first header is noy selected");var checkLabel=function($t1,txt,test){test.equals($t1.text(),txt,"header text"),test.equals($t1.children().length,0,"header render in itself")};checkLabel($tabheaders.eq(0),"Setup",test),test.equals($tabheaders.eq(1).is("li"),!0,"second header is not selected"),test.equals($tabheaders.eq(1).is(":not(.tau-active)"),!0,"second header is not selected"),checkLabel($tabheaders.eq(1),"Templates",test),test.equals($tabheaders.eq(2).is("li"),!0,"second header is not selected"),test.equals($tabheaders.eq(2).is(".tau-active"),!0,"third header is selected"),checkLabel($tabheaders.eq(2),"Limits",test);var $tabs=$ch.not($ch.eq(0)).children();test.equals($tabs.is("div.tau-board-settings-group"),!0,"tabs itself");var $tab=$tabs.eq(0);test.equals($tab.css("display")!="none",!0,"selected visible"),test.equals($tab.hasClass("tau-active"),!1,"selected visible");var $cont=$tab.children();test.equals($cont.length,2,"content"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB1 text","content"),test.equals($sp.eq(1).text(),"TAB1 text too","content");var $tab=$tabs.eq(1);test.equals($tab.css("display")!="none",!0,"non selected hidden"),test.equals($tab.hasClass("tau-active"),!1,"non selected hidden");var $cont=$tab.children();test.equals($cont.length,0,"content");var $tab=$tabs.eq(2);test.equals($tab.css("display")!="none",!0,"3rd selected"),test.equals($tab.hasClass("tau-active"),!0,"3rd selected");var $cont=$tab.children(),$cont=$tab.children();test.equals($cont.length,2,"content stille"),test.equals($cont.is("div"),!0,"content"),test.equals($cont.find("span.ui-label").length,2,"content");var $sp=$cont.find("span.ui-label");test.equals($sp.eq(0).text(),"TAB3 text","content"),test.equals($sp.eq(1).text(),"TAB3 text too","content"),test.done()}})}),testcase})