define(["jQuery","tests.async/testkit/testkit.component.board","tau/components/component.board.container","tau/ui/extensions/container/ui.extension.container.childrenEvents"],function($,TestKit,Component,ExtensionChildrenEvents){var testKit=new TestKit(Component,{name:"DevilBoard",cells:{types:["request","bug"]},x:{types:["release"],filter:"?It is not None"},y:{types:["feature"],filter:"?It is not None"},zoomLevel:1});testKit.registerSetup("fixtures",function(test,next){test.set("fixtures",{});var storage=test.get("configurator").getRestStorage();test.set("boardTemplates.groupName","testboardztemplatez"+ +(new Date)),storage.data(test.get("boardTemplates.groupName"),undefined,{scope:"Public",publicData:{name:"custom1",description:"bla bla custom"}}).done(_.bind(function(res){next()},this))}),testKit.registerSetup("configurator.externalService",function(test,next){var configuratorInstance=test.get("configurator");next()}),testKit.registerSetup("componentBus",function(test,next){test.set("componentBus",test.get("componentClass").create({extensions:[ExtensionChildrenEvents]})),next()}),testKit.registerSetup("component.initialize",function(test,next){var testData=test.get("data"),componentBus=test.get("componentBus");componentBus.initialize({context:{configurator:test.get("configuratorInstance")},children:[{type:"board.templates.selector",options:{groupName:test.get("boardTemplates.groupName")}},{type:"board.templates.editor",options:{groupName:test.get("boardTemplates.groupName")}}]}),test.get("configuratorInstance").setLoggedUser({isAdministrator:!0});var boardSettings=test.get("configuratorInstance").getBoardSettingsFactory().createInstance(test.get("board.definition"));componentBus.fire("boardSettings.ready",{boardSettings:boardSettings}),test.set("boardSettings",boardSettings),next()});var testcase={name:"component.board.templates.editor"};return testcase["should render valid markup"]=testKit.test(function(test){var itemsLength=0;return testKit.flow(test,{"bus afterRender[0]":function(evt,renderData){var $el=renderData.element;test.equals($el.length,1,"Render el");var $items=$el.find(".i-role-item");test.equals($items.length>0,!0,"Render items"),itemsLength=$items.length;var $trigger=$el.find(".i-role-formtrigger");test.equals($trigger.length,1,"Render editor button"),$trigger.click();var $bubble=$trigger.tauBubble("widget");test.equals($bubble.length,1,"Render editor bubble"),test.equals($bubble!=$trigger,!0,"Render editor bubble");var $form=$bubble.find("form");test.equals($form.length,1,"Render editor form");var $fields=$form.find(":input");test.equals($fields.length,4,"Render form inputs");var $fname=$fields.eq(0);test.equals($fname.is("input[type=text][name=name]"),!0,"Render name input"),test.equals($fname.val(),"DevilBoard","Render name input has name already");var $fdesc=$fields.eq(1);test.equals($fdesc.is("textarea[name=description]"),!0,"Render desc input");var $ftags=$fields.eq(2);test.equals($ftags.is("input[type=text][name=tags]"),!0,"Render tags input");var $fsub=$fields.eq(3);test.equals($fsub.is("button[type=submit]"),!0,"Render sub input"),$fname.val("T PRNS?"),$fdesc.val("ZBS"),$ftags.val("vonni, ptchk"),test.set("storageSpy",sinon.spy(test.get("configurator").getRestStorage(),"data")),$fsub.click()},"bus afterRender[0] + board.templates.selector.afterRender[1]":function(evt,renderData){var $el=renderData.element;test.equals($el.length,1,"Render el");var $items=$el.find(".i-role-item");test.equals($items.length>0,!0,"Render items"),test.equals($items.length,itemsLength+1,"add new item");var storageSpy=test.get("storageSpy");test.equals(storageSpy.callCount,2,"Send to save board");var call=storageSpy.getCall(1);test.equals(call.args[0],test.get("boardTemplates.groupName"),"args new template"),test.equals(call.args[1],undefined,"args new template"),test.equals(call.args[2].publicData.name,"T PRNS?","args new template"),test.equals(call.args[2].publicData.description,"ZBS","args new template"),test.deepEqual(call.args[2].publicData.definition.cells.types,["request","bug"],"args new template"),test.done()}})}),testcase})