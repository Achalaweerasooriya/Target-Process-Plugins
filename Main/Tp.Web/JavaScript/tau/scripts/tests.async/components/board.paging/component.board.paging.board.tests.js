define(["jQuery","tests.async/testkit/testkit.component.board","tau/components/component.board.container","tau/ui/extensions/container/ui.extension.container.childrenEvents","tests/common/remoteConstants"],function($,TestKit,Component,ExtensionChildrenEvents,Constants){var testKit=new TestKit(Component,{name:"MegaBoard",viewMode:"board",zoomLevel:0,min:1,max:20,x:{types:["feature"],filter:"?It is not None"},y:{types:["release"],filter:"?It is not None"},cells:{types:["userStory"],filter:""},page:{x:0,y:0}});testKit.registerSetup("fixtures",function(test,next){var entityTypes={us:Constants.EntityTypes.USERSTORY,release:Constants.EntityTypes.RELEASE,feature:Constants.EntityTypes.FEATURE},practices={planning:{id:Constants.Practices.PLANNING.id},requirements:{id:Constants.Practices.REQUIREMENTS.id}},processes={scrum:{name:"scrum"+ +(new Date),practices:["planning","requirements"]}},projects={p_scrum:{name:"Project Scrum"+ +(new Date),process:"scrum"}},releases={},features={},rows=95,cols=30;for(var r=0;r<rows;r++){var releaseName="release"+r;releases[releaseName]={name:"Release_"+r+"_"+ +(new Date),entityType:"release",project:"p_scrum"}}for(var r=0;r<cols;r++){var featureName="feature"+r;features[featureName]={name:"Feature_"+r+"_"+ +(new Date),entityType:"feature",project:"p_scrum"}}var fixtures={entityTypes:entityTypes,practices:practices,processes:processes,projects:projects,releases:releases,features:features};test.set("fixtures",fixtures),next()}),testKit.registerSetup("componentBus",function(test,next){test.set("componentBus",test.get("componentClass").create({extensions:[ExtensionChildrenEvents]})),next()}),testKit.registerSetup("component.initialize",function(test,next){var configuratorInstance=test.get("configurator"),store=configuratorInstance.getStore(),testData=test.get("data"),projectID=testData.project.p_scrum.id;test.get("real")===!1&&sinon.stub(store.config.proxy.service,"get",function(command){if(command.type=="context")command.callbacks.success({id:command.config.id,acid:"345"});else if(!command.config.id){var collection=_.toArray(testData[command.type]);setTimeout(function(){command.callbacks.success(collection)},0)}}),store.get("context",{projectId:projectID,fields:["acid"]},{success:function(r){var componentBus=test.get("componentBus"),definition=test.get("board.definition"),acid=r.data[0].acid;configuratorInstance.getHashService().setHref("http://localhost/targetprocess/RestUI/board.aspx?acid="+acid+"#"),configuratorInstance.setBoardSettingsOptions(definition),configuratorInstance.getSettingsManager().sources.splice(0,1),configuratorInstance.getClipboardManager().restStorage.sources.splice(0,1);var componentConfig={context:{configurator:configuratorInstance,definition:test.get("board.definition")}};componentConfig.children=[{type:"board.plus",name:"board_plus22"},{type:"board.paging",boardName:"board_plus22"}],componentBus.on("afterRender",function(e){componentBus.fire("view.dom.ready",{element:e.data.element})});var boardSettings=configuratorInstance.getBoardSettingsFactory().createInstance(test.get("board.definition"));configuratorInstance.registerService("boardSettings",boardSettings),componentBus.initialize(componentConfig),componentBus.fire("boardSettings.ready",{boardSettings:boardSettings}),next()}}).done()});var testcase={name:"component.board.paging on board"};return testcase["should render valid markup"]=testKit.test(function(test){testKit.flow(test,{"bus view.dom.ready[0]+board_plus22.overview.board.ready[0] + board_plus22.ui.board.paging.ready[0]":function(evt){var $el=_.values(evt)[0].data.element.find(".tau-boardpaging"),$boardEl=_.values(evt)[0].data.element.find(".tau-board-body");test.equals($boardEl.length,1,"Render board"),test.equals($el.length,1,"Render paging");var $pages=$el.find(".i-role-page");test.equals($pages.length,20,"Render pages");var $currentPage=$pages.filter("[data-x=0][data-y=0]");test.equals($currentPage.length,1,"Current page"),test.equals($currentPage.hasClass("tau-boardpaging__page_current_true"),!0,"Current page");var $nextPage=$pages.filter("[data-x=0][data-y=1]");test.equals($nextPage.length,1,"Next page"),test.equals($nextPage.hasClass("tau-boardpaging__page_current_true"),!1,"Next page"),test.equal($boardEl.find(".tau-page-navigation-button").length,2,"Real paging"),$nextPage.click(),test.equals($currentPage.hasClass("tau-boardpaging__page_current_true"),!1,"Current page"),test.equals($nextPage.hasClass("tau-boardpaging__page_current_true"),!0,"Next page")},"bus view.dom.ready[0] + board_plus22.ui.board.paging.ready[1]":function(evt){var $boardEl=_.values(evt)[0].data.element.find(".tau-board-body");test.equal($boardEl.find(".tau-page-navigation-button").length>2,!0,"Real paging changed"),test.done()}})}),testcase})