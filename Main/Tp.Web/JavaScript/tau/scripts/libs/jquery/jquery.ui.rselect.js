define(["libs/jquery/jquery.ui","libs/jquery/jquery.gid"],function(t){!function(t,e,i){var n="r-selected",o="rs-area",s="rs-holder",_=10,r=">>",c="rs-",l=function(e){this.__options=e,this.__gidObserver=t.gid({dragStart:t.proxy(this,"__onDragStart"),drag:t.proxy(this,"__onDrag"),dragEnd:t.proxy(this,"__onDragEnd")})};l.prototype={constructor:l,__eventToKeyDescriptor:function(t){var e={shift:t.shiftKey,ctrl:t.ctrlKey,meta:t.metaKey,alt:t.altKey,space:this.__keyDescriptor?this.__keyDescriptor.space:!1};if(32==t.which)switch(t.type){case"keydown":e.space=!0;break;case"keyup":e.space=!1}return e},__areKeyDescriptorsEqual:function(t,e){var i=!0;for(var n in t)if(t[n]!=e[n]){i=!1;break}return i},__anyActiveKeys:function(t){var e=!1;for(var i in t)if(t[i]){e=!0;break}return e},__updateMode:function(){var t=this.__keyDescriptor,e="resize";t.space&&(e="move");var i=t.shift||t.ctrl||t.meta,n=t.alt,o="new";i&&!n?o="add":n&&!i?o="subtract":i&&n&&(o="intersect"),this.__options.modeChange({rect:e,selection:o})},__startSelection:function(){this.__options.selectionStart(this.__basePoint)},__showSelection:function(){this.__options.selectionShow(this.__basePoint,this.__guidePoint)},__updateSelection:function(){this.__options.selectionChange(this.__guidePoint)},__endSelection:function(){this.__options.selectionEnd(this.__guidePoint)},__bindKeyCapture:function(){t(window).on("keydown keyup",t.proxy(this,"__onKeyChange"))},__unbindKeyCapture:function(){t(window).off("keydown keyup",this.__onKeyChange)},__finalizeKeyCapture:function(){this.__anyActiveKeys(this.__keyDescriptor)||(this.__unbindKeyCapture(),this.__unbindKeyCaptureFinalizer())},__bindKeyCaptureFinalizer:function(){t(window).on("keyup",t.proxy(this,"__finalizeKeyCapture"))},__unbindKeyCaptureFinalizer:function(){t(window).off("keyup",this.__finalizeKeyCapture)},__onDragStart:function(t,e){this.__basePoint=e;var i=this.__options.getVerticalScrollPosition;i&&(this.__basePoint.y+=i()),this.__startSelection(),this.__keyDescriptor=this.__eventToKeyDescriptor(t),this.__bindKeyCapture(),this.__updateMode()},__onDrag:function(e,i){if(this.__$elements)if(this.__guidePoint=i,this.__dragInitialized)this.__updateSelection();else{var n=Math.abs(this.__guidePoint.x-this.__basePoint.x),o=Math.abs(this.__guidePoint.y-this.__basePoint.y);n>_&&o>_&&(this.__dragInitialized=!0,this.__showSelection(),this.__$elements.on("scroll",t.proxy(this,"__updateSelection")))}},__onDragEnd:function(t,e){this.__guidePoint=e,this.__dragInitialized&&(this.__dragInitialized=!1,this.__$elements.off("scroll",this.__updateSelection)),this.__anyActiveKeys(this.__keyDescriptor)?this.__bindKeyCaptureFinalizer():this.__unbindKeyCapture(),this.__endSelection()},__onKeyChange:function(t){t.preventDefault();var e=this.__eventToKeyDescriptor(t);this.__areKeyDescriptorsEqual(this.__keyDescriptor,e)||(this.__keyDescriptor=e,this.__updateMode())},on:function(t,e){this.__$elements=t,this.__gidObserver.on(t,e,e?!0:!1)},off:function(){this.__gidObserver.off(),this.__$elements=null}};var h=function(e,i){var n={clipHorizontal:!0,clipVertical:!0};this.__$placeholder=e,this.__mode="resize",this.__options=t.extend({},n,i)};h.prototype={constructor:h,__createElement:function(){var e=t("<div/>").addClass(o);return getComputedStyle(e[0]),e},__getElement:function(){return this.__$element||(this.__$element=this.__createElement()),this.__$element},__toPlaceholderPoint:function(t){var e=this.__$placeholder[0],i=e.getBoundingClientRect();return{x:t.x-(i.left+e.clientLeft)+e.scrollLeft,y:t.y-(i.top+e.clientTop)+e.scrollTop}},__clipValue:function(t,e,i){var n=t;return e>n?n=e:n>i&&(n=i),n},__clipRect:function(t){var e=this.__$placeholder[0],i=e.scrollWidth,n=e.scrollHeight,o=t.left,s=t.left+t.width,_=t.top,r=t.top+t.height;return this.__options.clipHorizontal&&(o=this.__clipValue(o,0,i),s=this.__clipValue(s,0,i)),this.__options.clipVertical&&(_=this.__clipValue(_,0,n),r=this.__clipValue(r,0,n)),{left:o,width:s-o,top:_,height:r-_}},__drawRect:function(t){this.__getElement().css(this.__clipRect(t))},__updateDimensions:function(t){var e=this.__rect,i={x:this.__basePoint.x,y:this.__basePoint.y},n=this.__options.getVerticalScrollPosition;n&&(i.y-=n()),e.left=Math.min(i.x,t.x),e.top=Math.min(i.y,t.y),e.width=Math.abs(t.x-i.x),e.height=Math.abs(t.y-i.y),this.__rect=e,this.__drawRect(e)},__updatePosition:function(t){var e=this.__guidePoint,i=t.x-e.x,n=t.y-e.y,o=this.__basePoint;o.x+=i,o.y+=n;var s=this.__rect;s.left+=i,s.top+=n,this.__drawRect(this.__rect)},show:function(t,e){this.__basePoint=this.__toPlaceholderPoint(t),this.__rect={},this.__updateDimensions(this.__guidePoint=this.__toPlaceholderPoint(e)),this.__$placeholder.addClass(s).append(this.__getElement())},hide:function(){this.__getElement().detach(),this.__$placeholder.removeClass(s)},update:function(t){var e=this.__toPlaceholderPoint(t);switch(this.__mode){case"resize":this.__updateDimensions(e);break;case"move":this.__updatePosition(e)}this.__guidePoint=e},setMode:function(t){this.__mode=t},get:function(){return this.__getElement()[0].getBoundingClientRect()}};var a={__isIntersect:function(t,e){var i=t.right>=e.left&&t.left<=e.right,n=t.bottom>=e.top&&t.top<=e.bottom;return i&&n},getRectSelection:function(e,i,n){var o=t();if(e.width>0&&e.height>0){var s=n.split(r).reverse(),_=this;for(o=i;s.length>0;)o=o.find(s.pop()).filter(function(){return _.__isIntersect(e,this.getBoundingClientRect())})}return o},__getNewSelection:function(t,e){return e},__getUnionSelection:function(t,e){return t.add(e)},__getSubtractSelection:function(t,e){return t.not(e)},__getIntersectSelection:function(t,e){return t.add(e).filter(function(){return t.is(this)&&e.is(this)})},getActualSelection:function(t,e,i){switch(i){case"add":return this.__getUnionSelection(t,e);case"subtract":return this.__getSubtractSelection(t,e);case"intersect":return this.__getIntersectSelection(t,e);case"new":default:return this.__getNewSelection(t,e)}}};t.widget(e+"."+i,{options:{disabled:!1,trigger:"",selectable:"",selectionClass:n,start:t.noop,show:t.noop,end:t.noop},__on:function(){this.__inputObserver.on(this.element,this.options.trigger)},__off:function(){this.__inputObserver.off()},clearSelection:function(){this.__clearSelectionFrom(this.__getCurrentSelection())},__clearSelectionFrom:function(t){t&&t.removeClass(this.options.selectionClass).trigger(c+"deselect")},__getCurrentSelection:function(){var e=t.trim(this.options.selectable.replace(r,""));return this.element.find(e+"."+this.options.selectionClass)},__onSelectionStart:function(){this.__isSelectionActive||(this.__isSelectionActive=!0,this.__$oldSelection=this.__getCurrentSelection(),this._trigger("start",null,{selection:this.__$oldSelection}))},__onSelectionShow:function(t,e){this.__selectionRect&&(this.__selectionRect.show(t,e),this._trigger("show"))},__onSelectionChange:function(t){this.__selectionRect&&this.__selectionRect.update(t)},__onSelectionEnd:function(){if(this.__isSelectionActive){if(this.__isSelectionActive=!1,!this.__selectionRect)return;var t=this.__selectionRect.get();this.__selectionRect.hide();var e=a.getRectSelection(t,this.element,this.options.selectable),i=a.getActualSelection(this.__$oldSelection,e,this.__selectionMode),n=this.__$oldSelection.not(i);this.__clearSelectionFrom(n),i.addClass(this.options.selectionClass).trigger(c+"select"),this.__$oldSelection=null,this._trigger("end",null,{selection:i,deselection:n})}},__onModeChange:function(t){this.__selectionMode=t.selection,this.__selectionRect.setMode(t.rect)},_create:function(){this.widgetEventPrefix=c,this.__inputObserver=new l({selectionStart:t.proxy(this,"__onSelectionStart"),selectionShow:t.proxy(this,"__onSelectionShow"),selectionChange:t.proxy(this,"__onSelectionChange"),selectionEnd:t.proxy(this,"__onSelectionEnd"),modeChange:t.proxy(this,"__onModeChange"),getVerticalScrollPosition:this.options.getVerticalScrollPosition}),this.__selectionRect=new h(this.element,this.options),this.options.disabled||this.__on()},_setOption:function(t,e){switch(t){case"disabled":this[e?"disable":"enable"]()}},enable:function(){this.options.disabled&&(this.options.disabled=!1,this.__on())},disable:function(){this.options.disabled||(this.options.disabled=!0,this.__off())},destroy:function(){this.__selectionRect.hide(),this.__inputObserver.off(),this.__selectionRect=null,this.__inputObserver=null,this._super()}})}(t,"ui","rselect")});