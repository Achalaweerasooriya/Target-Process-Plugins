define(["libs/jquery/jquery.ui"],function(t){t.widget("tau.sprite",{options:{fps:25,autoplay:!1,width:null,height:null,frames:null,url:null},_create:function(){this.element.addClass(this._getClass()),this._initStyle=this.element.attr("style")},_init:function(){this.isPlaying()&&this.stop();var t=this.options.url||this.element.css("backgroundImage");if(t){try{this._initSheetData(t)}catch(e){this.element.html(e.message)}this._initDimensions(),this._setFrame(0),this.options.autoplay&&this.play()}},_getClass:function(){return this.namespace+"-"+this.widgetName},_urlToVal:function(t,e,i){var s=t.match(e);if(!s)throw Error(i);var n=s[0].match(/\d+/);if(!n)throw Error(i);return parseInt(n[0])},_parseFramesCount:function(t){return this._urlToVal(t,/f-\d+/,"Sprite frames count is not determined.")},_parseSheetWidth:function(t){return this._urlToVal(t,/w-\d+/,"Sprite sheet width is not determined.")},_parseSheetHeight:function(t){return this._urlToVal(t,/h-\d+/,"Sprite sheet height is not determined.")},_initSheetData:function(t){this._sheetWidth=this.options.width||this._parseSheetWidth(t),this._sheetHeight=this.options.height||this._parseSheetHeight(t),this._framesCount=this.options.frames||this._parseFramesCount(t),this._frameWidth=this._sheetWidth/this._framesCount,this._firstFrameIndex=0,this._lastFrameIndex=this._framesCount-1},_initDimensions:function(){this.element.css({width:this._frameWidth,height:this._sheetHeight})},_setFrame:function(t){var e=-((this._currentFrameIndex=t)*this._frameWidth);this.element.css("backgroundPosition",e+"px 0px")},_nextFrame:function(){var t=this._currentFrameIndex+1;t>this._lastFrameIndex&&(t=this._firstFrameIndex),this._setFrame(t)},isPlaying:function(){return!!this._playIntervalId},play:function(){this.isPlaying()||(this._playIntervalId=setInterval(t.proxy(this,"_nextFrame"),1e3/this.options.fps))},stop:function(){this.isPlaying()&&(clearInterval(this._playIntervalId),this._playIntervalId=null)},destroy:function(){this.stop(),this._initStyle?this.element.attr("style",this._initStyle):this.element.removeAttr("style"),this.element.removeClass(this._getClass()),t.Widget.prototype.destroy.call(this)
}})});