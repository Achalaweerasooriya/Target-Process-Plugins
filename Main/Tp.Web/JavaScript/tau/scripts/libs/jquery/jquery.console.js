define(["libs/jquery/jquery"],function(e){return function(e){e.fn.console=function(n){function o(){F=0,G="",U=0,v(),L=e('<div class="jquery-console-prompt-box"></div>');var n=e('<span class="jquery-console-prompt-label"></span>'),o=Y.continuedPrompt?E:D;L.append(n.text(o).show()),n.html(n.html().replace(" ","&nbsp;")),O=e('<span class="jquery-console-prompt"></span>'),L.append(O),Z.append(L),P()}function t(e){return(e.keyCode==M.tab||192==e.keyCode)&&e.altKey}function r(e){if(0!=R.length){U+=e,0>U?U=R.length:U>R.length&&(U=0);G=0==U?J:R[U-1],n.historyPreserveColumn?G.length<F+1?F=G.length:0==F&&(F=G.length):F=G.length,P()}}function s(){r(-1)}function i(){r(1)}function c(e){R.push(e),J=""}function a(){return F<G.length?(G=G.substring(0,F)+G.substring(F+1),J=G,!0):!1}function u(){j(-1)&&(a(),P())}function l(){a()&&P()}function f(){for(;a();)P()}function d(){for(;F<G.length&&!K(G[F]);)a(),P();for(;F<G.length&&K(G[F]);)a(),P()}function p(){var e=G;if("function"==typeof n.commandValidate){var o=n.commandValidate(e);1==o||0==o?o&&g():b(o,"jquery-console-message-error")}else g()}function h(){Z.prop({scrollTop:Z.prop("scrollHeight")})}function y(){"function"==typeof n.cancelHandle&&n.cancelHandle()}function g(){if("function"==typeof n.commandHandle){m(),c(G);var e=G;Y.continuedPrompt?Q?Q+="\n"+G:Q=G:Q=void 0,Q&&(e=Q);var o=n.commandHandle(e,function(e){b(e)});Y.continuedPrompt&&!Q&&(Q=G),"boolean"==typeof o?o?b():b("Command failed.","jquery-console-message-error"):"string"==typeof o?b(o,"jquery-console-message-success"):"object"==typeof o&&o.length?b(o):Y.continuedPrompt&&b()}}function m(){X=!1}function v(){X=!0}function b(e,n){if(F=-1,P(),"string"==typeof e)C(e,n);else for(var t in e){var r=e[t];C(r.msg,r.className)}o()}function C(n,o){var t=e('<div class="jquery-console-message"></div>');o&&t.addClass(o),t.filledText(n).hide(),Z.append(t),t.show()}function j(e){return F+e>=0&&F+e<=G.length?(F+=e,!0):!1}function q(){return j(1)?(P(),!0):!1}function w(){return j(-1)?(P(),!0):!1}function x(){j(-F)&&P()}function T(){j(G.length-F)&&P()}function k(){for(;F<G.length&&!K(G[F])&&q(););for(;F<G.length&&K(G[F])&&q(););}function A(){for(;F-1>=0&&!K(G[F-1])&&w(););for(;F-1>=0&&K(G[F-1])&&w(););}function K(e){if("string"==typeof e){var n=e.charCodeAt();return n>="A".charCodeAt()&&n<="Z".charCodeAt()||n>="a".charCodeAt()&&n<="z".charCodeAt()||n>="0".charCodeAt()&&n<="9".charCodeAt()}return!1}function I(){}function P(){var e=G,n="";if(F>0&&""==e)n=V;else if(F==G.length)n=H(e)+V;else{var o=e.substring(0,F),t=e.substring(F,F+1);t&&(t='<span class="jquery-console-cursor">'+H(t)+"</span>");var r=e.substring(F+1);n=H(o)+t+H(r)}O.html(n),h()}function H(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />").replace(/([^<>&]{10})/g,"$1<wbr>&shy;"+z)}var L,O,M={37:w,39:q,38:s,40:i,8:u,46:l,35:T,36:x,13:p,18:I},N={65:x,69:T,68:l,78:i,80:s,66:w,70:q,75:f},S={70:k,66:A,68:d},V='<span class="jquery-console-cursor">&nbsp;</span>',z=e.browser.opera?"&#8203;":"",B=e(this),Z=e('<div class="jquery-console-inner"></div>'),$=e('<textarea class="jquery-console-typer"></textarea>'),D=n&&n.promptLabel?n.promptLabel:"> ",E=n&&n.continuedPromptLabel?n.continuedPromptLabel:"> ",F=0,G="",J="",Q="",R=[],U=0,W=0,X=!0,Y={};return function(){B.append(Z),Z.append($),$.css({position:"absolute",top:0,left:"-9999px"}),n.welcomeMessage&&C(n.welcomeMessage,"jquery-console-welcome"),o(),n.autofocus&&(Z.addClass("jquery-console-focus"),$.focus(),setTimeout(function(){Z.addClass("jquery-console-focus"),$.focus()},100)),Y.inner=Z,Y.typer=$,Y.scrollToBottom=h}(),Y.reset=function(){var t="undefined"!=typeof n.welcomeMessage;Z.parent().fadeOut(function(){Z.find("div").each(function(){t?t=!1:e(this).remove()}),o(),Z.parent().fadeIn(function(){Z.addClass("jquery-console-focus"),$.focus()})})},Y.notice=function(n,o){var t=e('<div class="notice"></div>').append(e("<div></div>").text(n)).css({visibility:"hidden"});B.append(t);var r=!0;if("fadeout"==o)setTimeout(function(){t.fadeOut(function(){t.remove()})},4e3);else if("prompt"==o){var s=e('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');t.append(s),r=!1,s.click(function(){t.fadeOut(function(){t.remove(),Z.css({opacity:1})})})}var i=t.height();return t.css({height:"0px",visibility:"visible"}).animate({height:i+"px"},function(){r||Z.css({opacity:.5})}),t.css("cursor","default"),t},e("body").keydown(function(e){return e.ctrlKey||e.altKey?void 0:(Z.addClass("jquery-console-focus"),Z.removeClass("jquery-console-nofocus"),$.focus(),h(),!1)}),$.blur(function(){Z.removeClass("jquery-console-focus"),Z.addClass("jquery-console-nofocus")}),$.bind("paste",function(){$.val(""),setTimeout(function(){$.consoleInsert($.val()),$.val("")},0)}),$.keydown(function(e){W=0;var n=e.keyCode;if(e.ctrlKey&&67==n)return W=n,y(),!1;if(X){if(n in M)return W=n,M[n](),!1;if(e.ctrlKey&&n in N)return W=n,N[n](),!1;if(e.altKey&&n in S)return W=n,S[n](),!1}}),$.keypress(function(o){var r=o.keyCode||o.which;if(t(o))return!1;if(o.ctrlKey&&"v"==String.fromCharCode(r).toLowerCase())return!0;if(X&&W!=r&&r>=32){if(W)return!1;("undefined"==typeof n.charInsertTrigger||"function"==typeof n.charInsertTrigger&&n.charInsertTrigger(r,G))&&$.consoleInsert(r)}return e.browser.webkit?!1:void 0}),$.consoleInsert=function(e){var n=isNaN(e)?e:String.fromCharCode(e),o=G.substring(0,F),t=G.substring(F);G=o+n+t,j(n.length),J=G,P()},Y.promptText=function(e){return e&&(G=e,F=G.length,P()),G},Y},e.fn.filledText=function(n){return e(this).html(n),e(this).html(e(this).html()),this}}(e),e});