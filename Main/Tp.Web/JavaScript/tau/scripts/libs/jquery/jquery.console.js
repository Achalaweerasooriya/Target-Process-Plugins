define(["jQuery"],function(a){return function(a){a.fn.console=function(b){function y(){o=0,p="",t=0,O(),k=a('<div class="jquery-console-prompt-box"></div>');var b=a('<span class="jquery-console-prompt-label"></span>'),c=x.continuedPrompt?n:m;k.append(b.text(c).show()),b.html(b.html().replace(" ","&nbsp;")),l=a('<span class="jquery-console-prompt"></span>'),k.append(l),i.append(k),_()}function z(a){return(a.keyCode==c.tab||a.keyCode==192)&&a.altKey}function A(a){if(s.length==0)return;t+=a,t<0?t=s.length:t>s.length&&(t=0);var c=p;t==0?p=q:p=s[t-1],b.historyPreserveColumn?p.length<o+1?o=p.length:o==0&&(o=p.length):o=p.length,_()}function B(){A(-1)}function C(){A(1)}function D(a){s.push(a),q=""}function E(){return o<p.length?(p=p.substring(0,o)+p.substring(o+1),q=p,!0):!1}function F(){R(-1)&&(E(),_())}function G(){E()&&_()}function H(){while(E())_()}function I(){while(o<p.length&&!Y(p[o]))E(),_();while(o<p.length&&Y(p[o]))E(),_()}function J(){var a=p;if(typeof b.commandValidate=="function"){var c=b.commandValidate(a);c==1||c==0?c&&M():P(c,"jquery-console-message-error")}else M()}function K(){i.prop({scrollTop:i.prop("scrollHeight")})}function L(){typeof b.cancelHandle=="function"&&b.cancelHandle()}function M(){if(typeof b.commandHandle=="function"){N(),D(p);var a=p;x.continuedPrompt?r?r+="\n"+p:r=p:r=undefined,r&&(a=r);var c=b.commandHandle(a,function(a){P(a)});x.continuedPrompt&&!r&&(r=p),typeof c=="boolean"?c?P():P("Command failed.","jquery-console-message-error"):typeof c=="string"?P(c,"jquery-console-message-success"):typeof c=="object"&&c.length?P(c):x.continuedPrompt&&P()}}function N(){v=!1}function O(){v=!0}function P(a,b){o=-1,_();if(typeof a=="string")Q(a,b);else for(var c in a){var d=a[c];Q(d.msg,d.className)}y()}function Q(b,c){var d=a('<div class="jquery-console-message"></div>');c&&d.addClass(c),d.filledText(b).hide(),i.append(d),d.show()}function R(a){return o+a<0||o+a>p.length?!1:(o+=a,!0)}function S(){return R(1)?(_(),!0):!1}function T(){return R(-1)?(_(),!0):!1}function U(){R(-o)&&_()}function V(){R(p.length-o)&&_()}function W(){while(o<p.length&&!Y(p[o])&&S());while(o<p.length&&Y(p[o])&&S());}function X(){while(o-1>=0&&!Y(p[o-1])&&T());while(o-1>=0&&Y(p[o-1])&&T());}function Y(a){if(typeof a=="string"){var b=a.charCodeAt();return b>="A".charCodeAt()&&b<="Z".charCodeAt()||b>="a".charCodeAt()&&b<="z".charCodeAt()||b>="0".charCodeAt()&&b<="9".charCodeAt()}return!1}function Z(){}function _(){var a=p,b="";if(o>0&&a=="")b=f;else if(o==p.length)b=ba(a)+f;else{var c=a.substring(0,o),d=a.substring(o,o+1);d&&(d='<span class="jquery-console-cursor">'+ba(d)+"</span>");var e=a.substring(o+1);b=ba(c)+d+ba(e)}l.html(b),K()}function ba(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />").replace(/([^<>&]{10})/g,"$1<wbr>&shy;"+g)}var c={37:T,39:S,38:B,40:C,8:F,46:G,35:V,36:U,13:J,18:Z},d={65:U,69:V,68:G,78:C,80:B,66:T,70:S,75:H},e={70:W,66:X,68:I},f='<span class="jquery-console-cursor">&nbsp;</span>',g=a.browser.opera?"&#8203;":"",h=a(this),i=a('<div class="jquery-console-inner"></div>'),j=a('<textarea class="jquery-console-typer"></textarea>'),k,l,m=b&&b.promptLabel?b.promptLabel:"> ",n=b&&b.continuedPromptLabel?b.continuedPromptLabel:"> ",o=0,p="",q="",r="",s=[],t=0,u=0,v=!0,w=!1,x={};return function(){h.append(i),i.append(j),j.css({position:"absolute",top:0,left:"-9999px"}),b.welcomeMessage&&Q(b.welcomeMessage,"jquery-console-welcome"),y(),b.autofocus&&(i.addClass("jquery-console-focus"),j.focus(),setTimeout(function(){i.addClass("jquery-console-focus"),j.focus()},100)),x.inner=i,x.typer=j,x.scrollToBottom=K}(),x.reset=function(){var c=typeof b.welcomeMessage!="undefined";i.parent().fadeOut(function(){i.find("div").each(function(){c?c=!1:a(this).remove()}),y(),i.parent().fadeIn(function(){i.addClass("jquery-console-focus"),j.focus()})})},x.notice=function(b,c){var d=a('<div class="notice"></div>').append(a("<div></div>").text(b)).css({visibility:"hidden"});h.append(d);var e=!0;if(c=="fadeout")setTimeout(function(){d.fadeOut(function(){d.remove()})},4e3);else if(c=="prompt"){var f=a('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');d.append(f),e=!1,f.click(function(){d.fadeOut(function(){d.remove(),i.css({opacity:1})})})}var g=d.height();return d.css({height:"0px",visibility:"visible"}).animate({height:g+"px"},function(){e||i.css({opacity:.5})}),d.css("cursor","default"),d},h.click(function(){return i.addClass("jquery-console-focus"),i.removeClass("jquery-console-nofocus"),j.focus(),K(),!1}),j.blur(function(){i.removeClass("jquery-console-focus"),i.addClass("jquery-console-nofocus")}),j.bind("paste",function(a){j.val(""),setTimeout(function(){j.consoleInsert(j.val()),j.val("")},0)}),j.keydown(function(a){u=0;var b=a.keyCode;if(a.ctrlKey&&b==67)return u=b,L(),!1;if(v){if(b in c)return u=b,c[b](),!1;if(a.ctrlKey&&b in d)return u=b,d[b](),!1;if(a.altKey&&b in e)return u=b,e[b](),!1}}),j.keypress(function(c){var d=c.keyCode||c.which;if(z(c))return!1;if(c.ctrlKey&&String.fromCharCode(d).toLowerCase()=="v")return!0;if(v&&u!=d&&d>=32){if(u)return!1;(typeof b.charInsertTrigger=="undefined"||typeof b.charInsertTrigger=="function"&&b.charInsertTrigger(d,p))&&j.consoleInsert(d)}if(a.browser.webkit)return!1}),j.consoleInsert=function(a){var b=isNaN(a)?a:String.fromCharCode(a),c=p.substring(0,o),d=p.substring(o);p=c+b+d,R(b.length),q=p,_()},x.promptText=function(a){return a&&(p=a,o=p.length,_()),p},x},a.fn.filledText=function(b){return a(this).html(b),a(this).html(a(this).html()),this}}(a),a})