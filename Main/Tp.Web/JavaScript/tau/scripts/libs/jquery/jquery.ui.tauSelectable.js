define(["libs/jquery/jquery.ui"],function(jQuery){(function($,undefined){$.widget("ui.tauSelectable",{widgetEventPrefix:"tauselectable",options:{items:"> *",triggerSelector:null,className:"i-selected_true",dataName:"tauselectable",ctrl:!1,forceSelection:!1,selectOnMouseup:!1,fireEvents:!0},_create:function(){var o=this.options,$el=this.element,self=this,map={};if(o.ctrl){var isCtrl=function(evt){return evt.ctrlKey||evt.metaKey};map.mousedown=$.proxy(function(evt,item){var ctrl=isCtrl(evt),isSelected=this._getData(item,"selected"),$selected=this.getSelected(),$otherSelected=$selected.not(item),alreadySelected=$selected.length,isOnlySelected=isSelected&&alreadySelected==1;this._setData(item,"nextReset",!1),ctrl?(!o.forceSelection||!isOnlySelected)&&this._toggle(item):$otherSelected.length?isSelected?this._setData(item,"nextReset",!0):(this.reset($otherSelected),this._set(0,item)):o.forceSelection?this._set(0,item):this._toggle(item)},this),map.mouseup=$.proxy(function(evt,item){var $selected=this.getSelected(),$otherSelected=$selected.not(item);if(this._getData(item,"nextReset"))this.reset($otherSelected),this._set(0,item);else if(o.selectOnMouseup){var isSelected=!!this._getData(item,"selected");isSelected&&this.raiseChanged($selected,isSelected,!0)}this._setData(item,"nextReset",!1)},this)}else map.mousedown=$.proxy(function(evt,item){this._getData(item,"selected")?this._setData(item,"nextReset",!0):this._toggle(item)},this),map.mouseup=$.proxy(function(evt,item){this._getData(item,"selected")&&this._getData(item,"nextReset")&&(this._reset(0,item),this._setData(item,"nextReset",!1))},this);$el.delegate(o.items,"mousedown",function(evt){if(o.triggerSelector&&!$(evt.target).is(o.triggerSelector))return;map.mousedown(evt,this)}),$el.delegate(o.items,"mouseup",function(evt){if(o.triggerSelector&&!$(evt.target).is(o.triggerSelector))return;map.mouseup(evt,this)})},getSelected:function(){var o=this.options;return this.element.find(":data("+o.dataName+")").filter(function(evt){return $.data(this,o.dataName).selected})},select:function(cb){var o=this.options,$el=this.element.find(o.items);$el=$el.filter(cb),$el.length&&$el.each($.proxy(this._set,this))},unselect:function(cb){var o=this.options,$el=this.element.find(o.items).filter(cb);$el.length&&$el.each($.proxy(this._reset,this))},reset:function($cards,$except){$except=$except||$();var o=this.options,ce=o.fireEvents;o.fireEvents=!1;var $toReset=$();$cards?$toReset=$cards.not($except):$toReset=this.element.find(o.items).not($except),$toReset.each($.proxy(this._reset,this)),o.fireEvents=ce,o.fireEvents&&this.raiseChanged($toReset,!1)},raiseChanged:function($item,isSelected,mouseUp){mouseUp=mouseUp||!1;var raiseChangedOnlyForMouseup=isSelected&&this.options.selectOnMouseup;if(raiseChangedOnlyForMouseup&&!mouseUp)return;this._trigger("changed",{},{item:$item,selected:isSelected})},_toggle:function(el,isSelected){var o=this.options,$el=$(el),d=$el.data(o.dataName)||{},shouldBeSelected=arguments.length==2?!!isSelected:!d.selected;d.className&&d.className!=o.className&&$el.removeClass(d.className),$el.toggleClass(o.className,shouldBeSelected),d.selected=shouldBeSelected,d.className=o.className,shouldBeSelected||(d.nextReset=!1),$el.data(o.dataName,d),o.fireEvents&&this.raiseChanged($el,shouldBeSelected)},_reset:function(i,el){this._toggle(el,!1)},_resetForce:function(i,el){this._toggle(el,!1,!0)},_set:function(i,el){this._toggle(el,!0)},_setData:function(el,name,val){var dataName=this.options.dataName,d=$.data(el,dataName)||{};d[name]=val,$.data(el,dataName,d)},_getData:function(el,name){var dataName=this.options.dataName,d=$.data(el,dataName)||{};return d[name]}})})(jQuery)})