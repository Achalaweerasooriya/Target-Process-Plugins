define(["libs/jquery/jquery.ui"],function(e){e.widget("ui.tauSelectable",{widgetEventPrefix:"tauselectable",options:{items:"> *",triggerSelector:null,selectedItems:[],className:"i-selected_true",dataName:"tauselectable",ctrl:!1,forceSelection:!1,selectOnMouseup:!1,fireEvents:!0},_create:function(){var t=this.options,s=this.element;s.addClass("i-role-selectable");var i={};this.select(this.options.selectedItems),t.ctrl?(i.mousedown=e.proxy(function(e,s){var i=e.ctrlKey||e.metaKey,a=this._getData(s,"selected"),n=this.getSelected(),o=n.not(s),l=n.length,r=a&&1==l;this._setData(s,"nextReset",!1),i?t.forceSelection&&r||this._toggle(s):o.length?a?this._setData(s,"nextReset",!0):(this.reset(o),this._set(0,s)):t.forceSelection?this._set(0,s):this._toggle(s)},this),i.mouseup=e.proxy(function(e,s){var i=this.getSelected(),a=i.not(s);if(this._getData(s,"nextReset"))this.reset(a),this._set(0,s);else if(t.selectOnMouseup){var n=!!this._getData(s,"selected");n&&this.raiseChanged(i,n,!0)}this._setData(s,"nextReset",!1)},this)):(i.mousedown=e.proxy(function(e,t){this._getData(t,"selected")?this._setData(t,"nextReset",!0):this._toggle(t)},this),i.mouseup=e.proxy(function(e,t){this._getData(t,"selected")&&this._getData(t,"nextReset")&&(this._reset(0,t),this._setData(t,"nextReset",!1))},this)),s.on("mousedown.tauSelectable",t.items,function(s){2!=s.button&&(!t.triggerSelector||e(s.target).is(t.triggerSelector))&&i.mousedown(s,this)}),s.on("mouseup.tauSelectable",t.items,function(s){2!=s.button&&(!t.triggerSelector||e(s.target).is(t.triggerSelector))&&i.mouseup(s,this)})},destroy:function(){this.element.off("mousedown.tauSelectable"),this.element.off("mouseup.tauSelectable"),this._super()},getSelected:function(){var t=this.options;return this.element.find(":data("+t.dataName+")").filter(function(){return e.data(this,t.dataName).selected})},select:function(t){var s=this.options,i=this.element.find(s.items);i=i.filter(t),i.length&&i.each(e.proxy(this._set,this))},unselect:function(t){var s=this.options,i=this.element.find(s.items).filter(t);
i.length&&i.each(e.proxy(this._reset,this))},reset:function(t,s){s=s||e();var i=this.options,a=i.fireEvents;i.fireEvents=!1;var n=e();n=t?t.not(s):this.element.find(i.items).not(s),n.each(e.proxy(this._reset,this)),i.fireEvents=a,i.fireEvents&&this.raiseChanged(n,!1)},clearSelection:function(){this.reset(this.getSelected())},raiseChanged:function(e,t,s){s=s||!1;var i=t&&this.options.selectOnMouseup;(!i||s)&&this._trigger("changed",{},{item:e,selected:t})},_toggle:function(t,s){var i=this.options,a=e(t),n=a.data(i.dataName)||{},o=2==arguments.length?!!s:!n.selected;n.className&&n.className!=i.className&&a.removeClass(n.className),a.toggleClass(i.className,o),n.selected=o,n.className=i.className,o||(n.nextReset=!1),a.data(i.dataName,n),i.fireEvents&&this.raiseChanged(a,o)},_reset:function(e,t){this._toggle(t,!1)},_set:function(e,t){this._toggle(t,!0)},_setData:function(t,s,i){var a=this.options.dataName,n=e.data(t,a)||{};n[s]=i,e.data(t,a,n)},_getData:function(t,s){var i=this.options.dataName,a=e.data(t,i)||{};return a[s]}})});