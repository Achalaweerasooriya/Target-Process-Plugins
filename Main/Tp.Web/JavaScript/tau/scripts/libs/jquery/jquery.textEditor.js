define(["jQuery"],function(a){return function($,a){if(a in $)throw new Error('jQuery already has the "'+a+'" property.');var b=function(b,c){for(var d in c)b.bind(d+"."+a,c[d])},c=function(a,b){this.initElement(a),this.setOptions(b),this.bindEvents(b)};c.prototype={constructor:c,initElement:function(a){this.$element=a.addClass("editableText")},setOptions:function(a){var b=a||{};this.onSave=$.isFunction(b.onSave)?b.onSave:$.noop,this.onEditStart=$.isFunction(b.onEditStart)?b.onEditStart:$.noop,this.onEditEnd=$.isFunction(b.onEditEnd)?b.onEditEnd:$.noop,this.maxLength=b.maxLength||255,this.mask=b.mask?new RegExp(b.mask):!1,this.restoreText=typeof b.restoreText=="undefined"?!0:b.restoreText},bindEvents:function(a){a=a||{},a.resetOnBlur&&(this.onBlur=function(){this._cancelEdit()}),b(this.$element,{blur:$.proxy(this,"onBlur"),keydown:$.proxy(this,"mapKeys"),keypress:$.proxy(this,"mapKeys"),click:$.proxy(this,"onFocus")})},onFocus:function(a){a&&a.stopPropagation(),this.isActive()||(this.activate(),this.onEditStart(),this.storeInitialText())},_performSave:function(){if(!this.isActive())return;this.deactivate(),this.saveText(),this.onEditEnd()},_cancelEdit:function(){if(!this.isActive())return;this.deactivate(),this.restoreInitialText(),this.onEditEnd()},onBlur:function(){this._performSave()},onEnter:function(a){a.preventDefault(),this._performSave(),this.$element.blur()},onEscape:function(a){a.preventDefault(),this._cancelEdit(),this.$element.blur()},onKeyDefault:function(a){if(a.charCode!=0){var b=String.fromCharCode(a.charCode||a.keyCode),c=this.$element.text()+b;this.mask.test(c)||a.preventDefault()}},activate:function(){this.$element.prop("contentEditable",!0).addClass("active").focus()},deactivate:function(){this.$element.removeClass("active").removeProp("contentEditable")},isActive:function(){return this.$element.hasClass("active")},setInitialText:function(a){this.initialText=a},getInitialText:function(){return this.initialText},storeInitialText:function(){this.setInitialText(this.$element.text())},restoreInitialText:function(){this.$element.text(this.getInitialText())},trimText:function(a){return _.trim(a)},normalizeText:function(a){var b=this.trimText(a);return b.length==0&&this.restoreText===!0&&(b=this.getInitialText()),b},saveText:function(){var a=this.normalizeText(this.$element.text());this.$element.text(a),a!=this.getInitialText()&&this.onSave(a)},mapKeys:function(a){switch(a.which){case 13:this.onEnter(a);break;case 27:this.onEscape(a);break;default:a.type=="keypress"&&this.mask&&this.onKeyDefault(a)}}},$.fn[a]=function(b){return this.each(function(d,e){var f=$(e);f.data(a,new c(f,b))})},$[a]=function(b,c){return $(b)[a](c)}}(a,"textEditor"),a.fn.textEditor})