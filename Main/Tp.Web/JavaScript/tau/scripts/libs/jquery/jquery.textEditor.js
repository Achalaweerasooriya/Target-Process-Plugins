define(["libs/jquery/jquery"],function(a){(function(a,b){if(b in a)throw new Error('jQuery already has the "'+b+'" property.');var c=function(a,c){for(var d in c)a.bind(d+"."+b,c[d])},d=function(a,b){this.initElement(a),this.setOptions(b),this.bindEvents()};d.prototype={constructor:d,initElement:function(a){this.$element=a.addClass("editableText")},setOptions:function(b){var c=b||{};this.onSave=a.isFunction(c.onSave)?c.onSave:a.noop,this.onEditStart=a.isFunction(c.onEditStart)?c.onEditStart:a.noop,this.onEditEnd=a.isFunction(c.onEditEnd)?c.onEditEnd:a.noop,this.maxLength=c.maxLength||255,this.mask=c.mask?new RegExp(c.mask):!1,this.restoreText=typeof c.restoreText=="undefined"?!0:c.restoreText},bindEvents:function(){c(this.$element,{blur:a.proxy(this,"onBlur"),keydown:a.proxy(this,"mapKeys"),keypress:a.proxy(this,"mapKeys"),click:a.proxy(this,"onFocus")})},onFocus:function(){this.isActive()||(this.activate(),this.onEditStart(),this.storeInitialText())},onBlur:function(){this.isActive()&&(this.deactivate(),this.saveText(),this.onEditEnd())},onEnter:function(a){a.preventDefault(),this.$element.blur()},onEscape:function(a){a.preventDefault(),this.restoreInitialText(),this.$element.blur()},onKeyDefault:function(a){if(a.charCode!=0){var b=String.fromCharCode(a.charCode||a.keyCode),c=this.$element.text()+b;this.mask.test(c)||a.preventDefault()}},activate:function(){this.$element.prop("contentEditable",!0).addClass("active").focus()},deactivate:function(){this.$element.removeClass("active").removeProp("contentEditable")},isActive:function(){return this.$element.hasClass("active")},setInitialText:function(a){this.initialText=a},getInitialText:function(){return this.initialText},storeInitialText:function(){this.setInitialText(this.$element.text())},restoreInitialText:function(){this.$element.text(this.getInitialText())},trimText:function(a){return a},normalizeText:function(a){var b=this.trimText(a);b.length==0&&this.restoreText===!0&&(b=this.getInitialText());return b},saveText:function(){var a=this.normalizeText(this.$element.text());this.$element.text(a),a!=this.getInitialText()&&this.onSave(a)},mapKeys:function(a){switch(a.which){case 13:this.onEnter(a);break;case 27:this.onEscape(a);break;default:a.type=="keypress"&&this.mask&&this.onKeyDefault(a)}}},a.fn[b]=function(c){return this.each(function(e,f){var g=a(f);g.data(b,new d(g,c))})},a[b]=function(c,d){return a(c)[b](d)}})(a,"textEditor");return a.fn.textEditor})