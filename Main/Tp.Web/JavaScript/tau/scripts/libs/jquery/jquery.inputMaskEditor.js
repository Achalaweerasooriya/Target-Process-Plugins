define(["jQuery"],function(e){return e.widget("tau.inputMaskEditor",{options:{className:"editableText",mask:null},_create:function(){this.element.addClass(this.options.className).on("keypress"+this.eventNamespace,this.onKeyPress.bind(this))},onKeyPress:function(e){if(this.options.mask&&!(e.ctrlKey||e.altKey||e.metaKey||e.which<32)){var t=String.fromCharCode(e.which),n=e.target.value,a=this._getSelection(e.target);a.statusSelection?n=n.substring(0,a.start)+t+n.substring(a.end):n+=t;var s=new RegExp(this.options.mask);s.test(n)||e.preventDefault()}},_getSelection:function(e){var t;return t="number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?{start:e.selectionStart,end:e.selectionEnd}:this._getSelectionFromRange(e),t.statusSelection=t.start!==t.end,t},_getSelectionFromRange:function(e){var t,n,a,s,r,o=0,i=0;return n&&n.parentElement()==e&&(s=e.value.length,t=e.value.replace(/\r\n/g,"\n"),a=e.createTextRange(),a.moveToBookmark(n.getBookmark()),r=e.createTextRange(),r.collapse(!1),a.compareEndPoints("StartToEnd",r)>-1?(o=s,i=s):(o=-a.moveStart("character",-s),o+=t.slice(0,o).split("\n").length-1,a.compareEndPoints("EndToEnd",r)>-1?i=s:(i=-a.moveEnd("character",-s),i+=t.slice(0,i).split("\n").length-1))),{start:o,end:i}}}),e});