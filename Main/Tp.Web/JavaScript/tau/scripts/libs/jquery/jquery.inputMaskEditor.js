define(["libs/jquery/jquery.ui","Underscore"],function(t,e){var n="inputMaskEditor";return function(t,n){if(n in t)throw new Error('jQuery already has the "'+n+'" property.');var i=function(t){var e,n,i,s,r,o=0,a=0,c=!1;return"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd?(o=t.selectionStart,a=t.selectionEnd):(n=document.selection.createRange(),n&&n.parentElement()==t&&(s=t.value.length,e=t.value.replace(/\r\n/g,"\n"),i=t.createTextRange(),i.moveToBookmark(n.getBookmark()),r=t.createTextRange(),r.collapse(!1),i.compareEndPoints("StartToEnd",r)>-1?o=a=s:(o=-i.moveStart("character",-s),o+=e.slice(0,o).split("\n").length-1,i.compareEndPoints("EndToEnd",r)>-1?a=s:(a=-i.moveEnd("character",-s),a+=e.slice(0,a).split("\n").length-1)))),o-a!=0&&(c=!0),{start:o,end:a,statusSelection:c}},s=function(e,i,s){for(var r in s)e.on(r+"."+n,t.proxy(s[r],i))},r=function(e,i,s){for(var r in s)e.off(r+"."+n,t.proxy(s[r],i))},o=function(t,e){this.setOptions(e),this.initElement(t),this.bindEvents(e)};o.prototype={constructor:o,initElement:function(t){this.$element=t.addClass(this.className)},setOptions:function(e){e=e||{},this.onSave=t.isFunction(e.onSave)?e.onSave:t.noop,this.onEditStart=t.isFunction(e.onEditStart)?e.onEditStart:t.noop,this.onEditEnd=t.isFunction(e.onEditEnd)?e.onEditEnd:t.noop,this.maxLength=e.maxLength||255,this.mask=e.mask?new RegExp(e.mask):!1,this.restoreText="undefined"==typeof e.restoreText?!0:e.restoreText,this.className="undefined"==typeof e.className?"editableText":e.className,this.classNameActive=e.className||"active"},bindEvents:function(){var e=this;s(e.$element,e,{blur:this.onBlur,keypress:this.onKeyPress,click:this.onFocus}),t.ui.ie||t(window).blur(function(){e.$element.blur()})},unbindEvents:function(){r(this.$element,this,{blur:this.onBlur,keypress:this.onKeyPress,click:this.onFocus})},onKeyPress:function(t){if(this.mask&&!(t.ctrlKey||t.altKey||t.metaKey||t.which<32)){var e=String.fromCharCode(t.which),n=t.target.value,s=i(t.target);s.statusSelection?n=n.substring(0,s.start)+e+n.substring(s.end):n+=e,this.mask.test(n)||t.preventDefault()}},trimText:function(t){return e.trim(t)},normalizeText:function(t){var e=this.trimText(t);return 0==e.length&&this.restoreText===!0&&(e=this.getInitialText()),e}},t.fn[n]=function(e){return this.each(function(i,s){var r=t(s);r.data(n,new o(r,e))})},t[n]=function(e,i){return t(e)[n](i)}}(t,n),t.fn[n]});