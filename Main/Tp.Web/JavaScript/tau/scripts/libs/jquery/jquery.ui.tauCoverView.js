define(["libs/jquery/jquery.ui"],function(t){var e=function(e,i){this._coverView=e,this._options=i,this._$overlay=t(i.template).insertBefore(e.element),this._bind()};e.prototype={OVERLAY_ACTIVE_CLASS:"tau-cover-view__overlay_active",_bind:function(){this._options.hideViewOnClick&&(this._clickDelegate=this._onClick.bind(this),this._$overlay.on("click"+this._coverView.eventNamespace,this._clickDelegate))},_unBind:function(){this._clickDelegate&&(this._$overlay.off("click"+this._coverView.eventNamespace),this._clickDelegate=null)},_onClick:function(){this._options.hideViewOnClick&&this._coverView.hide()},_toggle:function(t){this._$overlay.toggleClass(this.OVERLAY_ACTIVE_CLASS,t)},activate:function(){this._toggle(!0)},deactivate:function(){this._toggle(!1)},destroy:function(){this._unBind(),this._$overlay.remove()}};var i={activate:t.noop,deactivate:t.noop,destroy:t.noop},o=function(e,i){this._$coverViewElement=e.element,this._options=i,this._$arrow=t(i.template).hide().appendTo(this._options.$appendTo),this._$arrowTarget=t(),this._arrowTargetOffset=this._$arrowTarget.offset()};o.prototype={_shouldBeAdjusted:function(t,e){return!this._$arrowTarget.is(t)||e.top!==this._arrowTargetOffset.top||e.left!==this._arrowTargetOffset.left},_ensureReadyToAdjust:function(){this._$arrow.is(":hidden")&&(this._$arrow.css("opacity",0),this._$arrow.show())},adjust:function(e){var i=e.offset();this._shouldBeAdjusted(e,i)&&(this._ensureReadyToAdjust(),this._$arrow.position(t.extend({of:e,using:function(t){this._$arrow.css("left",t.left+"px"),this._$arrow.css("top",t.top+"px"),this._arrowLeft=t.left}.bind(this)},this._options.positionConfig)),this._$arrowTarget=e,this._arrowTargetOffset=i)},adjustCoverView:function(){this._viewAdjustedForArrowLeft!==this._arrowLeft&&(this._ensureReadyToAdjust(),this._$coverViewElement.position({of:this._$arrow,my:"left",at:"right",using:function(t){this._$coverViewElement.css("left",t.left+"px")}.bind(this)}),this._viewAdjustedForArrowLeft=this._arrowLeft)},hide:function(){this._$arrow.hide()
},fadeIn:function(){this._$arrow.fadeTo("fast",1)},destroy:function(){this._$arrow.remove()}};var s={adjust:t.noop,adjustCoverView:t.noop,hide:t.noop,fadeIn:t.noop,destroy:t.noop},n=function(t,e,i){this._coverView=t,this._options=e,this._keyBoardManager=i,this._eventNamespace=t.eventNamespace,this._doNotCloseSelectors=(this._options.doNotHideSelectors||[]).join(","),this._bindOutsideAction(),this._bindScrollOf()};n.prototype={enable:function(){this._bindKeyboard()},disable:function(){this._unBindKeyboard()},_bindKeyboard:function(){this._options.onEscape&&this._keyBoardManager&&!this._keyDownHandler&&(this._keyDownHandler=this._onKeyDown.bind(this),this._keyBoardManager.pushHandler({handleKeyDown:this._keyDownHandler}))},_unBindKeyboard:function(){this._keyDownHandler&&(this._keyBoardManager.popHandler(),this._keyDownHandler=null)},_bindOutsideAction:function(){this._options.onOutsideAction&&!this._outsideActionDelegate&&(this._outsideActionDelegate=this._onOutsideAction.bind(this),t(document).on("mousedown"+this._eventNamespace,this._outsideActionDelegate))},_unBindOutsideAction:function(){this._outsideActionDelegate&&(t(document).off("mousedown"+this._eventNamespace),this._outsideActionDelegate=null)},_bindScrollOf:function(){this._options.onScroll.enabled&&!this._scrollOfDelegate&&(this._scrollOfDelegate=this._onScrollOf.bind(this),this._options.onScroll.$of.on("scroll"+this._eventNamespace,this._scrollOfDelegate))},_unBindScrollOf:function(){this._scrollOfDelegate&&(this._options.onScroll.$of.off("scroll"+this._eventNamespace),this._scrollOfDelegate=null)},_onOutsideAction:function(e){if(this._options.onOutsideAction){var i=t(e.target),o=this._coverView.element;o.is(":hidden")||i.is(":hidden")||i.closest(o).length>0||i.closest(this._doNotCloseSelectors).length>0||this._coverView.hide()}},_onKeyDown:function(e){this._options.onEscape&&e.keyCode===t.ui.keyCode.ESCAPE&&this._coverView.hide()},_onScrollOf:function(){this._options.onScroll.enabled&&this._coverView.hide()
},destroy:function(){this._unBindKeyboard(),this._unBindOutsideAction(),this._unBindScrollOf()}};var h={enable:t.noop,disable:t.noop,destroy:t.noop},a=function(e){this._coverView=e,this._$closeButton=t(this.buttonTemplate).hide().appendTo(e.element),this._$closeButton.on("click",e.hide.bind(e))};a.prototype={buttonTemplate:'<div class="close"></div>',show:function(){this._$closeButton.show()},hide:function(){this._$closeButton.hide()},destroy:function(){this._$closeButton.off("click"),this._$closeButton.remove()}};var r={show:t.noop,hide:t.noop,destroy:t.noop};t.widget("ui.tauCoverView",{CLASS_MAP:{coverView:"tau-cover-view",hide:"tau-cover-view-hide",animate:"tau-cover-view_animate",animateHide:"tau-cover-view_animate-hide"},NULL_OVERLAY:i,NULL_AUTO_HIDER:h,NULL_ARROW:s,NULL_CLOSE_BUTTON:r,options:{contentHolderSelector:"",arrow:{$appendTo:null,template:'<div class="tau-cover-view_arrow" style="top: 0; left: 0;"></div>',positionConfig:{my:"left center",at:"right center"}},autoHide:{onEscape:!1,onOutsideAction:!1,doNotHideSelectors:[],onScroll:{enabled:!1,$of:t()}},overlay:{show:!1,template:'<div class="tau-cover-view__overlay"></div>',hideViewOnClick:!1},showCloseButton:!1,keyBoardManager:null},_setOption:function(e,i){"autoHide"===e&&(i=t.extend(!0,this.options.autoHide,i)),"overlay"===e&&(i=t.extend(!0,this.options.overlay,i)),this._super(e,i)},_create:function(){this.element.addClass(this.CLASS_MAP.coverView).addClass(this.CLASS_MAP.hide),this._isVisible=!1,this._overlay=this.options.overlay.show?new e(this,this.options.overlay):this.NULL_OVERLAY,this._arrow=this.options.arrow.$appendTo?new o(this,this.options.arrow):this.NULL_ARROW,this._autoHider=this.options.autoHide.onEscape&&this.options.keyBoardManager||this.options.autoHide.onOutsideAction||this.options.autoHide.onScroll.$of.length?new n(this,this.options.autoHide,this.options.keyBoardManager):this.NULL_AUTO_HIDER,this._closeButton=this.options.showCloseButton?new a(this):this.NULL_CLOSE_BUTTON},show:function(t){return this._arrow.adjust(t),this._isVisible?void this._arrow.adjustCoverView():(this._isVisible=!0,this.element.removeClass(this.CLASS_MAP.hide),this._arrow.adjustCoverView(),this.element.animateWithCss({cssClassName:this.CLASS_MAP.animate,offsetTimeout:-40,complete:function(){this._isVisible&&(this._arrow.fadeIn(),this._closeButton.show(),this._overlay.activate()),this._trigger("showCompleted")
}.bind(this)}),this._autoHider.enable(),void this._trigger("show"))},hide:function(){this._isVisible&&(this._isVisible=!1,this._arrow.hide(),this._closeButton.hide(),this.element.hasClass(this.CLASS_MAP.hide)||this.element.animateWithCss({cssClassName:this.CLASS_MAP.animateHide,offsetTimeout:-40,complete:function(){this._isVisible||this.element.addClass(this.CLASS_MAP.hide)}.bind(this)}),this._overlay.deactivate(),this._autoHider.disable(),this._trigger("hide"))},setContent:function(t){this._removeContent();var e=this.options.contentHolderSelector?this.element.find(this.options.contentHolderSelector):this.element;e.append(t),this._$content=t},_removeContent:function(){this._$content&&this._$content.remove()},_destroy:function(){this.hide(),this._removeContent(),this._overlay.destroy(),this._arrow.destroy(),this._autoHider.destroy(),this._closeButton.destroy()}})});