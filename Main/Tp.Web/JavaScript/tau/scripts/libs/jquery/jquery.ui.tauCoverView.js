define(["libs/jquery/jquery.ui"],function(t){var e=function(e,o){this._$coverViewElement=e.element,this._options=o,this._$arrow=t.tmpl(this.arrowTemplate).hide().insertAfter(this._options.$insertAfter)};e.prototype={arrowTemplate:'<div class="tau-cover-view_arrow"></div>',_ensureReadyToAdjustment:function(){this._$arrow.is(":hidden")&&(this._$arrow.css("opacity",0),this._$arrow.show())},adjust:function(e){if(this._ensureReadyToAdjustment(),this._$arrowTarget!==e){this._$arrowTarget=e,this._$arrow.position(t.extend({of:this._$arrowTarget},this._options.positionConfig));var o=this._$arrow.position().left+this._$arrow.width();this._coverViewLeft!==o&&(this._$coverViewElement.css("left",o+"px"),this._coverViewLeft=o)}return this},hide:function(){this._$arrow.hide()},fadeIn:function(){this._$arrow.fadeTo("fast",1)},destroy:function(){this._$arrow.remove()}};var o=function(){};o.prototype={adjust:t.noop,hide:t.noop,fadeIn:t.noop,destroy:t.noop};var i=function(t,e){this._coverView=t,this._options=e,this._eventNamespace=t.eventNamespace,this._doNotCloseSelectors=(this._options.doNotHideSelectors||[]).join(","),this._bindOverlayAction(),this._bindKeyboard()};i.prototype={_bindKeyboard:function(){this._options.onEscape&&!this._keyDownHandler&&(this._keyDownHandler=this._onKeyDown.bind(this),t(document).on("keydown"+this._eventNamespace,this._keyDownHandler))},_unBindKeyboard:function(){this._keyDownHandler&&(t(document).off("keydown"+this._eventNamespace),this._keyDownHandler=null)},_bindOverlayAction:function(){this._options.onOverlayAction&&!this._overlayActionDelegate&&(this._overlayActionDelegate=this._onOverlayAction.bind(this),t(document).on("mousedown"+this._eventNamespace,this._overlayActionDelegate),this._options.$onScrollOf.on("scroll"+this._eventNamespace,this._overlayActionDelegate))},_unBindOverlayAction:function(){this._overlayActionDelegate&&(t(document).off("mousedown"+this._eventNamespace),this._options.$onScrollOf.off("scroll"+this._eventNamespace),this._overlayActionDelegate=null)},_onOverlayAction:function(e){var o=t(e.target),i=this._coverView.element;i.is(":hidden")||o.is(":hidden")||o.closest(i).length>0||o.closest(this._doNotCloseSelectors).length>0||this._coverView.hide()},_onKeyDown:function(e){e.keyCode===t.ui.keyCode.ESCAPE&&this._coverView.hide()},destroy:function(){this._unBindOverlayAction(),this._unBindKeyboard()}};var s=function(){};s.prototype={destroy:t.noop};var n=function(e){this._coverView=e,this._$closeButton=t.tmpl(this.buttonTemplate).hide().appendTo(e.element),this._$closeButton.on("click",e.hide.bind(e))};n.prototype={buttonTemplate:'<div class="close"></div>',show:function(){this._$closeButton.show()},hide:function(){this._$closeButton.hide()},destroy:function(){this._$closeButton.off("click"),this._$closeButton.remove()}};var r=function(){};r.prototype={show:t.noop,hide:t.noop,destroy:t.noop},t.widget("ui.tauCoverView",{CLASS_MAP:{hide:"tau-cover-view-hide",animate:"tau-cover-view_animate",animateHide:"tau-cover-view_animate-hide",overlayActive:"tau-cover-view__overlay_active"},options:{contentHolderSelector:"",arrow:{$insertAfter:null,positionConfig:{my:"left center",at:"right center"}},autoHide:{onEscape:!1,onOverlayAction:!1,onOverlayClick:!1,doNotHideSelectors:[],$onScrollOf:t()},overlayTemplate:'<div class="tau-cover-view__overlay"></div>',showOverlay:!1,showCloseButton:!1},_setOption:function(e,o){"autoHide"===e&&(o=t.extend(this.options.autoHide,o)),this._super(e,o)},_create:function(){this.element.addClass(this.CLASS_MAP.hide),this._isVisible=!1,this.options.showOverlay&&(this.$overlay=t(this.options.overlayTemplate).insertBefore(this.element),this.options.autoHide.onOverlayClick&&this.$overlay.on("click",this.hide.bind(this))),this._arrow=this.options.arrow.$insertAfter?new e(this,this.options.arrow):new o,this._autoHider=this.options.autoHide.onEscape||this.options.autoHide.onOverlayAction||this.options.autoHide.$onScrollOf.length?new i(this,this.options.autoHide):new s,this._closeButton=this.options.showCloseButton?new n(this):new r},show:function(t){this._arrow.adjust(t),this._isVisible||(this._isVisible=!0,this.element.removeClass(this.CLASS_MAP.hide),this.element.animateWithCss({cssClassName:this.CLASS_MAP.animate,offsetTimeout:-40,complete:function(){this._isVisible&&(this._arrow.fadeIn(),this._closeButton.show(),this.options.showOverlay&&this.$overlay.toggleClass(this.CLASS_MAP.overlayActive,!0)),this._trigger("showCompleted")}.bind(this)}))},hide:function(){this._isVisible&&(this._isVisible=!1,this._arrow.hide(),this._closeButton.hide(),this.element.hasClass(this.CLASS_MAP.hide)||this.element.animateWithCss({cssClassName:this.CLASS_MAP.animateHide,offsetTimeout:-40,complete:function(){this._isVisible||this.element.addClass(this.CLASS_MAP.hide)}.bind(this)}),this.options.showOverlay&&this.$overlay.toggleClass(this.CLASS_MAP.overlayActive,!1),this._trigger("hide"))},setContent:function(t){this._removeContent();var e=this.options.contentHolderSelector?this.element.find(this.options.contentHolderSelector):this.element;e.append(t),this._$content=t},_removeContent:function(){this._$content&&this._$content.remove()},_removeOverlay:function(){this.$overlay&&this.$overlay.remove()},_destroy:function(){this.hide(),this._removeOverlay(),this._removeContent(),this._arrow.destroy(),this._autoHider.destroy(),this._closeButton.destroy()}})});