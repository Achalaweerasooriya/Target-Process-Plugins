function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(a){var b=a.children;return b&&b.length?b[0]:a._tree.thread}function d3_layout_treeRight(a){var b=a.children,c;return b&&(c=b.length)?b[c-1]:a._tree.thread}function d3_layout_treeSearch(a,b){var c=a.children;if(c&&(e=c.length)){var d,e,f=-1;while(++f<e)b(d=d3_layout_treeSearch(c[f],b),a)>0&&(a=d)}return a}function d3_layout_treeRightmost(a,b){return a.x-b.x}function d3_layout_treeLeftmost(a,b){return b.x-a.x}function d3_layout_treeDeepest(a,b){return a.depth-b.depth}function d3_layout_treeVisitAfter(a,b){function c(a,d){var e=a.children;if(e&&(i=e.length)){var f,g=null,h=-1,i;while(++h<i)f=e[h],c(f,g),g=f}b(a,d)}c(a,null)}function d3_layout_treeShift(a){var b=0,c=0,d=a.children,e=d.length,f;while(--e>=0)f=d[e]._tree,f.prelim+=b,f.mod+=b,b+=f.shift+(c+=f.change)}function d3_layout_treeMove(a,b,c){a=a._tree,b=b._tree;var d=c/(b.number-a.number);a.change+=d,b.change-=d,b.shift+=c,b.prelim+=c,b.mod+=c}function d3_layout_treeAncestor(a,b,c){return a._tree.ancestor.parent==b.parent?a._tree.ancestor:c}d3.layout.tree=function(){function d(d,e){function h(a,c){var d=a.children,e=a._tree;if(d&&(f=d.length)){var f,g=d[0],i,k=g,l,m=-1;while(++m<f)l=d[m],h(l,i),k=j(l,i,k),i=l;d3_layout_treeShift(a);var n=.5*(g._tree.prelim+l._tree.prelim);c?(e.prelim=c._tree.prelim+b(a,c),e.mod=e.prelim-n):e.prelim=n}else c&&(e.prelim=c._tree.prelim+b(a,c))}function i(a,b){a.x=a._tree.prelim+b;var c=a.children;if(c&&(e=c.length)){var d=-1,e;b+=a._tree.mod;while(++d<e)i(c[d],b)}}function j(a,c,d){if(c){var e=a,f=a,g=c,h=a.parent.children[0],i=e._tree.mod,j=f._tree.mod,k=g._tree.mod,l=h._tree.mod,m;while(g=d3_layout_treeRight(g),e=d3_layout_treeLeft(e),g&&e)h=d3_layout_treeLeft(h),f=d3_layout_treeRight(f),f._tree.ancestor=a,m=g._tree.prelim+k-e._tree.prelim-i+b(g,e),m>0&&(d3_layout_treeMove(d3_layout_treeAncestor(g,a,d),a,m),i+=m,j+=m),k+=g._tree.mod,i+=e._tree.mod,l+=h._tree.mod,j+=f._tree.mod;g&&!d3_layout_treeRight(f)&&(f._tree.thread=g,f._tree.mod+=k-j),e&&!d3_layout_treeLeft(h)&&(h._tree.thread=e,h._tree.mod+=i-l,d=a)}return d}var f=a.call(this,d,e),g=f[0];d3_layout_treeVisitAfter(g,function(a,b){a._tree={ancestor:a,prelim:0,mod:0,change:0,shift:0,number:b?b._tree.number+1:0}}),h(g),i(g,-g._tree.prelim);var k=d3_layout_treeSearch(g,d3_layout_treeLeftmost),l=d3_layout_treeSearch(g,d3_layout_treeRightmost),m=d3_layout_treeSearch(g,d3_layout_treeDeepest),n=k.x-b(k,l)/2,o=l.x+b(l,k)/2,p=m.depth||1;return d3_layout_treeVisitAfter(g,function(a){a.x=(a.x-n)/(o-n)*c[0],a.y=a.depth/p*c[1],delete a._tree}),f}var a=d3.layout.hierarchy().sort(null).value(null),b=d3_layout_treeSeparation,c=[1,1];return d.separation=function(a){return arguments.length?(b=a,d):b},d.size=function(a){return arguments.length?(c=a,d):c},d3_layout_hierarchyRebind(d,a)}