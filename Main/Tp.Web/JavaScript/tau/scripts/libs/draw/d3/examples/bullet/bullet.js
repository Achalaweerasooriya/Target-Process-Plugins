function randomize(a){return a.randomizer||(a.randomizer=randomizer(a)),a.ranges=a.ranges.map(a.randomizer),a.markers=a.markers.map(a.randomizer),a.measures=a.measures.map(a.randomizer),a}function randomizer(a){var b=d3.max(a.ranges)*.2;return function(a){return Math.max(0,a+b*(Math.random()-.5))}}function bulletChart(){function j(a){a.each(function(a,j){var k=d.call(this,a,j).slice().sort(d3.descending),l=e.call(this,a,j).slice().sort(d3.descending),m=f.call(this,a,j).slice().sort(d3.descending),n=d3.select(this),o=d3.scale.linear().domain([0,Math.max(k[0],l[0],m[0])]).range(b?[g,0]:[0,g]),p=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(o.range());this.__chart__=o;var q=bulletWidth(p),r=bulletWidth(o),s=n.selectAll("rect.range").data(k);s.enter().append("svg:rect").attr("class",function(a,b){return"range s"+b}).attr("width",q).attr("height",h).attr("x",b?p:0).transition().duration(c).attr("width",r).attr("x",b?o:0),s.transition().duration(c).attr("x",b?o:0).attr("width",r).attr("height",h);var t=n.selectAll("rect.measure").data(m);t.enter().append("svg:rect").attr("class",function(a,b){return"measure s"+b}).attr("width",q).attr("height",h/3).attr("x",b?p:0).attr("y",h/3).transition().duration(c).attr("width",r).attr("x",b?o:0),t.transition().duration(c).attr("width",r).attr("height",h/3).attr("x",b?o:0).attr("y",h/3);var u=n.selectAll("line.marker").data(l);u.enter().append("svg:line").attr("class","marker").attr("x1",p).attr("x2",p).attr("y1",h/6).attr("y2",h*5/6).transition().duration(c).attr("x1",o).attr("x2",o),u.transition().duration(c).attr("x1",o).attr("x2",o).attr("y1",h/6).attr("y2",h*5/6);var v=i||o.tickFormat(8),w=n.selectAll("g.tick").data(o.ticks(8),function(a){return this.textContent||v(a)}),x=w.enter().append("svg:g").attr("class","tick").attr("transform",bulletTranslate(p)).style("opacity",1e-6);x.append("svg:line").attr("y1",h).attr("y2",h*7/6),x.append("svg:text").attr("text-anchor","middle").attr("dy","1em").attr("y",h*7/6).text(v),x.transition().duration(c).attr("transform",bulletTranslate(o)).style("opacity",1);var y=w.transition().duration(c).attr("transform",bulletTranslate(o)).style("opacity",1);y.select("line").attr("y1",h).attr("y2",h*7/6),y.select("text").attr("y",h*7/6),w.exit().transition().duration(c).attr("transform",bulletTranslate(o)).style("opacity",1e-6).remove()}),d3.timer.flush()}var a="left",b=!1,c=0,d=bulletRanges,e=bulletMarkers,f=bulletMeasures,g=380,h=30,i=null;return j.orient=function(c){return arguments.length?(a=c,b=a=="right"||a=="bottom",j):a},j.ranges=function(a){return arguments.length?(d=a,j):d},j.markers=function(a){return arguments.length?(e=a,j):e},j.measures=function(a){return arguments.length?(f=a,j):f},j.width=function(a){return arguments.length?(g=a,j):g},j.height=function(a){return arguments.length?(h=a,j):h},j.tickFormat=function(a){return arguments.length?(i=a,j):i},j.duration=function(a){return arguments.length?(c=a,j):c},j}function bulletRanges(a){return a.ranges}function bulletMarkers(a){return a.markers}function bulletMeasures(a){return a.measures}function bulletTranslate(a){return function(b){return"translate("+a(b)+",0)"}}function bulletWidth(a){var b=a(0);return function(c){return Math.abs(a(c)-b)}}var w=960,h=50,m=[5,40,20,120],chart=bulletChart().width(w-m[1]-m[3]).height(h-m[0]-m[2]);d3.json("bullets.json",function(a){var b=d3.select("#chart").selectAll("svg").data(a).enter().append("svg").attr("class","bullet").attr("width",w).attr("height",h).append("g").attr("transform","translate("+m[3]+","+m[0]+")").call(chart),c=b.append("g").attr("text-anchor","end").attr("transform","translate(-6,"+(h-m[0]-m[2])/2+")");c.append("text").attr("class","title").text(function(a){return a.title}),c.append("text").attr("class","subtitle").attr("dy","1em").text(function(a){return a.subtitle}),chart.duration(1e3),window.transition=function(){b.datum(randomize).call(chart)}})