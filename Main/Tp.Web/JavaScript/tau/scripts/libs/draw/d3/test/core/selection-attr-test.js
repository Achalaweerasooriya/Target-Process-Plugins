require("../env");var vows=require("vows"),assert=require("assert"),suite=vows.describe("selection.attr");suite.addBatch({"select(body)":{topic:function(){return d3.select("body")},"sets an attribute as a string":function(a){a.attr("bgcolor","red"),assert.equal(document.body.getAttribute("bgcolor"),"red")},"sets an attribute as a number":function(a){a.attr("opacity",1),assert.equal(document.body.getAttribute("opacity"),"1")},"sets an attribute as a function":function(a){a.attr("bgcolor",function(){return"orange"}),assert.equal(document.body.getAttribute("bgcolor"),"orange")},"sets an attribute as a function of data":function(a){a.data(["cyan"]).attr("bgcolor",String),assert.equal(document.body.getAttribute("bgcolor"),"cyan")},"sets an attribute as a function of index":function(a){a.attr("bgcolor",function(a,b){return"orange-"+b}),assert.equal(document.body.getAttribute("bgcolor"),"orange-0")},"sets a namespaced attribute as a string":function(a){a.attr("xlink:href","url"),assert.equal(document.body.getAttributeNS("http://www.w3.org/1999/xlink","href"),"url")},"sets a namespaced attribute as a function":function(a){a.data(["orange"]).attr("xlink:href",function(a,b){return a+"-"+b}),assert.equal(document.body.getAttributeNS("http://www.w3.org/1999/xlink","href"),"orange-0")},"gets an attribute value":function(a){document.body.setAttribute("bgcolor","yellow"),assert.equal(a.attr("bgcolor"),"yellow")},"gets a namespaced attribute value":function(a){document.body.setAttributeNS("http://www.w3.org/1999/xlink","foo","bar"),assert.equal(a.attr("xlink:foo"),"bar")},"removes an attribute as null":function(a){a.attr("bgcolor","red").attr("bgcolor",null),assert.equal(a.attr("bgcolor"),"")},"removes an attribute as a function":function(a){a.attr("bgcolor","red").attr("bgcolor",function(){return null}),assert.equal(a.attr("bgcolor"),"")},"removes a namespaced attribute as null":function(a){a.attr("xlink:href","url").attr("xlink:href",null),assert.equal(a.attr("bgcolor"),"")},"removes a namespaced attribute as a function":function(a){a.attr("xlink:href","url").attr("xlink:href",function(){return null}),assert.equal(a.attr("xlink:href"),"")},"returns the current selection":function(a){assert.isTrue(a.attr("foo","bar")===a)}}}),suite.addBatch({"selectAll(div)":{topic:function(){return d3.select("body").html("").selectAll("div").data(d3.range(2)).enter().append("div")},"sets an attribute as a string":function(a){a.attr("bgcolor","red"),assert.equal(a[0][0].getAttribute("bgcolor"),"red"),assert.equal(a[0][1].getAttribute("bgcolor"),"red")},"sets an attribute as a number":function(a){a.attr("opacity",.4),assert.equal(a[0][0].getAttribute("opacity"),"0.4"),assert.equal(a[0][1].getAttribute("opacity"),"0.4")},"sets an attribute as a function":function(a){a.attr("bgcolor",function(){return"coral"}),assert.equal(a[0][0].getAttribute("bgcolor"),"coral"),assert.equal(a[0][1].getAttribute("bgcolor"),"coral")},"sets an attribute as a function of data":function(a){a.attr("bgcolor",d3.interpolateRgb("brown","steelblue")),assert.equal(a[0][0].getAttribute("bgcolor"),"#a52a2a"),assert.equal(a[0][1].getAttribute("bgcolor"),"#4682b4")},"sets an attribute as a function of index":function(a){a.attr("bgcolor",function(a,b){return"color-"+b}),assert.equal(a[0][0].getAttribute("bgcolor"),"color-0"),assert.equal(a[0][1].getAttribute("bgcolor"),"color-1")},"sets a namespaced attribute as a string":function(a){a.attr("xlink:href","url"),assert.equal(a[0][0].getAttributeNS("http://www.w3.org/1999/xlink","href"),"url"),assert.equal(a[0][1].getAttributeNS("http://www.w3.org/1999/xlink","href"),"url")},"sets a namespaced attribute as a function":function(a){a.data(["red","blue"]).attr("xlink:href",function(a,b){return a+"-"+b}),assert.equal(a[0][0].getAttributeNS("http://www.w3.org/1999/xlink","href"),"red-0"),assert.equal(a[0][1].getAttributeNS("http://www.w3.org/1999/xlink","href"),"blue-1")},"gets an attribute value":function(a){a[0][0].setAttribute("bgcolor","purple"),assert.equal(a.attr("bgcolor"),"purple")},"gets a namespaced attribute value":function(a){a[0][0].setAttributeNS("http://www.w3.org/1999/xlink","foo","bar"),assert.equal(a.attr("xlink:foo"),"bar")},"removes an attribute as null":function(a){a.attr("href","url").attr("href",null),assert.equal(a[0][0].getAttribute("href"),""),assert.equal(a[0][1].getAttribute("href"),"")},"removes an attribute as a function":function(a){a.attr("href","url").attr("href",function(){return null}),assert.equal(a[0][0].getAttribute("href"),""),assert.equal(a[0][1].getAttribute("href"),"")},"removes a namespaced attribute as null":function(a){a.attr("xlink:foo","bar").attr("xlink:foo",null),assert.equal(a[0][0].getAttributeNS("http://www.w3.org/1999/xlink","foo"),""),assert.equal(a[0][1].getAttributeNS("http://www.w3.org/1999/xlink","foo"),"")},"removes a namespaced attribute as a function":function(a){a.attr("xlink:foo","bar").attr("xlink:foo",function(){return null}),assert.equal(a[0][0].getAttributeNS("http://www.w3.org/1999/xlink","foo"),""),assert.equal(a[0][1].getAttributeNS("http://www.w3.org/1999/xlink","foo"),"")},"ignores null nodes":function(a){var b=d3.selectAll("div");b[0][1]=null,b.attr("href",null).attr("href","url"),assert.equal(a[0][0].getAttribute("href"),"url"),assert.equal(a[0][1].getAttribute("href"),"")},"returns the current selection":function(a){assert.isTrue(a.attr("foo","bar")===a)}}}),suite.export(module)