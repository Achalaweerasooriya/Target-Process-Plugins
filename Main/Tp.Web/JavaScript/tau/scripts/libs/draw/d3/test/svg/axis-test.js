require("../env");var vows=require("vows"),assert=require("assert"),suite=vows.describe("d3.svg.axis");suite.addBatch({axis:{topic:function(){return d3.svg.axis},scale:{"defaults to a linear scale":function(a){var b=a(),c=b.scale();assert.deepEqual(c.domain(),[0,1]),assert.deepEqual(c.range(),[0,1]),assert.equal(c(.5),.5)},"can be defined as a scale object":function(a){var b=d3.scale.linear(),c=a().scale(b);assert.equal(c.scale(),b)},"can be a polylinear scale":function(a){var b=a().scale(d3.scale.linear().domain([0,1,10]).range([2,20,200])),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("path");assert.equal(d.attr("d"),"M2,6V0H200V6")},"can be an ordinal scale":function(a){var b=a().scale(d3.scale.ordinal().domain(["A","B","C"]).rangeBands([10,90])),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("path");assert.equal(d.attr("d"),"M10,6V0H90V6")},"can be an ordinal scale with explicit range":function(a){var b=a().scale(d3.scale.ordinal().domain(["A","B","C"]).range([10,50,90])),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("path");assert.equal(d.attr("d"),"M10,6V0H90V6")}},orient:{"defaults to bottom":function(a){var b=a();assert.equal(b.orient(),"bottom")},"supports top orientation":function(a){var b=a().orient("top"),c=d3.select("body").html("").append("svg:g").call(b),d=c.select("g:nth-child(3)"),e=d.select("text"),f=d.select("line"),g=c.select("path.domain");assert.equal(d.attr("transform"),"translate(0.2,0)"),assert.equal(e.attr("y"),-9),assert.equal(e.attr("dy"),"0em"),assert.equal(e.attr("text-anchor"),"middle"),assert.equal(e.text(),"0.2"),assert.equal(f.attr("y2"),-6),assert.equal(g.attr("d"),"M0,-6V0H1V-6")},"supports right orientation":function(a){var b=a().orient("right"),c=d3.select("body").html("").append("svg:g").call(b),d=c.select("g:nth-child(3)"),e=d.select("text"),f=d.select("line"),g=c.select("path.domain");assert.equal(d.attr("transform"),"translate(0,0.2)"),assert.equal(e.attr("x"),9),assert.equal(e.attr("dy"),".32em"),assert.equal(e.attr("text-anchor"),"start"),assert.equal(e.text(),"0.2"),assert.equal(f.attr("x2"),6),assert.equal(g.attr("d"),"M6,0H0V1H6")},"supports bottom orientation":function(a){var b=a().orient("bottom"),c=d3.select("body").html("").append("svg:g").call(b),d=c.select("g:nth-child(3)"),e=d.select("text"),f=d.select("line"),g=c.select("path.domain");assert.equal(d.attr("transform"),"translate(0.2,0)"),assert.equal(e.attr("y"),9),assert.equal(e.attr("dy"),".71em"),assert.equal(e.attr("text-anchor"),"middle"),assert.equal(e.text(),"0.2"),assert.equal(f.attr("y2"),6),assert.equal(g.attr("d"),"M0,6V0H1V6")},"supports left orientation":function(a){var b=a().orient("left"),c=d3.select("body").html("").append("svg:g").call(b),d=c.select("g:nth-child(3)"),e=d.select("text"),f=d.select("line"),g=c.select("path.domain");assert.equal(d.attr("transform"),"translate(0,0.2)"),assert.equal(e.attr("x"),-9),assert.equal(e.attr("dy"),".32em"),assert.equal(e.attr("text-anchor"),"end"),assert.equal(e.text(),"0.2"),assert.equal(f.attr("x2"),-6),assert.equal(g.attr("d"),"M-6,0H0V1H-6")}},tickSize:{"defaults to six pixels":function(a){var b=a();assert.equal(b.tickSize(),6)},"can be defined as a number":function(a){var b=a().tickSize(3);assert.equal(b.tickSize(),3)},"coerces input value to a number":function(a){var b=a().tickSize("3");assert.strictEqual(b.tickSize(),3)},"affects the generated domain path":function(a){var b=a().tickSize(3),c=d3.select("body").html("").append("svg:g").call(b),d=c.select("path.domain");assert.equal(d.attr("d"),"M0,3V0H1V3")},"affects the generated tick lines":function(a){var b=a().tickSize(3),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g line");d.each(function(){assert.equal(d3.select(this).attr("y2"),3)})},"if negative, labels are placed on the opposite end":function(a){var b=a().tickSize(-80),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g line"),e=c.selectAll("g text");d.each(function(){assert.equal(d3.select(this).attr("y2"),-80)}),e.each(function(){assert.equal(d3.select(this).attr("y"),3)})},"with two arguments, specifies end tick size":function(a){var b=a().tickSize(6,3),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("path");assert.equal(d.attr("d"),"M0,3V0H1V3")},"with three arguments, specifies end and minor tick sizes":function(a){var b=a().tickSubdivide(3).tickSize(6,3,9),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("path"),e=c.select(".minor");assert.equal(d.attr("d"),"M0,9V0H1V9"),assert.equal(e.attr("y2"),"3")}},tickPadding:{"defaults to three pixels":function(a){var b=a();assert.equal(b.tickPadding(),3)},"can be defined as a number":function(a){var b=a().tickPadding(6);assert.equal(b.tickPadding(),6)},"coerces input value to a number":function(a){var b=a().tickPadding("6");assert.strictEqual(b.tickPadding(),6)},"affects the generated tick labels":function(a){var b=a().tickSize(2).tickPadding(7),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g text");d.each(function(){assert.equal(d3.select(this).attr("y"),9)})}},ticks:{"defaults to [10]":function(a){var b=a();assert.deepEqual(b.ticks(),[10])},"can be defined as any arguments":function(a){var b={},c=a().ticks(b,42),d=c.ticks();assert.equal(d[0],b),assert.equal(d[1],42),assert.equal(d.length,2)},"passes any arguments to the scale's ticks function":function(a){var b=d3.scale.linear(),c={},d=a().ticks(c,42).scale(b),e=[],f=d3.select("body").html("").append("svg:g");b.ticks=function(){return e.push(arguments),[42]},f.call(d),assert.equal(e.length,1),assert.equal(e[0].length,2),assert.equal(e[0][0],c),assert.equal(e[0][1],42)},"passes any arguments to the scale's tickFormat function":function(a){var b={},c=d3.scale.linear(),d=a().scale(c).ticks(b,42),e=d3.select("body").html("").append("svg:g"),f=[];c.tickFormat=function(){return f.push(arguments),String},e.call(d),assert.equal(f.length,1),assert.equal(f[0].length,2),assert.equal(f[0][0],b),assert.equal(f[0][1],42)},"affects the generated ticks":function(a){var b=a().ticks(20),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g");assert.equal(d[0].length,21)}},tickValues:{"defaults to null":function(a){var b=a().tickValues();assert.isNull(b)},"can be given as array of positions":function(a){var b=[1,2.5,3],c=a().tickValues(b),d=c.tickValues();assert.equal(d,b),assert.equal(d.length,3)},"does not change the tick arguments":function(a){var b={},c=a().ticks(b,42).tickValues([10]),d=c.ticks();assert.equal(d[0],b),assert.equal(d[1],42),assert.equal(d.length,2)},"does not change the arguments passed to the scale's tickFormat function":function(a){var b=d3.scale.linear(),c=a().scale(b).ticks(10).tickValues([1,2,3]),d=d3.select("body").html("").append("svg:g"),e=[];b.tickFormat=function(){return e.push(arguments),String},d.call(c),assert.equal(e.length,1),assert.equal(e[0].length,1),assert.equal(e[0][0],10)},"affects the generated ticks":function(a){var b=a().ticks(20),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g");assert.equal(d[0].length,21)}},tickSubdivide:{"defaults to zero":function(a){var b=a();assert.equal(b.tickSubdivide(),0)},"coerces input value to a number":function(a){var b=a().tickSubdivide(!0);assert.strictEqual(b.tickSubdivide(),1)},"does not generate minor ticks when zero":function(a){var b=d3.select("body").html("").append("svg:g").call(a());assert.isTrue(b.selectAll(".minor").empty())},"affects the generated minor ticks":function(a){var b=a().tickSubdivide(3),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("line.tick.minor");assert.equal(d[0].length,30),assert.equal(d[0][1].getAttribute("transform"),"translate(0.05,0)")}},tickFormat:{"defaults to null":function(a){var b=a();assert.isTrue(b.tickFormat()==null)},"when null, uses the scale's tick format":function(a){var b=d3.scale.linear(),c=a().scale(b),d=d3.select("body").html("").append("svg:g");b.tickFormat=function(){return function(a){return"foo-"+a}},d.call(c);var e=d.selectAll("g text");assert.equal(e.text(),"foo-0")},"affects the generated tick labels":function(a){var b=a().tickFormat(d3.format("+.2%")),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g text");assert.equal(d.text(),"+0.00%")},"can be set to a constant":function(a){var b=a().tickFormat("I'm a tick!"),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g text");assert.equal(d.text(),"I'm a tick!")},"can be set to a falsey constant":function(a){var b=a().tickFormat(""),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("g text");assert.equal(d.text(),"")}},enter:{"generates a new domain path":function(a){var b=a(),c=d3.select("body").html("").append("svg:g").call(b),d=c.selectAll("path.domain");assert.equal(d[0].length,1),assert.equal(d.attr("d"),"M0,6V0H1V6"),assert.isNull(d.node().nextSibling)},"generates new tick marks with labels":function(a){var b=a(),c=d3.select("body").html("").append("svg:g").call(b),d=d3.scale.linear(),e=c.selectAll("g"),f=d.ticks(10),g=d.tickFormat(10);assert.equal(e[0].length,f.length),e.each(function(a,b){var c=d3.select(this);assert.isFalse(c.select("line").empty()),assert.isFalse(c.select("text").empty()),assert.equal(c.select("text").text(),g(f[b]))})}},update:{"updates the domain path":function(a){var b=a(),c=d3.select("body").html("").append("svg:g").call(b);b.scale().domain([0,2]).range([1,2]),b.tickSize(3),c.call(b);var d=c.selectAll("path.domain");assert.equal(d[0].length,1),assert.equal(d.attr("d"),"M1,3V0H2V3"),assert.domEqual(d.node().nextSibling,null)},"enters, exits and updates tick marks":function(a){var b=a(),c=d3.select("body").html("").append("svg:g").call(b),d=d3.scale.linear().domain([1,1.5]);b.scale().domain(d.domain()),b.tickSize(3).tickPadding(9),c.call(b);var e=c.selectAll("g"),f=d.ticks(10),g=d.tickFormat(10);assert.equal(e[0].length,f.length),e.each(function(a,b){var c=d3.select(this);assert.isFalse(c.select("line").empty()),assert.isFalse(c.select("text").empty()),assert.equal(c.select("text").text(),g(f[b]))})}}}}),suite.export(module)