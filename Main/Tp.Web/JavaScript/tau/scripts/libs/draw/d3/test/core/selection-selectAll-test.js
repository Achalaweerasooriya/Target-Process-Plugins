require("../env");var vows=require("vows"),assert=require("assert"),suite=vows.describe("selection.selectAll");suite.addBatch({"select(body)":{topic:function(){var a=d3.select("body").html("");return"__data__"in a[0][0]&&delete a[0][0].__data__,a.append("div").attr("class","first"),a.append("div").attr("class","second"),a},"selects all matching elements":function(a){var b=a.selectAll("div");assert.isTrue(b[0][0]===document.body.firstChild),assert.isTrue(b[0][1]===document.body.lastChild),assert.equal(b.length,1),assert.equal(b[0].length,2)},"propagates parent node to the selected elements":function(a){var b=a.selectAll("div");assert.isNotNull(b[0].parentNode),assert.isTrue(b[0].parentNode===document.body)},"does not propagate data if data was specified":function(a){var b=a.data([new Object]).selectAll("div");assert.isUndefined(b[0][0].__data__),assert.isUndefined(b[0][1].__data__)},"does not propagate data if data was not specified":function(a){var b=a.selectAll("div").data([1,2]);b=a.data([new Object]).selectAll("div"),assert.equal(b[0][0].__data__,1),assert.equal(b[0][1].__data__,2)},"returns empty array if no match is found":function(a){var b=a.selectAll("span");assert.equal(b.length,1),assert.equal(b[0].length,0)},"can select via function":function(a){var b={},c=[],d=[],e=[],f=a.data([b]).selectAll(function(a,b){return c.push(a),d.push(b),e.push(this),this.childNodes});assert.deepEqual(c,[b],"expected data, got {actual}"),assert.deepEqual(d,[0],"expected index, got {actual}"),assert.domEqual(e[0],document.body,"expected this, got {actual}"),assert.domEqual(f[0][0],document.body.firstChild),assert.domEqual(f[0][1],document.body.lastChild),delete document.body.__data__}}}),suite.addBatch({"selectAll(div)":{topic:function(){var a=d3.select("body").html("").selectAll("div").data(d3.range(2)).enter().append("div");return a.append("span").attr("class","first"),a.append("span").attr("class","second"),a},"selects all matching elements":function(a){var b=a.selectAll("span");assert.equal(b.length,2),assert.equal(b[0].length,2),assert.isTrue(b[0][0].parentNode===a[0][0]),assert.isTrue(b[0][1].parentNode===a[0][0]),assert.isTrue(b[1][0].parentNode===a[0][1]),assert.isTrue(b[1][1].parentNode===a[0][1])},"propagates parent node to the selected elements":function(a){var b=a.selectAll("span");assert.isNotNull(b[0].parentNode),assert.isTrue(b[0].parentNode===a[0][0]),assert.isTrue(b[1].parentNode===a[0][1])},"does not propagate data if data was specified":function(a){var b=a.selectAll("span");delete b[0][0].__data__,delete b[0][1].__data__,b=a.data([new Object,new Object]).selectAll("span"),assert.isUndefined(b[0][0].__data__),assert.isUndefined(b[0][1].__data__)},"does not propagate data if data was not specified":function(a){var b=new Object,c=new Object,d=a.selectAll("span").data([b,c]);delete a[0][0].__data__,delete a[0][1].__data__,d=a.selectAll("span"),assert.equal(d[0][0].__data__,b),assert.equal(d[0][1].__data__,c)},"returns empty array if no match is found":function(a){var a=a.selectAll("div");assert.equal(a.length,2),assert.equal(a[0].length,0),assert.equal(a[1].length,0)},"ignores null nodes":function(a){var b=d3.selectAll("div");b[0][1]=null;var c=b.selectAll("span");assert.equal(c.length,1),assert.equal(c[0].length,2),assert.isTrue(c[0][0].parentNode===a[0][0]),assert.isTrue(c[0][1].parentNode===a[0][0])},"can select via function":function(a){var b=[],c=[],d=[],e=a.data(["a","b"]).selectAll(function(a,e){return b.push(a),c.push(e),d.push(this),this.childNodes});assert.deepEqual(b,["a","b"],"expected data, got {actual}"),assert.deepEqual(c,[0,1],"expected index, got {actual}"),assert.domEqual(d[0],a[0][0],"expected this, got {actual}"),assert.domEqual(d[1],a[0][1],"expected this, got {actual}"),assert.domEqual(e[0][0],a[0][0].firstChild),assert.domEqual(e[0][1],a[0][0].lastChild),assert.domEqual(e[1][0],a[0][1].firstChild),assert.domEqual(e[1][1],a[0][1].lastChild)}}}),suite.export(module)