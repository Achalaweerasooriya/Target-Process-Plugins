function horizonChart(){function l(l){l.each(function(l,m){var n=d3.select(this),o=2*a+1,p=Infinity,q=-Infinity,r=-Infinity,s,t,u,v=l.map(function(a,b){var c=d.call(this,a,b),f=e.call(this,a,b);return c<p&&(p=c),c>q&&(q=c),-f>r&&(r=-f),f>r&&(r=f),[c,f]}),z=d3.scale.linear().domain([p,q]).range([0,f]),A=d3.scale.linear().domain([0,r]).range([0,g*a]);this.__chart__?(s=this.__chart__.x,t=this.__chart__.y,u=this.__chart__.id):(s=d3.scale.linear().domain([0,Infinity]).range(z.range()),t=d3.scale.linear().domain([0,Infinity]).range(A.range()),u=++h);var B=n.selectAll("defs").data([v]),C=B.enter().append("svg:defs");C.append("svg:clipPath").attr("id","horizon_clip"+u).append("svg:rect").attr("width",f).attr("height",g),B.select("rect").transition().duration(j).attr("width",f).attr("height",g),C.append("svg:path").attr("id","horizon_path"+u).attr("d",i.interpolate(c).x(function(a){return s(a[0])}).y0(g*a).y1(function(b){return g*a-t(b[1])})).transition().duration(j).attr("d",i.x(function(a){return z(a[0])}).y1(function(b){return g*a-A(b[1])})),B.select("path").transition().duration(j).attr("d",i),n.selectAll("g").data([null]).enter().append("svg:g").attr("clip-path","url(#horizon_clip"+u+")");var D=b=="offset"?function(b){return"translate(0,"+(b+(b<0)-a)*g+")"}:function(b){return(b<0?"scale(1,-1)":"")+"translate(0,"+(b-a)*g+")"},E=n.select("g").selectAll("use").data(d3.range(-1,-a-1,-1).concat(d3.range(1,a+1)),Number);E.enter().append("svg:use").attr("xlink:href","#horizon_path"+u).attr("transform",function(a){return D(a+(a>0?1:-1))}).style("fill",k).transition().duration(j).attr("transform",D),E.transition().duration(j).attr("transform",D).style("fill",k),E.exit().transition().duration(j).attr("transform",D).remove(),this.__chart__={x:z,y:A,id:u}}),d3.timer.flush()}var a=1,b="offset",c="linear",d=horizonX,e=horizonY,f=960,g=40,h=0,i=d3.svg.area(),j=0,k=d3.scale.linear().domain([-1,0,1]).range(["#d62728","#fff","#1f77b4"]);return l.duration=function(a){return arguments.length?(j=+a,l):j},l.bands=function(b){return arguments.length?(a=+b,k.domain([-a,0,a]),l):a},l.mode=function(a){return arguments.length?(b=a+"",l):b},l.colors=function(a){return arguments.length?(k.range(a),l):k.range()},l.interpolate=function(a){return arguments.length?(c=a+"",l):c},l.x=function(a){return arguments.length?(d=a,l):d},l.y=function(a){return arguments.length?(e=a,l):e},l.width=function(a){return arguments.length?(f=+a,l):f},l.height=function(a){return arguments.length?(g=+a,l):g},l}function horizonX(a){return a[0]}function horizonY(a){return a[1]}var w=960,h=40,chart=horizonChart().width(w).height(h).bands(5).mode("offset").interpolate("basis"),svg=d3.select("#chart").append("svg").attr("width",w).attr("height",h);d3.json("unemployment.json",function(a){var b=a.rate.reduce(function(a,b){return a+b},0)/a.rate.length;a=a.rate.map(function(c,d){return[Date.UTC(a.year[d],a.month[d]-1),c-b]}),svg.data([a]).call(chart),d3.selectAll("#mode button").data(["offset","mirror"]).on("click",function(a){svg.call(chart.duration(0).mode(a)),d3.selectAll("#mode button").classed("active",function(b){return b==a})}),d3.selectAll("#bands button").data([-1,1]).on("click",function(b){svg.call(chart.duration(1e3).bands(Math.max(1,chart.bands()+b)))})})