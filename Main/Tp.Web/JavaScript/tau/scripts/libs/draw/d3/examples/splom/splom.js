d3.json("flowers.json",function(a){function k(d){var g=d3.select(this);g.append("rect").attr("class","frame").attr("x",c/2).attr("y",c/2).attr("width",b-c).attr("height",b-c),g.selectAll("circle").data(a.values).enter().append("circle").attr("class",function(a){return a.species}).attr("cx",function(a){return e[d.x](a[d.x])}).attr("cy",function(a){return f[d.y](a[d.y])}).attr("r",3),g.call(h.x(e[d.x]).y(f[d.y]))}function l(a){h.data!==a&&(j.call(h.clear()),h.x(e[a.x]).y(f[a.y]).data=a)}function h(a){var b=h.extent();i.selectAll("circle").attr("class",function(c){return b[0][0]<=c[a.x]&&c[a.x]<=b[1][0]&&b[0][1]<=c[a.y]&&c[a.y]<=b[1][1]?c.species:null})}function m(){h.empty()&&i.selectAll("circle").attr("class",function(a){return a.species})}function n(a,b){var c=[],d=a.length,e=b.length,f,g;for(f=-1;++f<d;)for(g=-1;++g<e;)c.push({x:a[f],i:f,y:b[g],j:g});return c}var b=150,c=19.5,d=a.traits.length,e={},f={};a.traits.forEach(function(d){var g=function(a){return a[d]},h=[d3.min(a.values,g),d3.max(a.values,g)],i=[c/2,b-c/2];e[d]=d3.scale.linear().domain(h).range(i),f[d]=d3.scale.linear().domain(h).range(i.slice().reverse())});var g=d3.svg.axis().ticks(5).tickSize(b*d),h=d3.svg.brush().on("brushstart",l).on("brush",h).on("brushend",m),i=d3.select("#chart").append("svg").attr("width",b*d+c).attr("height",b*d+c);i.selectAll("g.x.axis").data(a.traits).enter().append("g").attr("class","x axis").attr("transform",function(a,c){return"translate("+c*b+",0)"}).each(function(a){d3.select(this).call(g.scale(e[a]).orient("bottom"))}),i.selectAll("g.y.axis").data(a.traits).enter().append("g").attr("class","y axis").attr("transform",function(a,c){return"translate(0,"+c*b+")"}).each(function(a){d3.select(this).call(g.scale(f[a]).orient("right"))});var j=i.selectAll("g.cell").data(n(a.traits,a.traits)).enter().append("g").attr("class","cell").attr("transform",function(a){return"translate("+a.i*b+","+a.j*b+")"}).each(k);j.filter(function(a){return a.i==a.j}).append("text").attr("x",c).attr("y",c).attr("dy",".71em").text(function(a){return a.x})})