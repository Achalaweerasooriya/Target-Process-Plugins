function randomize(a){return a.y=d3.range(n).map(Math.random),a}function qqChart(){function i(i){i.each(function(i,j){var k=d3.select(this),l=qqQuantiles(f,g.call(this,i,j)),m=qqQuantiles(f,h.call(this,i,j)),o=d&&d.call(this,i,j)||[d3.min(l),d3.max(l)],p=d&&d.call(this,i,j)||[d3.min(m),d3.max(m)],q,r,s=d3.scale.linear().domain(o).range([0,a]),t=d3.scale.linear().domain(p).range([b,0]);this.__chart__?(q=this.__chart__.x,r=this.__chart__.y):(q=d3.scale.linear().domain([0,Infinity]).range(s.range()),r=d3.scale.linear().domain([0,Infinity]).range(t.range())),this.__chart__={x:s,y:t};var u=k.selectAll("line.diagonal").data([null]);u.enter().append("svg:line").attr("class","diagonal").attr("x1",s(p[0])).attr("y1",t(o[0])).attr("x2",s(p[1])).attr("y2",t(o[1])),u.transition().duration(c).attr("x1",s(p[0])).attr("y1",t(o[0])).attr("x2",s(p[1])).attr("y2",t(o[1]));var v=k.selectAll("circle").data(d3.range(f).map(function(a){return{x:l[a],y:m[a]}}));v.enter().append("svg:circle").attr("class","quantile").attr("r",4.5).attr("cx",function(a){return q(a.x)}).attr("cy",function(a){return r(a.y)}).style("opacity",1e-6).transition().duration(c).attr("cx",function(a){return s(a.x)}).attr("cy",function(a){return t(a.y)}).style("opacity",1),v.transition().duration(c).attr("cx",function(a){return s(a.x)}).attr("cy",function(a){return t(a.y)}).style("opacity",1),v.exit().transition().duration(c).attr("cx",function(a){return s(a.x)}).attr("cy",function(a){return t(a.y)}).style("opacity",1e-6).remove();var w=e||s.tickFormat(4),z=e||t.tickFormat(4),A=function(a){return"translate("+s(a)+","+b+")"},B=function(a){return"translate(0,"+t(a)+")"},C=k.selectAll("g.x.tick").data(s.ticks(4),function(a){return this.textContent||w(a)}),D=C.enter().append("svg:g").attr("class","x tick").attr("transform",function(a){return"translate("+q(a)+","+b+")"}).style("opacity",1e-6);D.append("svg:line").attr("y1",0).attr("y2",-6),D.append("svg:text").attr("text-anchor","middle").attr("dy","1em").text(w),D.transition().duration(c).attr("transform",A).style("opacity",1),C.transition().duration(c).attr("transform",A).style("opacity",1),C.exit().transition().duration(c).attr("transform",A).style("opacity",1e-6).remove();var E=k.selectAll("g.y.tick").data(t.ticks(4),function(a){return this.textContent||z(a)}),F=E.enter().append("svg:g").attr("class","y tick").attr("transform",function(a){return"translate(0,"+r(a)+")"}).style("opacity",1e-6);F.append("svg:line").attr("x1",0).attr("x2",6),F.append("svg:text").attr("text-anchor","end").attr("dx","-.5em").attr("dy",".3em").text(z),F.transition().duration(c).attr("transform",B).style("opacity",1),E.transition().duration(c).attr("transform",B).style("opacity",1),E.exit().transition().duration(c).attr("transform",B).style("opacity",1e-6).remove()})}var a=1,b=1,c=0,d=null,e=null,f=100,g=qqX,h=qqY;return i.width=function(b){return arguments.length?(a=b,i):a},i.height=function(a){return arguments.length?(b=a,i):b},i.duration=function(a){return arguments.length?(c=a,i):c},i.domain=function(a){return arguments.length?(d=a==null?a:d3.functor(a),i):d},i.count=function(a){return arguments.length?(f=a,i):f},i.x=function(a){return arguments.length?(g=a,i):g},i.y=function(a){return arguments.length?(h=a,i):h},i.tickFormat=function(a){return arguments.length?(e=a,i):e},i}function qqQuantiles(a,b){var c=b.length-1;return b=b.slice().sort(d3.ascending),d3.range(a).map(function(d){return b[~~(d*c/a)]})}function qqX(a){return a.x}function qqY(a){return a.y}var w=280,h=280,m=[10,0,20,35],n=1e4,chart=qqChart().width(w).height(h).domain([-0.1,1.1]).tickFormat(function(a){return~~(a*100)}),vis=d3.select("#chart").append("svg").append("g").attr("transform","translate("+m[3]+","+m[0]+")");d3.json("turkers.json",function(a){var b=science.stats.mean(a),c=Math.sqrt(science.stats.variance(a)),d=[[.10306430789206111,.0036139086950272735,.30498647327844536],[.5924252668569606,.0462763685758622,.4340870312025223],[.9847627827855167,.0002352350767874714,.2609264955190324]],e=vis.selectAll("g").data([{x:d3.range(n).map(Math.random),y:a,label:"Uniform Distribution"},{x:d3.range(n).map(normal1(b,c)),y:a,label:"Gaussian (Normal) Distribution"},{x:d3.range(n).map(normal3(d)),y:a,label:"Mixture of 3 Gaussians"}]).enter().append("g").attr("class","qq").attr("transform",function(a,b){return"translate("+(w+m[1]+m[3])*b+")"});e.append("rect").attr("class","box").attr("width",w).attr("height",h),e.call(chart),e.append("text").attr("dy","1.3em").attr("dx",".6em").text(function(a){return a.label}),chart.duration(1e3),window.transition=function(){e.datum(randomize).call(chart)}})