function update(){vis.select("path").attr("d",line);var a=vis.selectAll("circle").data(points,function(a){return a});a.enter().append("circle").attr("r",1e-6).on("mousedown",function(a){selected=dragged=a,update()}).transition().duration(750).ease("elastic").attr("r",6.5),a.classed("selected",function(a){return a===selected}).attr("cx",function(a){return a[0]}).attr("cy",function(a){return a[1]}),a.exit().remove(),d3.event&&(d3.event.preventDefault(),d3.event.stopPropagation())}function mousemove(){if(!dragged)return;var a=d3.mouse(vis.node());dragged[0]=Math.max(0,Math.min(w,a[0])),dragged[1]=Math.max(0,Math.min(h,a[1])),update()}function mouseup(){if(!dragged)return;mousemove(),dragged=null}function keydown(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=points.indexOf(selected);points.splice(a,1),selected=points.length?points[a>0?a-1:0]:null,update()}}var w=960,h=500,line=d3.svg.line(),points=d3.range(1,5).map(function(a){return[a*w/5,50+Math.random()*(h-100)]}),dragged=null,selected=points[0],vis=d3.select("#chart").append("svg").attr("width",w).attr("height",h);vis.append("rect").attr("width",w).attr("height",h).on("mousedown",function(){points.push(selected=dragged=d3.mouse(vis.node())),update()}),vis.append("path").data([points]).attr("class","line").call(update),d3.select(window).on("mousemove",mousemove).on("mouseup",mouseup).on("keydown",keydown),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),update()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String)