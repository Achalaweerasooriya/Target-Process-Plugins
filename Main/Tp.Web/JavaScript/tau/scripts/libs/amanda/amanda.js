define([],function(){return function(){var isObject=function(input){return Object.prototype.toString.call(input)==="[object Object]"},isArray=function(input){return Object.prototype.toString.call(input)==="[object Array]"},isEmpty=function(input){if(isArray(input)||typeof input=="string")return input.length===0;if(isObject(input))for(var key in input)if(input.hasOwnProperty(key))return!1;return!0},merge=function(obj1,obj2){for(var key in obj2)obj2.hasOwnProperty(key)&&!obj1.hasOwnProperty(key)&&(obj1[key]=obj2[key]);return obj1},each=function(list,iterator,callback){var syncEach=function(list,iterator){if(isArray(list)&&!isEmpty(list))for(var i=0,len=list.length;i<len;i++)iterator.apply(list,[i,list[i]]);if(isObject(list)&&!isEmpty(list))for(var key in list)list.hasOwnProperty(key)&&iterator.apply(list,[key,list[key]])},asyncEach=function(list,iterator,callback){var queue=[],addToQueue=function(key,value){var index=queue.length+1;queue.push(function(){var next=function(error){var fn=queue[index];return!error&&fn?fn():!error&&!fn?callback():callback(error)};return iterator(key,value,next)})};if(isArray(list)&&!isEmpty(list))for(var i=0,len=list.length;i<len;i++)addToQueue(i,list[i]);else{if(!isObject(list)||!!isEmpty(list))return callback();for(var key in list)list.hasOwnProperty(key)&&addToQueue(key,list[key])}return queue[0]()};return typeof callback=="undefined"?syncEach.apply(this,arguments):asyncEach.apply(this,arguments)},pluck=function(list,propertyName){var output=[];for(var i=0,len=list.length;i<len;i++){var property=list[i][propertyName];output.indexOf(property)===-1&&output.push(property)}return output},Error=function(){this.length=0};Error.prototype.addError=function(error){this[this.length]=error,this.length++},each({getProperties:"property",getMessages:"message"},function(key,value){Error.prototype[key]=function(){return pluck(this,value)}});var messages={required:"The ‘{{property}}’ property is required.",minLength:"The ‘{{property}}’ property must be at least {{validator}} characters.",maxLength:"The ‘{{property}}’ property must not exceed {{validator}} characters.",length:"The ‘{{property}}’ property must be exactly {{validator}} characters.",format:"The ‘{{property}}’ property must be a/an {{validator}}.",type:"The ‘{{property}}’ property must be a/an {{validator}}.",except:"The ‘{{property}}’ property must not be {{propertyValue}}",minimum:"The minimum value of the ‘{{property}}’ must be {{validator}}",maximum:"The maximum value of the ‘{{property}}’ must be {{validator}}",pattern:"The `{{property}}` does not match the ‘{{validator}}’ pattern.",maxItems:"The `{{property}}` property must not contain more than {{validator}} items.",minItems:"The `{{property}}` property must contain at least {{validator}} items.",divisibleBy:"The ‘{{property}}’ property is not divisible by {{validator}}.",uniqueItems:"All items in the ‘{{property}}’ property must be unique.","enum":function(property,propertyValue,validator){return"Value of the ‘"+property+"’ must be "+validator.join(" or ")+"."}},Validation=function(options){var self=this;this.singleError=options.hasOwnProperty("singleError")?options.singleError:!0,this.validators=validators,this.messages=options.messages?merge(options.messages,messages):messages,this.Errors=new Error};Validation.prototype.renderErrorMessage=function(validatorName,templateData){var errorMessage=this.messages[validatorName];return typeof errorMessage=="function"?errorMessage(templateData.property,templateData.propertyValue,templateData.validator):typeof errorMessage=="string"?(each(templateData,function(key,value){errorMessage=errorMessage.replace(new RegExp("{{"+key+"}}","g"),value)}),errorMessage.replace(/\s+/g," ")):""},Validation.prototype.validateProperty=function(property,propertyValue,propertyValidators,callback){var self=this,iterator=function(validatorName,validatorFn,callback){var onComplete=function(error){if(!error)return callback();var errorMessage=self.renderErrorMessage(validatorName,{property:property,propertyValue:propertyValue,validator:propertyValidators[validatorName]});return self.Errors.addError({property:property,propertyValue:propertyValue,validator:validatorName,validatorValue:propertyValidators[validatorName],message:errorMessage}),callback(self.singleError?!0:null)};return propertyValidators[validatorName]?validatorFn(property,propertyValue,propertyValidators[validatorName],propertyValidators,onComplete):callback()};return propertyValidators.required!==!0&&typeof propertyValue=="undefined"?callback():each(self.validators,iterator,callback)},Validation.prototype.validate=function(instance,schema,callback){var self=this;return this.Errors=new Error,this.validateSchema(instance,schema,"",function(error){return callback(self.Errors.length>0?self.Errors:undefined)})},Validation.prototype.validateProperties=function(instance,schema,path,callback){var self=this;return each(schema.properties,function(property,propertyValidators,callback){var isObject=propertyValidators.type==="object"&&propertyValidators.properties,isArray=propertyValidators.type==="array",propertyValue=self.getProperty(instance,property),propertyName=property.indexOf(" ")!==-1?"['"+property+"']":"."+property,propertyPath=path.length===0?property:path+propertyName;return isObject||isArray?self.validateSchema(propertyValue,schema.properties[property],propertyPath,callback):self.validateProperty(propertyPath,propertyValue,propertyValidators,callback)},callback)},Validation.prototype.validateItems=function(instance,schema,path,callback){var self=this;return instance&&!isEmpty(instance)?["object","array"].indexOf(schema.items.type)!==-1?each(instance,function(index,propertyValue,callback){var propertyPath=path+"["+index+"]";return self.validateSchema(propertyValue,schema.items,propertyPath,callback)},callback):each(instance,function(index,propertyValue,callback){var propertyPath=path+"["+index+"]";return self.validateProperty(propertyPath,propertyValue,schema.items,callback)},callback):callback()},Validation.prototype.validateSchema=function(instance,schema,path,callback){var self=this;return["object","array"].indexOf(schema.type)!==-1?self.validateProperty(path,instance,schema,function(error){return schema.properties?self.validateProperties(instance,schema,path,callback):schema.items?self.validateItems(instance,schema,path,callback):callback()}):self.validateProperty(path,instance,schema,callback)},Validation.prototype.getProperty=function(source,property){return source?source[property]:undefined};var validators={required:function(property,propertyValue,validator,propertyValidators,callback){return validator&&propertyValue===undefined?callback(!0):callback()},type:function(){var types={object:function(input){return Object.prototype.toString.call(input)==="[object Object]"},array:function(input){return Object.prototype.toString.call(input)==="[object Array]"},integer:function(input){return typeof input=="number"&&input%1===0}},ar=["string","number","function","boolean"];for(var i=0,c=ar.length;i<c;i++)types[ar[i]]=function(type){return function(){return typeof arguments[0]===type}}(ar[i]);return function(property,propertyValue,validator,propertyValidators,callback){if(Object.prototype.toString.call(validator)==="[object Array]"){var noError=validator.some(function(type){return types[type](propertyValue)});return noError?callback():callback(!0)}return types[validator](propertyValue)?callback():callback(!0)}}(),format:function(){var formats={alpha:function(input){return typeof input=="string"&&input.match(/^[a-zA-Z]+$/)},alphanumeric:function(input){return typeof input=="string"&&/^[a-zA-Z0-9]+$/.test(input)||typeof input=="number"},ipv4:function(input){return typeof input=="string"&&input.match(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)},ipv6:function(input){return typeof input=="string"&&input.match(/(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:(?:[a-f\d]{1,4}:)*[a-f\d]{1,4})?::(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))?)/)},ip:function(input){return formats.ipv4(input)||formats.ipv6},email:function(input){return typeof input=="string"&&input.match(/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/)},url:function(input){return typeof input=="string"&&input.match(/^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|cat|coop|int|pro|tel|xxx|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2})?)|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/)},date:function(input){return Object.prototype.toString.call(input)==="[object Date]"},decimal:function(input){return/^[0-9]+(\.[0-9]{1,2})?$/.test(input)},"int":function(input){return/^-?[0-9]+$/.test(input)},percentage:function(input){return typeof input=="string"&&input.match(/^-?[0-9]{0,2}(\.[0-9]{1,2})?$|^-?(100)(\.[0]{1,2})?$/)||input>=-100&&input<=100},port:function(input){return/\:\d+/.test(input)},regexp:function(input){return input&&input.test&&input.exec},unsignedInt:function(input){return/^[0-9]+$/.test(input)}};return function(property,propertyValue,validator,propertyValidators,callback){return formats[validator](propertyValue)?callback():callback(!0)}}(),minLength:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&propertyValue.length>=validator?callback():callback(!0)},maxLength:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&propertyValue.length<=validator?callback():callback(!0)},length:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&propertyValue.length===validator?callback():callback(!0)},"enum":function(property,propertyValue,validator,propertyValidators,callback){return validator.indexOf(propertyValue)===-1?callback(!0):callback()},except:function(property,propertyValue,validator,propertyValidators,callback){return validator.indexOf(propertyValue)!==-1?callback(!0):callback()},minimum:function(property,propertyValue,validator,propertyValidators,callback){if(typeof propertyValue=="number"){var condition=propertyValidators.exclusiveMinimum?propertyValue>validator:propertyValue>=validator;return condition?callback():callback(!0)}return callback(!0)},maximum:function(property,propertyValue,validator,propertyValidators,callback){if(typeof propertyValue=="number"){var condition=propertyValidators.exclusiveMaximum?propertyValue<validator:propertyValue<=validator;return condition?callback():callback(!0)}return callback(!0)},pattern:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&!propertyValue.match(validator)?callback(!0):callback()},minItems:function(property,propertyValue,validator,propertyValidators,callback){return isArray(propertyValue)&&propertyValue.length>=validator?callback():callback(!0)},maxItems:function(property,propertyValue,validator,propertyValidators,callback){return isArray(propertyValue)&&propertyValue.length<=validator?callback():callback(!0)},uniqueItems:function(property,propertyValue,validator,propertyValidators,callback){return each(propertyValue,function(index,value,callback){return propertyValue.indexOf(value)<index?callback(!0):callback()},callback)},divisibleBy:function(property,propertyValue,validator,propertyValidators,callback){var isNumber=typeof propertyValue=="number",isDivisible=propertyValue%validator===0;return isNumber&&isDivisible?callback():callback(!0)}},amanda={validate:function(instance,schema,options,callback){return typeof options=="function"&&(callback=options,options={}),(new Validation(options)).validate(instance,schema,callback)},addValidator:function(validatorName,validatorFn){validators[validatorName]=validatorFn},getVersion:function(){return[0,3,0].join(".")},getValidators:function(){return validators}};return Validation}()})