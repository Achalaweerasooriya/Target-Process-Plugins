define(["require","exports","module","./utils","./objecttools"],function(t,e,i){var n=t("./utils"),s=t("./objecttools");i.exports=function(){var t=this,e=this.Schema=function(t){return"string"==typeof t&&(t=JSON.parse(t)),t instanceof e?t:(n.extend(this,t),void 0===this.id&&(this.id=""+e._id++),void(e.instances[this.id]=this))};n.extend(e.prototype,{validate:function(e,i){var n=new t.Validation(this,e,i);return n.instance&&delete n.instance.__id,n},setFallbacks:function(e){return this.fallbacks="string"==typeof e?t.Validation[e]:void 0===e?t.fallbacks:n.extend({},t.fallbacks,e),this}}),n.extend(e,{_id:1,create:function(e){if("string"==typeof e)var e=JSON.parse(e);var i=t.schemaSchema.validate(e);if(i.isError())throw console.log(i.getError()),i.getError();return i.instance},createSeveral:function(t){for(var e in t)void 0===t[e].id&&(t[e].id=e),t[e]=this.create(t[e]);return t},instances:{},resolveRefs:function(){for(var t in this.instances)s.resolveRefs(this.instances[t],!0)}})}});