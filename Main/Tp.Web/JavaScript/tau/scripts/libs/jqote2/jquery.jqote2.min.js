define(["libs/jquery/jquery"],function(a){return function(b){function n(a,c){throw b.extend(a,c),a}function o(a){var b=[];if(m.call(a)!==g)return c;for(var d=0,e=a.length;d<e;d++)b[d]=a[d].jqote_id;return b.length?b.sort().join(".").replace(/(\b\d+\b)\.(?:\1(\.|$))+/g,"$1$2"):c}function p(a,d){var e,f=[],d=d||k,h=m.call(a);if(h===i)return a.jqote_id?[a]:c;if(h!==g)return[b.jqotec(a,d)];if(h===g)for(var j=0,l=a.length;j<l;j++)return f.length?f:c}var c=!1,d="UndefinedTemplateError",e="TemplateCompilationError",f="TemplateExecutionError",g="[object Array]",h="[object String]",i="[object Function]",j=1,k="%",l=/^[^<]*(<[\w\W]+>)[^>]*$/,m=Object.prototype.toString;b.fn.extend({jqote:function(a,c){var a=m.call(a)===g?a:[a],d="";return this.each(function(e){var f=b.jqotec(this,c);for(var g=0;g<a.length;g++)d+=f.call(a[g],e,g,a,f)}),d}}),b.each({app:"append",pre:"prepend",sub:"html"},function(a,c){b.fn["jqote"+a]=function(d,e,f){var g,h,i=b.jqote(d,e,f),j=l.test(i)?b:function(a){return b(document.createTextNode(a))};return!(g=o(p(d)))||(h=new RegExp("(^|\\.)"+g.split(".").join("\\.(.*)?")+"(\\.|$)")),this.each(function(){var d=j(i);b(this)[c](d),(d[0].nodeType===3?b(this):d).trigger("jqote."+a,[d,h])})}}),b.extend({jqote:function(a,b,e){var f="",e=e||k,h=p(a);h===c&&n(new Error("Empty or undefined template passed to $.jqote"),{type:d}),b=m.call(b)!==g?[b]:b;for(var i=0,j=h.length;i<j;i++)for(var l=0;l<b.length;l++)f+=h[i].call(b[l],i,l,b,h[i]);return f},jqotec:function(c,g){var i,o,p,g=g||k,s=m.call(c);if(s===h&&l.test(c)){o=p=c;if(i=b.jqotecache[c])return i}else{o=s===h||c.nodeType?b(c):c instanceof a?c:null,(!o[0]||!(p=o[0].innerHTML)&&!(p=o.text()))&&n(new Error("Empty or undefined template passed to $.jqotec"),{type:d});if(i=b.jqotecache[b.data(o[0],"jqote_id")])return i}var t="",u,v=p.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"").split("<"+g).join(g+">").split(g+">");for(var w=0,x=v.length;w<x;w++)t+=v[w].charAt(0)!==""?"out+='"+v[w].replace(/(\\|["'])/g,"\\$1")+"'":v[w].charAt(1)==="="?";out+=("+v[w].substr(2)+");":v[w].charAt(1)==="!"?";out+=$.jqotenc(("+v[w].substr(2)+"));":";"+v[w].substr(1);t="try{"+('var out="";'+t+";return out;").split("out+='';").join("").split('var out="";out+=').join("var out=")+'}catch(e){e.type="'+f+'";e.args=arguments;e.template=arguments.callee.toString();throw e;}';try{var y=new Function("i, j, data, fn",t)}catch(o){n(o,{type:e})}return u=o instanceof a?b.data(o[0],"jqote_id",j):o,b.jqotecache[u]=(y.jqote_id=j++,y)},jqotefn:function(a){var d=m.call(a),e=d===h&&l.test(a)?a:b.data(b(a)[0],"jqote_id");return b.jqotecache[e]||c},jqotetag:function(a){m.call(a)===h&&(k=a)},jqotenc:function(a){return a.toString().replace(/&(?!\w+;)/g,"&#38;").split("<").join("&#60;").split(">").join("&#62;").split('"').join("&#34;").split("'").join("&#39;")},jqotecache:{}}),b.event.special.jqote={add:function(a){var b,c=a.handler,d=a.data?m.call(a.data)!==g?[a.data]:a.data:[];a.namespace||(a.namespace="app.pre.sub");if(!d.length||!(b=o(p(d))))return;a.handler=function(a,d,e){return!e||e.test(b)?c.apply(this,[a,d]):null}}}}(a),a})