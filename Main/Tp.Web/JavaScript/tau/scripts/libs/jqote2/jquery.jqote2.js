define(["libs/jquery/jquery"],function(jQuery){return function($){function k(a,b){throw $.extend(a,b),a}function l(a){var b=[];if(j.call(a)!==d)return!1;for(var c=0,e=a.length;c<e;c++)b[c]=a[c].jqote_id;return b.length?b.sort().join(".").replace(/(\b\d+\b)\.(?:\1(\.|$))+/g,"$1$2"):!1}function m(a,b){var c,e=[],b=b||h,g=j.call(a);if(g===f)return a.jqote_id?[a]:!1;if(g!==d)return[$.jqotec(a,b)];if(g===d)for(var i=0,k=a.length;i<k;i++)(c=m(a[i],b))&&e.push(c[0]);return e.length?e:!1}var a="UndefinedTemplateError",b="TemplateCompilationError",c="TemplateExecutionError",d="[object Array]",e="[object String]",f="[object Function]",g=1,h="%",i=/^[^<]*(<[\w\W]+>)[^>]*$/,j=Object.prototype.toString;$.fn.extend({jqote:function(a,b){var a=j.call(a)===d?a:[a],c="";return this.each(function(d){var e=$.jqotec(this,b);for(var f=0;f<a.length;f++)c+=e.call(a[f],d,f,a,e)}),c}}),$.each({app:"append",pre:"prepend",sub:"html"},function(a,b){$.fn["jqote"+a]=function(c,d,e){var f,g,h=$.jqote(c,d,e),j=i.test(h)?$:function(a){return $(document.createTextNode(a))};return!(f=l(m(c)))||(g=new RegExp("(^|\\.)"+f.split(".").join("\\.(.*)?")+"(\\.|$)")),this.each(function(){var c=j(h);$(this)[b](c),(c[0].nodeType===3?$(this):c).trigger("jqote."+a,[c,g])})}}),$.extend({jqote:function(b,c,e){var f="",e=e||h,g=m(b);g===!1&&k(new Error("Empty or undefined template passed to $.jqote"),{type:a}),c=j.call(c)!==d?[c]:c;for(var i=0,l=g.length;i<l;i++)for(var n=0;n<c.length;n++)f+=g[i].call(c[n],i,n,c,g[i]);return f},jqotec:function(d,f){var l,m,o,f=f||h,p=j.call(d);if(p===e&&i.test(d)){m=o=d;if(l=$.jqotecache[d])return l}else{m=p===e||d.nodeType?$(d):d instanceof jQuery?d:null,(!m[0]||!(o=m[0].innerHTML)&&!(o=m.text()))&&k(new Error("Empty or undefined template passed to $.jqotec"),{type:a});if(l=$.jqotecache[$.data(m[0],"jqote_id")])return l}var q="",r,s=o.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"").split("<"+f).join(f+">").split(f+">");for(var t=0,u=s.length;t<u;t++)q+=s[t].charAt(0)!==""?"out+='"+s[t].replace(/(\\|["'])/g,"\\$1")+"'":s[t].charAt(1)==="="?";out+=("+s[t].substr(2)+");":s[t].charAt(1)==="!"?";out+=$.jqotenc(("+s[t].substr(2)+"));":";"+s[t].substr(1);q="try{"+('var out="";'+q+";return out;").split("out+='';").join("").split('var out="";out+=').join("var out=")+'}catch(e){e.type="'+c+'";e.args=arguments;e.template=arguments.callee.toString();throw e;}';try{var v=new Function("i, j, data, fn",q)}catch(w){k(w,{type:b})}return r=m instanceof jQuery?$.data(m[0],"jqote_id",g):m,$.jqotecache[r]=(v.jqote_id=g++,v)},jqotefn:function(a){var b=j.call(a),c=b===e&&i.test(a)?a:$.data($(a)[0],"jqote_id");return $.jqotecache[c]||!1},jqotetag:function(a){j.call(a)===e&&(h=a)},jqotenc:function(a){return a.toString().replace(/&(?!\w+;)/g,"&#38;").split("<").join("&#60;").split(">").join("&#62;").split('"').join("&#34;").split("'").join("&#39;")},jqotecache:{}}),$.event.special.jqote={add:function(a){var b,c=a.handler,e=a.data?j.call(a.data)!==d?[a.data]:a.data:[];a.namespace||(a.namespace="app.pre.sub");if(!e.length||!(b=l(m(e))))return;a.handler=function(a,d,e){return!e||e.test(b)?c.apply(this,[a,d]):null}}}}(jQuery),jQuery})