define(["libs/underscore"],function(e){!function(){"use strict";if("undefined"!=typeof e)var t=e().reverse,r=e.include;var n=String.prototype.trim,i=function(e){return 1*e||0},u=function(e,t){for(var r=[];t>0;r[--t]=e);return r.join("")},a=function(e){return Array.prototype.slice.call(e)},s=function(e){return e?o.escapeRegExp(e):"\\s"},c=function(e){return function(){for(var t=a(arguments),r=0;r<t.length;r++)t[r]=null==t[r]?"":""+t[r];return e.apply(null,t)}},l=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var t=u,r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,n){var i,u,a,s,c,o,p,f=1,g=r.length,h="",d=[];for(u=0;g>u;u++)if(h=e(r[u]),"string"===h)d.push(r[u]);else if("array"===h){if(s=r[u],s[2])for(i=n[f],a=0;a<s[2].length;a++){if(!i.hasOwnProperty(s[2][a]))throw l('[_.sprintf] property "%s" does not exist',s[2][a]);i=i[s[2][a]]}else i=s[1]?n[s[1]]:n[f++];if(/[^s]/.test(s[8])&&"number"!=e(i))throw l("[_.sprintf] expecting number but found %s",e(i));switch(s[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=s[7]?i.toExponential(s[7]):i.toExponential();break;case"f":i=s[7]?parseFloat(i).toFixed(s[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&s[7]?i.substring(0,s[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(s[8])&&s[3]&&i>=0?"+"+i:i,o=s[4]?"0"==s[4]?"0":s[4].charAt(1):" ",p=s[6]-String(i).length,c=s[6]?t(o,p):"",d.push(s[5]?i+c:c+i)}return d.join("")},r.cache={},r.parse=function(e){for(var t=e,r=[],n=[],i=0;t;){if(null!==(r=/^[^\x25]+/.exec(t)))n.push(r[0]);else if(null!==(r=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[_.sprintf] huh?";
if(r[2]){i|=1;var u=[],a=r[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[_.sprintf] huh?";for(u.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))u.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw"[_.sprintf] huh?";u.push(s[1])}r[2]=u}else i|=2;if(3===i)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";n.push(r)}t=t.substring(r[0].length)}return n},r}(),o={isBlank:c(function(e){return/^\s*$/.test(e)}),stripTags:c(function(e){return e.replace(/<\/?[^>]+>/gi,"")}),capitalize:c(function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}),chop:c(function(e,t){t=i(t)||e.length;for(var r=[],n=0;n<e.length;)r.push(e.slice(n,n+t)),n+=t;return r}),clean:c(function(e){return o.strip(e.replace(/\s+/g," "))}),count:c(function(e,t){for(var r,n=0,i=0;i<e.length;)r=e.indexOf(t,i),r>=0&&n++,i=i+(r>=0?r:0)+t.length;return n}),chars:c(function(e){return e.split("")}),escapeHTML:c(function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:c(function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:c(function(e){return e.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:c(function(e,t,r){var n=e.split("");return n.splice(i(t),0,r),n.join("")}),includes:c(function(e,t){return-1!==e.indexOf(t)}),include:function(e,t){return!r||/string|number/.test(typeof e)?this.includes(e,t):r(e,t)},join:c(function(){var e=a(arguments);return e.join(e.shift())}),lines:c(function(e){return e.split("\n")}),reverse:function(r){return!t||/string|number/.test(typeof r)?Array.prototype.reverse.apply(String(r).split("")).join(""):t.call(e(r))},splice:c(function(e,t,r,n){var u=e.split("");return u.splice(i(t),i(r),n),u.join("")}),startsWith:c(function(e,t){return e.length>=t.length&&e.substring(0,t.length)===t}),endsWith:c(function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t
}),succ:c(function(e){var t=e.split("");return t.splice(e.length-1,1,String.fromCharCode(e.charCodeAt(e.length-1)+1)),t.join("")}),titleize:c(function(e){for(var t,r=e.split(" "),n=0;n<r.length;n++)t=r[n].split(""),"undefined"!=typeof t[0]&&(t[0]=t[0].toUpperCase()),r[n]=n+1===r.length?t.join(""):t.join("")+" ";return r.join("")}),camelize:c(function(e){return o.trim(e).replace(/(\-|_|\s)+(.)?/g,function(e,t,r){return r?r.toUpperCase():""})}),underscored:function(e){return o.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(e){return o.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},trim:c(function(e,t){return!t&&n?n.call(e):(t=s(t),e.replace(new RegExp("^["+t+"]+|["+t+"]+$","g"),""))}),ltrim:c(function(e,t){return t=s(t),e.replace(new RegExp("^["+t+"]+","g"),"")}),rtrim:c(function(e,t){return t=s(t),e.replace(new RegExp("["+t+"]+$","g"),"")}),truncate:c(function(e,t,r){return r=r||"...",t=i(t),e.length>t?e.slice(0,t)+r:e}),prune:c(function(e,t,r){r=r||"...",t=i(t);var n="";return n=o.rtrim(0===e.substring(t-1,t+1).search(/^\w\w$/)?e.slice(0,t).replace(/([\W][\w]*)$/,""):e.slice(0,t)),n=n.replace(/\W+$/,""),n.length+r.length>e.length?e:n+r}),words:function(e,t){return String(e).split(t||" ")},pad:c(function(e,t,r,n){var a="",s=0;switch(t=i(t),r?r.length>1&&(r=r.charAt(0)):r=" ",n){case"right":s=t-e.length,a=u(r,s),e+=a;break;case"both":s=t-e.length,a={left:u(r,Math.ceil(s/2)),right:u(r,Math.floor(s/2))},e=a.left+e+a.right;break;default:s=t-e.length,a=u(r,s),e=a+e}return e}),lpad:function(e,t,r){return o.pad(e,t,r)},rpad:function(e,t,r){return o.pad(e,t,r,"right")},lrpad:function(e,t,r){return o.pad(e,t,r,"both")},sprintf:l,vsprintf:function(e,t){return t.unshift(e),l.apply(null,t)},toNumber:function(e,t){var r=i(i(e).toFixed(i(t)));return 0!==r||"0"===e||0===e?r:Number.NaN},strRight:c(function(e,t){var r=t?e.indexOf(t):-1;return-1!=r?e.slice(r+t.length,e.length):e
}),strRightBack:c(function(e,t){var r=t?e.lastIndexOf(t):-1;return-1!=r?e.slice(r+t.length,e.length):e}),strLeft:c(function(e,t){var r=t?e.indexOf(t):-1;return-1!=r?e.slice(0,r):e}),strLeftBack:c(function(e,t){var r=e.lastIndexOf(t);return-1!=r?e.slice(0,r):e}),indexOfAnyChar:function(t,r,n){for(var i=t.length,u=n,a=-1,s=!1;i>u&&!s;)e.contains(r,t.charAt(u))&&(s=!0,a=u),++u;return a}};o.strip=o.trim,o.lstrip=o.ltrim,o.rstrip=o.rtrim,o.center=o.lrpad,o.ljust=o.lpad,o.rjust=o.rpad,e.mixin(o)}(this||window)});