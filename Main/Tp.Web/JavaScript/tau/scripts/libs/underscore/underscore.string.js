define(["libs/underscore"],function(e){!function(){"use strict";if("undefined"!=typeof e)var t=e().reverse,n=e.include;var r=String.prototype.trim,i=function(e){return 1*e||0},u=function(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")},a=function(e){return Array.prototype.slice.call(e)},s=function(e){return e?o.escapeRegExp(e):"\\s"},c=function(e){return function(){for(var t=a(arguments),n=0;n<t.length;n++)t[n]=null==t[n]?"":""+t[n];return e.apply(null,t)}},l=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var t=u,n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var i,u,a,s,c,o,p,f=1,g=n.length,h="",d=[];for(u=0;g>u;u++)if(h=e(n[u]),"string"===h)d.push(n[u]);else if("array"===h){if(s=n[u],s[2])for(i=r[f],a=0;a<s[2].length;a++){if(!i.hasOwnProperty(s[2][a]))throw l('[_.sprintf] property "%s" does not exist',s[2][a]);i=i[s[2][a]]}else i=s[1]?r[s[1]]:r[f++];if(/[^s]/.test(s[8])&&"number"!=e(i))throw l("[_.sprintf] expecting number but found %s",e(i));switch(s[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=s[7]?i.toExponential(s[7]):i.toExponential();break;case"f":i=s[7]?parseFloat(i).toFixed(s[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&s[7]?i.substring(0,s[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(s[8])&&s[3]&&i>=0?"+"+i:i,o=s[4]?"0"==s[4]?"0":s[4].charAt(1):" ",p=s[6]-String(i).length,c=s[6]?t(o,p):"",d.push(s[5]?i+c:c+i)}return d.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[_.sprintf] huh?";
if(n[2]){i|=1;var u=[],a=n[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[_.sprintf] huh?";for(u.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))u.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw"[_.sprintf] huh?";u.push(s[1])}n[2]=u}else i|=2;if(3===i)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}(),o={isBlank:c(function(e){return/^\s*$/.test(e)}),stripTags:c(function(e){return e.replace(/<\/?[^>]+>/gi,"")}),capitalize:c(function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}),chop:c(function(e,t){t=i(t)||e.length;for(var n=[],r=0;r<e.length;)n.push(e.slice(r,r+t)),r+=t;return n}),clean:c(function(e){return o.strip(e.replace(/\s+/g," "))}),count:c(function(e,t){for(var n,r=0,i=0;i<e.length;)n=e.indexOf(t,i),n>=0&&r++,i=i+(n>=0?n:0)+t.length;return r}),chars:c(function(e){return e.split("")}),escapeHTML:c(function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:c(function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:c(function(e){return e.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:c(function(e,t,n){var r=e.split("");return r.splice(i(t),0,n),r.join("")}),includes:c(function(e,t){return-1!==e.indexOf(t)}),include:function(e,t){return!n||/string|number/.test(typeof e)?this.includes(e,t):n(e,t)},join:c(function(){var e=a(arguments);return e.join(e.shift())}),lines:c(function(e){return e.split("\n")}),reverse:function(n){return!t||/string|number/.test(typeof n)?Array.prototype.reverse.apply(String(n).split("")).join(""):t.call(e(n))},splice:c(function(e,t,n,r){var u=e.split("");return u.splice(i(t),i(n),r),u.join("")}),startsWith:c(function(e,t){return e.length>=t.length&&e.substring(0,t.length)===t}),endsWith:c(function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t
}),succ:c(function(e){var t=e.split("");return t.splice(e.length-1,1,String.fromCharCode(e.charCodeAt(e.length-1)+1)),t.join("")}),titleize:c(function(e){for(var t,n=e.split(" "),r=0;r<n.length;r++)t=n[r].split(""),"undefined"!=typeof t[0]&&(t[0]=t[0].toUpperCase()),n[r]=r+1===n.length?t.join(""):t.join("")+" ";return n.join("")}),camelize:c(function(e){return o.trim(e).replace(/(\-|_|\s)+(.)?/g,function(e,t,n){return n?n.toUpperCase():""})}),underscored:function(e){return o.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(e){return o.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},trim:c(function(e,t){return!t&&r?r.call(e):(t=s(t),e.replace(new RegExp("^["+t+"]+|["+t+"]+$","g"),""))}),ltrim:c(function(e,t){return t=s(t),e.replace(new RegExp("^["+t+"]+","g"),"")}),rtrim:c(function(e,t){return t=s(t),e.replace(new RegExp("["+t+"]+$","g"),"")}),truncate:c(function(e,t,n){return n=n||"...",t=i(t),e.length>t?e.slice(0,t)+n:e}),prune:c(function(e,t,n){n=n||"...",t=i(t);var r="";return r=o.rtrim(0===e.substring(t-1,t+1).search(/^\w\w$/)?e.slice(0,t).replace(/([\W][\w]*)$/,""):e.slice(0,t)),r=r.replace(/\W+$/,""),r.length+n.length>e.length?e:r+n}),words:function(e,t){return String(e).split(t||" ")},pad:c(function(e,t,n,r){var a="",s=0;switch(t=i(t),n?n.length>1&&(n=n.charAt(0)):n=" ",r){case"right":s=t-e.length,a=u(n,s),e+=a;break;case"both":s=t-e.length,a={left:u(n,Math.ceil(s/2)),right:u(n,Math.floor(s/2))},e=a.left+e+a.right;break;default:s=t-e.length,a=u(n,s),e=a+e}return e}),lpad:function(e,t,n){return o.pad(e,t,n)},rpad:function(e,t,n){return o.pad(e,t,n,"right")},lrpad:function(e,t,n){return o.pad(e,t,n,"both")},sprintf:l,vsprintf:function(e,t){return t.unshift(e),l.apply(null,t)},toNumber:function(e,t){var n=i(i(e).toFixed(i(t)));return 0!==n||"0"===e||0===e?n:Number.NaN},strRight:c(function(e,t){var n=t?e.indexOf(t):-1;return-1!=n?e.slice(n+t.length,e.length):e
}),strRightBack:c(function(e,t){var n=t?e.lastIndexOf(t):-1;return-1!=n?e.slice(n+t.length,e.length):e}),strLeft:c(function(e,t){var n=t?e.indexOf(t):-1;return-1!=n?e.slice(0,n):e}),strLeftBack:c(function(e,t){var n=e.lastIndexOf(t);return-1!=n?e.slice(0,n):e}),indexOfAnyChar:function(t,n,r){for(var i=t.length,u=r,a=-1,s=!1;i>u&&!s;)e.contains(n,t.charAt(u))&&(s=!0,a=u),++u;return a},humanize:function(e){return 0===e.indexOf("#")?"#"+this._humanize(e.substring(1,e.length)):this._humanize(e)},_humanize:function(e){if(!e.match(/[-\()+*/\[\]]+/g)){var t=this.titleize(e),n=t.match(/[A-Z][a-z]+/g);return null===n?t:n.join(" ")}return e}};o.strip=o.trim,o.lstrip=o.ltrim,o.rstrip=o.rtrim,o.center=o.lrpad,o.ljust=o.lpad,o.rjust=o.rpad,e.mixin(o)}(this||window)});