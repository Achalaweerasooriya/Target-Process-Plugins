define(["jQuery","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function($,ProgressIndicator){return window._criticalTauChanges=!1,{getType:function(value){return value=value.toLowerCase(),value.indexOf("story")>=0?"UserStory":value.indexOf("bug")>=0?"Bug":value.indexOf("task")>=0?"Task":value.indexOf("feature")>=0?"Feature":value.indexOf("testplanrun")>=0?"TestPlanRun":value},show:function(entityId,entityTypeName,reloadCallback,ckPath){var self=this;if(self.lastEntityID===entityId)return;self.lastEntityID=entityId,entityTypeName=this.getType(entityTypeName).toLowerCase(),reloadCallback=reloadCallback||!1;var fnCallback=function(evt){if(evt&&evt.data&&evt.data.cmd){if(fnCallback.cmd===evt.data.cmd)return;fnCallback.cmd=evt.data.cmd}reloadCallback.apply({},arguments)},progress=ProgressIndicator.get($("body"));progress.show("Loading..."),require(["all.components"],function(){require(["tau/configurator","tau/components/component.application"],function(configurator,ApplicationComponent){progress.hide(),configurator.clearSingles(),configurator.setCkPath(ckPath||"../../../Ckeditor/"),configurator.setConfig("isPopup",!0),configurator.setExternal({location:{hash:""}}),configurator.setLoggedUser(window.loggedUser);var appConfig={applicationId:"popup",integration:{progress:progress,reloadCallback:fnCallback,showInPopup:!0},context:{configurator:configurator},options:{applicationId:"integrationPopup",routing:{silent:!0,executeOnStart:!1},integration:{showInPopup:!0,keepAlive:!1}}},appBus=ApplicationComponent.create(appConfig);appBus.initialize(appConfig),appBus.fire("history.reset"),appBus.fire("application.navigate.entity",{id:entityId,entity:entityTypeName});var isPopup=!!reloadCallback,exitCallback;isPopup?exitCallback=function(){configurator.getWindow()._criticalTauChanges=!0,appBus.fire("destroy")}:exitCallback=function(){appBus.fire("initProgress"),configurator.getRouting().redirect(configurator.getUrlBuilder().getDashboardUrl())},appBus.on("application.exit",exitCallback),appBus.on("destroy",function(){progress.hide(),self.lastEntityID=null})})})}}})