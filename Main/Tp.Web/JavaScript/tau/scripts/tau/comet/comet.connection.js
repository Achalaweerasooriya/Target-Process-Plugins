define(["jQuery","tau/comet/comet.subscriber"],function($,CometSubscriber){$(document).ready(function(){$(this).keypress(function(e){if(e.keyCode==27)return!1})});var $asyncProxyStarted=$.Deferred(),$asyncCommandStop=$.Deferred(),$asyncCommandStopCompleted=$.Deferred(),lockOpenForInitialization=!0,ConnectionSingleton={startAsync:function(cometProxyCallback){cometProxyCallback=cometProxyCallback||$.noop,$asyncProxyStarted.done(cometProxyCallback),lockOpenForInitialization&&(lockOpenForInitialization=!1,require(["tp/serverNotifications"],function(connection){if(!connection)return;$asyncCommandStop.done(function(){connection.stop(function(){lockOpenForInitialization=!0,$asyncProxyStarted=$.Deferred(),$asyncCommandStopCompleted.resolve(),$asyncCommandStopCompleted=$.Deferred()})}),connection.start(function(){var ProxySubscriptionFactory={createSubscriber:function(resourceName){return new CometSubscriber(resourceName,connection)}};$asyncProxyStarted.resolve(ProxySubscriptionFactory)})}))},stopAsync:function(stoppedProxyCallback){$asyncCommandStopCompleted.done(stoppedProxyCallback||$.noop),$asyncCommandStop.resolve()}};return $(window).unload(function(){ConnectionSingleton.stopAsync()}),ConnectionSingleton})