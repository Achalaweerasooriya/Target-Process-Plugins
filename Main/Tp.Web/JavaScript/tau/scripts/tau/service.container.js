define(["require","Underscore","libs/jquery/jquery","tau/core/class","tau/core/bus","tau/core/bus.reg","tau/core/global.bus","tau/store/factory","tau/services/keyboard.manager","tau/services/state.manager","tau/services/service.routing","tau/services/service.hash","tau/utils/utils.routing","tau/utils/utils.history","tau/utils/utils.urlBuilder.service","libs/parseUri","tau/nls/translator","tau/store/services/service.globalSettings","tau/services/service.applicationContext","tau/store/services/service.notifications","tau/store/services/service.actions","tau/storage/api","tau/libs/boardSettings/factory.board.settings","tau/services/boards/service.boards.operations","tau/services/boards/service.views.menu","tau/components/board.menu/services/board.menu.board.url.service","tau/services/boards/service.views.menu.comet.listener","tau/components/board.menu/services/board.menu.integration.service","tau/slice/slice.factory","tau/utils/utils.titleManager","tau/services/service.componentBuilder","tau/core/bus.collection","tau/libs/clipboard/clipboard.manager","tau/ui/ui.templateFactory","tau/utils/utils.redirect","tau/utils/utils.date/utils.date.wrapper","tau/utils/utils.date","tau/utils/utils.constants","tau/services/service.avatar","tau/services/service.features","tau/services/comet/comet.connection","tau/services/comet/service.comet","tau/services/service.workflow","tau/services/service.boardCacheData","tau/services/customize/service.customize.units.registry","tau/services/customize/service.customize.units.customField.factory","tau/services/service.help-scenarios","tau/services/boards/service.acid","tau/services/service.board.access","tau/components/board.changelog/controllers/controller.board.changelog","tau/store/services/service.auditHistory","tau/libs/store2/store2","tau/services/service.prototypeContextEntity","tau/services/service.diagnostics","tau/services/service.sample.data.api","tau/components/dashboard/services/dashboard.widget.template.registry","tau/components/dashboard/services/dashboard.model.registry","tau/components/dashboard/services/dashboard.widget.model.factory","tau/services/service.activity","tau/services/service.entity.view","tau/services/colorEncoding/service.colorEncoding.brewer","tau/services/service.resize","tau/services/service.entity.filters"],function(e){var t=e("Underscore"),i=e("libs/jquery/jquery"),r=e("tau/core/class"),s=e("tau/core/bus"),n=e("tau/core/bus.reg"),o=e("tau/core/global.bus"),c=e("tau/store/factory"),a=e("tau/services/keyboard.manager"),u=e("tau/services/state.manager"),h=e("tau/services/service.routing"),g=e("tau/services/service.hash"),v=e("tau/utils/utils.routing"),l=e("tau/utils/utils.history"),d=e("tau/utils/utils.urlBuilder.service"),S=e("libs/parseUri"),f=e("tau/nls/translator"),p=e("tau/store/services/service.globalSettings"),y=e("tau/services/service.applicationContext"),w=e("tau/store/services/service.notifications"),b=e("tau/store/services/service.actions"),m=e("tau/storage/api"),C=e("tau/libs/boardSettings/factory.board.settings"),F=e("tau/services/boards/service.boards.operations"),M=e("tau/services/boards/service.views.menu"),R=e("tau/components/board.menu/services/board.menu.board.url.service"),P=e("tau/services/boards/service.views.menu.comet.listener"),_=e("tau/components/board.menu/services/board.menu.integration.service"),A=e("tau/slice/slice.factory"),B=e("tau/utils/utils.titleManager"),x=e("tau/services/service.componentBuilder"),E=e("tau/core/bus.collection"),O=e("tau/libs/clipboard/clipboard.manager"),U=e("tau/ui/ui.templateFactory"),D=e("tau/utils/utils.redirect"),k=e("tau/utils/utils.date/utils.date.wrapper"),V=e("tau/utils/utils.date"),W=e("tau/utils/utils.constants"),I=e("tau/services/service.avatar"),H=e("tau/services/service.features"),q=e("tau/services/comet/comet.connection"),z=e("tau/services/comet/service.comet"),L=e("tau/services/service.workflow"),T=e("tau/services/service.boardCacheData"),j=e("tau/services/customize/service.customize.units.registry"),G=e("tau/services/customize/service.customize.units.customField.factory"),K=e("tau/services/service.help-scenarios"),N=e("tau/services/boards/service.acid"),J=e("tau/services/service.board.access"),Q=e("tau/components/board.changelog/controllers/controller.board.changelog"),X=e("tau/store/services/service.auditHistory"),Y=e("tau/libs/store2/store2"),Z=e("tau/services/service.prototypeContextEntity"),$=e("tau/services/service.diagnostics"),et=e("tau/services/service.sample.data.api"),tt=e("tau/components/dashboard/services/dashboard.widget.template.registry"),it=e("tau/components/dashboard/services/dashboard.model.registry"),rt=e("tau/components/dashboard/services/dashboard.widget.model.factory"),st=e("tau/services/service.activity"),nt=e("tau/services/service.entity.view"),ot=e("tau/services/colorEncoding/service.colorEncoding.brewer"),ct=e("tau/services/service.resize"),at=e("tau/services/service.entity.filters"),ut=r.extend({_config:{},isBoardEdition:!1,init:function(){this.registeredServices={},this.registerService("urlBuilder",new d(this)),this.registerService("errorBar",new s),this.registerService("colorEncoding",new ot),this.registerService("resize",new ct)
},getUrlBuilder:function(){return this.service("urlBuilder")},setLoggedUser:function(e){this.loggedUser=e},getLoggedUser:function(){return this.loggedUser||this.getWindow().loggedUser},setSystemInfo:function(e){this.systemInfo=e},getSystemInfo:function(){var e=this.systemInfo||this.getWindow().tauSystemInfo;return t.clone(e)},setRequireLoader:function(e){this.require=e},getRequireLoader:function(){return this.require||window.require},getComponentBuilder:function(){return this.componentBuilder=this.componentBuilder||new x(this),this.componentBuilder},require:function(e,t){var i=this.require||window.require;i(e,t)},setRestStorage:function(e){this.restStorage=e},getRestStorage:function(){return this.restStorage||(this.restStorage=new m({service:this.getRestStorageService()})),this.restStorage},setRestStorageService:function(e){this.restStorageService=e},getRestStorageService:function(){return this.restStorageService||(this.restStorageService=i.ajax),this.restStorageService},setBoardSettingsOptions:function(e){this.boardSettingsOptions=e},getBoardSettingsOptions:function(){return this.boardSettingsOptions},getBoardSettingsFactory:function(){return this._boardSettingsFactory||(this._boardSettingsFactory=new C(this)),this._boardSettingsFactory},getViewsMenuCometListener:function(){return this._viewsMenuCometListener||(this._viewsMenuCometListener=new P(this.getComet(),this.getViewsMenuService(),this.getFeaturesService())),this._viewsMenuCometListener},getBoardOperationsService:function(){return this._boardOperationsService||(this._boardOperationsService=new F(this.getGlobalBus(),this.service("errorBar"),this,this.getViewsMenuService(),this.getUrlBuilder(),this.getRouting(),this.getHistory())),this._boardOperationsService},getViewApiService:function(){return this.getViewsMenuService().viewsApi},getBoardApiService:function(){return console.warn('Method "getBoardApiService" is deprecated. Use "getViewApiService" instead'),this.getViewApiService()},getViewsMenuService:function(){return this._viewsMenuService||(this._viewsMenuService=new M({service:this.getRestStorageService()},this.getViewsMenuUrlService())),this._viewsMenuService
},getInternalViewsMenuIntegrationService:function(){return this._viewsMenuIntegrationService||(this._viewsMenuIntegrationService=new _),this._viewsMenuIntegrationService},getViewsMenuActionsIntegrationService:function(){return this.getInternalViewsMenuIntegrationService().getActionsMenuExtender()},setViewsMenuService:function(e){this._viewsMenuService=e},getViewsMenuUrlService:function(){return this._viewsMenuUrlService||(this._viewsMenuUrlService=new R(this.getUrlBuilder(),this.getAcidService())),this._viewsMenuUrlService},getDashboardWidgetTemplateRegistry:function(){return this._dashboardWidgetTemplateRegistry||(this._dashboardWidgetTemplateRegistry=new tt),this._dashboardWidgetTemplateRegistry},setDashboardWidgetTemplateRegistry:function(e){this._dashboardWidgetTemplateRegistry=e},getDashboardModelRegistry:function(){if(!this._dashboardModelRegistry){var e=new rt(this.getDashboardWidgetTemplateRegistry(),this.getAcidService());this._dashboardModelRegistry=new it(e,this.getViewApiService(),this.getLoggedUser())}return this._dashboardModelRegistry},getStoreFactory:function(){return this.storeFactory||(this.storeFactory=new c),this.storeFactory},setStoreFactory:function(e){this.storeFactory=e},setSliceFactoryOptions:function(e){this.sliceFactoryOptions=e||{}},mergeSliceFactoryOptions:function(e){this.sliceFactoryOptions=t.extend(this.sliceFactoryOptions||{},e)},getSliceFactoryOptions:function(){return t.defaults(this.sliceFactoryOptions||{},{base64:!0,options:{DnDTurnOffCometWhenItemsCountExceed:50},service:this.getSliceService()})},getSliceFactory:function(){if(!this.sliceFactory){var e=this.getSliceFactoryOptions();this.sliceFactory=new A(e)}return this.sliceFactory},setSliceService:function(e){this.sliceService=e},getSliceService:function(){return this.sliceService||(this.sliceService=i.ajax),this.sliceService},setStore2Service:function(e){this.store2Service=e},getStore2Service:function(){return this.store2Service||(this.store2Service=i.ajax),this.store2Service},getKeyBoardManager:function(){if(!this.keyboardManager){this.keyboardManager=new a;
var e={handleKeyDown:function(e){e.keyCode==i.ui.keyCode.ESCAPE&&(e.preventDefault(),e.stopPropagation())}};this.keyboardManager.pushHandler(e)}return this.keyboardManager},setGlobalSettingsService:function(e){this.globalSettingsService=e},getGlobalSettingsService:function(){if(!this.globalSettingsService){var e={appPath:this.getApplicationPath()};this.globalSettingsService=new p(e)}return this.globalSettingsService},setApplicationContextService:function(e){this.applicationContextService=e},getApplicationContextService:function(){return this.applicationContextService||(this.applicationContextService=new y(this),this.applicationContextService.isBoardEdition=this.isBoardEdition),this.applicationContextService},setNotificationService:function(e){this.notificationService=e},getNotificationService:function(){if(!this.notificationService){var e={appPath:this.getApplicationPath()};this.notificationService=new w(e)}return this.notificationService},setActionsService:function(e){this.actionsService=e},getActionsService:function(){if(!this.actionsService){var e={appPath:this.getApplicationPath()};this.actionsService=new b(e)}return this.actionsService},clearSingles:function(){this.getStoreFactory().clearSingles()},clear:function(){this._cometService&&this._cometService.destroy(),this.clearSingles(),this.currentDate=null,this.window=null,this.routing=null,this.stateManager=null,this.getStoreFactory().clear(),this.getBoardSettingsFactory().clear(),this.getBusRegistry().clear(),this.getResizeService().destroy()},getAppStateStore:function(){return this.acidStore=this.acidStore||this.getBoardSettingsFactory().createAcidSettings({id:"appConfig"}),this.acidStore},setAppStateStore:function(e){this.acidStore=e},getAcidService:function(){return this._acidService=this._acidService||new N(this.getAppStateStore()),this._acidService},getAuditHistoryService:function(){return this.auditHistoryService=this.auditHistoryService||new X(this.getApplicationPath()),this.auditHistoryService},getCurrentAcid:function(){var e="",t=this.getWindow();
return t.location&&t.location.href&&(e=S(t.location.href).queryKey.acid||e),e},setWindow:function(e){this.window=e},getWindow:function(){return this.window||window},getHistory:function(){return this.history||(this.history=new l),this.history},createRouting:function(){var e={window:this.getWindow()};return new v(e)},getRouting:function(){return this.routing||(this.routing=this.createRouting()),this.routing},getTitleManager:function(){return this.titleManager||(this.titleManager=new B({window:this.getWindow()})),this.titleManager},getTranslator:function(){return f},setCurrentDate:function(e){this.currentDate=new k(e)},getCurrentDate:function(){return this.currentDate?this.currentDate:V.getServerNow()},getGlobalBus:function(){return o.get()},getBusRegistry:function(){return n},getComponentBusRegistry:function(){return this.componentBusRegistry||(this.componentBusRegistry=new E),this.componentBusRegistry},setApplicationPath:function(e){this.getStoreFactory().setApplicationPath(e)},getApplicationPath:function(){return this.getStoreFactory().getApplicationPath()},getCkPath:function(){return this.ckPath||(this.ckPath=this.getApplicationPath()+"/Ckeditor"),this.ckPath},setCkPath:function(e){this.ckPath=e},setInitialData:function(e){this.getStoreFactory().setInitialData(e)},setService:function(e){this.getStoreFactory().setService(e)},getService:function(){return this.getStoreFactory().getService()},getRestPath:function(){return this.getStoreFactory().getRestPath()},setProxy:function(e){this.getStoreFactory().setProxy(e)},getProxy:function(){return this.getStoreFactory().getProxy()},disableRules:function(){this.getStoreFactory().disableRules()},enableRules:function(){this.getStoreFactory().enableRules()},initRules:function(){this.getStoreFactory().initRules()},getStore:function(e){return e=e||{},e.services=e.services||this,this.getStoreFactory().getStore(e)},getStore2:function(){return this.store2||(this.store2=new Y(this)),this.store2},setStore2:function(e){this.store2=e},setConfig:function(e,t){this._config[e]=t
},getConfig:function(e,t){return this._config.hasOwnProperty(e)?this._config[e]:t},getStateManager:function(){if(!this.stateManager){var e=this.getHashService(),t=new h({external:e});this.stateManager=new u({service:t,state:e.hashParams()});var i=this,r=function(){var t=e.hashParams();i.stateManager?i.stateManager.update(t):e.unbindHashChange(r)};e.onHashChange(r)}return this.stateManager},getSettingsManager:function(){return this.settingsManager=this.settingsManager||this.getBoardSettingsFactory().createComponentSettings({id:"board"}),this.settingsManager},setClipboardManagerOptions:function(e){this.clipboardManagerOptions=e},getClipboardManagerOptions:function(){return t.defaults(this.clipboardManagerOptions||{},{id:"clipboard"})},getClipboardManager:function(){return this.clipboardManager||(this.clipboardManager=new O(this.getBoardSettingsFactory().createComponentSettings(this.getClipboardManagerOptions()))),this.clipboardManager},setRedirect:function(e){this.redirect=e},getRedirect:function(){return this.redirect||(this.redirect=new D(this.getWindow(),this.getApplicationPath())),this.redirect},getTemplateFactory:function(){return U},getConstObject:function(){return W},getAvatarService:function(){return this.avatarService||(this.avatarService=new I(this.getApplicationPath())),this.avatarService},setAvatarService:function(e){this.avatarService=e},createChild:function(){var e=new ut;return e.getStoreFactory().setStore(this.getStore()),e.isBoardEdition=this.isBoardEdition,e.featuresService=this.getFeaturesService(),e.acidStore=this.getAppStateStore(),e.setPrototypeContextEntityService(this.getPrototypeContextEntityService()),e.applicationContextService=this.getApplicationContextService(),e.loggedUser=this.getLoggedUser(),e},getFeaturesService:function(e){return this.featuresService||(this.featuresService=new H(e)),this.featuresService},setFeaturesService:function(e){return this.featuresService=new H(e),this.featuresService},getCometConnection:function(){var e="comet-connection";
return this.registeredServices.hasOwnProperty(e)||this.registerService(e,new q(this.getFeaturesService())),this.service(e)},getComet:function(){return this._cometService||(this._cometService=new z(this.getCometConnection(),this.getActivityService()),this._cometService.logging=this.getFeaturesService().isEnabled("comet.collect-server-statistics")),this._cometService},getActivityService:function(){return st},registerService:function(e,t){this.registeredServices[e]=t},service:function(e){if(!this.registeredServices.hasOwnProperty(e))throw new Error("Service ["+e+"] is not registered");return this.registeredServices[e]},setHashService:function(e){this.registerService("hash",e)},getHashService:function(){if(!this.registeredServices.hasOwnProperty("hash")){var e=new g(this);e.setWindow(this.getWindow()),this.registerService("hash",e)}return this.service("hash")},getExternal:function(){return this.getHashService()},getWorkflowService:function(){return this.registeredServices.hasOwnProperty("workflow")||this.registerService("workflow",new L(this)),this.service("workflow")},getBoardCacheService:function(){return this.registeredServices.hasOwnProperty("boardCacheData")||this.registerService("boardCacheData",new T(this)),this.service("boardCacheData")},getPrototypeContextEntityService:function(){return this.registeredServices.hasOwnProperty("prototypeContextEntity")||this.registerService("prototypeContextEntity",new Z),this.service("prototypeContextEntity")},setPrototypeContextEntityService:function(e){return this.registerService("prototypeContextEntity",e),this.service("prototypeContextEntity")},getChangelogController:function(){if(!this.registeredServices.hasOwnProperty("changelog")){var e=new Q,t=this.service("errorBar");e.onError.add(t.fire.bind(t,"error")),this.registerService("changelog",e)}return this.service("changelog")},getUnitsRegistry:function(){return this.unitsRegistry||(this.unitsRegistry=new j(void 0,this.getSystemInfo().culture)),this.unitsRegistry},setUnitsRegistry:function(e){return this.unitsRegistry=e,this.unitsRegistry
},getHelpScenarioService:function(){return this.registeredServices.hasOwnProperty("flow-help")||this.registerService("flow-help",new K({configurator:this})),this.service("flow-help")},getCustomFieldsUnitsFactory:function(){return this.customFieldsUnitsRegistry||(this.customFieldsUnitsRegistry=new G(this)),this.customFieldsUnitsRegistry},getBoardAccessService:function(){return J},getDiagnosticsService:function(){return this.diagnosticsService||(this.diagnosticsService=new $({configurator:this})),this.diagnosticsService},getSampleDataService:function(){return this.sampleDataService||(this.sampleDataService=new et({configurator:this})),this.sampleDataService},getEntityViewService:function(){return this.entityViewService||(this.entityViewService=new nt({configurator:this})),this.entityViewService},getColorEncodingService:function(){return this.service("colorEncoding")},getResizeService:function(){return this.service("resize")},setEntityFiltersService:function(e){this._entityFiltersService=e},getEntityFiltersService:function(){return this._entityFiltersService||(this._entityFiltersService=new at({applicationPath:this.getApplicationPath(),loggedUser:this.getLoggedUser()})),this._entityFiltersService}});return ut});