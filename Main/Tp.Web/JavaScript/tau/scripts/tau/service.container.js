define(["tau/core/Class","tau/store/factory","tau/core/keyboard.manager","tau/core/global.bus","tau/core/external","tau/core/state.manager","tau/services/service.routing","tau/utils/utils.routing","tau/utils/utils.history","libs/parseUri","tau/store/services/service.globalSettings","tau/services/service.applicationContext","tau/store/services/service.notifications","tau/store/services/service.actions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){return a.extend({ckPath:"../Ckeditor/",_config:{},isBoardEdition:!1,setRestStorageService:function(a){this.restStorageService=a},getRestStorageService:function(){return this.restStorageService},getStoreFactory:function(){return this.storeFactory||(this.storeFactory=new b),this.storeFactory},getKeyBoardManager:function(){if(!this.keyboardManager){this.keyboardManager=new c;var a={handleKeyDown:function(a){a.keyCode==$.ui.keyCode.ESCAPE&&(a.preventDefault(),a.stopPropagation())}};this.keyboardManager.pushHandler(a)}return this.keyboardManager},setGlobalSettingsService:function(a){this.globalSettingsService=a},getGlobalSettingsService:function(){if(!this.globalSettingsService){var a={appPath:this.getApplicationPath()};this.globalSettingsService=new k(a)}return this.globalSettingsService},setApplicationContextService:function(a){this.applicationContextService=a},getApplicationContextService:function(){return this.applicationContextService||(this.applicationContextService=new l(this.getStore())),this.applicationContextService},setNotificationService:function(a){this.notificationService=a},getNotificationService:function(){if(!this.notificationService){var a={appPath:this.getApplicationPath()};this.notificationService=new m(a)}return this.notificationService},setActionsService:function(a){this.actionsService=a},getActionsService:function(){if(!this.actionsService){var a={appPath:this.getApplicationPath()};this.actionsService=new n(a)}return this.actionsService},clearSingles:function(){this.getStoreFactory().clearSingles()},clear:function(){this.clearSingles(),d.reset(),delete this.currentDate,delete this.external,delete this.stateManager,this.getStoreFactory().clear()},getCurrentAcid:function(){var a="",b=this.getWindow();if(b.location&&b.location.href){var c=b.location.href;a=j(c).queryKey.acid||a}return a},setWindow:function(a){this.window=a},getWindow:function(){return this.window||window},getHistory:function(){return this.history||(this.history=new i),this.history},pushRouting:function(){this.routingArr=this.routingArr||[],this.routingArr.push(this.routing),this.routing=null},popRouting:function(){this.routing=this.routingArr.pop()},createRouting:function(a){var b={window:this.getWindow()};a&&(b.safe=!0,b.v2=!0,b.safeParameterName=a);var c=new h(b);return c},getRouting:function(a){return this.routing||(this.routing=this.createRouting(a)),this.routing},setCurrentDate:function(a){this.currentDate=a},getCurrentDate:function(){return this.currentDate?this.currentDate:new Date},getGlobalBus:function(){return d.get()},setApplicationPath:function(a){this.getStoreFactory().setApplicationPath(a)},getApplicationPath:function(){return this.getStoreFactory().getApplicationPath()},getCkPath:function(){return this.ckPath},setCkPath:function(a){this.ckPath=a},setInitialData:function(a){this.getStoreFactory().setInitialData(a)},setStoreFactory:function(a){this.storeFactory=a},setService:function(a){this.getStoreFactory().setService(a)},getService:function(){return this.getStoreFactory().getService()},getRestPath:function(){return this.getStoreFactory().getRestPath()},setProxy:function(a){this.getStoreFactory().setProxy(a)},getProxy:function(){return this.getStoreFactory().getProxy()},disableRules:function(){this.getStoreFactory().disableRules()},enableRules:function(){this.getStoreFactory().enableRules()},initRules:function(){this.getStoreFactory().initRules()},getStore:function(a){return a=a||{},_.defaults(a,{services:this}),this.getStoreFactory().getStore(a)},setConfig:function(a,b){this._config[a]=b},getConfig:function(a,b){var c=b;return this._config.hasOwnProperty(a)&&(c=this._config[a]),c},setExternal:function(a){this.external=new e(a)},getExternal:function(){return this.external||(this.external=new e(window)),this.external},getStateManager:function(){var a=this;if(!a.stateManager){var b=a.getExternal(),c=new g({external:b});a.stateManager=new f({service:c,state:b.hashParams()}),b.onHashChange(function(b){var c=b.hashParams();a.stateManager.update(c)})}return a.stateManager}})})