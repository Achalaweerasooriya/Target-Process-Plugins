define(["Underscore","tau/core/class","tau/rules/auto-include-beforeSave"],function(a,b,c){return b.extend({init:function(b){var d=this;d.store=b.store||{},b.rulesImpl=b.rulesImpl||{},a.extend(d,c),a.extend(d,{name:"rules engine"}),a(b.rulesImpl).each(function(b){a.extend(d,b)}),d.register(b.rules||[])},register:function(b){var d=this;a.isArray(b)||(b=[b]),a(b).each(function(b){a.defaults(b,{name:a(c).keys()[0],fields:[],changes:[]});if(!b.hasOwnProperty("type"))throw"type should be configured for rule";if(b.fields.length===0)return;a.each(b.changes,function(a){var c=function(a){d[b.name](a,b)},e=b.name.split(" ");d.store.on({eventName:e[e.length-1],type:b.type,listener:d,hasChanges:[a]},c)})})},registerRule:function(b){var c=this;a.defaults(b,{fields:[],changes:[]});if(!b.hasOwnProperty("name"))throw'"name" field should be configured for rule';if(!b.hasOwnProperty("type"))throw'"type" field should be configured for rule';if(!c.hasOwnProperty(b.name))throw"unknown rule name ["+b.name+"]";c[b.name].call(c,b)},destroy:function(){var a=this.store;delete this.store,a.unbind(this)}})})