define(["Underscore"],function(_){var fn=function(evt,rule){var rulesEngine=this,obj=evt.data.obj;for(var i=0;i<rule.fields.length;i++){var field=rule.fields[i];(obj.id&&rulesEngine.store.isPropertyInitialized(obj.id,obj.type,_.getFieldName(field))||rule.force)&&_.mergeFields(evt.data.cmd.config.fields,[field])}};return{"auto-include-before-save":function(rule){var rulesEngine=this;if(rule.fields.length===0)return;_.each(rule.changes,function(change){var storeChanges=[change],fnProcess=function(evt){fn.call(rulesEngine,evt,rule)};rulesEngine.store.on({eventName:"beforeSave",type:rule.type,listener:rulesEngine,hasChanges:storeChanges},fnProcess)})}}})