define(["Underscore","jQuery","tau/core/view-base","tau/core/event-dispatcher","tau/ui/templates/container/ui.template.container.list","tau/ui/templates/container/ui.template.container.table","tau/ui/templates/container/ui.template.container.replaceable"],function(i,e,n,t){return n.extend({init:function(i){this._loaded=!1,this._super(i)},"bus initialize":function(i,e){this.startLifeCycle(i,e)},"bus refresh":function(i,e){this.startLifeCycle(i,e)},"bus componentCreated":function(i){var e=i.data.component;this.fire("childComponentCreated",e),this.children.push(e)},"bus afterRender + afterRenderLazy":function(i,e){this.fire("afterRenderAll",e)},"bus afterInit + internalChildrenRendered":function(e,n,t){var s=this._getRenderConfig();this.fireBeforeRender({data:s}),this.doRender(s),i.extend(t,{config:this.config}),this.fire("childrenRendered",t),this.config.visibility&&this.fire("visibility.on"),this.fireAfterRender({data:s})},"bus afterInit + internalChildrenRenderedLazy":function(e,n,t){i.extend(t,{config:this.config}),this.fire("childrenRenderedLazy",t),this.config.visibility&&this.fire("visibility.on")},"bus componentsCreated:last + sendEventToComponents":function(e,n,t){i.forEach(n,function(i){i.component.fire(t.name,t.data)})},"bus componentsCreated":function(e,n){this.fire("beforeComponentsInitialize",e.data);var t={};i.forEach(n,function(e,n){var s=e.config,r=e.component;i.has(s,"label")?t[s.label]=r:t[n]=r}),this.fire("childrenBuses.ready",t),this.initializeComponents(e),this.fire("afterComponentsInitialize",e.data)},"bus show":function(){this.show(),this._loaded||this.fire("initialize")},"bus hide":function(){this.hide()},"bus $children.rendered":function(i,e){this._fireVisibilityChanged(e,this.config.visible)},completeInitializationWithoutChildren:function(){this.fire("afterInit",{}),this._fireChildrenRendered({children:[],childrenEvtArgs:[]})},completeInitializationWithoutChildrenLazy:function(){this._fireChildrenRenderedLazy({children:[],childrenEvtArgs:[]})},setDefaultConfig:function(){this._super(),i.defaults(this.config,{template:{name:"container."+(this.config.layout||"list")}})
},_fireChildrenRendered:function(i){this.fire("internalChildrenRendered",i)},_fireChildrenRenderedLazy:function(i){this.fire("internalChildrenRenderedLazy",i)},initializeComponents:function(e){var n=i.pluck(e.data,"config"),t=this.separateChildComponents(this.children,n);this.listenContainerChildren(t.containerComponents),t.lazyComponents.components.length>0&&this.fire("existLazyChildren"),this.bus.on("internalChildrenRendered",i.bind(function(){this.initializeLazyComponents(t.lazyComponents)},this)),this.initializeFastComponents(t.fastComponents)},separateChildComponents:function(e,n){var t={components:[],configs:[]},s={components:[],configs:[]},r={components:[],configs:[]};return i.each(this.children,function(i,e){var o=n[e];o.lazy?(t.components.push(i),t.configs.push(o)):(s.components.push(i),s.configs.push(o));var h=this.config.visible!==!1&&o.visible!==!1,a="tabs"===o.type||o.children&&0!==o.children.length;a&&h&&(r.components.push(i),r.configs.push(i))},this),{lazyComponents:t,fastComponents:s,containerComponents:r}},initializeFastComponents:function(e){return 0===e.components.length?void this.completeInitializationWithoutChildren():(this.dispatcher=new t(e.components),this.dispatcher.listen("afterInit",i.bind(function(i){this.fire(i.eventName)},this)),this.dispatcher.listen("afterRender",i.bind(function(i){var n=i.argsArr,t={children:e.components,childrenEvtArgs:n};this._fireChildrenRendered(t)},this)),void i.forEach(e.components,i.bind(function(i,e,n){e.fire("initialize",i[n])},this,e.configs)))},initializeLazyComponents:function(e){return 0===e.components.length?void this.completeInitializationWithoutChildrenLazy():(this.dispatcherLazy=new t(e.components),this.dispatcherLazy.listen("afterRender",i.bind(function(i){var n=i.argsArr,t={children:e.components,childrenEvtArgs:n};this._fireChildrenRenderedLazy(t)},this)),void this.config.store.freeze(!0).done(i.bind(function(e){this.fire("storeFreeze.ready",e);var n=["afterInit"];i.forEach(n,i.bind(function(n){this.dispatcherLazy.listen(n,i.bind(function(){e.unfreeze()
},this))},this))},this)).done(i.bind(function(){i.forEach(e.components,function(i,n){i.fire("initialize",e.configs[n])})},this)))},"bus storeFreeze.ready + destroy":function(i,e){e.unfreeze()},"bus storeFreeze.ready + refresh":function(i,e){e.unfreeze()},listenContainerChildren:function(n){var s=e.Deferred(),r=e.Deferred(),o=e.Deferred(),h=e.Deferred(),a=e.Deferred();return a.done(i.bind(function(){this.fire(this.fire("afterRenderLazy"))},this)),this.bus.on("afterRender",i.bind(function(i,e){r.resolve(e)},this)),this.bus.on("internalChildrenRenderedLazy",i.bind(function(){o.resolve()},this)),this.dispatcherContainers=new t(n.components),this.dispatcherContainers.listen("afterRenderLazy",i.bind(function(){h.resolve()},this)),s.done(i.bind(function(n){this.fire("isLazy",n),this.config.lazy&&e.when(r,o).done(i.bind(function(){this.fire("afterRenderLazy")},this)),n&&!this.config.lazy?e.when(r,h,o).done(i.bind(function(){this.fire("afterRenderLazy")},this)):e.when(r,o).done(i.bind(function(){this.fire("afterRenderLazy")},this))},this)),this.config.lazy?void s.resolve(!0):0===n.components.length?void s.resolve(!1):void this.dispatcherContainers.listen("isLazy",i.bind(function(e){var n=!0;-1===i.indexOf(e.argsArr,!0)&&(n=!1),s.resolve(n)},this))},lifeCycleCleanUp:function(){this.destroyChildren()},startLifeCycle:function(e,n){this.setDefaultConfig(),i.extend(this.config,n||{}),this.fire("beforeInit",{config:this.config});var t=this.config.children;this.children=[];var s=i.isArray(t)&&i.size(t)>0&&this.config.visible;if(s){var r=this.config.children,o=this.config.context||{};this.fire("createComponents",{components:r,context:o})}else this.completeInitializationWithoutChildren(),this.completeInitializationWithoutChildrenLazy()},_useAnimation:function(i){if(!this._loaded||this.config.useAnimation===!1||e.fx.off)return!1;var n=e.contains(document.documentElement,i[0]);return n&&!i.parents(".tau-bubble:first").length},toggle:function(i,e,n){n!==!1&&this._useAnimation(i)?e?i.slideDown(200,this._fireVisibilityChanged.bind(this,i,e)):i.slideUp(200,this._fireVisibilityChanged.bind(this,i,e)):(this._super(i,e),this._fireVisibilityChanged(i,e))
},_fireVisibilityChanged:function(e,n){var t=n?"show.completed":"hide.completed",s=n?"container.show.completed":"container.hide.completed";this.fire(t,e),i.each(this.children,function(i){i.fire(s,e)},this)},_getRenderConfig:function(){var i=this.config;return i.visible&&(this._loaded=!0),i},destroyChildren:function(){this.children&&this.children.length&&i.invoke(this.children,"destroy"),this.children=null},destroy:function(){this.destroyChildren(),this._super()}})});