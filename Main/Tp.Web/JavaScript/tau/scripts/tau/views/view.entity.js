define(["Underscore","tau/core/view-base","tau/components/component.container","tau/configurations/factory.container.config"],function(_,a,b,c){return a.extend({init:function(a){this._super(a),this.config.placeholder&&this.config.placeholder.addClass("ui-entity-view")},"container afterInit":function(a){this.fireAfterInit()},initialize:function(){},"container afterRender":function(a){this.fireBeforeRender(),this.element=a.data.element,this.config.placeholder&&this.config.placeholder.append(this.element),this.config.placeholder&&this.config.placeholder.addClass("tau-entity-loaded"),this.fireAfterRender()},initializeContainer:function(a){this.container.initialize(a)},getStateFields:function(a){var b={};a.hasOwnProperty("stateName")&&(b[a.stateName]=a);var c=this,d=[];if(_.isArray(a.children))d=a.children;else if(_.isArray(a.tabs)){var e=_.pluck(a.tabs,"items");d=_.flatten(e)}return _.each(d,function(a){_.extend(b,c.getStateFields(a))}),b},"bus contextRetrieved":function(a){var d=this,e=a.data;_.extend(e,d.config.containerConfig||c.getConfig(e));var f=this.getStateFields(e);this.container=b.create({name:"entity container",store:this.config.store}),this.container.on("afterInit",this["container afterInit"],this),this.container.on("afterRender",this["container afterRender"],this),d.bus.fire("onConfigContainerCreated",e);if(!_.isEmpty(f)){var g=_.pluck(f,"stateName"),d=this;e.context.componentSettings.get({fields:g,callback:function(a){_.each(f,function(b,c){a.hasOwnProperty(c)&&(f[c][c]=a[c])}),d.initializeContainer(e)}})}else this.initializeContainer(e)},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},destroyContainer:function(){if(!this.container)return;this.container.destroy(),this.container=null},destroy:function(){this.destroyContainer(),this.container=null,this._super()}})})