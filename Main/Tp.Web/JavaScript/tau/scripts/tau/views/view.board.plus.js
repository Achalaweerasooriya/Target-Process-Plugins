define(["jQuery","tau/core/extension.base.stateful","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,EventEmitter,BoardPlusUtils){return EventEmitter.extend({name:"view.board.plus","bus view.build.skeleton":function(evt){BoardPlusUtils.resetCardIds();var data=evt.data;this.fire("template.bind",{name:"boardplus.skeleton",data:data})},"bus template.boardplus.skeleton.bound":function(evt){var self=this,$element=evt.data.element;this.fire("view.skeleton.built",{element:$element});var $cells=$element.find(".i-role-cell");self.fire("view.cellSlot.built.start",{cells:$cells}),$cells.each(function(){var coords={};this.hasAttribute("data-x")&&(coords.x=this.getAttribute("data-x")),this.hasAttribute("data-y")&&(coords.y=this.getAttribute("data-y")),self.fire("view.cellSlot.built",{element:this,data:coords})}),self.fire("view.cellSlot.built.end",{cells:$cells})},"bus view.build.cell.skeleton":function(evt){var data=evt.data,hasX=data.hasOwnProperty("x"),hasY=data.hasOwnProperty("y"),cellType=hasX&&hasY?"grid":"axis",templateName="boardplus.cell."+cellType+".skeleton",bindData=data;cellType=="axis"&&(bindData=BoardPlusUtils.convertCellAxisData(bindData)),this.bindCellTemplate(templateName,bindData)},bindCellTemplate:function(templateName,data){this.fire("template.bind",{name:templateName,data:data})},appendCellToBoardSkeleton:function(cellEvtData,$skeleton){var cellDataItem=cellEvtData.data,$cellContent=cellEvtData.element,cellId=BoardPlusUtils.generateId(cellDataItem),$cell=$skeleton.find("#"+cellId),target={cell:$cell,content:$cellContent};this.fire("view.cell.skeleton.element.beforeUpdate",target),$cell.append($cellContent),this.fire("view.cell.skeleton.element.afterUpdate",target),this.fireCellSkeletonBuilt({element:$cell,data:cellDataItem})},fireCellSkeletonBuilt:function(eventData){this.fire("view.cell.skeleton.built",eventData)},"bus view.skeleton.built:last+template.boardplus.cell.grid.skeleton.bound":function(evt){var $skeleton=evt["view.skeleton.built"].data.element,cellEvtData=evt["template.boardplus.cell.grid.skeleton.bound"].data;this.appendCellToBoardSkeleton(cellEvtData,$skeleton)},"bus view.skeleton.built:last+template.boardplus.cell.axis.skeleton.bound":function(evt){var $skeleton=evt["view.skeleton.built"].data.element,cellEvtData=evt["template.boardplus.cell.axis.skeleton.bound"].data;this.appendCellToBoardSkeleton(cellEvtData,$skeleton)},"bus view.cell.skeleton.built":function(evt){var self=this,evtData=evt.data,dataItem=evtData.data,hasX=dataItem.hasOwnProperty("x"),hasY=dataItem.hasOwnProperty("y");if(hasX&&hasY){var $cell=evtData.element;$cell.find(".i-role-card").each(function(){var $card=$(this);self.fire("view.card.skeleton.built",{element:$card,data:{id:$card.attr("data-id"),type:$card.attr("data-type")}})})}}})})