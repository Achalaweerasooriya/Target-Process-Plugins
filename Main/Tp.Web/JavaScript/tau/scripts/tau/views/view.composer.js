define(["Underscore","jQuery","tau/core/view-base","tau/core/event-dispatcher"],function(_,$,a,b){var c=a.extend({init:function(a){this._loaded=!1,this._super(a)},initialize:function(){var a=this,b=a.config.children,c=_.size(b)>0&&a.config.visible;if(c){var d=a.config.children,e=a.config.context||{};this.fire("createComponents",{components:d,context:e})}else a._super.apply(a,arguments),a._fireChildrenRendered({children:[],childrenEvtArgs:[]})},"bus componentCreated":function(a){var b=a.data.component;this.fire("childComponentCreated",b)},"bus componentsCreated":function(a){this.fire("beforeComponentsInitialize",a.data),this.initializeChildrenComponents(a),this.fire("afterComponentsInitialize",a.data)},initializeChildrenComponents:function(a){var c=this,d=_(a.data).pluck("component"),e=_(a.data).pluck("config");c.dispatcher=new b(d),c.dispatcher.listen("afterInit",function(a){c.fireAfterInit()}),c.dispatcher.listen("afterRender",function(a){var b=a.argsArr,e={children:d,childrenEvtArgs:b};c._fireChildrenRendered(e)}),_(d).each(function(a,b){a.fire("initialize",e[b])})},_fireChildrenRendered:function(a){this.fire("internalChildrenRendered",a)},"bus afterInit+dataBind":function(a){},"bus afterInit+dataBind+internalChildrenRendered":function(a){this.destroyChildComponents();var b=this,c=a.afterInit.data,d=a.dataBind.data,e=a.internalChildrenRendered.data;b.children=e.children,b.config.visible&&(b._loaded=!0);if(e.children.length===0)b.render(d,c);else{b.fireBeforeRender({data:d});var f=b.bindTemplate(d);f.find("[runas]").each(function(a,b){var c=$(this),d=c.attr("runas"),f=c.attr("componentId"),g=_(e.childrenEvtArgs).detect(function(a,b){var c=a.view.config;return c.type===d&&c.id.toString()===f});if(!g){var i='Component "'+f+'" type of ['+d+"] not found";throw i}var h=g.element;c.replaceWith(h)}),f=b.prepareElement(f),b.fire("childrenRendered",e.children),b.updateElement(f,c.refreshSelector),!b.config.visible&&b.hide(),b.fireAfterRender({data:d})}},"bus show":function(){this._super(),this._loaded||this.fire("initialize",{})},lifeCycleCleanUp:function(){this._super()},destroyChildComponents:function(){delete this.dispatcher;var a=null;if(this.children&&this.children.length)while(a=this.children.pop())a.destroy();delete this.children},destroy:function(){this.destroyChildComponents(),this._super()}});return c})