define(["require","Underscore","tau/core/view-base","tau/components/component.container","tau/configurations/factory.container.config","tau/configurations/const.page.entity.modes","tau/configurations/const.page.entity.actions"],function(t){var n=t("Underscore"),e=t("tau/core/view-base"),i=t("tau/components/component.container"),o=t("tau/configurations/factory.container.config"),a=t("tau/configurations/const.page.entity.modes"),r=t("tau/configurations/const.page.entity.actions");return e.extend({init:function(t){this.tausInitialLoad=taus.start("statistics_view",{"@":["--add-last-view-entity-context"],tags:["initial load"]}),this._super(t),this.config.placeholder&&this.config.placeholder.addClass("ui-entity-view")},"container afterInit":function(){this.fireAfterInit()},initialize:function(){},"container afterRender":function(t,n){this.tausInitialLoad&&this.tausInitialLoad.stop(),this.render(n.element)},"bus configurator.ready:last + loadingError.ready":function(t,n,e){n.getTitleManager().set(e.message);var i=n.getHistory().pop(),o=n.getTemplateFactory().get("page.error").bind({},{err:e,backLink:i?i.url:null});this.render(o)},render:function(t){this.fireBeforeRender(),this.element=t,this.config.placeholder&&(this.config.placeholder.append(t),this.config.placeholder.addClass("tau-entity-loaded")),this.fireAfterRender()},initializeContainer:function(t){this.container&&this.container.initialize(t)},getStateFields:function(t){var e={};t.hasOwnProperty("stateName")&&(e[t.stateName]=t);var i=this,o=[];if(n.isArray(t.children))o=t.children;else if(n.isArray(t.tabs)){var a=n.pluck(t.tabs,"items");o=n.flatten(a)}return n.each(o,function(t){n.extend(e,i.getStateFields(t))}),e},"bus contextRetrieved":function(t,e){var a=this,r=this._createConfig(e);n.extend(r,a.config.containerConfig||o.getConfig(r)),this.container=i.create({name:"entity container",store:this.config.store,context:a.config.context,cssClass:a.config.cssClass,extensions:r.extensions||[]}),this.bus.on("afterRender",function(t,n){this.container.on("afterRenderAll",function(){this.fire("afterRenderAll",n)
},this)},this),this.container.on("afterInit",this["container afterInit"],this),this.container.on("afterRender",this["container afterRender"],this);var s=function(t){a.fire("onConfigContainerCreated",t),a.fire("initializeContainer",t)};a.fire("configReadyForIntegration",r),r.integrationReadyPromise?r.integrationReadyPromise.always(function(t){s(t)}):s(r)},_createConfig:function(t){return n.extend(t,{action:this.config.action||r.SHOW,mode:this.config.mode||a.FULL,registry:this.config.registry||{}})},"bus onConfigContainerCreated+initializeContainer":function(t,e){var i=this,o=i.getStateFields(e),a=i.config.context.configurator;if(n.isEmpty(o))e.context.configurator=a,i.initializeContainer(e);else{var r=n.pluck(o,"stateName");e.context.componentSettings.get({fields:r,callback:function(t){n.each(o,function(n,e){t.hasOwnProperty(e)&&(o[e][e]=t[e])}),e.context.configurator=a,i.initializeContainer(e)}})}},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},destroyContainer:function(){this.container&&(this.container.destroy(),this.container=null)},destroy:function(){this.destroyContainer(),this.container=null,this._super()}})});