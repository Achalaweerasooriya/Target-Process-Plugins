define(["tau/store/store","tau/core/repository","tau/services/service.rest","tau/core/keyboard.manager","tau/core/bus","tau/utils/utils.routing","tau/utils/utils.history","libs/parseUri","tau/services/service.globalSettings","tau/services/service.notifications","tau/services/service.actions","tau/rules/core","tau/rules/rule.auto-include-before-save","tau/rules/rule.auto-action-after-save","tau/target.process.rules.registrator"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){var a=new d;return this.getKeyBoardManager=function(){return a},this.getKeyBoardManager()}return{ckPath:"../Ckeditor/",getKeyBoardManager:p,globalBus:null,_config:{},setGlobalSettingsService:function(a){this.globalSettingsService=a},getGlobalSettingsService:function(){if(!this.globalSettingsService){var a={appPath:this.getApplicationPath()};this.globalSettingsService=new i(a)}return this.globalSettingsService},setNotificationService:function(a){this.notificationService=a},getNotificationService:function(){if(!this.notificationService){var a={appPath:this.getApplicationPath()};this.notificationService=new j(a)}return this.notificationService},setActionsService:function(a){this.actionsService=a},getActionsService:function(){if(!this.actionsService){var a={appPath:this.getApplicationPath()};this.actionsService=new k(a)}return this.actionsService},clearSingles:function(){this.rulesEngine&&(this.rulesEngine.destroy&&this.rulesEngine.destroy(),delete this.rulesEngine),delete this.proxy,delete this.service,delete this.store},clear:function(){this.clearSingles(),this.globalBus&&this.globalBus.removeAllListeners(),delete this.globalBus,delete this.initialData,delete this.appPath,delete this.currentDate,delete this.rulesDisabled},getCurrentAcid:function(){var a="",b=this.getWindow();if(b.location&&b.location.href){var c=b.location.href;a=h(c).queryKey.acid||a}return a},setWindow:function(a){this.window=a},getWindow:function(){return this.window||window},getHistory:function(){return this.history||(this.history=new g),this.history},getRouting:function(){return this.routing||(this.routing=new f({window:this.getWindow()})),this.routing},setCurrentDate:function(a){this.currentDate=a},getCurrentDate:function(){return this.currentDate?this.currentDate:new Date},getGlobalBus:function(){return this.globalBus=this.globalBus||new e({id:"global",name:"globalBus"}),this.globalBus},setApplicationPath:function(a){if(this.appPath===a)return;this.appPath=a},getApplicationPath:function(){return this.appPath},getCkPath:function(){return this.ckPath},setCkPath:function(a){this.ckPath=a},setInitialData:function(a){this.initialData=a},setService:function(a){if(this.service===a)return;this.clearSingles(),this.service=a},getService:function(){return this.service||(this.service=new c({appPath:this.getApplicationPath(),path:this.getRestPath()})),this.service},getRestPath:function(){return this.getApplicationPath()+"/api/v1"},setProxy:function(a){this.proxy=a},getProxy:function(){return this.proxy||(this.proxy=new b({service:this.getService()})),this.initialData&&(this.proxy.registerData(this.initialData,!0),delete this.initialData),this.proxy},disableRules:function(){this.rulesDisabled=!0},enableRules:function(){this.rulesDisabled=!1},initRules:function(){if(this.rulesDisabled==1)return;this.rulesEngine=new l({store:this.store,rules:[],rulesImpl:[m,n]}),o.registerRules(this.rulesEngine,this)},getStore:function(b){return b=b||{},this.store||(b.proxy=this.getProxy(),_.defaults(b,{eventEmitter:this.getGlobalBus()}),this.store=new a(b),this.initRules()),this.store},setConfig:function(a,b){this._config[a]=b},getConfig:function(a,b){var c=b;return this._config.hasOwnProperty(a)&&(c=this._config[a]),c}}})