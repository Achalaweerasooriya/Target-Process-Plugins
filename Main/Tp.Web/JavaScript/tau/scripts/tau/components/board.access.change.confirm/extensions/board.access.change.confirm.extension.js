define(["require","Underscore","tau/core/extension.base","../models/board.access.level.constants"],function(e){var t=e("Underscore"),s=e("tau/core/extension.base"),a=e("../models/board.access.level.constants");return s.extend({"bus beforeInit":function(e,s){var a=s.config.context,n=a.configurator;n.getApplicationContextService().getTeamsProjectsAvailable(n.getLoggedUser().id).done(function(e){var s=this._getOldAccessDetails(a.view,a.group,e.projects,e.teams),n=this._getNewAccessDetails(a.view,a.group,e.projects,e.teams);t.isEqual(s,n)?a.onApply():this.fire("props.ready",{currentAccessDetails:s,newAccessDetails:n,onApply:a.onApply,onCancel:a.onCancel})}.bind(this))},_markItems:function(e,s,a){e&&s&&e.forEach(function(e){t.contains(s,e.id)||a(e)})},_getOldAccessDetails:function(e,t,s,a){var n=this._getAccessDetails(e,s,a);return e.getIsCustomShared()&&t.getIsCustomShared()&&(this._markItems(n.projects,t.customSharedData.projectIds,function(e){e.removed=!0}),this._markItems(n.teams,t.customSharedData.teamIds,function(e){e.removed=!0})),n},_getNewAccessDetails:function(e,t,s,a){var n=this._getAccessDetails(t,s,a);return e.getIsCustomShared()&&t.getIsCustomShared()&&(this._markItems(n.projects,e.customSharedData.projectIds,function(e){e.added=!0}),this._markItems(n.teams,e.customSharedData.teamIds,function(e){e.added=!0})),n},_getAccessDetails:function(e,s,n){return e.getIsPublic()?{sharing:a.PUBLIC}:e.getIsCustomShared()?{sharing:a.CUSTOM,projects:t.chain(s).filter(function(s){return t.contains(e.customSharedData.projectIds,s.id)}).map(t.clone).value(),teams:t.chain(n).filter(function(s){return t.contains(e.customSharedData.teamIds,s.id)}).map(t.clone).value()}:{sharing:a.PRIVATE}}})});