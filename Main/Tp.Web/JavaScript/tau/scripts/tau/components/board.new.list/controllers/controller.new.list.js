define(["require","Underscore","tau/core/controller.base","./controller.new.list.tree.root","tau/models/board.plus/model.board.slice.extender","../models/model.new.list.tree.root","tau/libs/boardSettings/board.settings.to.definition.translator","tau/components/board.new.list/models/counts.strategies.factory"],function(e){var t=e("Underscore"),i=e("tau/core/controller.base"),o=e("./controller.new.list.tree.root"),n=e("tau/models/board.plus/model.board.slice.extender"),r=e("../models/model.new.list.tree.root"),s=e("tau/libs/boardSettings/board.settings.to.definition.translator"),a=e("tau/components/board.new.list/models/counts.strategies.factory");return i.extend({_lastRenderedElement:null,init:function(e,t,i,o,n,r,s,a,l,d){this._skeletonView=e,this._listModel=t,this._eventAggregator=i,this._configurator=s,this._editorComponentBuilder=o,this._quickAddComponentBuilder=n,this._contextMenuComponentBuilder=r,this._sliceFactory=a,this._componentBus=l,this._behaviorsConfig=d},startLifeCycle:function(e,t,i){taus.start("statistics_newlist_cardLoad",{},"statistics_newlist_cardLoad");var o=new s(e,i);o.getBoardDefinition().then(function(e){var i=e.definition,o=e.configuration;this._eventAggregator.acidRetrieved.fire(i.global.acid),this._eventAggregator.boardSettingsRetrieved.fire(o),this._eventAggregator.definitionReady.fire(i,o);var r={definition:i},s=this._sliceFactory.create(r),a=new n;a.extend({slice:s},t).then(function(e){this._eventAggregator.sliceServiceCreated.fire({service:e.slice,definition:i})}.bind(this))}.bind(this))},buildSkeleton:function(e,t){var i=this._listModel.getEmptyModelInfoArgs(e.config.definition);this._eventAggregator.sliceInfoRetrieved.fire(i),this._skeletonView.buildSkeleton(e.config.definition,i,t)},render:function(e,i,n){var s=i.config.definition;e.get(["cellPaging"]).then(t.bind(function(a){var l={paging:a.cellPaging,boardId:e.settings.id,listSettings:{apiService:i,boardSettingsService:e,serviceContainer:this._configurator,options:this._extendDefaultListOptions(n,s)}},d=n.TreeRootModel?new n.TreeRootModel(this._eventAggregator,l):new r(this._eventAggregator,l);
if(this._listModel.setup(d,s),this._listModel.isNotConfigured())this._skeletonView.showNotConfiguredMessage();else{var c=new o(d,this._skeletonView,this._eventAggregator,this._editorComponentBuilder,this._quickAddComponentBuilder,this._configurator,l);c.startLifeCycle(),this._addChildDestroyable(c),t.each(this._createBehaviors(l,c,d),function(e){this._addChildDestroyable(e),e.attach()},this)}},this))},_extendDefaultListOptions:function(e,i){return t.defaults(t.clone(e),this._getListStrategies(i))},_getListStrategies:function(e){return{countsStrategy:a.create(e)}},_createBehaviors:function(e,i,o){var n={eventAggregator:this._eventAggregator,skeletonView:this._skeletonView,configurator:this._configurator,componentBus:this._componentBus,rootTreeController:i,modelSettings:e,listModel:this._listModel,treeRootModel:o,contextMenuComponentBuilder:this._contextMenuComponentBuilder,behaviorsSettings:this._behaviorsConfig.settings};return t.map(this._behaviorsConfig.behaviors,function(e){return new e(n)})}})});