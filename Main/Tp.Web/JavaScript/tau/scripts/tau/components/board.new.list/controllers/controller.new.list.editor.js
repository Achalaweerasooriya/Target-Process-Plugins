define(["Underscore","jQuery","tau/core/controller.base"],function(i,t,n){var e=n.extend({init:function(i,t,n,e){this._view=i,this._treeNodeModel=t,this.configurator=e,this._editorComponentBuilder=n,this._initSubscriptions()},startLifeCycle:function(){this._view.startListen()},_initSubscriptions:function(){this._view.unitClicked.add(this._onUnitClicked.bind(this))},_onUnitClicked:function(t){var n=this.configurator.getUnitsRegistry().getUnitById(t.unitId),e=this._treeNodeModel.hierarchy.findChildByCardId(t.cardId).card,o=n&&e&&n.editorConfig;if(o){var d=null;d=i.delay(function(){this._view.toggleUnitBusyIndicator(t.$unit,!0)}.bind(this),200),this._createEditorComponent(e,n,t.$card,t.$unit).then(function(){clearTimeout(d),this._view.toggleUnitBusyIndicator(t.$unit,!1)}.bind(this)),taus.track({action:"open editor",unit:n.name,cardType:e.type,tags:["newlist"]})}},_createEditorComponent:function(i,t,n,e){return this._editorComponentBuilder.createEditorView(i,t,n,e).then(this._initEditorViewSubscriptions.bind(this,i,t))},_initEditorViewSubscriptions:function(i,t,n){n.toggleFocus(!0),n.unitEditorUpdating.add(function(){n.toggleBusyIndicator(!0)}),n.unitEditorUpdated.add(function(i){this._treeNodeModel.loadCard(i.cardId,i.cardType).always(function(){n.toggleBusyIndicator(!1)})}.bind(this)),n.unitEditFinished.add(function(){n.toggleFocus(!1)}.bind(this))}});return e});