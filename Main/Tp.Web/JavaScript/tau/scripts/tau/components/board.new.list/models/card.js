define(["Underscore","tau/core/class"],function(t,e){return e.extend({init:function(e){t.each(e,function(t,e){this[e]=t},this),this.entity=t.extend(e.data.cardData||{},{entityType:{name:e.type}})},getCardProperties:function(){return t.chain(t.keys(this)).filter(function(e){return!t.isObject(this[e])},this).map(function(t){return{key:t,propertyName:t,getValue:function(e){return e[t]},setValue:function(e,n){e[t]=n}}},this).union(t.map(this.data,function(t,e){return{key:"data__"+e,propertyName:e,getValue:function(t){return t.data[e]},setValue:function(t,n){t.data[e]=n}}},this)).value()},getDiff:function(e){var n=this,a=e.getCardProperties();return t.chain(this.getCardProperties()).map(function(i){var r=t.find(a,function(t){return i.key==t.key});if(!r)return null;var u=t.isEqual(r.getValue(e),i.getValue(n));return u?null:r}).compact().value()},getId:function(){return this.data.cardData.id},getEncodedId:function(){return this.id},getEntityType:function(){return this.data.cardData.type},isNoValueCard:function(){return!!this.data.empty}})});