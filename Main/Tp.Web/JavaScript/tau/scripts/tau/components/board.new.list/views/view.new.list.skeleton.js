define(["require","Underscore","jQuery","tau/core/class","tau/components/board.new.list/templates/template.new.list","tau/components/board.new.list/templates/template.new.list.subtree","tau/components/board.new.list/views/view.new.list.tree.root","tau/ui/templates/board.plus/ui.template.board.plus.emptyMessage","tau/components/board.new.list/views/columnWidthService","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function(e){"use strict";var t=e("Underscore"),i=e("jQuery"),n=e("tau/core/class"),s=e("tau/components/board.new.list/templates/template.new.list"),o=e("tau/components/board.new.list/templates/template.new.list.subtree"),r=e("tau/components/board.new.list/views/view.new.list.tree.root"),a=e("tau/ui/templates/board.plus/ui.template.board.plus.emptyMessage"),l=e("tau/components/board.new.list/views/columnWidthService"),u=e("tau/ui/behaviour/common/ui.behaviour.progressIndicator");return n.extend({$el:null,_$currentRoot:i(),columnWidthService:null,cardLayoutFactory:null,_rootView:null,_EVENT_NAME_SPACE:".newlist",init:function(e,i,n){this.configurator=e,this.eventAggregator=i,this._columnWidthOptions=n.columnWidths,this.treeViewCreated=t.Callbacks(),this._eventNamespace=t.uniqueId(this._EVENT_NAME_SPACE),this._getEmptyTemplate=n.getEmptyTemplate,this._getOrCreateLoader=n.getOrCreateLoader},setCardLayoutFactory:function(e){this.cardLayoutFactory=e},buildSkeleton:function(e,t,n){return this._boardSettings=n,i.when(s.render(t)).then(function(t){return this.columnWidthService=new l(n,this._columnWidthOptions),this.eventAggregator.skeletonBuilt.fire(t),this._setElement(e,t),t}.bind(this)).promise()},_setElement:function(e,t){this.$el&&this.$el.replaceWith(t),this.$el=t},createTreeView:function(e){return i(this.configurator.getWindow()).off("resize"+this._eventNamespace).on("resize"+this._eventNamespace,t.throttle(this.resize.bind(this),250)),this._$currentRoot.remove(),this._$currentRoot=o.render(e),this.columnWidthService.setElementScope(this._$currentRoot),e.cardAdded.add(this.updateEmptyListMessage,this),e.cardDeleted.add(this.updateEmptyListMessage,this),this._rootView=new r(e,this._$currentRoot,null,this),this.treeViewCreated.fire(this._rootView),this._rootView
},appendRoot:function(){var e=this.$el.find(".i-role-list-root-container");e.css("opacity",0),e.append(this._$currentRoot),this.calculateColumnWidths(),e.css("opacity",1)},findRootPagingContainer:function(){return this.$el.find(".i-role-pagingholder").eq(0)},findView:function(e){return this._rootView.findView(e)},getAllTreeViews:function(){if(!this._rootView)return[];var e=function(i){return(i.subViews||[]).concat(t.flatMap(i.subViews,e))};return[this._rootView].concat(e(this._rootView))},showNotConfiguredMessage:function(){var e={message:"Set up your list View",type:"notConfigured"},t=a.render(e);this.$el.prepend(t),this.eventAggregator.treeRendered.fire(i())},updateEmptyListMessage:function(){var e=this._rootView.treeModel,t=this.$el.find(".i-role-board-body");if(e.items&&e.items.length)t.find(".i-role-empty-message").remove();else{var n="Yikes...! Nothing in there :-|",s=this._getEmptyTemplate?i('<div class="i-role-empty-message"></div>').append(this._getEmptyTemplate(n)):a.render({message:n,type:"isEmpty"});t.append(s)}this.eventAggregator.hasDataInSliceChanged.fire(e)},calculateColumnWidths:function(){this.columnWidthService.resetCache(),i.when(this._calculateColumnWidthsFor(".tau-list-level",!1)).then(function(){taus.track({action:"name column width calculate",width:this.columnWidthService.layout.name,tags:["newlist"]})}.bind(this))},calculateColumnWidthsForLevel:function(e,t){this.calculateColumnWidthsForMultipleLevels([e],t)},calculateColumnWidthsForMultipleLevels:function(e,i){var n=t.map(e,function(e){return".tau-list-level-"+e}).join(", ");this._calculateColumnWidthsFor(n,i)},_calculateColumnWidthsFor:function(e,n){var s=t.map(this.$el.find(e),function(e){var t=i(e);return{levelKey:t.data("listLevelKey"),levelContainer:e}});return this.columnWidthService.calculateColumnWidths(s,n)},toggleProgress:function(e){var t=this._getOrCreateLoader?this._getOrCreateLoader(this.$el):u.get(this.$el);e?t.show():t.hide(),this.$el.find(".i-role-board-body").css("opacity",e?.5:1)
},resize:function(){this.columnWidthService.resize(this.$el)},cleanup:function(){this._rootView=null,this.treeViewCreated.empty(),i(this.configurator.getWindow()).off(this._eventNamespace)},destroy:function(){this.cleanup()}})});