define(["Underscore","jQuery","tau/core/class","tau/components/board.new.list/templates/template.new.list","tau/components/board.new.list/templates/template.new.list.subtree","tau/components/board.new.list/views/view.new.list.tree.root","tau/ui/templates/board.plus/ui.template.board.plus.emptyMessage","tau/components/board.new.list/views/columnWidthService","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function(e,t,i,n,o,r,s,a,l){"use strict";return i.extend({$el:null,_$currentRoot:t(),columnWidthService:null,cardLayoutFactory:null,_rootView:null,_eventNamespace:".newlist",init:function(t,i){this.configurator=t,this.eventAggregator=i,this.treeViewCreated=e.Callbacks()},setCardLayoutFactory:function(e){this.cardLayoutFactory=e},buildSkeleton:function(i,o,r){return this._boardSettings=r,t.when(n.render(o)).then(e.bind(function(e){return this.columnWidthService=new a(r),this.eventAggregator.skeletonBuilt.fire(e),this._setElement(i,e),e},this)).promise()},_setElement:function(e,t){this.$el&&this.$el.replaceWith(t),this.$el=t},createTreeView:function(i){return t(this.configurator.getWindow()).off("resize"+this._eventNamespace).on("resize"+this._eventNamespace,e.throttle(this.resize.bind(this),250)),this._$currentRoot.remove(),this._$currentRoot=o.render(i),this.columnWidthService.setElementScope(this._$currentRoot),i.cardAdded.add(this.updateEmptyListMessage,this),i.cardDeleted.add(this.updateEmptyListMessage,this),this._rootView=new r(i,this._$currentRoot,null,this,this.columnWidthService),this.treeViewCreated.fire(this._rootView),this._rootView},appendRoot:function(){var e=this.$el.find(".i-role-list-root-container");e.css("opacity",0),e.append(this._$currentRoot),this.calculateColumnWidths(),e.css("opacity",1)},findBoardContainer:function(){return this.$el.find(".tau-board-list-view__inner")},findRootPagingContainer:function(){return this.$el.find(".i-role-pagingholder").eq(0)},findView:function(e){return this._rootView.findView(e)},getAllTreeViews:function(){if(!this._rootView)return[];var t=function(i){return(i.subViews||[]).concat(e.flatMap(i.subViews,t))};return[this._rootView].concat(t(this._rootView))},showNotConfiguredMessage:function(){var e={message:"Set up your list View",type:"notConfigured"},i=s.render(e);this.$el.prepend(i),this.eventAggregator.treeRendered.fire(t())},updateEmptyListMessage:function(){var e=this._rootView.treeModel,t=this.$el.find(".i-role-board-body");if(e.items&&e.items.length)t.find(".i-role-empty-message").remove();else{var i={message:"Yikes...! Nothing in there :-|",type:"isEmpty"};s.render(i).appendTo(t)}this.eventAggregator.hasDataInSliceChanged.fire(e)},calculateColumnWidths:function(){this.columnWidthService.resetCache(),t.when(this._calculateColumnWidthsFor(".tau-list-level",!1)).then(function(){taus.track({action:"name column width calculate",width:this.columnWidthService.layout.name,tags:["newlist"]})}.bind(this))},calculateColumnWidthsForLevel:function(e,t){this.calculateColumnWidthsForMultipleLevels([e],t)},calculateColumnWidthsForMultipleLevels:function(t,i){var n=e.map(t,function(e){return".tau-list-level-"+e}).join(", ");this._calculateColumnWidthsFor(n,i)},_calculateColumnWidthsFor:function(i,n){var o=e.map(this.$el.find(i),function(e){var i=t(e);return{levelKey:i.data("listLevelKey"),levelContainer:e}});return this.columnWidthService.calculateColumnWidths(o,n)},toggleProgress:function(e){var t=l.get(this.$el);e?t.show():t.hide(),this.$el.find(".i-role-board-body").css("opacity",e?.5:1)},resize:function(){this.columnWidthService.resize(this.$el)},cleanup:function(){this._rootView=null,this.treeViewCreated.empty(),t(this.configurator.getWindow()).off(this._eventNamespace)},destroy:function(){this.cleanup()}})});