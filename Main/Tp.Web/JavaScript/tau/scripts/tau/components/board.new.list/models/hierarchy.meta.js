define(["Underscore","tau/core/class","tau/utils/utils.debug"],function(e,t,r){return t.extend({init:function(t){this._globalMeta=t,r.assertWarn(e.isArray(t),"Global meta should be an array"),e.each(t,this._extendMetaForLevel.bind(this))},getMetaForLevelAndType:function(t,n){var a=this._globalMeta[t];return a?a.groups?(r.assertError(e.isString(n),"Parent entity type should be specified for entities at inner levels"),a.groups[n.toLowerCase()]):a:null},getMetaForCells:function(){var t=e.find(this._globalMeta,function(e){return"cells"==e.levelType});return t?(r.assertError(e.isUndefined(t.groups),"Cell level meta should not contain entity groups"),t):null},_extendMetaForLevel:function(t,r,n){var a={levelType:t.levelType,totalLevelCount:n.length,findCardTypeByValueType:function(t){return t=t.toLowerCase(),e.find(this.cardTypes,function(e){return e.valueType.toLowerCase()===t})},hasNextLevel:function(){var e=n[r+1];return e&&("cells"!==e.levelType||e.cardTypes.length>0)}};t.groups?t.groups=this._createExtendedLevelMetaGroups(t.groups,a):e.defaults(t,a)},_createExtendedLevelMetaGroups:function(t,r){return e.reduce(t,function(t,n,a){var l=a.toLowerCase();return t[l]=e.defaults(n,r,{parentEntityType:l}),t},{})},_getCardTypesForLevel:function(t){return t.groups?e.flatMap(t.groups,function(e){return e.cardTypes}):t.cardTypes}})});