define(["require","Underscore","tau/core/class","tau/utils/debug/utils.debug"],function(e){function t(e){return e.groups?r.flatMap(e.groups,r.property("cardTypes")):e.cardTypes}var r=e("Underscore"),l=e("tau/core/class"),n=e("tau/utils/debug/utils.debug");return l.extend({init:function(e){this._globalMeta=e,n.assertWarn(r.isArray(e),"Global meta should be an array"),r.each(e,this._extendMetaForLevel.bind(this))},getMetaForLevelAndType:function(e,t){var l=this._globalMeta[e];return l?l.groups?(n.assertError(r.isString(t),"Parent entity type should be specified for entities at inner levels"),l.groups[t.toLowerCase()]):l:null},getMetaForCells:function(){var e=r.find(this._globalMeta,function(e){return"cells"==e.levelType});return e?(n.assertError(r.isUndefined(e.groups),"Cell level meta should not contain entity groups"),e):null},_extendMetaForLevel:function(e,l,n){var s={levelType:e.levelType,canAssignTypes:e.canAssignTypes,totalLevelCount:n.length,isCellLevel:"cells"===e.levelType,isRootLevel:0===l,isAxisLevel:"entityHierarchyCells"===e.levelType||!("cells"===e.levelType),isInnerCollectionsLevel:"innerCollections"===e.levelType,findCardTypeByValueType:function(e){return e=e.toLowerCase(),r.find(this.cardTypes,function(t){return t.valueType.toLowerCase()===e})},hasNextLevel:function(){var e=n[l+1];return e&&("cells"!==e.levelType||e.cardTypes.length>0)},getCardTypesForAllLevels:function(){return r.flatMap(n,t)}};e.groups?e.groups=this._createExtendedLevelMetaGroups(e.groups,s):r.defaults(e,s)},_createExtendedLevelMetaGroups:function(e,t){return r.reduce(e,function(e,l,n){var s=n.toLowerCase();return e[s]=r.defaults(l,t,{parentEntityType:s}),e},{})}})});