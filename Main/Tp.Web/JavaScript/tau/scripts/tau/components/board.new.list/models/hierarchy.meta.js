define(["Underscore","tau/core/class","tau/utils/debug/utils.debug"],function(e,t,r){return t.extend({init:function(t){this._globalMeta=t,r.assertWarn(e.isArray(t),"Global meta should be an array"),e.each(t,this._extendMetaForLevel.bind(this))},getMetaForLevelAndType:function(t,l){var n=this._globalMeta[t];return n?n.groups?(r.assertError(e.isString(l),"Parent entity type should be specified for entities at inner levels"),n.groups[l.toLowerCase()]):n:null},getMetaForCells:function(){var t=e.find(this._globalMeta,function(e){return"cells"==e.levelType});return t?(r.assertError(e.isUndefined(t.groups),"Cell level meta should not contain entity groups"),t):null},_extendMetaForLevel:function(t,r,l){var n={levelType:t.levelType,totalLevelCount:l.length,isCellLevel:"cells"===t.levelType,isRootLevel:0===r,isAxisLevel:"entityHierarchyCells"===t.levelType||!("cells"===t.levelType),isInnerCollectionsLevel:"innerCollections"===t.levelType,findCardTypeByValueType:function(t){return t=t.toLowerCase(),e.find(this.cardTypes,function(e){return e.valueType.toLowerCase()===t})},hasNextLevel:function(){var e=l[r+1];return e&&("cells"!==e.levelType||e.cardTypes.length>0)}};t.groups?t.groups=this._createExtendedLevelMetaGroups(t.groups,n):e.defaults(t,n)},_createExtendedLevelMetaGroups:function(t,r){return e.reduce(t,function(t,l,n){var s=n.toLowerCase();return t[s]=e.defaults(l,r,{parentEntityType:s}),t},{})},_getCardTypesForLevel:function(t){return t.groups?e.flatMap(t.groups,function(e){return e.cardTypes}):t.cardTypes}})});