define(["require","tau/core/class","Underscore","jQuery","tau/services/customize/unitEditors/unitEditorEventHandler","tau/services/customize/unitEditors/editor.utils"],function(t){var e=t("tau/core/class"),i=t("Underscore"),n=t("jQuery"),r=t("tau/services/customize/unitEditors/unitEditorEventHandler"),o=t("tau/services/customize/unitEditors/editor.utils"),a="custom_field__";return e.extend({init:function(t){this._$element=t.skeletonView.$el,this._treeRootModel=t.treeRootModel,this._configurator=t.configurator,this._bus=t.componentBus,this._eventNamespace=i.uniqueId(".listUnitEditorBehavior")},attach:function(){this._$element.on("click"+this._eventNamespace,".tau-elems-cell_unit-editable:not(.disabled)",function(t){var e=n(t.currentTarget);this._onUnitClicked(e),t.stopPropagation()}.bind(this))},_onUnitClicked:function(t){if(!o.unitHasBusyState(t)){var e=t.closest(".i-role-card"),i=t.find(".tau-board-unit"),n={$card:e,$unit:t,$unitData:i,cardId:e.data("id").toString(),cardType:e.data("entityType"),unitId:i.data("id").toString()},r=this._getUnit(n),a=this._treeRootModel.hierarchy.findAllDescendantNodesByCardIdAndType(n.cardId,n.cardType),d=(a[0]||{}).card;this._canCreateEditorView(r,d)&&this._createListUnitEditor(r,d,n.$unit,n.$card,this._treeRootModel)}},_getUnit:function(t){var e=i.startsWith(t.unitId,a)?this._configurator.getCustomFieldsUnitsFactory():this._configurator.getUnitsRegistry();return e.getUnitById(t.unitId)},_canCreateEditorView:function(t,e){return Boolean(t&&e&&t.interactionConfig&&t.interactionConfig.handler)},_createListUnitEditor:function(t,e,i,n,o){taus.track({action:"open editor",unit:t.name,cardType:e.type,tags:["newlist"]});var a={cardDataForUnit:e.data[t.id],unit:t,$unit:i,$card:n},d={configurator:this._configurator,hostBus:this._bus,unitEditorEventHandler:new r({whenUnitUpdated:function(){return o.loadCard(e.getEncodedId(),e.getEntityType())}})};return t.interactionConfig.handler(a,d)},destroy:function(){this._$element.off(this._eventNamespace)
}})});