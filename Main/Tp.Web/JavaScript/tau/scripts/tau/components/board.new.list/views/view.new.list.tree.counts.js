define(["Underscore","jQuery","tau/core/class","tau/ui/ui.templateFactory"],function(t,e,r,i){return r.extend({init:function(t,e,r){this.treeView=t,this.treeModel=r,this.countsModel=e,this.termProcessor=i.getTermProcessor(),this.treeModel.applyAndObserve(function(t){t.countsModel.dataLoaded.add(this._refreshCount.bind(this,t.countsModel))}.bind(this)),this.treeModel.cardUpdated.add(this._onCardUpdated.bind(this))},_onCardUpdated:function(t){var e=this.treeModel.hierarchy.findChildByCardId(t.card.id);this._refreshCount(e.countsModel)},_getTitle:function(e){var r;return e.data&&e.data.types&&(r=t.map(e.getTypedCountsForTitle(),function(t){var e=this._getTypePluralizedName(t.type);return(""===e?t.typeName:e)+": "+t.count},this).join(" / ")),r},_refreshCount:function(t){var e=t.getAllCount(),r=this.treeView.findChildCardById(t.treeModel.card.id),i=r.find(".tau-counter").first();i.length&&(i.text(e),i[0].title=this._getTitle(t));var d=r.find(".tau-board-unit").first();d.toggleClass("tau-board-unit--has-counter",!!e)},_getTypePluralizedName:function(t){return this.termProcessor.getTerm(t,"names")},destroy:function(){}})});