define(["require","Underscore","jQuery","tau/core/class","../customReport.spaceProcessor"],function(e){var t=e("Underscore"),s=e("jQuery"),i=e("tau/core/class"),l=e("../customReport.spaceProcessor"),n=i.extend({init:function(e){this.$el=e.$el},get:function(){var e=this.$el.find("[name=cells_filter]");return{items:t.map(this.$el.find(".tau-board-settings-cards .tau-btn.tau-checked"),function(e){return{id:s(e).prev().val()}}),filter:e.is(":visible")?e.val():""}},set:function(e,t,s,i){return this._disableUnavailableCells(this.$el,t,s,i,e)},bindActions:function(e,t,i,l){this.$el.on("click",".i-role-cell-type",function(e){if(this.disableSettingsChange)e.preventDefault(),e.stopPropagation();else{this.disableSettingsChange=!0;var n=s(e.currentTarget),a=n.prev("input");n.toggleClass("tau-checked");var r=n.hasClass("tau-checked");a.prop("checked",r),r&&this.$el.find(".tau-board-settings-cards h4").removeClass("tau-attention"),i.set({set:{cells:this._getSelectedCells(this.$el)}}),this._disableUnavailableCells(this.$el,t,i,l)}}.bind(this))},_disableUnavailableCells:function(e,t,i,n,a){return a?(this._processCells(e,a),s.Deferred().resolve()):(this.disableSettingsChange=!0,l.getSpaceTotal(t.getSliceFactory(),i,n).then(function(t){this._processCells(e,t),this.disableSettingsChange=!1}.bind(this)))},_processCells:function(e,i){var l=i.cells.types,n=e.find("[name=cells_types]");t.forEach(l,function(e){var t=!e.isAvailable,i=n.filter(function(){return this.value==e.id||s(this).hasClass("permission-denied")}),l=i.next();i.prop("disabled",t).toggleClass("tau-disabled",t),l.prop("disabled",t).toggleClass("tau-disabled",t)})},_getSelectedCells:function(e){var i=e.find("[name=cells_types]"),l=t.filter(i,function(e){return s(e).is(":checked")});return{types:t.map(l,function(e){return e.value})}}});return n});