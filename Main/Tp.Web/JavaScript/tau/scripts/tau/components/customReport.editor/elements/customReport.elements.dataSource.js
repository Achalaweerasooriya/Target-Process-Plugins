define(["require","Underscore","jQuery","tau/core/class","../customReport.spaceProcessor","./customReport.elements.empty.highlighter"],function(e){var t=e("Underscore"),i=e("jQuery"),s=e("tau/core/class"),l=e("../customReport.spaceProcessor"),n=e("./customReport.elements.empty.highlighter"),r=s.extend({init:function(e){this.$el=e.$el},get:function(){var e=this.$el.find("[name=cells_filter]");return{items:t.map(this.$el.find(".tau-board-settings-cards .tau-btn.tau-checked"),function(e){return{id:i(e).prev().val()}}),filter:e.is(":visible")?e.val():""}},set:function(e,t,i,s){return this._disableUnavailableCells(this.$el,t,i,s,e)},bindActions:function(e,t,s,l){this.$el.on("click",".i-role-cell-type",function(e){if(this.disableSettingsChange)e.preventDefault(),e.stopPropagation();else{this.disableSettingsChange=!0;var n=i(e.currentTarget),r=n.prev("input");n.toggleClass("tau-checked");var a=n.hasClass("tau-checked");r.prop("checked",a),a&&this.$el.find(".tau-board-settings-cards h4").removeClass("tau-attention"),s.set({set:{cells:this._getSelectedCells(this.$el)}}),this._disableUnavailableCells(this.$el,t,s,l),this._toggleCellsFilter(this.$el)}}.bind(this))},highlightIfEmpty:function(){this.isEmpty()&&n.highlightIfEmpty(this._getCaptionEl())},isEmpty:function(){return 0===this.$el.find(".tau-board-settings-cards .tau-btn.tau-checked").length},_getCaptionEl:function(){return this.$el.find(".tau-customReport-info .tau-customReport-info-select-dataSource")},_disableUnavailableCells:function(e,t,s,n,r){return r?(this._processCells(e,r),i.Deferred().resolve()):(this.disableSettingsChange=!0,l.getSpaceTotal(t.getSliceFactory(),s,n,t.getEntityFiltersService()).then(function(t){this._processCells(e,t),this.disableSettingsChange=!1}.bind(this)))},_processCells:function(e,s){var l=s.cells.types,n=e.find("[name=cells_types]");t.forEach(l,function(e){var t=!e.isAvailable,s=n.filter(function(){return this.value==e.id||i(this).hasClass("permission-denied")}),l=s.next();s.prop("disabled",t).toggleClass("tau-disabled",t),l.prop("disabled",t).toggleClass("tau-disabled",t)
}),this._toggleCellsFilter(e)},_toggleCellsFilter:function(e){e.find(".i-role-filter-control").find("input, button").not(".i-role-filter-toggle").prop("disabled",!this._getSelectedCells(e).types.length)},_getSelectedCells:function(e){var s=e.find("[name=cells_types]"),l=t.filter(s,function(e){return i(e).is(":checked")});return{types:t.map(l,function(e){return e.value})}}});return r});