define(["require","jQuery","tau/core/extension.base","tau/services/customReport/service.customReport.settings.wrapper","../customReport.settings.parser","../customReport.spaceProcessor"],function(e){var t=e("jQuery"),r=e("tau/core/extension.base"),i=e("tau/services/customReport/service.customReport.settings.wrapper"),s=e("../customReport.settings.parser"),n=e("../customReport.spaceProcessor");return r.extend({init:function(e){this._super(e),this._reportSettingsWrapper=new i},"bus boardSettings.ready:last + afterInit + configurator.ready:last":function(e,r,i,n){t.when(n.getAppStateStore().get({fields:["acid"]}),this._reportSettingsWrapper.getReportSettings(r.boardSettings)).then(function(e,t){var i=new s({reportSettings:t});r.boardSettings.set({set:{cells:i.getCells()}}),i.canParse()?this._fireDataReady(n,r,e,i):this.fire("dataBind",this._generateEmptyReport())}.bind(this))},_fireDataReady:function(e,t,r,i){var s=e.getLoggedUser(),o=e.getBoardAccessService(),a=o.isEditable(t.boardSettings.settings,s);n.getSpaceTotal(e.getSliceFactory(),t.boardSettings,r,e.getEntityFiltersService()).then(function(e){this.fire("acid.ready",r),this.fire("space.ready",e),this.fire("dataBind",this._generateReport(e,i,a))}.bind(this)),this.fire("editableState",{isEditable:a})},_generateReport:function(e,t,r){return{cells:e.cells,x1:this._dimensionFilterSource("x1",t.getX1()),x2:this._dimensionFilterSource("x2",t.getX2()),y1:this._dimensionFilterSource("y1",t.getY1()),y2:this._dimensionFilterSource("y2",t.getY2()),color:this._dimensionFilterSource("color",t.getColor()),size:this._dimensionFilterSource("size",t.getSize()),isEditable:r,canParse:!0}},_generateEmptyReport:function(){return{cells:{types:[]},x1:{},x2:{},y1:{},y2:{},color:{},size:{},isEditable:!1,canParse:!1}},"bus beforeInit":function(e,t){var r=t.config.context.configurator;this.fire("configurator.ready",r)},_dimensionFilterSource:function(e,t){var r=t&&t.filter?t.filter:"";return{name:e,useFilter:Boolean(r),filter:r}}})});