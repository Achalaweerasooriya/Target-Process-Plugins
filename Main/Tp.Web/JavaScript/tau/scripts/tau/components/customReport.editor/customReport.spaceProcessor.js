define(["require","JQuery","Underscore","tau/models/board.editor/board.filter.help"],function(e){var t=e("JQuery"),l=e("Underscore"),r=e("tau/models/board.editor/board.filter.help");return{getSpaceTotal:function(e,l,r){return t.when(this._spaceAvailable(e,r),this._spaceCells(e,l,r),this._getPredefinedFilters(l)).then(function(e,t,r){return this._processSpaces(e,t,r,l)}.bind(this))},_getPredefinedFilters:function(e){return e.get({fields:["cells"]}).then(function(e){return(new r).get({cells:e.cells})})},_spaceAvailable:function(e,t){var l={global:{acid:t}},r=e.create({definition:l});return r.space()},_spaceCells:function(e,l,r){return l.get({fields:["cells"]}).then(function(l){var n={definition:{global:{acid:r},cells:l.cells}},i=e.create(n);return t.when(l.cells,r,i.space())}).then(function(e,t,l){return{space:l.data,currentCells:e,acid:t}})},_processSpaces:function(e,t,r,n){var i={spaceDefault:e.data,availableCells:t.space.cells||[],currentCells:t.currentCells},s={cells:{name:"cells",types:[],predefinedFilters:r.cells||[],useFilter:!0,filter:n.settings.reportSettings.dataSource.source.filter||""}},a=function(e){return e.toLowerCase()};return s.cells.types=l.map(i.spaceDefault.cells.items,function(e){var t={id:e.id,name:e.name,isAvailable:l.any(i.availableCells.items,function(t){return a(t.id)===a(e.id)}),isSelected:l.any(i.currentCells.types,function(t){return a(t)===a(e.id)})};return t.isAvailable=t.isSelected?!0:t.isAvailable,t}),s.acid=t.acid||"",s}}});