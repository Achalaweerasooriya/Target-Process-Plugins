define(["require","jQuery","Underscore","../customReport.settings.parser","tau/core/class","./customReport.elements.empty.highlighter"],function(t){var e=t("jQuery"),i=t("Underscore"),n=t("../customReport.settings.parser"),o=t("tau/core/class"),s=t("./customReport.elements.empty.highlighter"),r=o.extend({init:function(t){this.$el=t.$el},get:function(){var t=[{axis:"x1",getter:this._firstX.bind(this)},{axis:"x2",getter:this._secondX.bind(this)},{axis:"y1",getter:this._firstY.bind(this)},{axis:"y2",getter:this._secondY.bind(this)},{axis:"size",getter:this._size.bind(this)},{axis:"color",getter:this._color.bind(this)}];return i.chain(t).map(function(t){var e=t.getter().val();return e?{model:e,dimension:t}:null}).compact().map(function(t){return this._createDimension(t)}.bind(this)).reduce(function(t,e){return this._groupDimensionByModel(t,e)},[],this).value()},isEmpty:function(){return i.all(this.$el.find(".i-role-dimension"),function(t){return""===e(t).val()})},_createDimension:function(t){var e=t.dimension.axis,i=this.$el.find("[name="+e+"_filter]");return{model:t.model,id:e,filter:i.is(":visible")?i.val():""}},_groupDimensionByModel:function(t,e){var n=i.find(t,function(t){return t.model.toLowerCase()===e.model.toLowerCase()&&t.filter.toLowerCase()===e.filter.toLowerCase()});return n?n.axes.push(e.id):t.push({id:e.id,model:e.model,filter:e.filter,axes:[e.id]}),t},set:function(t){return t.get({fields:["reportSettings"]}).then(function(t){var e=new n({reportSettings:t.reportSettings}),i=function(t){return t?t.model||t.id:""},o=i(e.getX2()),s=i(e.getY2());this._firstX().val(i(e.getX1())),this._secondX().val(o),this._firstY().val(i(e.getY1())),this._secondY().val(s),this._color().val(i(e.getColor())),this._size().val(i(e.getSize())),this._bindSecondLevel("x2",o),this._bindSecondLevel("y2",s)}.bind(this))},bindActions:function(){var t=function(t){t.$toggle.on("click",function(i){this._toggleVisibility(e(i.currentTarget).hasClass("tau-icon-r-direction"),t.$toggle,t.$section)
}.bind(this))}.bind(this);t(this._getSecondLevel("x2")),t(this._getSecondLevel("y2")),this.$el.find(".i-role-dimension").focus(function(){this._getCaptionEl().removeClass("tau-attention")}.bind(this))},highlightIfEmpty:function(){this.isEmpty()&&s.highlightIfEmpty(this._getCaptionEl())},_getCaptionEl:function(){return this.$el.find(".tau-customReport-info .tau-customReport-info-setupChart")},_bindSecondLevel:function(t,e){var i=this._getSecondLevel(t);this._toggleVisibility(Boolean(e),i.$toggle,i.$section)},_getSecondLevel:function(t){return{$toggle:this.$el.find(".i-role-"+t+"-toggle").eq(0),$section:this.$el.find(".i-role-"+t+"-section").eq(0)}},_toggleVisibility:function(t,e,i){e.toggleClass("tau-icon-r-direction",!t),e.toggleClass("tau-icon-b-direction",t),i.toggleClass("tau-row-show",t),i.toggleClass("tau-row-hide",!t)},_getNameByModel:function(t,e,n){var o=e,s=t.split(".");return t.indexOf("(")>=0?s.length>1&&(o=s[s.length-1]):o=2==s.length||1==s.length?s[0]:s[s.length-2],o=o.charAt(0).toLowerCase()+(o.length>1?o.slice(1):""),i.contains(n,o)&&(o+=n.length),o},_firstX:function(){return this._getDimension("i-role-firstX")},_secondX:function(){return this._getDimension("i-role-secondX")},_firstY:function(){return this._getDimension("i-role-firstY")},_secondY:function(){return this._getDimension("i-role-secondY")},_color:function(){return this._getDimension("i-role-color")},_size:function(){return this._getDimension("i-role-size")},_getDimension:function(t){return this.$el.find("input."+t+":enabled")}});return r});