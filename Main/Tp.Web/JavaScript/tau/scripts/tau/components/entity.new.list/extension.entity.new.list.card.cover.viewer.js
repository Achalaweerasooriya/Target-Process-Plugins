define(["require","tau/core/extension.base","tau/components/entity.new.list/entity.new.list.card.viewer","tau/components/entity.new.list/entity.new.list.card.viewer.component.factory","tau/components/entity.new.list/testPlanRun.new.list.card.viewer.component.factory"],function(e){var t=e("tau/core/extension.base"),i=e("tau/components/entity.new.list/entity.new.list.card.viewer"),n=e("tau/components/entity.new.list/entity.new.list.card.viewer.component.factory"),r=e("tau/components/entity.new.list/testPlanRun.new.list.card.viewer.component.factory");return t.extend({"bus beforeInit":function(e,t){if(!this._cardViewer){var n=t.config,r=this._getComponentFactory(n.context.entity.entityType),s=n.context.configurator.getKeyBoardManager();this._cardViewer=new i(new r(n),s),this._cardViewer.opened.add(this.fire.bind(this,"details.view.toggled",{viewerOpened:!0})),this._cardViewer.closed.add(this.fire.bind(this,"details.view.toggled",{viewerOpened:!1}))}},"bus afterRender:last + new.list.open.card.details.view":function(e,t,i){var n=t.element,r=i.cardData;this._cardViewer.isShown(r)?this._cardViewer.hide():this._cardViewer.show({$list:n,$card:i.$card,cardData:r,scrollToCard:i.scrollToCard})},"bus afterRender:last + details.view.toggled":function(e,t,i){this._toggleViewingForList(t.element,i.viewerOpened)},"bus details.view.toggled:last > view.cell.skeleton.built":function(e,t,i){t.viewerOpened&&this._toggleViewingForCards(i,t.viewerOpened)},"bus new.list.close.card.details.view":function(){this._cardViewer.hide()},"bus destroy":function(){this._cardViewer.destroy()},_toggleViewingForList:function(e,t){e.toggleClass("tau-details-view-opened"),this._toggleViewingForCards(e,t)},_toggleViewingForCards:function(e,t){var i=e.find(".i-role-details-trigger").closest(".tau-elems-cell");i.filter(".tau-elems-cell_unit-editable").toggleClass("disabled",t),i.toggleClass("i-role-details-trigger",t)},_getComponentFactory:function(e){return"testplanrun"===e.name.toLowerCase()?r:n}})});