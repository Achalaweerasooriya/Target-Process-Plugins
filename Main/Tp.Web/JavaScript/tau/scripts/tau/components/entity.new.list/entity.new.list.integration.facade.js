define(["require","jQuery","tau/core/class"],function(e){var t=e("jQuery"),i=e("tau/core/class");return i.extend({init:function(e,i){this.newListModel=e,this.viewSkeleton=i,this._treeModelReady=t.Deferred(),this._treeViewReady=t.Deferred(),this.newListModel.treeModelCreated.add(this._treeModelCreated,this)},_treeModelCreated:function(e){this._startActualTreeViewWaiting(),this._startActualTreeModelWaiting(),this._treeModel&&(this._treeModel.loadingStatusChanged.remove(this),this._treeModel.nodeCollectionCreated.remove(this)),this._treeModel=e,e.loadingStatusChanged.add(this._loadingStatusChanged,this),e.nodeCollectionCreated.add(this._nodeCollectionCreated.bind(this,e),this)},_startActualTreeViewWaiting:function(){"pending"!==this._treeViewReady.state()&&(this._treeViewReady=t.Deferred()),this.viewSkeleton.treeViewCreated.remove(this._treeViewCreated,this),this.viewSkeleton.eventAggregator.treeRendered.remove(this._treeRendered,this)},_startActualTreeModelWaiting:function(){"pending"!==this._treeModelReady.state()&&(this._treeModelReady=t.Deferred())},_loadingStatusChanged:function(e){e.isLoading&&(this._startActualTreeViewWaiting(),this._startActualTreeModelWaiting())},_nodeCollectionCreated:function(e){this._startActualTreeViewWaiting(),this._treeModelReady.resolve(e),this.viewSkeleton.treeViewCreated.add(this._treeViewCreated,this)},_treeViewCreated:function(e){this._startActualTreeViewWaiting(),this._treeView=e,this.viewSkeleton.eventAggregator.treeRendered.add(this._treeRendered,this)},_treeRendered:function(e){this._treeView.$treeContainer===e&&this._treeViewReady.resolve(this._treeView)},getTreeModel:function(){return this._treeModelReady.promise()},getTreeView:function(){return this._treeViewReady.promise()},destroy:function(){this.newListModel.treeModelCreated.remove(this),this.viewSkeleton.treeViewCreated.remove(this),this.viewSkeleton.eventAggregator.treeRendered.remove(this),"pending"===this._treeModelReady.state()&&this._treeModelReady.reject(),"pending"===this._treeViewReady.state()&&this._treeViewReady.reject()
}})});