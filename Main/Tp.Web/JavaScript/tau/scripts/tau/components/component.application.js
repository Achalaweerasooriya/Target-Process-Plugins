define(["Underscore","jQuery","tau/components/component.application.generic","tau/services/service.navigator","tau/ui/extensions/page/ui.extension.page.print","libs/parseUri","tau/configurations/const.page.entity.actions"],function(t,e,n,a,i,o,r){return{create:function(p){var s=p.context.configurator;s.registerService("navigator",new a(s,{parameterName:p.options.applicationId||null}));var c="entity component",y=function(t,e,n){taus.track({"@":["--save-last-view-entity-context"],action:"view entity",name:"view "+t+" #"+e,tags:["view entity"],type:t,id:e});var a=taus.start("statistics_view",{"@":["--add-last-view-entity-context",function(t){var e="@timing";return t.loadTime=t[e],delete t[e],t}],entity:{id:e,type:t.toLowerCase()}});this.resolve({entity:{id:parseInt(e,10),type:t},action:n,handlers:{onPageLoaded:function(){a.stop()}}})},u=function(n,a,i){var o=this.configurator,r=o.getStore(),p=o.getBoardSettingsFactory().createComponentSettings({id:"project"}),s=e.Deferred();r.find("projectmember",{id:a,fields:[{project:["id"]}]}).done({success:function(e){var n=t.find(e[0].data[0],function(t){return t.id==a});s.resolve(n&&n.project?n.project.id:a)},failure:function(){s.resolve(a)}});var c=e.Deferred();p.set({set:{generalTab:"people"},callback:function(){c.resolve()}});var u=y.bind(this);e.when(s,c).done(function(t){u("project",t,i)})},m=function(e,n,a){var i="projectmember"==e.toLowerCase()?u:y;t.bind(i,this)(e,n,a||r.SHOW)};return p.routes=[{pattern:/^$/,adapter:function(){var t=this.configurator.getRouting().getReferer();t?this.configurator.service("navigator").to(t):this.fire("application.exit")},host:{name:"empty_host",type:"master.empty"},type:{name:c,type:"page.entity"}},{pattern:/finish-(\w+)\/([0-9]+)/,adapter:function(t,e){this.resolve({entity:{id:parseInt(e,10),type:t},applicationClassName:"tau-info-popup"})},host:{name:"empty_host",type:"master.empty"},type:{name:"entity component",type:"page.finish-iteration"}},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,adapter:function(e,n){t.bind(m,this)(e,n)
},host:{name:"empty_host",type:"master.empty"},type:{name:c,type:"page.entity"}},{pattern:new RegExp("(\\w+)\\/([0-9]+)\\/"+r.SILENT),adapter:function(e,n){t.bind(m,this)(e,n)},host:{name:"empty_host",type:"master.empty",turnOffLoadingIndicator:!0},type:{name:c,type:"page.entity",turnOffLoadingIndicator:!0}},{pattern:new RegExp("(\\w+)\\/([0-9]+)\\/"+r.PRINT),adapter:function(e,n){var a=o(window.location.href);"Print.aspx"==a.file?t.bind(m,this)(e,n,r.PRINT):this.configurator.service("navigator").to("#"+e+"/"+n)},host:{name:"empty_host",type:"master.empty"},type:{name:c,type:"page.entity",hostClassName:"tau-page-entity",extensions:[i]}},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,adapter:function(e,n,a){t.bind(m,this)(e,n,a)},host:{name:"empty_host",type:"master.empty"},type:{name:c,type:"page.entity",hostClassName:"tau-page-entity"}}],n.create(p)}}});