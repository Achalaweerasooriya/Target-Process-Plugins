define(["require","jQuery","Underscore","libs/react/react-ex","tau/core/class","jsx!./property.teamEntityState.view"],function(t){var e=t("jQuery"),i=t("Underscore"),n=t("libs/react/react-ex"),o=t("tau/core/class"),s=t("jsx!./property.teamEntityState.view"),r={_eventName:"mousedown.teamEntityState",onDocumentClick:i.Callbacks(),start:function(){e(document).on(this._eventName,function(t){this.onDocumentClick.fire(t.target)}.bind(this))},stop:function(){e(document).off(this._eventName)}},h=o.extend({init:function(t,e){this._model=t,this._workflowHelpData=e,this._view=null,this._container=null,this.initialDataRetrieved=this._model.refreshCurrentStates(),this._model.onStateChangeNotification.add(function(t){this._doWithLoader(this._refreshStates.bind(this,t))}.bind(this))},render:function(t,i){var o=this._getViewProps(i);this._container=t,this._view=n.renderClass(s,o,this._container),r.onDocumentClick.add(function(t){var i=e(t),n=i.closest(".multiple-team-state-select").length>0,o=i.closest(".tau-bubble-tooltipArticle").length>0;n||o||this._closeSelector()},this)},destroy:function(){r.onDocumentClick.remove(this),r.stop(),this._container&&n.unmountComponentAtNode(this._container),this._model.destroy(),this._container=null,this._view=null},_getViewProps:function(t){return{currentStates:t,workflowHelpData:this._workflowHelpData,isLoading:!1,actions:{loadWorkflow:this._loadWorkflow.bind(this),openDropDown:this._openSelector.bind(this),closeDropDown:this._closeSelector.bind(this),changeState:this._changeState.bind(this),changeTeamState:this._changeTeamState.bind(this)}}},_loadWorkflow:function(){this._model.getCurrentWorkflow()},_openSelector:function(){this._doWithLoader(function(){return this._model.getCurrentWorkflow().then(function(t){r.start(),this._setProps({entityStateGroups:t})}.bind(this))}.bind(this))},_closeSelector:function(){r.stop(),this._setProps({entityStateGroups:null})},_refreshStates:function(t){return this._model?this._refreshUsing(this._model.refreshCurrentStates(t)):null
},_forceRefresh:function(){return this._model?this._refreshUsing(this._model.forceRefreshCurrentStates()):null},_refreshUsing:function(t){return t.then(function(t){this._setProps({currentStates:t})}.bind(this))},_changeState:function(t,e){this._doWithLoader(function(){return this._closeSelector(),this._model.updateParentState(t,e).then(this._refreshStates.bind(this),this._forceRefresh.bind(this))}.bind(this))},_changeTeamState:function(t,e,i){this._doWithLoader(function(){return this._closeSelector(),this._model.updateTeamState(t,e,i).then(this._refreshStates.bind(this),this._forceRefresh.bind(this))}.bind(this))},_doWithLoader:function(t){return this._toggleLoader(!0),t().always(this._toggleLoader.bind(this,!1))},_toggleLoader:function(t){this._setProps({isLoading:t})},_setProps:function(t){this._view&&this._view.setProps(t)}});return h});