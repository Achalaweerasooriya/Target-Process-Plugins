define(["require","Underscore","jQuery","tau/services/data.service"],function(t){var e=t("Underscore"),n=t("jQuery"),i=t("tau/services/data.service"),a=i.extend({_entityStateFields:["Id","Name"],getAssignableWithCurrentStates:function(t){var n=e.union(this._entityStateFields,"NextStates","Workflow.Id as WorkflowId").map(function(t){return"EntityState."+t}).join(",");return this._findOne("assignable",{where:{id:t},select:["Project:{Project.Id}","EntityState:{"+n+"}","TeamStates.Select({Id,Team:{Team.Id,Team.Name,Team.Icon},EntityState:{"+n+"}}) as TeamStates"]}).then(function(t){return e.each(t.teamStates,function(t){e.isEmpty(t.entityState)&&(t.entityState=null)}),t})},getTeamWorkflowIds:function(t,i,a){return t?this._findOne("teamProject",{where:{"Team.Id":t.id,"Project.Id":i.id},select:['Workflows.Where(EntityType.Name="'+a+'").Select({Id,Name}) as Workflows']}).then(function(t){return[e.first(t.workflows).id]}):n.when([])},getWorkflowsByIds:function(t){var n=e.union(this._entityStateFields,"ParentEntityState","Workflow.Id as WorkflowId");return this._find("entityState",{where:{"Workflow.Id":{is:"in ["+t.join(",")+"]"}},select:n})},updateAssignableState:function(t,e,n){return this._store.saveDef(t,{id:e,$set:{entityState:{id:n}}})},updateAssignableTeamState:function(t,e){return this._store.saveDef("teamState",{id:t,$set:{entityState:{id:e}}})}});return a});