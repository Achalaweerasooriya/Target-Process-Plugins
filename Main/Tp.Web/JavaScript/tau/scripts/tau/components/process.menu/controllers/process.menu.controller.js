define(["require","jQuery","tau/core/class","libs/react/react-ex","tau/services/process.service","../models/process.menu.model","tau/components/setup.process/process.optionGroups","jsx!../views/process.menu.view"],function(e){"use strict";var s=e("jQuery"),t=e("tau/core/class"),i=e("libs/react/react-ex"),o=e("tau/services/process.service"),n=e("../models/process.menu.model"),r=e("tau/components/setup.process/process.optionGroups"),c=e("jsx!../views/process.menu.view");return t.extend({init:function(e,t,i,r,c){this._container=i;var d=new o(e),a=e.getRouting(),h=e.getUrlBuilder();this._model=new n(d,a,c),this._viewIsInDom=s.Deferred(),this._view=this._initViewComponent(t,h,r,e.getLoggedUser()),this._model.processesChanged.add(this._onProcessesChanges,this),this._model.activePageChanged.add(this._onActivePageChanged.bind(this,h,a,e.getHistory())),this._model.updateProgress.add(this._onUpdateProgress,this),s.when(this._model.refresh(),this._viewIsInDom).then(function(){this._view.setState({isInDom:!0})}.bind(this))},_initViewComponent:function(e,s,t,o){var n=i.resolveClass(e,c);return i.renderClass(n,{urlBuilder:s,openEntityViewAction:t,activePage:this._model.getActivePage(),setActivePage:this._model.setActivePage.bind(this._model),user:o,actions:{createProcess:this._createProcess.bind(this),renameProcess:this._model.renameProcess.bind(this._model),cloneProcess:this._cloneProcess.bind(this),deleteProcess:this._model.deleteProcess.bind(this._model)}},this._container)},_createProcess:function(){this._model.createProcess().then(function(e){this._model.setActivePage({processId:e,isNew:!0})}.bind(this))},_cloneProcess:function(e){this._model.cloneProcess(e).then(function(e){this._model.setActivePage({processId:e})}.bind(this))},updateActivePage:function(e){this._model.setActivePage(e)},markAsInDom:function(){this._viewIsInDom.resolve()},destroy:function(){i.unmountComponentAtNode(this._container),this._model.destroy(),this._model=null,this._view=null},_onProcessesChanges:function(e){this._view.setState({processes:e})
},_onUpdateProgress:function(e){this._view.setProps({isUpdating:e.isUpdating})},_onActivePageChanged:function(e,s,t,i){this._view.setProps({activePage:i});var o=r.create(e,i.optionGroupId,i.processId),n=o.getTp3Url(i.entityType);s.redirect(n),t.reset(),t.setCurrent({id:"process-setup",title:o.getTitle(),url:n})}})});