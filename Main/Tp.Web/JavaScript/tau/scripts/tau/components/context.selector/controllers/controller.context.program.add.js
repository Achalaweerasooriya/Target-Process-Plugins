define(["jQuery","tau/core/class","tau/components/context.selector/views/view.context.program.add","tau/components/context.selector/models/model.context.program.add"],function(e,t,r,n){var i=t.extend({init:function(t,i){this._$element=e('<div class="tau-managed-category tau-programs tau-managed-category_formactive_true"></div>'),this._model=new n(t),this._model.onProjectSaved.add(this._refresh,this),this._view=new r(this._$element),this._view.onProgramCreate.add(this._onProgramCreate,this),this._dispatcher=i},render:function(){return this._render().then(function(){return{element:this._$element}}.bind(this))},completeShow:function(){this._view.focus()},destroy:function(){this._view.onProgramCreate.remove(this)},_render:function(){return this._model.getData().then(this._view.render.bind(this._view))},_onProgramCreated:function(e){this._dispatcher.addCompleted(e),this._refresh()},_refresh:function(){this._dispatcher.refresh()},_onProgramCreate:function(e){this._model.setData(e).then(this._onProgramCreated.bind(this)).fail(this._onProgramError.bind(this))},_onProgramError:function(){this._view.error()}});return i});