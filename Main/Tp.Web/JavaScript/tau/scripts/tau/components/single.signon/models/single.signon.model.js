define(["require","jQuery","Underscore","tau/core/class","tau/store/header"],function(t){var e=t("jQuery"),n=t("Underscore"),r=t("tau/core/class"),a=t("tau/store/header");return r.extend({_globalSettingsId:null,init:function(t){this._configurator=t.configurator},getSettings:function(){var t=this._getCallUrl()+"?format=json";return e.ajax({url:t,dataType:"json",type:"GET"}).then(this._formatResponse).then(function(t){var e=t.data[0];this._globalSettingsId=e.id;var n=this._prepareSsoSettingsData(e.ssoSettings);return n}.bind(this))},_prepareSsoSettingsData:function(t){return t.exceptionUsers=n.map(t.exceptionUsers,this._appendUserName),t},_appendUserName:function(t){return t.name=t.firstName+" "+t.lastName,t},updateSettings:function(t){var n=this._prepareUpdateData(t);return e.ajax({url:this._getCallUrl(),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(n)}).then(this._formatResponse).then(function(t){var e=this._prepareSsoSettingsData(t.data.ssoSettings);return e}.bind(this))},_prepareUpdateData:function(t){t.exceptionUsers=n.map(t.exceptionUsers,function(t){return n.pick(t,"id")});var e={id:this._globalSettingsId,ssoSettings:t};return e},_formatResponse:function(t){return a.formatObject(t)},_getCallUrl:function(){return this._configurator.getRestPath()+"/globalsettings"}})});