define(["require","Underscore","jQuery","tau/core/class","tau/components/testPlanRun.testRuns/testPlanRun.testRuns.hierarchy.visitor"],function(e){var t=e("Underscore"),n=e("jQuery"),s=e("tau/core/class"),r=e("tau/components/testPlanRun.testRuns/testPlanRun.testRuns.hierarchy.visitor");return s.extend({init:function(e,n){this._newListModel=e,this._testPlanRun=n,this.nextRunItemReady=t.Callbacks(),this.runCompleted=t.Callbacks()},runNext:function(e){return this._getTreeRootModel().then(this._executeListRunAction.bind(this,e)).then(this._nextRunItemReady.bind(this,e))},_getTreeRootModel:function(){if(this._newListModel.treeRootModel)return n.when(this._newListModel.treeRootModel);var e=n.Deferred();return this._newListModel.treeRootModelCreated.once(e.resolve.bind(e)),e.promise()},_executeListRunAction:function(e,t){return t.executeSubTreeDataWorkflow(function(n){var s=new r(this._testPlanRun.id);return t.hierarchy.accept(s),n.resolveDeferred("runNext",{$take:t.pagingModel.getTake(),$set:{currentTestCaseRunId:e,treeViewStructure:s.result}})}.bind(this))},_nextRunItemReady:function(e,t){t.data.isCompleted?this.runCompleted.fire(!!e):this.nextRunItemReady.fire({testCaseRunId:t.data.testCaseRunId,path:t.data.path})},destroy:function(){this.nextRunItemReady.empty()}})});