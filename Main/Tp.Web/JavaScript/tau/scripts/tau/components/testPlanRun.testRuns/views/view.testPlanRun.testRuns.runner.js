define(["require","Underscore","jQuery","tau/core/class"],function(e){var i=e("Underscore"),t=e("jQuery"),n=e("tau/core/class");return n.extend({init:function(e){this._skeletonView=e,this.nextRunCardReady=i.Callbacks()},findNextRunCard:function(e){this._cancelPrevious(),this._getTreeView(e.path).then(this._$findNextCard.bind(this,e.testCaseRunId)).done(this._nextCardReady.bind(this))},_getTreeView:function(e){var i=this._skeletonView.findView(e);return i?t.when(i):this._waitTreeView(e)},_waitTreeView:function(e){var n=t.Deferred(),r=function(t){i.isEqual(e,t.treeModel.hierarchy.getPath())&&(this._cancelTreeViewWait(),n.resolve(t))}.bind(this);return this._cancelTreeViewWait=function(){this._skeletonView.treeViewCreated.remove(r,this),this._cancelTreeViewWait=null}.bind(this),this._skeletonView.treeViewCreated.add(r,this),n.promise()},_$findNextCard:function(e,i){return i.treeIsRendered?t.when(i.findChildCardById(e)):this._waitTreeViewRender(i).then(i.findChildCardById.bind(i,e))},_nextCardReady:function(e){this.nextRunCardReady.fire({$card:e,cardData:e.data()})},_waitTreeViewRender:function(e){var i=t.Deferred(),n=function(){this._cancelTreeViewRenderWait(),i.resolve()}.bind(this);return this._cancelTreeViewRenderWait=function(){e.treeRendered.remove(n,this),this._cancelTreeViewRenderWait=null}.bind(this),e.treeRendered.add(n,this),i.promise()},_cancelPrevious:function(){this._cancelTreeViewWait&&this._cancelTreeViewWait(),this._cancelTreeViewRenderWait&&this._cancelTreeViewRenderWait()},destroy:function(){this._cancelPrevious(),this.nextRunCardReady.empty()}})});