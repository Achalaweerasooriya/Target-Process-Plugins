define(["Underscore","tau/core/class"],function(e,t){var i=t.extend({init:function(t,i){this._cardModel=t,this._timelineRangeModel=i,this.onUpdated=e.Callbacks(),this.update(t)},update:function(t){e.extend(this,this.calculateViewMetrics(t.cardData())),this.onUpdated.fire()},get:function(){return e.pick(this,"actual","planned","forecast")},applyEdit:function(e,t){var i=this._timelineRangeModel.getCorrespondingDateRange({from:e,to:t});this._cardModel.applyEdit(i)},calculateViewMetrics:function(e){var t=e.showPlanned&&this._processPlannedSection(e),i=e.showFixed&&this._processFixedSection(e);return{planned:t||i||this._noMetrics(),actual:e.showActual?this._processActualSection(e):this._noMetrics(),forecast:e.showForecast?this._processForecastSection(e):this._noMetrics()}},_noMetrics:function(){return{show:!1,from:0/0,to:0/0}},_processFixedSection:function(e){return{show:!0,showAsFixed:!0,from:this._timelineRangeModel.toRelativeOffset(e.fixedDate),to:null}},_processActualSection:function(e){return{show:!0,from:this._timelineRangeModel.toRelativeOffset(e.actualStartDate),to:this._timelineRangeModel.toRelativeOffset(e.actualEndDate)}},_processPlannedSection:function(e){return{show:!0,from:this._cardModel.isStartDateInfinite?-1/0:this._timelineRangeModel.toRelativeOffset(e.plannedStartDate),to:this._cardModel.isEndDateInfinite?+1/0:this._timelineRangeModel.toRelativeOffset(e.plannedEndDate)}},_processForecastSection:function(e){return{show:!0,from:this._timelineRangeModel.toRelativeOffset(e.forecastStartDate),to:this._timelineRangeModel.toRelativeOffset(e.forecastEndDate)}}});return{_timelineRangeModel:null,setRangeModel:function(e){this._timelineRangeModel=e},create:function(e){return new i(e,this._timelineRangeModel)}}});