define(["Underscore","jQuery","tau/core/class","tau/ui/templates/board.timeline/ui.template.board.timeline.ruler10","tau/components/board.timeline/views/ruler/scale","tau/components/board.timeline/views/board.timeline.view.now-marker","tau/components/board.timeline/views/board.timeline.view.first-label","tau/utils/timeline/utils.timeline.date.position.calculator","tau/utils/utils.date"],function(e,t,i,n,a,l,r,s,o){var d=i.extend({init:function(){this._$placeholder=null,this._dateRange=null,this._nowMarker=new l(this._getNowOffset.bind(this)),this._firstLabel=new r},_html:function(e){var t=a.createFor(this._$placeholder.width(),e).segments();return this._firstLabel.setLabel(t[0].firstLabel),n.get().bind({},t)},bind:function(e){this._dateRange=e,this._positionCalculator=new s(e),this._$placeholder&&this._doRender()},_getNowOffset:function(){return this._positionCalculator.getRelativeDatePosition(o.getServerNow())},renderTo:function(e){this._$placeholder=e.find(".tau-scale-ruler"),this._$placeholder.width(e.find(".tau-timeline-flow").width()),this._dateRange&&this._doRender()},_doRender:function(){if(this._$placeholder.html(this._html(this._dateRange)),this._nowMarker.render(this._$placeholder),this._firstLabel.isEmpty()){var e=this._$placeholder.find(".tau-ruler-segment.tau-is-period-start").first(),t=e.position(),i=e.find(".tau-notch-label");i.length>0&&i.width()/2>t.left&&(this._firstLabel.setLabel(i.html()),i.empty())}this._firstLabel.render(this._$placeholder)},updateNowPosition:function(){this._nowMarker.updatePosition()}});return d});