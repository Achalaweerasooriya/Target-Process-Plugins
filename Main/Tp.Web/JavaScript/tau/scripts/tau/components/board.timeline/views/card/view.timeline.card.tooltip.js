define(["Underscore","jQuery","tau/core/class","tau/utils/utils.date"],function(t,e,o,n){var i=o.extend({init:function(e){this._$dom=this._render(),this._model=e,this._model.onPlannedDatesUpdating.add(this._updatePosition,this),this._model.onPlannedDatesUpdating.add(t.throttle(this._updateContent,200),this),this._model.onPlannedDatesUpdated.add(this._hide,this),this._$dom.on("remove",this._destroy.bind(this))},appendTo:function(t){this._$dom.appendTo(t)},_render:function(){return e('<div class="tau-timeline-card-tooltip" style="width:100%;"></div>').tauBubble({zIndex:999,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow" role="arrow"></div>','<div class="tau-bubble-board__inner tau-container" role="content"></div>',"</div>"].join(""),className:"tau-bubble-tooltip",mode:"tooltip",showEvent:"none",stackName:"tooltip",delay:500,onPositionConfig:this._tooltipPositionConfig,onArrowPositionConfig:this._tooltipPositionConfig})},_tooltipPositionConfig:function(t){t.at="center bottom-1",t.my="center top"},_updatePosition:function(){this._$dom.tauBubble("option","appendTo",e(".i-role-timeline-bubble-holder")),this._$dom.tauBubble("show")},_updateContent:function(){this._destroyed||this._$dom.tauBubble("setContent",d[this._model.type](this._model.plannedDateRange()))},_hide:function(){this._$dom.tauBubble("hide")},_destroy:function(){this._destroyed=!0,this._model.onPlannedDatesUpdating.remove(this),this._model.onPlannedDatesUpdated.remove(this)}}),d={fixed:function(t){return a(t.startDate)},durable:function(t){return r(t)}},a=function(t){return n.format.datetime.short(n.convertToTimezone(t))},s=function(t){return null===t?"-&infin;":n.format.date.short(n.convertToTimezone(t))},r=function(t){return s(t.startDate)+"&nbsp;â€”&nbsp;"+s(t.endDate)};return i});