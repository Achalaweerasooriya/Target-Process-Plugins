define(["Underscore","jQuery","tau/components/board.timeline/views/card/view.card-base","tau/components/board.timeline/models/cell/model.cell.base","tau/ui/templates/timeline/ui.template.timeline.card-holder","tau/ui/extensions/board.plus/ui.board.plus.dom.utils","tau/components/board.timeline/views/card/view.timeline.card.actual-section","tau/components/board.timeline/views/card/view.timeline.card.forecast-section","tau/components/board.timeline/views/card/view.timeline.card.planned-section"],function(e,t,i,d,a,n,s,o,r){var c=i.extend({init:function(t,i,d){this._boardCardView=i,this._cardMetricsConverter=d,this.onEditStarted=e.Callbacks(),this.onEditStopped=e.Callbacks(),this._super(t),this._updateCardHolderGeometry(),this._model.onMetricsUpdating.add(this._updateCardHolderGeometry.bind(this))},insertAt:function(e,t){this._$dom.insertAt(e,t)},_updateCardHolderGeometry:function(){this._sections.actual.setPosition(),this._sections.planned.setPosition(),this._sections.forecast.setPosition()},_$render:function(){var e=a.render({card:this._model.cardData()}),t=this._boardCardView.$dom();return this._sections={planned:new r(this._model,e.find(".i-role-card-planner"),t,this._cardMetricsConverter),actual:new s(this._model,e.find(".i-role-timeline-card-holder"),t.clone(!0)),forecast:new o(this._model,e.find(".i-role-card-predictor"))},this._sections.planned.onEditStarted.add(this.onEditStarted.fire.bind(this.onEditStarted)),this._sections.planned.onEditStopped.add(this.onEditStopped.fire.bind(this.onEditStopped)),this._sections.planned.onEditStopped.add(this.markAsNotChanged.bind(this)),this._sections.forecast.$section().on("contextmenu mouseup mousedown dblclick click mouseenter mouseleave",function(e){n.redirectEvent(this._sections.actual.$section().find(".i-role-card"),e)}.bind(this)),e.data("visualMetrics",this._model.metrics()),e},update:function(e){this._model.update(e.cardData()),this._updateCardHolderGeometry(),this._boardCardView.update(this._model),this._sections.actual.setContent(this._boardCardView.$dom().clone(!0));var t=this._model.metrics();this._checkVisualMetricsChanged(t)},updateMetrics:function(e){this._model.update(e.cardData()),this._updateCardHolderGeometry()},remove:function(){this._$dom.remove()},$dom:function(){return this._$dom.find(".i-role-card")},clearArtifacts:function(){this.remove(),this.onCleared.fire(this)},animateUpdate:function(e){return this._changed&&(this._boardCardView.markAsChanged(),this.markAsNotChanged()),this._boardCardView.animateUpdate(e)},whenAnimated:function(e,t){return this._boardCardView.whenAnimated(e,t)},_checkVisualMetricsChanged:function(){var t=this._$dom.data("visualMetrics"),i=this._model.metrics();e.isEqual(t,i)||(this.markAsChanged(),this._$dom.data("visualMetrics",i))}});return c});