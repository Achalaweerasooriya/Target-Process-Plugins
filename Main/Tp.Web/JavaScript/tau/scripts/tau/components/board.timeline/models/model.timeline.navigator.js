define(["require","jQuery","tau/core/class","tau/utils/timeline/utils.timeline.date-range","tau/utils/timeline/utils.timeline.date.position.calculator","tau/utils/utils.date"],function(t){var e=t("jQuery"),a=t("tau/core/class"),i=t("tau/utils/timeline/utils.timeline.date-range"),n=t("tau/utils/timeline/utils.timeline.date.position.calculator"),o=t("tau/utils/utils.date");return a.extend({init:function(t){this._dataProvider=t,this._dataProvider.onTimelineLocalDateRangeChanged.add(this.onLocalDataRangeChanged.bind(this)),this._dataProvider.onTimelineGlobalDateRangeChanged.add(this.onGlobalDataRangeChanged.bind(this)),this._positionCalculator=null,this._localDateRange=null},onLocalDataRangeChanged:function(t){this._localDateRange=t},onGlobalDataRangeChanged:function(t){this._positionCalculator=t.isValid?n(t):null},globalDateRangeIsDefined:function(){return!!this._positionCalculator},getRelativeNowOffset:function(){return this._positionCalculator.getRelativeDatePosition(o.getServerNow())},getRelativeSelectedRange:function(){return{start:this._positionCalculator.getRelativeDatePosition(this._localDateRange.startDate),end:this._positionCalculator.getRelativeDatePosition(this._localDateRange.endDate)}},convertToDateRange:function(t,e){var a=this._positionCalculator.getCorrespondingDate(t),n=this._positionCalculator.getCorrespondingDate(e);return new i(a,n)},setRelativeSelectedRange:function(t,e){this._localDateRange=this.convertToDateRange(t,e),this._dataProvider.setTimelineLocalDateRange(this._localDateRange)},queryDensity:function(t){return this._positionCalculator?e.when(this._dataProvider.queryDensity(t)).then(function(t){return t.data}):[]}})});