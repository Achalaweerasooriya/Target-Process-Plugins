define(["Underscore","jQuery","tau/components/board.timeline/views/card/view.timeline.card.section-base","tau/components/board.timeline/views/timeline.card-metrics-editor","tau/ui/extensions/board.plus/ui.board.plus.dom.utils","tau/components/board.timeline/views/card/view.timeline.card.tooltip"],function(i,t,e,s,o,n){var r=e.extend({init:function(t,e,r,d){this._super(t,e),this._$section.find(".i-role-card-placeholder").replaceWith(r),this._cardMetricsEditor=s.createFor(t),this._cardMetricsConverter=d,this.onEditStarted=i.Callbacks(),this.onEditStopped=i.Callbacks(),this._$section.find(".i-role-range-editor").on("dblclick mouseenter mousemove mouseleave",o.redirectEvent.bind(this,r)),this._$section.resizable({handles:{w:this._$section.find(".ui-resizable-w"),e:this._$section.find(".ui-resizable-e")},minWidth:3,resize:this._onResize.bind(this),start:this._onEditStart.bind(this),stop:this._onEditStop.bind(this)}).draggable({axis:"x",scroll:!1,drag:this._onDrag.bind(this),start:this._onEditStart.bind(this),stop:this._onEditStop.bind(this)}).css("position","absolute"),new n(t).appendTo(this._$section)},_prepareSection:function(i){i.css({left:"",width:0})},_isVisible:function(){return this._model.showPlanned||this._model.showFixed},_metrics:function(){return this._model.convertPlannedMetrics(this._model.plannedRange())},setPosition:function(){if(this._super(),this._model.showPlanned&&this._model.showForecast&&!this._model.hasActual){var t=this._$section.find(".i-role-card");if(this._model.plannedLeft<this._model.forecastLeft)t.hide();else{var e=this._model._cardData.data.cardData.type.toLowerCase();t.removeClass("tau-card-v2_type_"+e)}}var s=this._model.plannedRange();this._$section.find(".tau-start-date").toggle(s.from>=0),this._$section.find(".tau-end-date").toggle(!i.isNull(s.to)&&s.to<=1),this._$section.find(".ui-resizable-w").toggle(this._cardMetricsEditor.leftResizeAvailable()),this._$section.find(".ui-resizable-e").toggle(this._cardMetricsEditor.rightResizeAvailable())},_onResize:function(i,t){var e=this._cardMetricsConverter.toRelative(t.position.left-t.originalPosition.left),s=this._cardMetricsConverter.toRelative(t.size.width-t.originalSize.width);this._cardMetricsEditor.resize(e,s)},_onDrag:function(i,t){var e=this._cardMetricsConverter.toRelative(t.position.left-t.originalPosition.left);this._cardMetricsEditor.drag(e),t.position.left=this._$section.position().left},_onEditStart:function(){this._cardMetricsEditor.begin(),this.onEditStarted.fire(this._model)},_onEditStop:function(){this._cardMetricsEditor.commit(),this.onEditStopped.fire(this._model)}});return r});