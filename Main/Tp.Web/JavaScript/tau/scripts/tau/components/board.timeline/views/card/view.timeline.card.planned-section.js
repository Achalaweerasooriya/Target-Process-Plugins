define(["Underscore","jQuery","tau/components/board.timeline/views/card/view.timeline.card.section-base","tau/components/board.timeline/views/timeline.card-metrics-editor","tau/ui/extensions/board.plus/ui.board.plus.dom.utils","tau/components/board.timeline/views/card/view.timeline.card.tooltip"],function(i,t,e,s,o,r){var n=e.extend({init:function(t,e,n,a,d){this._super(t,e,n),this._$section.find(".i-role-card-placeholder").replaceWith(a),this._cardMetricsEditor=s.createFor(t,e),this._cardMetricsConverter=d,this.onEditStarted=i.Callbacks(),this.onEditStopped=i.Callbacks(),this._$section.find(".i-role-range-editor").on("dblclick mouseenter mousemove mouseleave",o.redirectEvent.bind(this,a)),this._$section.resizable({handles:{w:this._$section.find(".ui-resizable-w"),e:this._$section.find(".ui-resizable-e")},minWidth:3,resize:this._onResize.bind(this),start:this._onEditStart.bind(this),stop:this._onEditStop.bind(this)}).draggable({axis:"x",scroll:!1,drag:this._onDrag.bind(this),start:this._onEditStart.bind(this),stop:this._onEditStop.bind(this)}).css("position","absolute"),new r(t).appendTo(this._$section)},_prepareSection:function(i){i.css({left:"",width:0})},_isVisible:function(){return this._model.showPlanned||this._model.showFixed},_metrics:function(){var t=this._cardMetricsEditor.plannedRange();return{left:t.from,width:i.isNull(t.to)?null:t.to-t.from}},setPosition:function(){if(this._super(),this._viewMetrics.planned.show&&this._viewMetrics.forecast.show&&!this._model.hasActual){var t=this._$section.find(".i-role-card");if(this._viewMetrics.planned.from<this._viewMetrics.forecast.from)t.hide();else{var e=this._model.cardData().data.cardData.type.toLowerCase();t.removeClass("tau-card-v2_type_"+e)}}var s=this._metrics();this._$section.find(".tau-start-date").toggle(s.left>=0),this._$section.find(".tau-end-date").toggle(!i.isNull(s.width)&&s.left+s.width<=1),this._$section.find(".ui-resizable-w").toggle(this._cardMetricsEditor.leftResizeAvailable()),this._$section.find(".ui-resizable-e").toggle(this._cardMetricsEditor.rightResizeAvailable()),this._$section.toggleClass("tau-timeline-part-card",this._model.isStartDateInfinite||this._metrics().left<0)
},_onResize:function(i,t){var e=this._cardMetricsConverter.toRelative(t.position.left-t.originalPosition.left),s=this._cardMetricsConverter.toRelative(t.size.width-t.originalSize.width);this._cardMetricsEditor.resize(e,s)},_onDrag:function(i,t){var e=this._cardMetricsConverter.toRelative(t.position.left-t.originalPosition.left);this._cardMetricsEditor.drag(e),t.position.left=this._$section.position().left},_onEditStart:function(){this._cardMetricsEditor.begin(),this.onEditStarted.fire()},_onEditStop:function(){this._cardMetricsEditor.commit(),this.onEditStopped.fire()}});return n});