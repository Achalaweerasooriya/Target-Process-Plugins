define(["Underscore","jQuery","tau/core/class","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/components/board.timeline/view/view.cell.timeline","tau/components/board.timeline/view/view.cell.board","tau/components/board.timeline/view/view.axis-cell.board"],function(e,t,i,n,l,r,d){var a=i.extend({init:function(t){this._timelineRangeModel=t,this.onBeforeUpdateCell=e.Callbacks(),this.onAfterUpdateCell=e.Callbacks(),this.cellsRegistry=[],this.onCellUpdated=e.Callbacks(),this.onAxisUpdated=e.Callbacks(),this.onOpenCardViewRequired=e.Callbacks()},renderCell:function(e,t,i,n,l){return i.isTimeline?this._renderTimelineCell(l,e,t,i,n):this._renderBoardCell(e,t,i,n)},renderAxisCell:function(e,t,i,n){this._renderCell(d,e,t,i,n).done(this.addAxisCellToRegistry.bind(this))},addCellToRegistry:function(e){return e.onViewUpdated.add(function(t,i){this.onCellUpdated.fire({target:e,operation:t,result:i})}.bind(this)),this.cellsRegistry.push(e),e},addAxisCellToRegistry:function(e){return e.onViewUpdated.add(function(t,i){this.onAxisUpdated.fire({target:e,operation:t,result:i})}.bind(this)),this.cellsRegistry.push(e),e},axisCellAdded:function(e,i){this.onAxisUpdated.fire({operation:{name:"added",location:"axis",items:[e],options:i},result:{cards:[],dataItems:[e.data],$cell:t("<div></div>").data(e.data)},target:null})},moveCard:function(e,t,i,n){this.moveCardToCell(e,i,n),this.clearCardFromCell(e,t)},clearCardArtifacts:function(e,t){this._getCellViewByCoords(t).clearCardArtifacts(e)},moveCardToCell:function(e,t,i){this._getCellViewByCoords(t).moveCardIn(e,i)},clearCardFromCell:function(e,t){this._getCellViewByCoords(t).moveCardOut(e)},unlockAllTrackCards:function(){e.each(this.cellsRegistry,function(e){e.unlockAllTrackCards&&e.unlockAllTrackCards()})},_getCellViewByCoords:function(t){return t=e.defaults(t,{x:null,y:null}),e.chain(this.cellsRegistry).filter(function(e){var i=e._$cell?e._$cell.data():{};return i.x===t.x&&i.y===t.y}).last().value()||new o},_getCellElement:function(e,t){var i=n.generateId(e);return t.find("#"+i)},_renderTimelineCell:function(e,t,i,n,r){return e.then(function(e){return this._renderCell(l,t,i,n,r,{timelineWidth:e})}.bind(this)).then(this.addCellToRegistry.bind(this))},_renderBoardCell:function(e,t,i,n){return this._renderCell(r,e,t,i,n).then(this.addCellToRegistry.bind(this))},_renderCell:function(t,i,n,l,r,d){var a=this._getCellElement(l.dataItem,r);return d=e.extend({beforeInsert:this.onBeforeUpdateCell.fire.bind(this.onBeforeUpdateCell),afterInsert:this.onAfterUpdateCell.fire.bind(this.onAfterUpdateCell)},d),n.getLayoutFactory().then(function(e){var n=new t(l,a,e,i,d,this._timelineRangeModel);return n.onOpenCardViewRequired&&n.onOpenCardViewRequired.add(this.onOpenCardViewRequired.fire.bind(this.onOpenCardViewRequired)),n.render(),n}.bind(this))}}),o=i.extend({init:function(){},_$cell:t(),moveCardIn:t.noop,clearCardArtifacts:t.noop,createPlaceholderContent:t.noop});return a});