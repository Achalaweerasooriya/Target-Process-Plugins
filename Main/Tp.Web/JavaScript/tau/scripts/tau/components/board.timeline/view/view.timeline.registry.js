define(["Underscore","jQuery","tau/core/class","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/components/board.timeline/view/view.cell.timeline","tau/components/board.timeline/view/view.cell.board","tau/components/board.timeline/view/view.axis-cell.board","tau/components/board.timeline/models/collection.coords.based","tau/components/board.timeline/views/card/view.timeline.card-metrics"],function(e,t,n,i,r,l,o,s,d){var a=n.extend({init:function(e,t){d.setRangeModel(e),this._timelineRangeModel=e,this._busEvents=t,this._cellViews=new s},renderCell:function(e,t,n,i,r){return n.isTimeline?this._renderTimelineCell(r,e,t,n,i):this._renderBoardCell(e,t,n,i)},renderAxisCell:function(e,t,n,i){this._renderCell(o,e,t,n,i).done(this._addAxisCellToRegistry.bind(this))},_addCellToRegistry:function(e){return e.onViewUpdated.add(function(t,n){this._busEvents.onCellUpdated.fire({target:e,operation:t,result:n})},this),this._cellViews.insert(e._$cell.data(),e),e},_addAxisCellToRegistry:function(e){return e.onViewUpdated.add(function(t,n){this._busEvents.onAxisUpdated.fire({target:e,operation:t,result:n})},this),e},axisCellsAdded:function(n,i){this._busEvents.onAxisUpdated.fire({target:null,operation:{name:"added",location:"axis",items:n,options:i},result:{cards:[],dataItems:e.pluck(n,"data"),$cell:t("<div></div>").data(e.first(n).data)}})},moveCard:function(e,t,n,i){this.moveCardToCell(e,n,i),this.clearCardFromCell(e,t)},clearCardArtifacts:function(e,t){this._getCellViewByCoords(t).clearCardArtifacts(e)},moveCardToCell:function(e,t,n){this._getCellViewByCoords(t).moveCardIn(e,n)},clearCardFromCell:function(e,t){this._getCellViewByCoords(t).moveCardOut(e)},unlockAllTrackCards:function(){this._cellViews.forEach(function(e){e.unlockAllTrackCards&&e.unlockAllTrackCards()})},_getCellViewByCoords:function(e){return this._cellViews.get(e)||new c},_getCellElement:function(e,t){var n=i.generateId(e);return t.find("#"+n)},_renderTimelineCell:function(e,t,n,i,l){return e.then(function(e){return this._renderCell(r,t,n,i,l,{timelineWidth:e})
}.bind(this)).then(this._addCellToRegistry.bind(this))},_renderBoardCell:function(e,t,n,i){return this._renderCell(l,e,t,n,i).then(this._addCellToRegistry.bind(this))},_renderCell:function(t,n,i,r,l,o){var s=this._getCellElement(r.dataItem,l);return o=e.extend({beforeInsert:this._busEvents.onBeforeUpdateCell.fire.bind(this._busEvents.onBeforeUpdateCell),afterInsert:this._busEvents.onAfterUpdateCell.fire.bind(this._busEvents.onAfterUpdateCell)},o),i.getLayoutFactory().then(function(e){var i=new t(r,s,e,n,o,this._busEvents,d);return i.render(),i}.bind(this))}}),c=n.extend({init:function(){},_$cell:t(),moveCardIn:t.noop,clearCardArtifacts:t.noop,createPlaceholderContent:t.noop});return a});