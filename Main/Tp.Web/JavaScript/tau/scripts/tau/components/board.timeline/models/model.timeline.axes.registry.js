define(["Underscore","jQuery","tau/core/class","tau/components/board.timeline/models/cell/model.cell.timeline.axes"],function(e,i,t,n){return t.extend({init:function(i){this.timelineRangeModel=i,this.onAxisCellAdded=e.Callbacks(),this.clear()},_getSliceItemDeferred:function(t,n,r){var s=e.find(t,function(e){return e.x===n.x&&e.y===n.y});if(s&&r){var d=t.indexOf(s);t.splice(d,1),s=null}return s||(s={x:n.x,y:n.y,value:i.Deferred()},t.push(s)),s},_getAxisDeferred:function(e,i){return this._getSliceItemDeferred(this.axesDeferreds,e,i)},registerAxisCell:function(e,i){null==i.x&&delete i.x,null==i.y&&delete i.y;var t=this._getAxisDeferred(i,!0),r=new n(e);return t.value.resolve(r),this},getAxes:function(e){return this._getAxisDeferred(e,!1).value},clear:function(){this.axesDeferreds=[]},whenAxisRegistered:function(e){return this._getAxisDeferred(e).value.promise()},broadcastAxes:function(i){e.each(this.axesDeferreds,function(e){e.value.done(i)})},_extractAxisCoords:function(i){return e.pick(i,"x","y")},updateAxes:function(i){var t=function(e,i){i.updateAxis(e)};e(i).chain().reduce(function(i,n){var r=this._extractAxisCoords(n);return this.whenAxisRegistered(r).done(e.bind(t,null,n)),i.push(r),i}.bind(this),[]).value()},removeAxes:function(i){var t=function(e,i){i.removeAxis(e)};e.each(i,function(i){this.broadcastAxes(e.bind(t,null,i.data.id))},this)},addAxes:function(i,t){var n=function(e){this.onAxisCellAdded.fire(e,t)};e.each(i,function(i){var t=this._extractAxisCoords(i),r=e(i).chain().pick("x","y").defaults({fixed:{items:[]},dynamic:{items:[i.data]}}).value();this.registerAxisCell(r,t).whenAxisRegistered(t).done(e.bind(n,this,i))},this)}})});