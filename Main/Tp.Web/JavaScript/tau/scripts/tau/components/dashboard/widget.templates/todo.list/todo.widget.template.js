define(["require","Underscore","libs/react/react-ex","./todo.widget.model","jsx!./todo.widget.view","jsx!./todo.widget.settings","./todo.widget.constants","tau/components/dashboard/widget.templates/todo.list/todo.widget.entity.layouts","tau/core/termProcessor","tau/ui/templates/board.plus/customized/ui.template.boardplus.default.card.customized","./todo.widget.highlighter","tau/core/bus"],function(t){var e=t("Underscore"),i=t("libs/react/react-ex"),n=t("./todo.widget.model"),o=t("jsx!./todo.widget.view"),r=t("jsx!./todo.widget.settings"),a=t("./todo.widget.constants"),s=t("tau/components/dashboard/widget.templates/todo.list/todo.widget.entity.layouts"),d=t("tau/core/termProcessor"),c=t("tau/ui/templates/board.plus/customized/ui.template.boardplus.default.card.customized"),u=t("./todo.widget.highlighter"),g=t("tau/core/bus"),l=new g,h=function(t){return{id:h.TEMPLATE_ID,name:"ToDo List",previewSrc:"../img/widgets/todo-list.png",description:"All open work assigned to you",tags:["Lists"],insert:function(e,r,a){var s=new n(a.context,t,r),d=new u(t.getStore());return d.initialize().then(function(){return i.render(i.createElement(o,{highlighter:d,cardsRetrieving:s.cardsRetrieving,cardsRetrieved:s.cardsRetrieved,renderCardAsText:function(e,i){return c.renderToString({dataItem:e,layout:i,configurator:t})},openEntityView:function(e){t.getEntityViewService().showEntityView(e)},handleUnitInteraction:function(e){var i=t.getUnitsRegistry().getUnitById(e.unitId);if(!i)return void console.error('Unknown unit "'+e.unitId+'". Unable to handle the interaction.');var n=s.getCardDataByEntityId(e.cardId);if(!n)return void console.error('Unable to find card with id "'+e.cardId+'" for unit interaction');var o=n[e.unitId];if(o||console.warn('Card data for unit "'+e.unitId+'" does not exist'),i.interactionConfig&&i.interactionConfig.handler){var r={cardDataForUnit:o,unit:i,$unit:e.$unit,$card:e.$card},a={configurator:t,hostBus:l};i.interactionConfig.handler(r,a)}}}),e),{update:function(t){s.update(t)
},updateContext:s.updateContext.bind(s),destroy:function(){s.destroy(),i.unmountComponentAtNode(e)}}})},insertSettings:function(n,o,s){return t.getApplicationContextService().getApplicationContext({acid:s.context.acid}).then(function(t){var s=e.find(t.processes,e.property("isDefault")),c=s||t.processes[0],u=new d(c.terms),g=i.renderClass(r,{termProcessor:u,initialEntities:o.entities,initialHighlight:o.highlight},n);return function(){return{entities:g.state.entities,highlight:{blockers:g.state.highlight.blockers,noStateChanges:g.state.highlight.noStateChanges,noStateChangesDays:g.state.highlight.noStateChangesDays||a.NO_STATE_CHANGE_DAYS}}}})},defaultSettings:{entities:e.keys(s),highlight:{blockers:!1,noStateChanges:!1,noStateChangesDays:a.NO_STATE_CHANGE_DAYS}}}};return h.TEMPLATE_ID="todo_list",h});