define(["require","tau/core/class","./../models/dashboard.model","./../models/dashboard.column.layout.model","tau/services/service.board.access","jQuery"],function(e){var t=e("tau/core/class"),o=e("./../models/dashboard.model"),i=e("./../models/dashboard.column.layout.model"),s=e("tau/services/service.board.access"),r=e("jQuery");return t.extend({init:function(e,t,o){this._viewsApi=t,this._loggedUser=o,this._widgetFactory=e,this._modelStorage={},t.on("service.views.api.removed.view",this._onItemRemoved,this)},getDashboardModel:function(e){return this._getDashboardSettings(e).then(function(t){var o=this._modelStorage[e];return o?o.updateLayoutModel(t.data.layout):(o=this._createModel(t.data),this._modelStorage[e]=o),o}.bind(this))},_getDashboardSettings:function(e){return this._widgetFactory.initialized.then(function(){return this._viewsApi.getViewMenuItem(e)}.bind(this))},_createModel:function(e){var t=s.isEditable(e,this._loggedUser);return new o(e,t,this._widgetFactory,this._viewsApi)},getColumnLayout:function(e){var t=r.Deferred();return this.getDashboardModel(e).then(function(e){var o=e.layoutModel;o.layoutType===i.LAYOUT_TYPE_NAME?t.resolve(o):t.reject("Layout exists but it is not a columns layout")}).fail(function(e){t.reject(e)}),t.promise()},_onItemRemoved:function(e,t){this._modelStorage[t]=null},destroy:function(){this._viewsApi.removeAllListeners(this)}})});