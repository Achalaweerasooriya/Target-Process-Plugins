define(["require","Underscore","tau/core/class","./dashboard.column.layout.model","./dashboard.error.layout.model"],function(t){var e=t("Underscore"),o=t("tau/core/class"),d=t("./dashboard.column.layout.model"),a=t("./dashboard.error.layout.model");return o.extend({init:function(t,o,d,a){this.updated=e.Callbacks(),this.widgetAdded=e.Callbacks(),this._isEditable=o,this._viewsApi=a,this._dashboardId=t.key,this._widgetFactory=d,this.layoutModel=this._createLayoutModel(t.layout),this.layoutModel.updated.add(this._onLayoutUpdated,this),this.layoutModel.changed.add(this._onLayoutChanged,this),this.layoutModel.columnCountChanged.add(this._onColumnCountChanged,this)},updateLayoutModel:function(t){this.layoutModel.updateLayout(t)},getResizeBroker:function(){return this._widgetFactory.getResizeBroker()},addWidgetFromTemplate:function(t){return this._addWidgetFromTemplateInternal(t,!1)},addWidgetFromTemplateAndMakeVisible:function(t){return this._addWidgetFromTemplateInternal(t,!0)},_addWidgetFromTemplateInternal:function(t,e){var o=this.doWithColumnLayout(function(e){return e.addWidgetFromTemplate(t)});return o.inserted.once(function(t){this.widgetAdded.fire({placeholder:t.placeholder,scrollToWidget:e})}.bind(this)),o},doWithColumnLayout:function(t){return this.layoutModel instanceof d?t(this.layoutModel):void 0},_createLayoutModel:function(t){switch(t.id){case"columns":return new d(t,this._isEditable,this._widgetFactory);default:return new a('Unknown layout type: "'+t.id+'"')}},_onLayoutChanged:function(t){this._viewsApi.updateViewMenuItem(this._dashboardId,{layout:t.getLayout()})},_onLayoutUpdated:function(){this._notifyUpdated()},_onColumnCountChanged:function(){this.getResizeBroker().notifyResized()},_notifyUpdated:function(){this.updated.fire(this)}})});