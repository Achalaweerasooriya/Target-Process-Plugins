define(["require","Underscore","jQuery","tau/core/class"],function(t){var e=t("Underscore"),r=t("jQuery"),i=t("tau/core/class"),o=["userstory","bug","request"],n=["userstory","bug","task","request"];return i.extend({init:function(t){this._store=t},initialize:function(){return this._loadTopPriorities()},_loadTopPriorities:function(){return r.when(this._store.getDef("priority",{fields:["importance",{entityType:["name"]}]}),this._store.getDef("severity",{fields:["importance"]})).then(function(t,r){this._topPriorities={userstory:this._getTopPriorityForEntity(t,"userstory"),request:this._getTopPriorityForEntity(t,"request"),bug:e.min(r,e.property("importance"))}}.bind(this))},_getTopPriorityForEntity:function(t,r){return e.min(e.filter(t,function(t){return t.entityType.name.toLowerCase()===r}),e.property("importance"))},shouldHighlightCard:function(t,r){var i=t.type.toLowerCase();if(r.blockers&&e.contains(o,i)){var s;if("userstory"===i||"request"===i?s=t.data.cardData.importance:"bug"===i&&(s=t.data.severity_icon.severity.importance),s===this._topPriorities[i].importance)return!0}if(r.noStateChanges&&e.contains(n,i)&&t.lastStateChangeDate){var a=Math.floor((e.now()-t.lastStateChangeDate.getTime())/864e5);if(a>=r.noStateChangesDays)return!0}return!1}})});