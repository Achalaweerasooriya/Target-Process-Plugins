define(["require","jQuery","Underscore","template!tau/components/customReport/templates/customReport.template","tau/components/customReport/customReport.renderer","tau/components/customReport/customReport.state.renderer"],function(e){function t(e){return{height:e.clientHeight-p}}var n=e("jQuery"),r=e("Underscore"),o=e("template!tau/components/customReport/templates/customReport.template"),i=e("tau/components/customReport/customReport.renderer"),s=e("tau/components/customReport/customReport.state.renderer"),u=i.extend({getChartPlugins:function(e,t,n){return[this.getTooltipPlugin(e,n),this.getOpenEntityPlugin(),this.getTrendlinePlugin({showPanel:!1})]}}),p=17;return{insertReportComponent:function(e){var r=e.placeholder,i=n('<div class="tau-custom-report-widget-adapter"></div>').append(o.get().bind()).appendTo(r),p=i.find(".i-role-report-content"),c={size:t(r),autoResize:!1},a=this._createReportSettings(e.reportDefinition,e.environmentContext);return new s(new u(e.configurator)).renderCustomReportAndGetState(p,a,c).then(function(n){return{updateContext:function(t){n.rerender(this._createReportSettings(e.reportDefinition,t))}.bind(this),resize:function(){n.resize(t(r))},destroy:function(){n.destroy()}}}.bind(this))},_createReportSettings:function(e,t){var n=r.deepClone(e.reportSettings);return n.dataSource.global=r.extend(n.dataSource.global||{},{acid:t.acid}),n}}});