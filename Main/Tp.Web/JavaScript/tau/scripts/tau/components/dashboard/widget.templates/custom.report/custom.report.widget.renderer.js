define(["require","jQuery","Underscore","jsx!tau/components/dashboard/widget.templates/shared/status.view","template!tau/components/customReport/templates/customReport.template","tau/components/customReport/customReport.renderer","tau/components/customReport/customReport.state.renderer","tau/components/customReport/customReport.report.transformer"],function(e){function t(e){return{height:e.placeholder.clientHeight-c-(e.reportDefinition.description?d:0)}}var r=e("jQuery"),o=e("Underscore"),n=e("jsx!tau/components/dashboard/widget.templates/shared/status.view"),s=e("template!tau/components/customReport/templates/customReport.template"),a=e("tau/components/customReport/customReport.renderer"),i=e("tau/components/customReport/customReport.state.renderer"),p=e("tau/components/customReport/customReport.report.transformer"),u=a.extend({getChartPlugins:function(e,t){return[this.getTooltipPlugin(e,t),this.getOpenEntityPlugin(),this.getTrendlinePlugin({showPanel:!1})]}}),c=17,d=40;return{insertReportComponent:function(e){var o=e.placeholder,a=r('<div class="tau-custom-report-widget-adapter"></div>').append(s.get().bind()).appendTo(o),p={size:t(e),autoResize:!1,getEmptyTemplate:function(e){return n.renderToDOM({containerClassName:"tau-dashboard-widget-placeholder--tau-dashboard-report"},[e])},getLoaderTemplate:function(){return'<div class="tau-dashboard-widget-placeholder tau-loading--centered" />'}},c=this._createReportSettings(e.reportDefinition,e.environmentContext);return new i(new u(e.configurator)).renderCustomReportAndGetState(a,c,p).then(function(r){return{updateContext:function(t){r.rerender(this._createReportSettings(e.reportDefinition,t))}.bind(this),resize:function(){r.resize(t(e))},destroy:function(){r.destroy()}}}.bind(this))},_createReportSettings:function(e,t){var r=o.deepClone(e);return r.reportSettings.dataSource.global=o.extend(r.reportSettings.dataSource.global||{},{acid:t.acid}),r.report=p.setCompactMode(r.reportSettings.report),r.report=p.changeXScaleFromPeriodToTime(r.reportSettings.report),r
}}});