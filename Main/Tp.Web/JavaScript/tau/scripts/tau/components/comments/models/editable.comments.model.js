define(["require","Underscore","tau/core/model.editable.base"],function(e){var t=e("Underscore"),i=e("tau/core/model.editable.base");return i.extend({name:"Editable Comments",_signUpEventsIfRequired:function(){if(!this._signedUp){this._signedUp=!0;var e=function(e){e.data.cmd.guid=+new Date,this.fire("prepareUpdate",e.data)}.bind(this),t=function(e){this.fire("applyUpdate",e.data)}.bind(this),i=function(e){e.data.cmd.guid=+new Date,this.fire("prepareRemove",e.data)}.bind(this),n=function(e){var t=e.data.obj.parentId,i=this.getComment(t);i&&i.deleted&&1===i.comments.length?this.store.remove("comment",{id:t}).done():this.fire("applyRemove",e.data)}.bind(this);this.store.unbind(this),this.store.on({eventName:"beforeSave",type:"comment",listener:this},e).on({eventName:"afterSave",type:"comment",listener:this},t).on({eventName:"beforeRemove",type:"comment",listener:this},i).on({eventName:"afterRemove",type:"comment",listener:this},n)}},"bus dataBind":function(e){var i=e.data.items;this.commentsList=this.getPlainList(i);var n=t(this.commentsList).pluck("id"),s={editable:!0,editableItems:n,deletable:!0,deletableItems:n};this._signUpEventsIfRequired(),this.fire("permissionsReady",s)},getComment:function(e){return e?t.findWhere(this.commentsList,{id:e}):null},getPlainList:function(e){for(var t=[],i=0,n=e.length;n>i;i++){var s=e[i];t.push(s);var a=this.getPlainList(e[i].comments);t=t.concat(a)}return t}})});