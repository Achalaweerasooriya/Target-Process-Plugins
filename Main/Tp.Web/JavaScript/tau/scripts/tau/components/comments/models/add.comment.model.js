define(["require","Underscore","./comment.model.base","tau/models/dataprocessor/model.processor.comment","./comment.editor.model"],function(e){var t=e("Underscore"),o=e("./comment.model.base"),n=e("tau/models/dataprocessor/model.processor.comment"),i=e("./comment.editor.model");return o.extend({"bus afterInit":function(e,t){this.config=t.config;var o=t.config.context.configurator,n=o.getLoggedUser(),i=o.getStore();i.getDef("user",{id:n.id,fields:["id","firstName","email","lastName","kind","avatarUri","login"]}).then(function(e){var t={id:null,description:"",owner:e},o=this._convertDto(t);this._draftComment=o,this.fire("dataBind",o),this._createEditorModel()}.bind(this))},_createEditorModel:function(){var e=this.config.context.entity,t=new i({entityId:e.id,entityType:e.entityType.name,saveComment:function(e){return this.postCommentText(this._draftComment.id,e)}.bind(this),saveActionName:"Add comment"});this.fire("editorModelReady",t)},_convertDto:function(e){var o=this.config,i=o.parentCommentId,r=new n(o.context.configurator),d=r.convertDTO(t.extend({},e));return d.parentId=i,d}})});