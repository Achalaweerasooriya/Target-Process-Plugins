define(["require","Underscore","tau/core/class","../services/comments.localStorage.service"],function(e){var t=e("Underscore"),n=e("tau/core/class"),i=e("../services/comments.localStorage.service"),o=new i,s=n.extend({init:function(e){this._entityId=e.entityId,this._entityType=e.entityType,this._getDefaultCommentText=e.getDefaultCommentText||t.constant(""),this._saveComment=e.saveComment,this._saveActionConfig={text:e.saveActionName||"Save",disableIfEmpty:!0,checkChanges:e.checkChanges},this.editorClosed=t.Callbacks()},getEditorText:function(){return this._retrieveCommentBackup()},saveComment:function(e){this._saveComment(e).done(function(){this._clearCommentBackup()}.bind(this))},updateCommentText:function(e){this._storeCommentBackup(e)},getSaveActionConfig:function(){return t.deepClone(this._saveActionConfig)},cancelEdit:function(){this._clearCommentBackup()},closeEditor:function(){this.editorClosed.fire()},_storeCommentBackup:function(e){o.storeComment(this._entityId,this._entityType,e)},_retrieveCommentBackup:function(){return o.retrieveComment(this._entityId,this._entityType)||this._getDefaultCommentText()},_clearCommentBackup:function(){o.clearComment(this._entityId,this._entityType)}});return s});