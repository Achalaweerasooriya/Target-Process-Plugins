define(["require","Underscore","tau/core/class"],function(e){var t=e("Underscore"),r=e("tau/core/class"),n=window.localStorage,o="userInputBackup:";return r.extend({EVICT_TIME_DELTA_MS:864e5,storeComment:function(e,t,r){try{this._storeComment(e,t,r)}catch(n){this.runCommentBackupCleanup();try{this._storeComment(e,t,r)}catch(o){console.error("Unable to store comment backup",o)}}},_storeComment:function(e,t,r){var o=JSON.stringify(this._createStorageItem(r));n.setItem(this._createKey(e,t),o)},retrieveComment:function(e,t){var r=n.getItem(this._createKey(e,t));return r?this._parseStorageItem(r).value:null},clearComment:function(e,t){n.removeItem(this._createKey(e,t))},runCommentBackupCleanup:function(){var e=t.now();t.each(t.keys(n),function(r){if(t.startsWith(r,o)){var a=this._parseStorageItem(n.getItem(r)).createdAt;e-a>=this.EVICT_TIME_DELTA_MS&&n.removeItem(r)}},this)},_parseStorageItem:function(e){try{return JSON.parse(e)}catch(t){return console.error("Unable to parse stored comment",t),null}},_createStorageItem:function(e){return{createdAt:t.now(),value:e}},_createKey:function(e,t){return o+t+":"+e}})});