define(["require","Underscore","tau/core/model-base","tau/models/dataprocessor/model.processor.comment"],function(e){var t=e("Underscore"),n=e("tau/core/model-base"),r=e("tau/models/dataprocessor/model.processor.comment");return n.extend({name:"Comments",FIELDS:["id",{comments:["id","description","createDate","parentId",{owner:["id","firstName","lastName","kind","avatarUri","email","login"]}],list:!0}],onInit:function(){this.converter=new r(this.config.context.configurator),this._requestAssignable()},"bus createDTO":function(e){var t=this.converter.convertDTO(e.data);t.comments=[],this.fire("DTOCreated",t)},_requestAssignable:function(){var e=this.config.context.entity,t={id:e.id,fields:this.FIELDS},n={success:this.safeCallback(this._onAssignableRetrieved)};this.store.get(e.entityType.name,t,n).done()},_onAssignableRetrieved:function(e){this.assignable=e.data;var n=e.data.comments,r=t.sortBy(n,function(e){return e.id});this._convertDTO(r);var s=this._convertToTree(null);this.bus.fire("dataBind",{items:s})},_convertDTO:function(e){return this.convertedComments=t.map(e,function(e){return this.converter.convertDTO(e)},this),this},_convertToTree:function(e){for(var t=[],n=this.convertedComments,r=0,s=n.length;s>r;r++){var o=n[r];o.parentId==e&&(t.push(o),o.comments=this._convertToTree(o.id))}return t},destroy:function(){this.converter.destroy(),this._super()}})});