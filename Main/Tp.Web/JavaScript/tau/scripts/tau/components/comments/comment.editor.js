define(["require","jQuery","Underscore","tau/core/class","tau/ui/extensions/comment/mention.ckeditor.plugin","tau/ui/behaviour/common/markdown.uploader.plugin","tau/ui/behaviour/common/markdown.mention.plugin","tau/utils/utils.constants","tau/ui/behaviour/common/ui.behaviour.richeditor","tau/ui/behaviour/common/ui.behaviour.richeditorMarkdown"],function(i){var t=i("jQuery"),o=i("Underscore"),e=i("tau/core/class"),n=i("tau/ui/extensions/comment/mention.ckeditor.plugin"),r=i("tau/ui/behaviour/common/markdown.uploader.plugin"),s=i("tau/ui/behaviour/common/markdown.mention.plugin"),d=i("tau/utils/utils.constants").get("editorByType");return i("tau/ui/behaviour/common/ui.behaviour.richeditor"),i("tau/ui/behaviour/common/ui.behaviour.richeditorMarkdown"),e.extend({init:function(i){this._configurator=i.configurator,this._editorModel=i.editorModel,this._extension=i.extension,this._$editor=i.$editor,this._mentionConfig=i.mentionConfig,this._uploadUrl=i.pluginConfig.uploadUrl,this._widget=d[i.editorType||"Markdown"]},showEditor:function(){this._$editor[this._widget]("instance")||(this._$editor[this._widget](this._createRichEditorConfig()),this._$editor[this._widget]({change:o.throttle(this._extension.safeCallback(this._onEditorChange.bind(this)),1e3)})),this._$editor[this._widget]("show")},_createRichEditorConfig:function(){return{ckPath:this._configurator.getCkPath(),settings:{toolbar:"Basic",removePlugins:"autogrow,magicline",allowedContent:!0,MentionPlugin:n.getMentionPlugin(this._mentionConfig),height:200},plugins:[r({uploadUrl:this._uploadUrl}),s(this._mentionConfig)],executionGroupName:"comments",onCreate:this._onEditorCreate.bind(this),onSave:function(i){this._extension.fire("editorSave"),this._editorModel.saveComment(i),this._closeEditor()}.bind(this),onCancel:function(){this._editorModel.cancelEdit(),this._closeEditor()}.bind(this),saveAction:this._editorModel.getSaveActionConfig(),cancelAction:{available:!0},text:this._editorModel.getEditorText(),rawText:this._editorModel.getEditorText()}
},_onEditorCreate:function(){var i=this._$editor.parent(),o=this._$editor.closest(".ui-popup-content");0===o.length&&(o=t(window)),o.scrollTo(i,100),this._extension.fire("$editor.ready",this._$editor),this._extension.fire("$editorHolder.ready",i)},_closeEditor:function(){this._$editor[this._widget]("destroy"),this._editorModel.closeEditor()},_onEditorChange:function(){var i=this._$editor[this._widget]("getText");this._editorModel.updateCommentText(i)}})});