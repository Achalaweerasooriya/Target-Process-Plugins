define(["require","tau/core/class","Underscore","jQuery"],function(t){var e=t("tau/core/class"),n=t("Underscore"),i=t("jQuery");return e.extend({init:function(t,e,n){this.store=t.getStore(),this.followId=null,this.entity=n,this.userId=e},_getSettings:function(){return{general:{id:this.entity.id},user:{id:this.userId}}},toggleFollow:function(){return this.isFollowing().then(function(t){return t?this.unFollow():this.follow()}.bind(this))},follow:function(){return this.store.saveDef("generalFollower",{$set:this._getSettings()}).then(function(t){return this._track("follow"),this.followId=t.data.id,t}.bind(this))},unFollow:function(){var t=i.Deferred();return this.store.remove("generalFollower",{id:this.followId}).done({success:function(){this._track("unfollow"),t.resolve()}.bind(this),failure:function(){t.reject()}}),t.promise()},isFollowing:function(){return this.store.getDef("generalFollower",{$query:this._getSettings()}).then(function(t){var e=n.first(t);return e?(this.followId=e.id,!0):!1}.bind(this))},_track:function(t){taus.track({name:t,entityType:this.entity.entityType.name})}})});