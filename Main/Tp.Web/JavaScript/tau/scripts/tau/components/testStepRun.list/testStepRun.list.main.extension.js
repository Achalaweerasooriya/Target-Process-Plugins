define(["require","tau/core/extension.base","Underscore","tau/const/testCaseRun.status","tau/utils/utils.date"],function(t){{var e=t("tau/core/extension.base"),n=t("Underscore"),s=t("tau/const/testCaseRun.status");t("tau/utils/utils.date")}return e.extend({"bus beforeInit":function(t,e){this.config=e.config,this.config.store.get("testcaserun",{id:this.config.context.entity.id,fields:[{testStepRuns:["description","result","passed","runned","id","runOrder"]},{testPlanRun:[{entityState:["isFinal"]}]}]}).done({scope:this,success:function(t){this.runs=n.sortBy(t[0].data.testStepRuns,function(t){return t.runOrder}),this.testPlanRunInFinalState=t[0].data.testPlanRun.entityState.isFinal,this.fireProps()}})},"bus afterRender":function(t,e){e.element.on("click mousedown","a:not(.i-role-fullview)",function(t){t.preventDefault(),t.stopPropagation(),"click"==t.type&&window.open(this.href)})},fireProps:function(){this.fire("props.ready",{runs:this.runs,editable:!(this.config.allData&&this.config.allData.editable===!1||this.testPlanRunInFinalState),disabled:this.testPlanRunInFinalState,changeStatus:this.changeStatus.bind(this)})},changeStatus:function(t,e){t=n.findWhere(this.runs,{id:t.id});var s=n.clone(t);t.runned=null!==e,t.passed=t.runned?e:null,this.config.store.save("teststeprun",{$set:{id:t.id,runned:t.runned,passed:t.passed}}).done({scope:this,failure:function(){this.runs=n.map(this.runs,function(t){return t.id===s.id?s:t}),this.fireProps()}}),this.fireProps(),this.maybeUpdateTestCaseRun()},maybeUpdateTestCaseRun:function(){var t=n.every(this.runs,function(t){return t.passed}),e=!t&&1==n.reduce(this.runs,function(t,e){return e.passed===!1?++t:t},0),i=null;e?i=s.failed:t&&(i=s.passed),i&&this.config.store.save("testcaserun",{$set:{id:this.config.context.entity.id,status:i},fields:["status","runDate"]}).done()}})});