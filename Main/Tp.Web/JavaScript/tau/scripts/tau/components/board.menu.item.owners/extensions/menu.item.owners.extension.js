define(["require","tau/components/extensions/component.extension.base","Underscore","react","tau/components/board.menu/services/board.menu.users.service","../models/menu.item.owners.model","jsx!../views/menu.item.owners.view"],function(e){var t=e("tau/components/extensions/component.extension.base"),n=e("Underscore"),i=e("react"),s=e("tau/components/board.menu/services/board.menu.users.service"),r=e("../models/menu.item.owners.model"),o=e("jsx!../views/menu.item.owners.view");return t.extend({"bus afterInit":function(e,t){var n=t.config.context;this._defaultProps=this._createDefaultProps(n),this.fire("dataBind"),n.menuItemKey&&this.fire("_menuItemKey",n.menuItemKey)},"bus boardSettings.ready":function(e,t){t.boardSettings.get({fields:["key"]}).then(function(e){this.fire("_menuItemKey",e.key)}.bind(this))},"bus afterInit + afterRender + _menuItemKey":function(e,t,n,a){var u=t.config.context,m=u.configurator,d=u.menuItemType||"board",c=new s(m.getStore()),f=m.getViewsMenuService(),h=new r(a,d,c,m.getLoggedUser(),f);this._itemService=f.getApiForType(d),this._itemService.getViewMenuItem(a).then(function(e){var t=this.element[0],n=h.setNewOwnerList(e.data.ownerIds),s=i.render(i.createElement(o,this._getProps(h)),t);this._wireUpView(h,s),this._itemService.on("service.views.api.updated",function(e,t){t.data.key===a&&h.setNewOwnerList(t.data.ownerIds)},this),n.then(function(){this.fire("menu.item.owners.view.ready",{view:s,containerElement:t,componentBus:this.bus})}.bind(this))}.bind(this))},_wireUpView:function(e,t){e.ownersChanged.add(function(){t.isMounted()&&t.setProps(this._getProps(e))},this)},_getProps:function(e){return n.defaults({owners:e.owners,canEdit:e.getIsOwnerListEditable(),store:e},this._defaultProps)},_createDefaultProps:function(e){var t=e.configurator,i={store2:t.getStore2(),keyboardManager:t.getKeyBoardManager(),notifyListEditorCreated:function(e){this.fire("testOnly.menu.item.owners.editor.view.created",e)}.bind(this)},s=n.pick(e,["ContainerTemplate","labelText"]);
return n.extend(i,s)},"bus destroy":function(){this._itemService&&this._itemService.removeAllListeners(this),this.element&&i.unmountComponentAtNode(this.element[0]),this._super()}})});