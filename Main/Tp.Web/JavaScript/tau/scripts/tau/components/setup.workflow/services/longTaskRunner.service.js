define(["require","Underscore","jQuery","tau/core/class","app.path"],function(t){"use strict";var e=t("Underscore"),n=t("jQuery"),i=t("tau/core/class"),a=t("app.path"),r=i.extend({STATUS_POLL_INTERVAL:1e3,migrateEntityState:function(t,e){return this._runTask("migrateEntityState",{entityStateId:t,newEntityStateId:e})},_runTask:function(t,e){var i=n.Deferred();return this._post("/api/longTasks/"+t,e).then(this._waitForCompletion.bind(this,i),i.reject.bind(i)),i},_post:function(t,e){return n.ajax({url:a.get()+t,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},_waitForCompletion:function(t,n){n.isCompleted?t.resolve():(t.notify(n),e.delay(function(){this._queryStatus(n.taskId,t).then(this._waitForCompletion.bind(this,t),t.reject.bind(t))}.bind(this),this.STATUS_POLL_INTERVAL))},_queryStatus:function(t){return n.ajax({url:a.get()+"/api/longTasks/status",contentType:"application/json",data:{taskId:t}})}});return r});