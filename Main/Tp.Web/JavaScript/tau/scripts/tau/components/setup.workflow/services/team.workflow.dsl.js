define(["require","jQuery","Underscore"],function(e){"use strict";var t=e("jQuery"),r=e("Underscore");return{createTeamWorkflowFromText:function(e,i,n){e=t.trim(e);var a=t.Deferred();if(!e)return a.reject("Specify a Team Workflow name."),a.promise();var s=r.compact(i.split("\n"));if(0===s.length)return a.reject("A Team Workflow requires at least the initial and final states mapped to the Process Workflow states."),a;var o=r.map(n,function(e){return{id:e.id,name:e.name.toLowerCase()}}),m=r.chain(s).map(function(e){var t=e.trim(),i=t.indexOf(":");if(!(1>i)&&i!==t.length-1){var n=t.substring(0,i).trim().toLowerCase(),s=r.findWhere(o,{name:n});if(!s)return a.reject("'"+n+"' state doesn't exist."),a.promise();var m=t.substring(i+1).split(",");return r.map(m,function(e){var t=e.trim();return t.length>0?{name:t,parentEntityState:{id:s.id}}:null})}}.bind(this)).flatten().compact().map(function(e,t){return e.numericPriority=t+1,e}).value();return m.length<2?(a.reject("The initial and final states of the '"+e+"' have to be mapped to the Process Workflow states."),a.promise()):(r.first(m).isInitial=!0,r.last(m).isFinal=!0,a.resolve({name:e,entityStates:m}),a.promise())}}});