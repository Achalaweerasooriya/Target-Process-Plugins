define(["require","jQuery","Underscore","tau/nls/translator","tau/core/class"],function(e){var t=e("jQuery"),a=e("Underscore"),n=e("tau/nls/translator"),i=e("tau/core/class");return i.extend({init:function(e,t){this.emailRegexp=t,this.dataService=e},_notSelectedCompany:{id:"empty",name:"- Select Company -"},getFormModel:function(e){var a={updateSettings:this.updateSettings.bind(this,e),generateAndSendPassword:this.dataService.generateAndSendPassword.bind(this.dataService,e),"delete":this.dataService.deleteRequester.bind(this.dataService,e)};return t.when(this.dataService.getRequester(e),this.getCompanies(),this.dataService.isGenerateAndSendPasswordAvailable(e),a).then(function(e,t,a,n){return{requester:e,companies:t,isGenerateAndSendPasswordAvailable:a,actions:n}})},getCompanies:function(){return this.dataService.getCompanies().then(function(e){return[this._notSelectedCompany].concat(e)}.bind(this))},updateSettings:function(e,n){var i=this.validate(n);if(!a.isEmpty(i)){var r=t.Deferred();return r.reject({validationContext:i}),r}var s=this._mapViewStateToRequester(n);return this.dataService.updateSettings(e,s).then(a.constant(n))},validate:function(e){var t={};if(e.password!==e.confirmPassword){var i=n("Your password and confirmation password don't match");t.password=i,t.confirmPassword=i}return a.isEmpty(a.trim(e.email))?t.email=n("Please enter email"):this._isEmailValid(e.email)||(t.email=n("Invalid email address")),t},_isEmailValid:function(e){return this.emailRegexp.test(a.trim(e))},_mapViewStateToRequester:function(e){var t=a.pick(e,["email","password","phone","notes"]);return a.isUndefined(e.companyId)||(t.company=null,e.companyId!==this._notSelectedCompany.id&&(t.company={id:e.companyId})),t}})});