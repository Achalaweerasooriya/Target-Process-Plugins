define(["require","tau/components/extensions/component.extension.base","Underscore","jQuery","react","./../models/menu.item.access.model","./../models/menu.item.access.notification.model","jsx!./../views/menu.item.access.view","tau/services/boards/view.types","tau/components/component.board.menu.item.access.context"],function(e){var t=e("tau/components/extensions/component.extension.base"),i=e("Underscore"),n=e("jQuery"),o=e("react"),s=e("./../models/menu.item.access.model"),a=e("./../models/menu.item.access.notification.model"),r=e("jsx!./../views/menu.item.access.view"),c=e("tau/services/boards/view.types"),d=e("tau/components/component.board.menu.item.access.context");return t.extend({"bus afterInit":function(e,t){var n=t.config.context;this.fire("dataBind"),this._enableAutoSubmit=i.has(n,"enableAutoSubmit")?n.enableAutoSubmit:!0,n.menuItemKey&&this.fire("_menuItemKey",n.menuItemKey)},"bus boardSettings.ready":function(e,t){t.boardSettings.get({fields:["key"]}).then(function(e){this.fire("_menuItemKey",e.key)}.bind(this))},"bus afterRender + _menuItemKey":function(e,t,i){var n=this.config.context,s=n.configurator,a=n.menuItemType||"board";this._model=this._createModel(i,a,s);var c=this._createNotificationsModel(i,a,s);c.initialize().then(this.safeCallback(function(){var e=this.element[0],t=o.render(o.createElement(r),e);return this._wireUpView(this._model,c,t),this._model.initialize()})).then(function(){this.fire("menu.item.access.initialized")}.bind(this))},_createModel:function(e,t,i){var n=new s(e,t,i.getLoggedUser(),i.getStore(),i.getViewsMenuService()),o=i.service("errorBar");return n.errorOccurred.add(o.fire.bind(o,"error")),n.accessSaving.add(function(){this.fire("board.editor.access.changes.applied")}.bind(this)),n},_createNotificationsModel:function(e,t,i){var n=new a(e,t,i.getViewsMenuService(),i.getGlobalSettingsService(),i.getSliceFactory().create({}),i.getUrlBuilder()),o=i.service("errorBar");return n.errorOccurred.add(o.fire.bind(o,"error")),n.notifying.add(this.fire.bind(this,"notification",{message:"People will be notified that you've shared a "+c.getViewTypeName(this._menuItemType)+" with them.",delay:3e3})),n
},_wireUpView:function(e,t,n){e.accessChanged.add(function(){if(n.isMounted()){var o=e.getAccessData(),s=i.extend(o,{accessModel:e,isInitializing:!1,isEmailNotificationsEnabled:t.getIsEnabled(o),enableAutoSubmit:this._enableAutoSubmit,createCustomSharingComponent:this._createCustomSharingComponent.bind(this,e),getHasNotificationDataChanged:t.getHasNotificationDataChanged.bind(t,o),onSendNotification:t.sendNotification.bind(t,o),onCancel:this.fire.bind(this,"board.editor.access.cancel")});n.setProps(s)}},this)},_createCustomSharingComponent:function(e,t){var i=n.Deferred(),o=d.create();return o.on("afterRender",function(e,s){n(t).prepend(s.element),i.resolve({updateCustomSharingComponent:o.fire.bind(o,"menu.item.access.context.update")})}),o.on("item.access.context.selection.changed",function(t,i){e.setNewCustomSharingState(i.teamIds,i.projectIds),this._enableAutoSubmit&&e.applyAccessChanges()}.bind(this)),o.initialize({context:{configurator:this.config.context.configurator,access:e.getCustomSharingOptions()}}),i.promise()},"bus destroy":function(){this._model&&this._model.destroy(),this.element&&o.unmountComponentAtNode(this.element[0]),this._super()}})});