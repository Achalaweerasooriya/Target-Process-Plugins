define(["require","Underscore","jQuery","tau/core/class"],function(t){var i=t("Underscore"),e=t("jQuery"),a=t("tau/core/class"),s=a.extend({init:function(t,e,a,s,n,r){this._menuItemId=t,this._menuItemType=e,this._itemApiService=a.getApiForType(e),this._globalSettingsService=s,this._sliceApi=n,this._urlBuilder=r,this._lastNotificationData=null,this.notifying=i.Callbacks(),this.errorOccurred=i.Callbacks()},initialize:function(){return this._getEmailNotifications().then(function(t){this._emailNotificationSettings=t}.bind(this))},getIsEnabled:function(t){return this._emailNotificationSettings&&t.isView&&t.isEditable},sendNotification:function(t){return this._lastNotificationData=i.deepClone(this._extractNotificationData(t)),this.notifying.fire(),this._itemApiService.getViewMenuItem(this._menuItemId).then(function(t){var i=t.data,e=this._urlBuilder.getBoardPageRelativePath()+this._urlBuilder.getRelativeViewUrl(this._menuItemId,this._menuItemType,i.acid);return this._sliceApi.notifyViewAccess({teamIds:this._lastNotificationData.teamIds,projectIds:this._lastNotificationData.projectIds,viewUrl:e,viewName:i.name,viewType:i.itemType})}.bind(this)).fail(function(t){this.errorOccurred.fire({message:t.data.responseText.Message,delay:3e3})}.bind(this))},getHasNotificationDataChanged:function(t){return!i.isEqual(this._lastNotificationData,this._extractNotificationData(t))},_extractNotificationData:function(t){return{teamIds:t.customSharedData.teamIds,projectIds:t.customSharedData.projectIds}},_getEmailNotifications:function(){var t=e.Deferred();return this._globalSettingsService.getGlobalSettings({success:function(i){t.resolve(i.IsEmailNotificationsEnabled)},failure:function(){t.resolve(!1)}}),t.promise()}});return s});