define(["require","Underscore","./board.menu.view.item.access","./board.menu.board","./board.menu.constants","tau/services/service.board.access"],function(r){var e=r("Underscore"),t=r("./board.menu.view.item.access"),o=r("./board.menu.board"),a=r("./board.menu.constants"),i=r("tau/services/service.board.access"),s=["key","name","isExpanded","isFavorite","menuNumericPriority","menuIsVisible","isShared","customSharedData","ownerIds"];return t.extend({init:function(r,t){this._urlService=r,this.viewsMenuGroupUpdated=e.Callbacks(),this.boards=e.chain(t.boards).sortBy(e.property("menuNumericPriority")).map(this._createBoardModel,this).value(),this._applyGroupData(t),this.groupTypes=[];var o=t.key;o===a.FAVORITES_GROUP_KEY&&this.groupTypes.push(a.FAVORITES_GROUP_TYPE,a.UNGROUPED_GROUP_TYPE),o===a.UNGROUPED_GROUP_KEY&&this.groupTypes.push(a.UNGROUPED_GROUP_TYPE)},getIsFavoriteUngroupedGroup:function(){return this.isFavorite&&this.getIsUngroupedGroup()},getIsRegularGroup:function(){return!this.getIsUngroupedGroup()},getIsUngroupedGroup:function(){return e.contains(this.groupTypes,a.UNGROUPED_GROUP_TYPE)},getCanPrioritizeGroup:function(r){if(!r)throw new Error("User should be defined");return i.isEditable(this._storedGroupData,r)},findBoardIndexById:function(r){return e.findIndex(this.boards,e.matches({boardId:r}))},hasBoard:function(r){return this.findBoardIndexById(r)>-1},updateGroupData:function(r){this._applyGroupData(r),this.viewsMenuGroupUpdated.fire(this)},invalidateViewsOrder:function(){this.boards=e.sortBy(this.boards,e.property("menuNumericPriority")),this.viewsMenuGroupUpdated.fire(this)},getUpdatedGroupData:function(r){var t=e.extend(e.deepClone(this._storedGroupData||{}),e.pick(r,s));return e.defaults(t,{isFavorite:!1})},_applyGroupData:function(r){var t=this.getUpdatedGroupData(r);this._storedGroupData=t,e.extend(this,t),this.groupId=t.key},createBoardInGroup:function(r){return this.createBoardsInGroupBatch([r])[0]},createBoardsInGroupBatch:function(r){var t=e.map(r,this._createBoardModel,this);
return this.boards=this.boards.concat(t),this.invalidateViewsOrder(),t},removeBoard:function(r){var t=e.findWhere(this.boards,{boardId:r});return t&&(this.boards=e.without(this.boards,t),this.viewsMenuGroupUpdated.fire(this)),t?t.storedViewData:null},_removeBoardsBatchInternal:function(r){var t=e.filter(this.boards,function(t){return e.contains(r,t.boardId)});return this.boards=e.difference(this.boards,t),e.map(t,e.property("storedViewData"))},moveBoardToGroup:function(r,e){var t=this.removeBoard(r);return e.createBoardInGroup(t)},moveBoardsToGroupBatch:function(r,e){var t=this._removeBoardsBatchInternal(r);this.viewsMenuGroupUpdated.fire(this),e.createBoardsInGroupBatch(t)},moveAllBoardsToGroup:function(r){var t=e.map(this.boards,e.property("boardId"));this.moveBoardsToGroupBatch(t,r)},_createBoardModel:function(r){var e=new o(this._urlService,r);return e.boardUpdated.add(this._onBoardUpdated,this),e},_onBoardUpdated:function(){this.viewsMenuGroupUpdated.fire(this)}})});