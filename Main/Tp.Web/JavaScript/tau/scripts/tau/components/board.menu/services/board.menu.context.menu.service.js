define(["require","tau/core/class","./../models/board.menu.operations.model","../templates/board.menu.context.menu.template"],function(e){var t=e("tau/core/class"),i=e("./../models/board.menu.operations.model"),o=e("../templates/board.menu.context.menu.template");return t.extend({init:function(e,t,i,o,n,r){this.bus=r,this.templateFactory=e,this.boardSettingsService=t,this.boardApiService=i,this.urlBuilder=o,this.routingService=n},showMenu:function(e,t){var i=e.parents(".i-role-views-navigator"),o=function(){e.parent().removeClass("t3-opened"),e.data("ui-tauBubble")&&e.tauBubble("destroy")};o(),e.tauBubble({appendTo:i,showArrow:!1,content:this._getMenuContent(t),onPositionConfig:function(e){e.my="left top",e.at="left bottom"},onShow:function(){e.parent().addClass("t3-opened")},onHide:function(){o()},template:['<div class="tau-bubble t3-views-navigator-bubble">','    <div class="tau-bubble__inner" role="content"></div>',"</div>"].join("")}),e.tauBubble("show");var n=i.find(".tau-bubble");n.on("click",".i-role-menu-action-setup",function(){this._toggleEditSettings(t),o()}.bind(this)),n.on("click",".i-role-menu-action-hide",function(){this._toggleVisibility(t),o()}.bind(this))},_getMenuContent:function(e){var t=this.templateFactory.get(o.name);return t.bindPure({},e)},_toggleEditSettings:function(e){if(e.isCurrentBoard)i.toggleBoardEditMode(this.boardSettingsService);else{var t=function(){this.boardSettingsService.settingsUpdated.remove(t),setTimeout(function(){i.toggleBoardEditMode(this.boardSettingsService)}.bind(this),0)}.bind(this);this.boardSettingsService.settingsUpdated.add(t);var o=this.urlBuilder.getRelativeBoardUrl(e.board.boardId);this.routingService.redirect(o)}},_toggleVisibility:function(e){e.isCurrentBoard?i.toggleBoardVisibility(this.boardSettingsService):(this.boardApiService.setBoardData(e.board.boardId,{menuIsVisible:!e.board.menuIsVisible}),e.board.menuIsVisible=!e.board.menuIsVisible,this.bus.fire("board.menu.update.board",e.board))}})});