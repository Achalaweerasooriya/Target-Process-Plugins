define(["jQuery"],function(t){return{SORTABLE_KEY_NAME:{full:"data-sortable-key","short":"sortableKey"},sortState:null,sortableSelector:"div[draggable]",_findClosestSortable:function(e){return t(e).closest(this.sortableSelector)},_findFirstSortable:function(e){return t(e).find(this.sortableSelector+":not(.t3-dragging):first")},_findLastSortable:function(e){return t(e).find(this.sortableSelector+":not(.t3-dragging):last")},_findMenuRoot:function(t){return t.closest(".i-role-board-menu")},_removeAllDropClasses:function(e){var r=this._findMenuRoot(t(e));return this._removeDropClasses(r.find(".t3-drop-target"))},_removeDropClasses:function(t){return t.removeClass("t3-drop-target t3-drop-before t3-drop-after")},_addDropClasses:function(t,e){t.addClass("t3-drop-target "+(e?"t3-drop-after":"t3-drop-before"))},_removeDraggingClass:function(){this.sortState.$element.removeClass("t3-dragging")},_addDraggingClass:function(){this.sortState.$element.addClass("t3-dragging")},_findSortableFromEvent:function(t){var e=t.target,r=this._findClosestSortable(e);if(r.length)return this.sortState.overNonSortable=null,r;var s=document.elementFromPoint(t.clientX,t.clientY);return r=this._findClosestSortable(s),r.length?(this.sortState.overNonSortable=null,r):(this.sortState.overNonSortable=e,r=this._findLastSortable(e))},_clearSortState:function(){this.sortState={$element:t(),key:null,over:{$element:t()}}},_setSortStateElement:function(t){this.sortState.$element=this._findClosestSortable(t),this.sortState.key=this._getSortableKey(this.sortState.$element)},_setSortStateOverElement:function(t){var e=t[0],r=this.sortState.over.$element[0];r!==e&&(this.sortState.over={$element:t,top:t.offset().top,height:e.offsetHeight},this.sortState.placeAfter=null)},_getSortableKey:function(t){var e=t.data(this.SORTABLE_KEY_NAME.short);return e?e+"":null},_getSortableText:function(){return this.sortState.$element.find("a").prop("href")},sortStart:function(t){this._isDropFinished=!1,this._clearSortState(),this._setSortStateElement(t.target),setTimeout(this._addDraggingClass,1),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text",this._getSortableText())
},sortDragOver:function(t){t.preventDefault();var e=t.clientY;if(e!==this.sortState.positionY||t.target!==this.sortState.eventTarget){this.sortState.eventTarget=t.target;var r=this._findSortableFromEvent(t);if(!r.length)return void this._removeAllDropClasses(t.target);this._setSortStateOverElement(r),this.sortState.positionY=e;var s=e-this.sortState.over.top,o=s>this.sortState.over.height/2;o!==this.sortState.placeAfter&&(this.sortState.placeAfter=o,this._removeAllDropClasses(r),this._addDropClasses(r,o))}},sortDrop:function(t){this._isDropFinished=!0,t.preventDefault()},sortEnd:function(){this._isDropFinished&&this._sortItems(),this._removeAllDropClasses(this.sortState.over.$element),this._removeDraggingClass(),this._clearSortState()},_sortItems:function(){var t=this.sortState.key,e=this._getSortableKey(this.sortState.over.$element);t!==e&&this.sortItems(t,e,this.sortState.placeAfter)}}});