define(["require","Underscore","jQuery","tau/core/class"],function(i){var t=i("Underscore"),e=i("jQuery"),d=i("tau/core/class");return d.extend({init:function(i,d){this._appStateStore=d,this._urlBuilder=i,this.acidInitialized=e.Deferred(),this.acidUpdated=t.Callbacks(),this._lastAcidValue=null,d.get({fields:["acid"],callback:function(i){this.acidInitialized.resolve(),this._setAcid(i.id,i.acid)}.bind(this)}),d.bind({listener:this,fields:["acid"],callback:function(i){this._setAcid(d.settings.id,i.acid),this.acidUpdated.fire(this._lastAcidValue)}.bind(this)})},_setAcid:function(i,t){this._lastAcidValue={id:i,acid:t}},getBoardUrl:function(i){if("resolved"!==this.acidInitialized.state())return console.error("Acid is not initialized yet"),"";var e=t.clone(this._lastAcidValue);return e.acid=i.acid||e.acid,this._urlBuilder.getRelativeBoardUrl(i.boardId||i.key,e)},destroy:function(){this._appStateStore.unbind({listener:this})}})});