define(["require","jQuery","Underscore","./../board.menu.config","tau/core/extension.base","tau/core/injector","./../services/board.menu.context.menu.service","./../services/board.menu.settings.service","tau/services/boards/service.board.access.editor","../services/board.menu.scroll.service","tau/services/boards/service.board.settings.wrapper","tau/services/boards/service.views.menu.api.wrapper","jsx!./../views/board.menu.list.view","jsx!./../views/board.menu.list.item.view","jsx!./../views/board.menu.list.group.view","jsx!./../views/board.menu.list.section.view","jsx!./../views/board.menu.actions.view","jsx!./../views/board.menu.search.view","./../models/board.menu.model"],function(e){var r=e("jQuery"),i=e("Underscore"),s=e("./../board.menu.config"),t=e("tau/core/extension.base"),n=e("tau/core/injector"),o=e("./../services/board.menu.context.menu.service"),a=e("./../services/board.menu.settings.service"),c=e("tau/services/boards/service.board.access.editor"),d=e("../services/board.menu.scroll.service"),u=e("tau/services/boards/service.board.settings.wrapper"),v=e("tau/services/boards/service.views.menu.api.wrapper"),g=e("jsx!./../views/board.menu.list.view"),b=e("jsx!./../views/board.menu.list.item.view"),w=e("jsx!./../views/board.menu.list.group.view"),l=e("jsx!./../views/board.menu.list.section.view"),S=e("jsx!./../views/board.menu.actions.view"),m=e("jsx!./../views/board.menu.search.view"),h=e("./../models/board.menu.model");return t.extend({_configurator:null,init:function(e){this._super(e),this._ownedResources=[],this._renderDataDef=r.Deferred(),this._configurator=e.context.configurator,this._boardSettingsServiceWrapper=new u,this._boardSettingsServiceWrapper.serviceInitialized.then(function(){var e=this._boardSettingsServiceWrapper.getCurrentService();return"none"===e.settings.id?r.Deferred().resolve():e.get({fields:s.watchedBoardSettingsFields})}.bind(this)).then(i.constant(this._renderDataDef)).then(this._initializeMenu.bind(this))},"bus boardSettings.ready":function(e,r){this._boardSettingsServiceWrapper.setNewBoardSettingsService(r.boardSettings)
},"bus afterRender":function(e,r){this._renderDataDef.resolve(r)},_initializeMenu:function(e){var r=this._configurator,i=this._boardSettingsServiceWrapper,s=v.create(r.getViewsMenuService(),function(){return i.getCurrentService()}.bind(this)),t=new n;t.register("integrationService",r.getInternalViewsMenuIntegrationService()),t.register("featuresService",r.getFeaturesService());var u=r.getUrlBuilder();t.register("urlBuilder",u);var p=r.getViewsMenuUrlService();t.register("boardMenuUrlService",p);var f=r.getRouting();t.register("routingService",f);var M=r.getLoggedUser();t.register("loggedUser",M);var _=this.bus;t.register("boardMenuBus",_),t.register("boardMenuViewsMenuService",s),t.register("boardSettingsService",i);var x=new a(r.getSettingsManager());t.register("settingsService",x),t.register("boardsOperationsService",r.getBoardOperationsService());var j=new c(r);t.register("boardAccessEditorService",j);var B=new h(this.bus,M,s,r.getBoardOperationsService(),i);this._ownedResources.push(B),t.register("boardMenuModel",B);var D=new d;t.register("boardMenuScrollService",D),t.register("boardContextMenuService",new o(r.getBoardAccessService(),D,M,t)),t.registerModule("board.menu.list.item.view",b),t.registerModule("board.menu.list.group.view",w),t.registerModule("board.menu.list.section.view",l),t.registerModule("boardMenuListView",g),t.registerModule("boardMenuActionsView",S),t.registerModule("boardMenuSearchView",m);var U={configurator:r,element:e.element.filter(".i-role-views-navigator-container")[0],serviceScope:t,model:B};this.fire("board.menu.config.ready",U)},destroy:function(){i.invoke(this._ownedResources,"destroy"),this._ownedResources=[],this._boardSettingsServiceWrapper.currentBoardChanged.remove(this),this._super()}})});