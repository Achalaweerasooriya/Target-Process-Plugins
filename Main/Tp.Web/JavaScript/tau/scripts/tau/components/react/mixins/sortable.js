define(["jQuery"],function(t){return{SORTABLE_KEY_NAME:{full:"data-sortable-key","short":"sortableKey"},sortState:null,sortableOptions:null,getDefaultSortableOptions:function(){return{sortableRootSelector:null,sortableItemSelector:"div[draggable=true]",sortableHandleSelector:null,sortItems:null}},componentWillMount:function(){this.sortableOptions=t.extend(this.getDefaultSortableOptions(),this.getSortableOptions())},componentDidMount:function(){this._clearSortState()},_getSortableText:function(){return""},_isBeingDragged:function(){return null!==this.sortState.key},_findClosestSortable:function(e){return t(e).closest(this.sortableOptions.sortableItemSelector)},_findFirstSortable:function(e){return t(e).find(this.sortableOptions.sortableItemSelector+":not(.t3-dragging):first")},_findLastSortable:function(e){return t(e).find(this.sortableOptions.sortableItemSelector+":not(.t3-dragging):last")},_findSortableRoot:function(t){return t.closest(this.sortableOptions.sortableRootSelector)},_removeAllDropClasses:function(e){var s=this._findSortableRoot(t(e));return this._removeDropClasses(s.find(".t3-drop-target"))},_removeDropClasses:function(t){return t.removeClass("t3-drop-target t3-drop-before t3-drop-after")},_addDropClasses:function(t){t.addClass("t3-drop-target "+(this.sortState.placeAfter?"t3-drop-after":"t3-drop-before"))},_toggleDraggingClass:function(t){this.sortState.$element.toggleClass("t3-dragging",t)},_toggleDragGhostClass:function(t){this.sortState.$element.toggleClass("t3-drag-ghost",t)},_findSortableTargetFromEvent:function(t){var e=t.target,s=this._findClosestSortable(e);if(s.length)return this.sortState.overNonSortable=null,s;var o=document.elementFromPoint(t.clientX,t.clientY);return s=this._findClosestSortable(o),s.length?(this.sortState.overNonSortable=null,s):(this.sortState.overNonSortable=e,s=this._findLastSortable(e))},_clearSortState:function(){this.sortState&&this.sortState.$element.length&&(this._toggleDragGhostClass(!1),this._toggleDraggingClass(!1)),this.sortableMouseDownTarget=null,this.sortState={key:null,$element:t(),target:{$element:t()}}
},_updateSortStateElement:function(t){this.sortState.$element=this._findClosestSortable(t),this.sortState.key=this._getSortableKey(this.sortState.$element)},_updateSortStateTarget:function(t){var e=t[0];if(e!==this.sortState.target.$element[0]){var s=e.getBoundingClientRect();this.sortState.target={$element:t,boundary:this._getBoundary(s)},this.sortState.placeAfter=null}},_updateSortStatePlacement:function(){var t=this.sortState.target,e=this.sortState.position-t.boundary.offset,s=e>t.boundary.dimension/2;s===this.sortState.placeAfter?this._addDropClasses(t.$element):(this.sortState.placeAfter=s,this._overElementChanged(t.$element))},_overElementChanged:function(t){this._removeAllDropClasses(t),this._addDropClasses(t)},_getSortableKey:function(t){var e=t.data(this.SORTABLE_KEY_NAME.short);return"undefined"==typeof e?null:e+""},sortMouseDown:function(t){this.sortableMouseDownTarget=t.target},sortStart:function(e){if(this.sortableOptions.sortableHandleSelector){var s=this.sortableMouseDownTarget&&t(this.sortableMouseDownTarget),o=s&&s.closest(this.sortableOptions.sortableHandleSelector);if(!o||!o.length)return void e.preventDefault()}this._isDropFinished=!1,this._clearSortState(),this._updateSortStateElement(e.target),this._toggleDragGhostClass(!0),setTimeout(function(){this._toggleDragGhostClass(!1),this._toggleDraggingClass(!0)}.bind(this),0),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text",this._getSortableText())},sortDragOver:function(t){if(this._isBeingDragged()){var e=this._getPosition(t);if(e===this.sortState.position&&t.target===this.sortState.eventTarget)return void t.preventDefault();this.sortState.eventTarget=t.target,this.sortState.position=e;var s=this._findSortableTargetFromEvent(t);if(!s.length)return void this._removeAllDropClasses(t.target);t.preventDefault(),this._updateSortStateTarget(s),this._updateSortStatePlacement()}},sortDrop:function(t){this._isDropFinished=!0,t.preventDefault()},sortEnd:function(){this._isBeingDragged()&&(this._isDropFinished&&this._sortItems(),this._removeAllDropClasses(this.sortState.target.$element),this._toggleDraggingClass(!1),this._clearSortState())
},_sortItems:function(){var t=this.sortState.key,e=this._getSortableKey(this.sortState.target.$element);t!==e&&this.sortableOptions.sortItems(t,e,this.sortState.placeAfter)}}});