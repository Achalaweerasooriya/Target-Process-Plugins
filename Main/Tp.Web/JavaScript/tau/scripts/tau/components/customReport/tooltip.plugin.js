define(["require","jQuery","Underscore","vendors/tauCharts/tauCharts.tooltip","tau/utils/utils.date"],function(t){var e=t("jQuery"),i=t("Underscore"),a=t("vendors/tauCharts/tauCharts.tooltip"),r=t("tau/utils/utils.date");return{getPlugin:function(t,e,i){var r=this._createConfig(t,e,i);return a(r)},_createConfig:function(t,a,n){var o=a.dataSource.dimensions,l=i.pluck(o,"id"),s=function(t){var e=i.find(o,function(e){return e.model&&e.model.toLowerCase()==t});e&&(l=i.filter(l,function(t){return t.toLowerCase()!=e.id.toLowerCase()}))};n[0].dataItem&&(l.unshift("dataItem"),s("id"),s("name"));var u=function(e,i){return t.getUrlBuilder().getNewViewUrl(e,i,!0)};return{fields:l,entityTemplate:i.template(['<a href="<%=href%>" class="i-role-entity" data-id="<%=id%>" data-type="<%=type%>">','<span class="tau-entity-icon tau-entity-icon--<%=type.toLowerCase()%>">',"<%=id%>","</span>",'<span class="graphical-report__tooltip__entity-title"><%-name%></span>',"</a>"].join("")),simpleTemplate:i.template(['<div class="graphical-report__tooltip__list__item">','<div class="graphical-report__tooltip__list__elem"><%-label%></div>','<div class="graphical-report__tooltip__list__elem"><%-value%></div>',"</div>"].join("")),renderItem:function(t,e,a,n){if("dataItem"==a){var o=n.type.toLowerCase();return this.entityTemplate({id:n.id,type:o,name:n.data.name,href:u(n.id,o)})}return i.isNumber(e)?e=Math.round(100*e)/100:i.isDate(e)&&(e=e.getTime()==r.trimTime(e).getTime()?r.format.date.short(e):r.format.datetime.short(e)),t=i.titleize(t).substring(0,40),this.simpleTemplate({label:t,value:e})},afterInit:function(i){e(i).on("click",".i-role-entity",function(i){var a=e(this);t.getEntityViewService().showEntityView({entityId:parseInt(a.data("id"),10),entityType:a.data("type")}),i.preventDefault()})}}}}});