requirejs.config({map:{"*":{tauCharts:"vendors/tauCharts/tauCharts"}}}),define(["require","jQuery","Underscore","tau/core/extension.base","../customReport.renderer"],function(t){var e=t("jQuery"),r=t("Underscore"),i=t("tau/core/extension.base"),n=t("../customReport.renderer");return i.extend({init:function(t){this._super(t),this._lastTick=null,this._lastChart=null},"bus afterInit":function(){this.fire("dataBind")},"bus configurator.ready":function(t,e){var i={callbacks:[],finish:function(){r.each(i.callbacks,function(t){t()})},onFinish:function(t){i.callbacks.push(t)}};e.registerService("report.rendering",i)},"bus boardSettings.ready:last +  afterRender + configurator.ready + view.dom.ready:last":function(t,e,r,i){var n=e.boardSettings,a=r.element;this._$reportContent=a.find(".i-role-report-content"),this._$report=a,this._drawReportOnInit(i,n),this._subscribeOnAppStateChanged(i,n),this._subscribeOnBoardSettingsChanged(i,n);var s=i.getSettingsManager();s.unbind({listener:this}),s.bind({fields:["collapser_aside_collapsed"],listener:this,callback:function(){this._resizeChart()}})},destroy:function(){this._destroyChartIfRequired(),this._super()},_resizeChart:function(){this._lastChart&&this._lastChart.resize()},"bus boardSettings.ready:last + configurator.ready:last + destroy":function(t,e,r){e.boardSettings.unbind(this),r.getAppStateStore().unbind(this);var i=r.getSettingsManager();i.unbind({listener:this})},_subscribeOnBoardSettingsChanged:function(t,e){e.unbind({listener:this}),e.bind({fields:["edit"],listener:this,callback:function(){this._resizeChart()}}),e.bind({fields:["reportSettings","reportError"],listener:this,callback:this.safeCallback(function(r){r.reportError?new n(t).renderCustomReportError(r.reportError,this._$reportContent):this._drawReport(r.reportSettings,t,e)})})},_subscribeOnAppStateChanged:function(t,e){var i=t.getAppStateStore();i.unbind({listener:this}),i.bind({fields:["acid"],listener:this,callback:function(i){e.get({fields:["reportSettings"]}).then(this.safeCallback(function(n){var a=r.cloneDeep(n.reportSettings),s=a.dataSource.global;
a.tick=s&&s.acid===i.acid?a.tick:(new Date).getTime(),a.dataSource.global={acid:i.acid},this._drawReport(a,t,e,!1)}.bind(this)))}.bind(this)})},_drawReportOnInit:function(t,e){e.get({fields:["reportSettings"]}).done(this.safeCallback(function(r){this._lastTick=null,this._drawReport(r.reportSettings,t,e)}.bind(this)))},_drawReport:r.debounce(function(t,e,i,a){if(t.tick!==this._lastTick&&null!==this._$reportContent){var s=t.dataSource.global;t=r.cloneDeep(t),this._destroyChartIfRequired(),this._$reportContent.empty(),this._$report.tauProgressIndicator(),this._$report.tauProgressIndicator("show"),this._getAcid(e,i,t).then(this.safeCallback(function(r){return t.dataSource.global={acid:r},new n(e).renderCustomReport(this._$reportContent,t,{})})).done(this.safeCallback(function(t){if(a!==!1){var e=t.chartSettings;e.tick=e.tick||(new Date).getTime(),e.dataSource.global=s,this._lastTick=e.tick,i.set({set:{reportSettings:e}})}this._destroyChartIfRequired(),this._lastChart=t.chart}.bind(this))).always(this.safeCallback(function(){this._$report.tauProgressIndicator("hide"),e.service("report.rendering").finish()}))}},200),_destroyChartIfRequired:function(){this._lastChart&&this._lastChart.destroy()},_getAcid:function(t,r,i){var n=e.Deferred();return i.dataSource.global&&i.dataSource.global.acid?n.resolve(i.dataSource.global.acid):r.get({fields:["acid"]}).then(function(e){e&&e.acid?n.resolve(e.acid):t.getAppStateStore().get({fields:["acid"]}).then(function(t){n.resolve(t.acid)})}),n}})});