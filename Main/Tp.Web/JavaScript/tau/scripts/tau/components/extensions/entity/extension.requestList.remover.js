define(["Underscore","tau/core/model-base","tau/models/model.extensions"],function(_,ExtensionBase,ExtensionModel){return ExtensionBase.extend({init:function(config){this._super.apply(this,arguments),this.hideElementIfHelpDeskPracticeIsOff(this.config.context)},hideElementIfHelpDeskPracticeIsOff:function(context){this.store=this.config.context.configurator.getStore(),context.isPracticeAvailable("Help Desk")<0&&(this.bus.getGlobalBus().on("requestWasAttachedToEntity",this._updateRefresh,this),this.bus.getGlobalBus().on("bugWasMarkedAsDuplicate",this._updateRefresh,this),this.bus.on("afterRender",this._update,this))},_updateRefresh:function(){var context=this.config.context;this.config.store.evictProperties(context.entity.id,context.entity.entityType.name,["requests-count"]),this._update()},_update:function(){ExtensionModel.calculateRequestsCount.call(this,{callback:function(data){var count=data.count,$el=this.$el;count>0?$el.show():$el.hide()},scope:this})},destroy:function(){this.bus.getGlobalBus().removeListener("requestWasAttachedToEntity",this._updateRefresh,this),this._super()},"bus afterRender":function(e){this.$el=e.data.element}})})