define(["Underscore","tau/core/class","tau/core/event","tau/core/types","tau/configurator"],function(a,b,c,d,e){return b.extend({init:function(b){this.config=b,this.bus=b.bus;var d=this.routing=e.getRouting(),f=d.getUrl().source;this.defaultHash=f!=="#"?f:"#__"+a.uniqueId(),c.subscribeOn(this);var g=this;this.bus.getGlobalBus().on("routing.setState",function(b){a.forEach(b.data,function(a,b){d.setStateParameter(b,a,!1)}),g.bus.fire("history.updateCurrent",{url:d.getUrl().source})}),this.bus.getGlobalBus().on("routing.redirect",function(a){d.redirect(a.data.url)});var g=this;d.on("stateChanged",function(a){g.bus.getGlobalBus().fire("routing.stateChanged",a.data)})},"bus registerRoute":function(a){var b=a.data;this.routing.register(b.pattern,b.callback)},"bus registerRouteNotFound":function(a){var b=a.data;this.routing.register404(b.callback)},"bus afterInit":function(a){this.bus.fire("routing.registered",{})},"bus controller.ready":function(){this.routing.start();var a=e.getRouting().getUrl();this.config.startUrl?this.routing.execute(this.config.startUrl):this.config.executeOnStart!==!1&&this.routing.execute(a.source)},"bus destroy":function(){this.routing.reset(),this.routing.stop(),this.routing.setUrl(this.defaultHash)}})})