define(["Underscore","tau/core/event.emitter"],function(_,Class){var isNotABusOrFunctionIterator=function(key){return key!=="bus"&&!_.isFunction(this[key])},destroyPropertyIterator=function(key){delete this[key]},Creator=Class.extend({init:function(config){this._super(config),this.config=config},"bus beforeInit":function(evtArgs){var configurator=null;if(this.config.context)var configurator=this.config.context.configurator;evtArgs.data&&evtArgs.data.config&&(this.config=_.extend(this.config,evtArgs.data.config)),this.config.context&&(this.config.context.configurator=this.config.context.configurator?this.config.context.configurator:configurator,this.store=this.config.context.configurator.getStore())},"bus afterRender":function(evtArgs){this.element=evtArgs.data.element},createComponents:function(componentsConfig,callback){var creator={bus:this.bus,config:componentsConfig,create:function(){this.bus.on("componentsCreated",this.onComponentCreated,this),this.bus.fire("createComponents",this.config,this)},onComponentCreated:function(evtArgs){if(evtArgs.caller!==this)return;evtArgs.removeListener(),callback(evtArgs.data)}};creator.create()},isEntityInContext:function(evt){var currentEntityId=this.config.context.entity.id,entityFromContext=currentEntityId==(evt.data.entity||evt.data.assignable).id;return entityFromContext},destroy:function(){var context=(this.config||{}).context;delete this.config;var propNames=_.keys(this);_(propNames).chain().select(isNotABusOrFunctionIterator,this).each(destroyPropertyIterator,this).value(),this._super(),this.config={context:context};var emptyFn=function(){};this.store={on:emptyFn,remove:emptyFn,get:emptyFn,find:emptyFn}}});return Creator})