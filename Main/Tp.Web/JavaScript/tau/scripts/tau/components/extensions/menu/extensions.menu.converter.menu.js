define(["tau/components/extensions/component.extension.base","tau/core/termProcessor","tau/ui/behaviour/menu/ui.behaviour.menu.actions","tau/components/component.finder","tau/models/finder/model.userStory.search"],function(ExtensionBase,TermProcessor,ui,Finder,UserStorySearch){return ExtensionBase.extend({"bus menu.show":function(evt,$menu){$menu.behaviourMenuActions("show")},"bus configurator.ready:last + $el.ready:last + convertSubmenuData.ready + menu.show.first":function(evt,configurator,$el,data,$menu){var $item=$el.find(".i-role-action-convert");if(data.items.length>0){var $submenu=configurator.getTemplateFactory().get("menu.actions.submenu").bind({},data);$item.append($submenu),this.fire("$submenu.ready",$submenu)}else $item.hide();$menu.behaviourMenuActions("show")},"bus $submenu.ready":function(evt,$submenu){var self=this,entity=this.config.context.entity,tp=new TermProcessor(this.config.context.getTerms()),$items=$submenu.find(".ui-menu__item"),thisEntityType=tp.getTerms(entity.entityType.name).name;$items.each(function(){var $item=$(this);if($item.data("alias")!="convertToTask")var name=$item.data("name"),id=$item.data("id"),entityType={id:id,name:name},thatEntityType=tp.getTerms(name).name,$bubbled=$item.tauBubble({template:['<div class="tau-bubble tau-warning-bubble">','<div class="tau-bubble__arrow"  role="arrow"></div>','<div class="tau-bubble__inner tau-container"  role="content"></div>',"</div>"].join(""),content:["<h3>Do you really want to convert "+thisEntityType+" to "+thatEntityType+"?</h3>",'<div class="tau-buttons">','<button type="button" class="tau-btn tau-primary i-role-actionok">Yes, I\'m sure</button>','<button type="button" class="tau-btn i-role-actioncancel">No</button>',"</div>"].join(""),onPositionConfig:function(conf){conf.my="left center",conf.at="right center",conf.offset="0 20",conf.collision="flip flip"},onHide:function(){$submenu.toggleClass("sub-ui-menu_dont-hide",!1),$item.find(".drop-down-option").toggleClass("drop-down-option_hover",!1)},onShow:function(){$submenu.toggleClass("sub-ui-menu_dont-hide",!0),$item.find(".drop-down-option").toggleClass("drop-down-option_hover",!0);var $w=$bubbled.tauBubble("widget");$w.unbind("click"),$w.one("click",".i-role-actioncancel",function(){$bubbled.tauBubble("hide")}),$w.one("click",".i-role-actionok",function(){$bubbled.tauBubble("hide"),console.log(entityType),self.fire("convertTo",{entityType:entityType})})},zIndex:130})})}})})