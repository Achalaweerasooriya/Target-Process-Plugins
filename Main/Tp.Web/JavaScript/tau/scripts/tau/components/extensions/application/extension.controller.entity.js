define(["Underscore","jQuery","tau/core/extension.base.stateful","tau/components/component.page.entity","tau/components/extensions/print.convert.extension"],function(_,$,ExtensionBase,PageComponent,PrintExtension){return ExtensionBase.extend({"bus beforeInit + configurator.ready":function(evt,initConfig,configurator){var reloadEvt=_.bind(function(evt){var evtData=evt.data,changes={project:{id:evtData.project.id}},data={id:evtData.entity.id,changes:changes,cmd:{config:{$set:changes}}};this.fire("integration.react",data)},this),duplicateBugReloadEvt=_.bind(function(evt){var evtData=evt.data,changes={},data={id:evtData.bugId,changes:changes,cmd:{config:{$set:changes}}};this.fire("integration.react",data)},this),gb=configurator.getGlobalBus();gb.removeAllListeners(this),gb.on("bugWasMarkedAsDuplicate",duplicateBugReloadEvt,this),gb.on("entityWasMovedToProject",reloadEvt,this),gb.on("redirectBack",_.bind(this._redirectBack,this,configurator),this);var store=configurator.getStore();store.unbind(this);var reloadCallback=_.bind(function(e){this.fire("integration.react",e.data)},this),types=["general","assignment","roleEffort"];_.each(types,_.bind(function(type){store.on({type:type,eventName:"afterSave",listener:this},reloadCallback),store.on({type:type,eventName:"afterRemove",listener:this},reloadCallback)},this))},"bus afterRender:last + innerContentRendered":function(e,renderData,childRenderData){var $element=renderData.element,$content=childRenderData.element;$element.empty().append($content),this.fire("contentRendered",{element:$element})},_getItemConfig:function(id,type,configurator){var config={entity:{id:id,type:type}};return configurator&&(config.context={configurator:configurator}),config},castEntityParams:function(params){return{id:params.id?parseInt(params.id,10):null,entity:params.entity||params.type}},_closeCurrent:function(configurator){this.current&&(this.current.removeAllListeners(this),this.current.destroy(),configurator.getStore().evictData())},"bus configurator.ready + application.exit":function(evt,configurator){$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!1),this._closeCurrent(configurator)},"bus application.navigate.entity":function(evt,args){var self=this,action=(args.action||"").toLocaleLowerCase(),actionName="action"+(action&&action!="demoview"&&action!="tpview"?action:"show");if(args.entity=="team"&&action=="members"){var configurator=self.config.context.configurator,settingsManager=configurator.getBoardSettingsFactory().createComponentSettings({id:"team"});settingsManager.set({set:{generalTab:"people"},callback:function(){self.fire("application.navigate.entity",{id:args.id,entity:"team"})}})}else{!self[actionName]&&(actionName="actionshow");var params=self.castEntityParams(args);self.fire("controller.preExecute",{action:actionName,parameters:params}),self[actionName].call(self,params.id,params.entity),self.fire("controller.postExecute")}},actionshow:function(id,entity){this._action(id,entity),$("html").toggleClass("tau-html_action_view",!0).toggleClass("tau-html_action_print",!1)},actionprint:function(id,entity){this._action(id,entity,{extensions:[PrintExtension]}),$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!0),$("body").addClass("print-mode")},_action:function(id,entity,componentConfig){var configurator=this.config.context.configurator;$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!1),this._closeCurrent(configurator);var componentConfig=componentConfig||{};componentConfig.turnOffLoadingIndicator=this.config.options.turnOffLoadingIndicator;var entityCfg=this._getItemConfig(id,entity,configurator),pageBus=PageComponent.create(entityCfg,componentConfig);pageBus.on("beforeDelete",_.bind(function(e){this.fire("initProgress")},this),this),pageBus.on("deleted",_.bind(this._redirectBack,this,configurator),this),pageBus.on("error",_.bind(function(e){this.fire("application.error",e.data)},this),this),pageBus.on("afterRender",_.bind(function(e){this.fire("application.entity.loaded",{id:id,entity:entity}),this.fire("innerContentRendered",{element:e.data.element})},this),this),this.current=pageBus,pageBus.initialize()},_redirectBack:function(configurator){var history=configurator.getHistory(),item=history.pop();item?(history.setCurrent(null),this.fire("urlToNavigate.ready",item.url)):this.fire("application.exit"),_.delay(_.bind(this.fire,this,"clearError"),100)},"bus configurator.ready > destroy":function(evt,configurator){configurator.getStore().unbind(this),configurator.getGlobalBus().removeAllListeners(this),this._closeCurrent(configurator),delete this.current,delete this.$element,delete this.config}})})