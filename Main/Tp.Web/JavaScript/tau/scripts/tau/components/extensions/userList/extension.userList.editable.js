define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.listSelectable"],function(_,$,a){return a.extend({category:"edit",name:"user list",init:function(){this._super.apply(this,arguments),this._userClick=$.proxy(this.onUserClick,this),this._unassignClick=$.proxy(this.onUnassignClick,this),this._assignToMeClick=$.proxy(this.onAssignToMeClick,this),this._filterChanged=$.proxy(this.onFilterChanged,this),this._moreClicked=$.proxy(this.onMoreClick,this)},onMoreClick:function(a){a.stopPropagation(),this.fire("showMore")},onUserClick:function(a){var b=$(a.target),c=b.tmplItem().data;this.fire("changeAssignment",{user:c})},onUnassignClick:function(){this.fire("removeAssignment")},onAssignToMeClick:function(){this.fire("assignToLoggedUser")},onFilterChanged:function(a){if(a.keyCode==$.ui.keyCode.DOWN||a.keyCode==$.ui.keyCode.UP||a.keyCode==$.ui.keyCode.ENTER)return;a.preventDefault(),this.fire("setFilter",{filter:$(a.target).val()})},"bus beforeRender":function(){var a=this.$element;a&&(a.find(".user").unbind("click",this._userClick),a.find(".unassign-button").unbind("click",this._unassignClick),a.find(".assign-to-me-button").unbind("click",this._assignToMeClick),a.find(".user-search-box").unbind("keyup",this._filterChanged),a.find(".more-link").unbind("click",this._moreClicked))},"bus afterRender":function(a){var b=this,c=b.$element=a.data.element;c.find(".user").click(this._userClick),c.find(".unassign-button").click(this._unassignClick),c.find(".assign-to-me-button").click(this._assignToMeClick),c.find(".user-search-box").keyup(this._filterChanged),c.find(".more-link").bind("click",this._moreClicked)},"bus refresh":function(a){var b=this.$element.find(".user-list");this._resize(),b.listSelectable({items:".user",className:"user_hover"}),b.listSelectable("enable"),b.listSelectable("reset")},"bus focus":function(a){var b=this.$element.find(".user-list");b.listSelectable({items:".user",className:"user_hover"}),b.listSelectable("enable"),this.$element.find(".user-search-box").focus()},"bus blur":function(a){this.$element.find(".user-list:visible").listSelectable("disable")},_resize:function(a){if(!this.$element)return;var b=this.$element,c=b.find(".user-list");c.css("maxHeight",$(window).height()/3),c.css("overflowY","auto"),c.css("overflowX","hidden")},"bus afterRender+popupResize":function(a){this._resize(a.popupResize.data)},"bus popupResize":function(a){this._resize(a.data)}})})