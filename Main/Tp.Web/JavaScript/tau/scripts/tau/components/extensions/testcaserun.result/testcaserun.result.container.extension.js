define(["tau/core/extension.base"],function(t){return t.extend({init:function(t){this.store=t.store,this.entity=t.context.entity,this._runnerModel=t.context.registry.runnerModel,this._super(t)},"bus afterRender":function(t){var e=this.store,n=this.entity.id,i=this.entity.entityType.name;this.$nextCaseButton=t.data.element.find(".i-role-next-tcr-btn"),this._bindHandlerForRunNextTCRButton(n),this._initRunNextTCRButtonState(e,n,i)},_bindHandlerForRunNextTCRButton:function(t){this.$nextCaseButton.on("click",function(){this._runnerModel.runNext(t)}.bind(this))},_initRunNextTCRButtonState:function(t,e,n){t.get(n,{id:e,fields:["passed","comment","runDate",{testplanrun:[{entitystate:["isFinal"]}]}]}).done({success:function(i){var s=i[0].data;s.testplanrun.entitystate.isFinal?this.$nextCaseButton.css("display","none"):(this._monitorRunNextTCRButtonState(t,e,n),this._fireStoreData(i))},scope:this})},_monitorRunNextTCRButtonState:function(t,e,n){t.unbind(this),t.on({eventName:"afterSave",type:n,listener:this,filter:{id:e},hasChanges:["comment|runDate"]},function(){this._setRunNextTCRButtonState(t,e,n)}.bind(this))},_setRunNextTCRButtonState:function(t,e,n){t.get(n,{id:e,fields:["passed","comment","runDate"]}).done({success:this._fireStoreData,scope:this})},_fireStoreData:function(t){this.fire("store.data",{passed:t[0].data.passed,comment:t[0].data.comment,runDate:t[0].data.runDate})},"bus store.data":function(t,e){this._updateRunNextTCRButtonState(e)},"bus public.note.changed + store.data:last":function(t,e,n){this._updateRunNextTCRButtonState({passed:n.passed,runDate:n.runDate,comment:e})},_updateRunNextTCRButtonState:function(t){var e=t.passed===!1&&!t.comment||null==t.passed&&null==t.runDate;this.$nextCaseButton.prop("disabled",e)}})});