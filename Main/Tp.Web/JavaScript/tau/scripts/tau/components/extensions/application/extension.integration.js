define(["Underscore","jQuery","tau/core/class","tau/core/event","tau/store/types","tau/configurator","tau/utils/utils.redirect"],function(_,$,a,b,c,d,e){return a.extend({init:function(a){this.config=a,this.config.integration=this.config.integration||{},this.bus=a.bus,this.globalBus=this.bus.getGlobalBus(),b.subscribeOn(this),this.criticalChanged=!1,this.window=d.getWindow(),this.redirect=new e},"bus afterRender":function(){$("body").delegate("a[href=#]","click",function(a){a.preventDefault()});var a=this.config.integration.reloadCallback,b=!!a;b?$("html").addClass("tau-html_integration_popup"):$("html").addClass("tau-html_integration_main")},"bus initProgress":function(a){this.config.integration.progress&&this.config.integration.progress.show("Reloading...")},"bus application.error":function(a){this.config.integration.progress&&this.config.integration.progress.hide()},"globalBus showProgress":function(a){this.config.integration.progress&&this.config.integration.progress.show(a.data.text)},"globalBus hideProgress":function(a){this.config.integration.progress&&this.config.integration.progress.hide()},"bus destroy":function(){d.getGlobalBus().removeAllListeners(this),this.window._criticalTauChanges&&(this.bus.fire("initProgress"),this.redirect.reload()),$("body .jquery-notify-bar").remove()},"bus application.reload":function(a){var b=this.config.integration.reloadCallback;if(!!b==0)return;b(a)},"bus application.exit":function(a){var b=this.config.integration.reloadCallback,c=!!b;c?(this.window._criticalTauChanges=!0,this.bus.fire("destroy")):(this.bus.fire("initProgress"),this.redirect.redirect("default.aspx"))}})})