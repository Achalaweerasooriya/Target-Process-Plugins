define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(e,t,n){return n.extend({"bus permissionsReady+afterRender":function(t,n,i){this.$element=i.element,n.deletable&&(this._createDeleteTriggers(),this.$element.on("click",".ui-attach.deletable .delete",e.bind(this._onAttachmentDeleteClick,this)))},"bus attachmentUploaded":function(){this._createDeleteTriggers()},"bus afterAttachmentRemove":function(e){var t=e.data.id,n=this.$element.find("#attach-"+t);n.animate({opacity:0},{complete:function(){n.remove()}})},_createDeleteTriggers:function(){this.$element.find(".ui-attach:not(.deletable)").each(function(e,n){t(n).addClass("deletable").find(".toolbar").append(t('<button class="delete" type="button">delete</button>'))})},_onAttachmentDeleteClick:function(e){var n=this._findUpConfirmationPlaceholder(t(e.target));this._showConfirmation(n)},_findUpConfirmationPlaceholder:function(e){return e.closest(".ui-attach").children(".inner")},_findUpAttachElement:function(e){return e.closest(".ui-attach")},_createConfirmation:function(t){t.confirmation({message:"Delete attachment?",ok:e.bind(this._deleteAttachment,this),cancel:e.bind(this._cancelAttachmentDelete,this)})},_showConfirmation:function(e){e.data("confirmation")||this._createConfirmation(e),e.confirmation("show")},_hideConfirmation:function(e){e.confirmation("hide")},_deleteAttachment:function(e){var n=t(e.target);this._hideConfirmation(this._findUpConfirmationPlaceholder(n));var i=this._findUpAttachElement(n),a=i.data("id");this.bus.fire("markElementToBeDeleted",{element:i}),this.bus.fire("remove",{id:a,typeName:"attachment"})},_cancelAttachmentDelete:function(e){this._hideConfirmation(this._findUpConfirmationPlaceholder(t(e.target)))}})});