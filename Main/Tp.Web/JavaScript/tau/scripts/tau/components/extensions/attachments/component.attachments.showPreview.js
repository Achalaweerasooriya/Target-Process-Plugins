define(["Underscore","tau/components/extensions/component.creator.extension"],function(_,ComponentCreatorExtension){var attachmentsExtension=ComponentCreatorExtension.extend({"bus initialize":function(evtArgs){var context=evtArgs.data.context,assignable=context.entity;this.contextForPreview={applicationContext:context.applicationContext};var generalEntity={entityType:assignable.entityType,id:assignable.id};_(this.contextForPreview).extend({entity:generalEntity,configurator:context.configurator})},"bus attachmentSelected":function(evtArgs){var attachment=evtArgs.data.attachment;attachment.mimeType=attachment.mimeType||"";if(attachment.mimeType.indexOf("image/")==0){var componentsConfig={components:[{type:"attachmentsPreview",selected:{id:attachment.id}}],context:this.contextForPreview};this.createComponents(componentsConfig,function(data){var item=data[0],attachmentPreviewComponent=item.component;attachmentPreviewComponent.on("afterRender",function(evtArgs){evtArgs.removeListener(),evtArgs.data.element.appendTo($("body"))}),attachmentPreviewComponent.fire("initialize")})}else window.open(attachment.uri,"_blank")}});return attachmentsExtension})