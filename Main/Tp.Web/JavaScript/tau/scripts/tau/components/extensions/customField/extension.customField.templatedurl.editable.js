define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.editableText","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $el=eventData.afterRender.data.element,$widget=$el.find(".ui-customfield__value");self.$widget=$widget;var $h;$widget.editableText({onEditStart:function(){$h=$widget.children().detach(),$widget.text(""),$widget.hasClass("ui-validationerror")||$widget.text($widget.data("textEdit"))},onEditEnd:function(){$widget.hasClass("ui-validationerror")||$widget.html($h)},restoreText:!1,onSave:function(text){self.bus.fire("save",{customFields:[{name:fieldData.name,type:fieldData.type,value:text}]})}}),$widget.on("click","a",function(e){e.stopImmediatePropagation()}),$el.behaviourCustomFieldRow({onActivate:function(){$widget.editableText("activate"),$widget.focus()}}),$el.addClass("ui-customfield_editable_true")}},"bus validate":function(){this.$widget.editableText("resetValidationErrors")},"bus afterValidate":function(evt){this.$widget.editableText("setValue",evt.data.validation.instance.value)},"bus validationFailed":function(evt){this.$widget.editableText("setValidationErrors",evt.data.validation.errors[0].description)}})})