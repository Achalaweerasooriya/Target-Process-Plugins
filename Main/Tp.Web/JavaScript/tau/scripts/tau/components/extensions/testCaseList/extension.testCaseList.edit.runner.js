define(["Underscore","jQuery","tau/components/extensions/component.extension.base","app.path"],function(_,$,ExtensionBase,appPath){return ExtensionBase.extend({"bus dataBind":function(evt){this.data=evt.data},onAfterRender:function(){},"bus afterRender":function(evt){this.element=evt.data.element,this.onAfterRender()},"bus afterRender+permissionsReady":function(evtArgs){if(evtArgs.permissionsReady.data.editable){var $el=evtArgs.afterRender.data.element;$el.find(".last-run").removeClass("hidden"),$el.find(".buttons").removeClass("hidden"),$el.find(".passed").click($.proxy(this.passedClickHandler,this)),$el.find(".failed").click($.proxy(this.failedClickHandler,this))}},getTestCaseId:function(evt){return $(evt.target).parents("tbody").eq(0).tmplItem().data.id},passedClickHandler:function(evt){var testCaseId=this.getTestCaseId(evt);this.setTestCaseStatus(testCaseId,!0)},failedClickHandler:function(evt){var testCaseId=this.getTestCaseId(evt);this.setTestCaseStatus(testCaseId,!1)},setTestCaseStatus:function(testCaseId,status){Ext.Ajax.request({url:(new appPath.tp.WebServiceURL("/PageServices/TestCaseListService.asmx/ChangeRunState")).toString(),headers:{"Content-Type":"application/json"},success:this._onChangeStateComplete.createDelegate(this),failure:this._onChangeStateFailed.createDelegate(this),jsonData:{testCaseID:testCaseId,status:status}})},openNextTestCase:function(){var testCaseId=this.testCaseId,items=this.data.items;for(var i=0;i<items.length-1;i++)items[i].id===testCaseId&&this.fire("expandTestCase",{testCaseId:items[i+1].id});this.onAfterRender=function(){}},_onChangeStateComplete:function(result){this.testCaseId=$.parseJSON(result.responseText).d.TestCaseID,this.onAfterRender=this.openNextTestCase,this.fire("testCaseStateWasChanged")},_onChangeStateFailed:function(fatalError){this.fire("showError",{message:fatalError.get_message()})},destroy:function(){delete this.data,delete this.element}})})