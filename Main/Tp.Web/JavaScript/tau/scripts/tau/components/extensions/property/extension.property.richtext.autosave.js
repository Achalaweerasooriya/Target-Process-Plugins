define(["require","Underscore","tau/core/extension.base","tau/utils/utils.constants"],function(t){var e="Saving...",a=t("Underscore"),i=t("tau/core/extension.base"),o=t("tau/utils/utils.constants"),s=o.get("editorByType"),n=o.get("editorType");return i.extend({category:"edit",resetLifecycle:!0,autoSaveDelay:5e3,"bus beforeInit + dataBind:last":function(t,e,a){this.fire("options.ready",this._extractOptions(e.config.options,{richeditor:s[a.editorType||n.HTML]}))},"bus options.ready:last + $editor.ready":function(t,i,o){var s=i.richeditor;o[s]("setStatus",""),o[s]("enableSaveButton"),o.on(s.toLowerCase()+"change.autosave",function(){o[s]("getStatus")!=e&&o[s]("setStatus","")}),o.on(s.toLowerCase()+"change.autosave",a.debounce(a.bind(function(){if(o.data("ui-"+s)){var t=o[s]("getText");"string"==typeof t&&(o[s]("setStatus",e),o[s]("disableSaveButton"),this.fire("submitted.auto",t))}},this),this.autoSaveDelay))},"bus beforeInit:last + submitted.auto":function(t,e,a){var i={};if(e.config.fieldName)i[e.config.fieldName]=a;else{var o=e.config.customField;i={customFields:[{name:o.name,type:o.type,value:a}]}}this.fire("save",i)},"bus submitted.auto > afterSave":function(){this.fire("autosave.completed")},"bus submitted.auto > validationFailed":function(t,e,a){this.fire("autosave.failed",a.validation.errors[0].description)},"bus options.ready:last + $editor.ready:last + autosave.completed":function(t,e,a){var i=e.richeditor;a[i]("setStatus","All changes saved"),a[i]("enableSaveButton")},"bus options.ready:last + $editor.ready:last + autosave.failed":function(t,e,a,i){var o=e.richeditor;a[o]("setStatus",i),a[o]("disableSaveButton")}})});