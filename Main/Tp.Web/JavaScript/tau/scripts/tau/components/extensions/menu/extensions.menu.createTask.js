define(["Underscore","tau/components/extensions/component.extension.base","tau/components/component.finder.entity"],function(e,t,n){return t.extend({"bus beforeInit:last + configurator.ready:last + $create.submenu.ready":function(e,t,i,o){var a=this,r=o.find(".ui-menu__item"),u=r.filter("[data-alias=createTask]");if(u.length){var d=n.createAsChild(this,{entityType:"userstory"}),s={id:u.data("id"),name:u.data("name")};d.on("afterRender",function(e,t){var n=$("<div/>").append(t.element),r=u.tauBubble({template:['<div class="tau-bubble">','<div class="tau-bubble__arrow" role="arrow"></div>','<div class="tau-bubble__inner tau-container" role="content"></div>',"</div>"].join(""),content:n,onPositionConfig:function(e){e.my="center top",e.at="center bottom",e.collision="flipfit flipfit"},onHide:function(){i.getKeyBoardManager().popHandler(),o.toggleClass("sub-ui-menu_dont-hide",!1),u.find(".drop-down-option").toggleClass("drop-down-option_hover",!1)},onShow:function(){i.getKeyBoardManager().pushHandler({}),o.toggleClass("sub-ui-menu_dont-hide",!0),u.find(".drop-down-option").toggleClass("drop-down-option_hover",!0);var e=r.tauBubble("widget");e.find(".tau-lookup-block").show(),e.find(".filter-field").focus(),e.unbind("click"),d.fire("popupResize",r),u.tauBubble("adjustPosition")},zIndex:10002});a.fire("$taskBubble.ready",r),d.fire("$outerBubbled.ready",r)}),d.on("entitySelected",function(e,t){var n=u.tauBubble("widget");n.find(".tau-lookup-block").hide(),u.tauBubble("hide"),a.fire("entitySelected",t),a.fire("createTask",s)}),this.reFire(d),d.initialize({context:t.config.context})}},reFire:function(t){var n=t,i=this.bus,o=n.fire,a=n.name;n.fire=function(t,r){var u=e.toArray(arguments);o.apply(n,u),i.fire(a+"."+t,r)}},"bus entitySelected + createTask":function(e,t,n){this.fire("create",{entityType:n,userStory:t.entity})}})});