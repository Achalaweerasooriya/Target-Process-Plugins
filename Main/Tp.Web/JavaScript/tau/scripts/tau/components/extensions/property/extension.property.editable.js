define(["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender+dataBind":function(eventData){var self=this,$element=this.element=eventData.afterRender.data.element;eventData.afterRender.data.element.find(".external-view").click(function(e){e.stopPropagation()});var permissions=this.permissions=eventData.permissionsReady.data;if(permissions.editable===!1)return;$element.find(".tau-property").addClass("tau-property_editable_true"),$element.addClass("tau-editable");var data=eventData.dataBind.data;(!data.text||!data.text.length)&&$element.find(".property").addClass("editable");if(permissions.editable){this.config.targetElementSelector=this.config.targetElementSelector||".property-text";var target=this.config.targetElementSelector||"",align=this.config.alignElementSelector||"",componentsConfig={components:[_.extend({data:data},this.config.editorComponentConfig)],context:self.config.context},bubbleConfig={target:$element.is(target)?$element:$element.find(target),alignTo:$element.is(align)?$element:$element.find(align),componentsConfig:componentsConfig,applyBubbleClasses:this.config.applyBubbleClasses,stackName:this.config.alignElementSelector||"default",className:this.config.bubbleClassName,onShow:_.bind(function(){this.config.context.configurator.getKeyBoardManager().pushHandler({})},this),onHide:_.bind(function(){this.config.context.configurator.getKeyBoardManager().popHandler()},this)};this.fire("initBubble",bubbleConfig)}},"bus edit":function(){this.permissions.editable&&this.fire("toggleBubble")}})})