define(["Underscore","jQuery","tau/components/extensions/component.extension.base","libs/jquery/jquery.ui.confirmation"],function(a,b,c){return c.extend({"bus permissionsReady+afterRender":function(a){this.$element=a.afterRender.data.element;var b=a.permissionsReady.data;b.deletable&&this._createDeleteTriggers()},"bus attachmentUploaded":function(a){this._createDeleteTriggers()},"bus afterAttachmentRemove":function(a){var c=this,d=a.data.id,e=this.$element.find("#attach-"+d);this.bus.fire("deleteElement",{element:e,callback:function(){b(this).remove()}})},_getDeleteTriggerProto:function(){return this._deleteTriggerProto||(this._deleteTriggerProto=b('<button class="delete" type="button">delete</button>').click(b.proxy(this,"_onAttachmentDelete"))),this._deleteTriggerProto},_createDeleteTriggers:function(){var a=this;this.$element.find(".ui-attach:not(.deletable)").each(function(c,d){b(d).addClass("deletable").find(".toolbar").append(a._getDeleteTriggerProto().clone(!0))})},_onAttachmentDelete:function(a){var c=this._findUpConfirmationPlaceholder(b(a.target));c.data("confirmation")||this._createConfirmation(c),this._showConfirmation(c)},_findUpConfirmationPlaceholder:function(a){return a.closest(".ui-attach").children(".inner")},_findUpAttachElement:function(a){return a.closest(".ui-attach")},_createConfirmation:function(a){a.confirmation({message:"Delete attachment?",ok:b.proxy(this,"_deleteAttachment"),cancel:b.proxy(this,"_cancelAttachmentDelete")})},_showConfirmation:function(a){a.confirmation("show")},_hideConfirmation:function(a){a.confirmation("hide")},_deleteAttachment:function(a){var c=b(a.target);this._hideConfirmation(this._findUpConfirmationPlaceholder(c));var d=this._findUpAttachElement(c);this.bus.fire("markElementToBeDeleted",{element:d}),this.bus.fire("remove",{id:d.attr("id").replace(/[^\d]/g,""),typeName:"attachment"})},_cancelAttachmentDelete:function(a){this._hideConfirmation(this._findUpConfirmationPlaceholder(b(a.target)))}})})