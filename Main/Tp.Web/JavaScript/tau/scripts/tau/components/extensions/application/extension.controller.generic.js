define(["Underscore","jQuery","tau/core/event.emitter","tau/core/event-dispatcher","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function(_,$,EventEmitter,EventDispatcher,ProgressIndicator){return EventEmitter.extend({init:function(config){this._super(config),this.config=config,this.fire("controller.hostType",null),this.fire("controller.app.host.prev",null),this.fire("controller.app.page.prev",null)},destroy:function(){this._super(),delete this.config},"bus controller.app.host + controller.app.host.prev":function(e){var next=e["controller.app.host"].data,prev=e["controller.app.host.prev"].data;prev&&prev.destroy(),this.fire("controller.app.host.prev",next)},"bus controller.app.page + controller.app.page.prev":function(e){var next=e["controller.app.page"].data,prev=e["controller.app.page.prev"].data;prev&&prev.destroy(),this.fire("controller.app.page.prev",next)},"bus configurator.ready:last + application.navigate + controller.postExecute":function(e,configurator,request){var params=request.args,ctx={id:params.id,type:params.entity},defaultDefinition=configurator.getBoardDefinitionFactory().createDefault();configurator.setBoardSettingsOptions(defaultDefinition);var boardSettings=configurator.getBoardSettingsFactory().create(ctx.id);this.prepareBoardSettings({boardSettings:boardSettings})},prepareBoardSettings:function(args){var self=this,boardSettings=args.boardSettings;boardSettings.get({fields:["name","x","y","cells","viewMode","zoomLevel","collapse","focus"],callback:function(r){var bs={boardSettings:boardSettings};self.fire("boardSettings.ready",bs)}})},"bus controller.app.host:last + controller.app.page:last + boardSettings.ready":function(e){var host=e["controller.app.host"].data,page=e["controller.app.page"].data,data=e["boardSettings.ready"];_([host,page]).each(function(p){p.fire(data.name,data.data)})},"bus controller.hostType:last + application.navigate":function(e){var self=this,h=e["controller.hostType"].data,d=e["application.navigate"].data,isMasterTypeChanged=h!==d.host;isMasterTypeChanged&&self.fire("controller.hostType",d.host);var postfix=isMasterTypeChanged?"full":"partial";self.fire("controller.load."+postfix,d)},"bus controller.load.full":function(e){var self=this,d=e.data;require([d.host,d.type],function(HostComponentModule,PageComponentModule){self.fire("controller.preExecute",{});var host=self.build("Host",HostComponentModule,d.args),page=self.build("Page",PageComponentModule,d.args);self.fire("controller.app.host",host),self.fire("controller.app.page",page);var parts=[host,page],eventDispatcher=new EventDispatcher(parts);eventDispatcher.listen("afterRender",function(e){var $host=e.argsArr[0].element;self.fire("innerContentRendered",{element:$host})}),_(parts).each(function(p){p.initialize()}),self.fire("controller.postExecute",{})})},"bus controller.load.partial > controller.host.rendered":function(e,$1,$host){var $el=$host.element.find("[role=main]"),integration=this.config.integration||{};!0!==integration.disableProgressIndicator&&ProgressIndicator.get($el).show()},"bus controller.load.partial > controller.host.rendered > innerPageRendered":function(e,$1,$host){var $el=$host.element.find("[role=main]"),integration=this.config.integration||{};!0!==integration.disableProgressIndicator&&ProgressIndicator.get($el).hide()},"bus controller.load.partial + controller.host.rendered":function(e){var self=this;self.fire("controller.host.rendered",e["controller.host.rendered"].data);var d=e["controller.load.partial"].data;require([d.type],function(PageComponentModule){self.fire("controller.preExecute",{});var page=self.build("Page",PageComponentModule,d.args);self.fire("controller.app.page",page),page.initialize(),self.fire("controller.postExecute",{})})},build:function(alias,Module,args){var self=this,entity={id:args.id,type:args.entity},appConfig={context:{configurator:self.config.context.configurator,entity:entity},entity:entity},c=Module.create(appConfig);return c.on("error",function(e){self.fire("application.error",e.data)}),c.on("afterRender",function(e){self.fire("inner"+alias+"Rendered",e.data)}),c.on("beforeDelete",function(e){self.fire("initProgress")}),c.on("deleted",function(e){var configurator=self.config.context.configurator,history=configurator.getHistory(),redirect=configurator.getRedirect(),item=history.pop();item?(history.setCurrent(null),redirect.redirect(item.url)):self.fire("application.exit")}),c},"bus innerHostRendered":function(e){this.fire("controller.host.rendered",e.data)},"bus controller.host.rendered:last + innerPageRendered":function(e){var $host=e["controller.host.rendered"].data.element,$page=e.innerPageRendered.data.element;$host.find("[role=main]").append($page),this.fire("innerContentRendered",{element:$host})},"bus afterRender:last > controller.load.full > innerContentRendered":function(e){var applicationElement=e.afterRender.data.element,hostElement=e.innerContentRendered.data.element;$("html").toggleClass("tau-html_action_view",!0).toggleClass("tau-html_action_print",!1);var classToAdd="",classToDel="";hostElement.hasClass("tau-board-container")?(classToAdd="tau-page-board",classToDel="tau-page-entity"):(classToAdd="tau-page-entity",classToDel="tau-page-board"),applicationElement.removeClass(classToDel).addClass(classToAdd).empty().append(hostElement),this.fire("controller.appContent.rendered",applicationElement),this.fire("contentRendered",{element:applicationElement})},"bus controller.appContent.rendered:last + view.dom.ready:last + controller.app.host:last + innerHostRendered":function(e){var appHost=e["controller.app.host"].data,domReady=e["view.dom.ready"].data;appHost.fire("view.dom.ready",domReady)},"bus controller.appContent.rendered:last + view.dom.ready:last + controller.app.page:last + innerPageRendered":function(e){var appPage=e["controller.app.page"].data,domReady=e["view.dom.ready"].data;appPage.fire("view.dom.ready",domReady)},"bus controller.app.host:last > destroy":function(e,target){target.fire("destroy")},"bus controller.app.page:last > destroy":function(e,target){target.fire("destroy")}})})