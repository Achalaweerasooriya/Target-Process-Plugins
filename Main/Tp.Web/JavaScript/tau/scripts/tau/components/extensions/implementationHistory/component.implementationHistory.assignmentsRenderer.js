define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/configurator"],function(_,$,a,b){return a.extend({"bus afterRender+stateProgressRendered":function(a){this._$element=a.afterRender.data.element,this._data=a.afterRender.data.data,this._render()},_render:function(){var a=this._$element.find(".tau-historyGrid .tau-historyItem");_.each(this._data.historyItems,function(b,c){b.assignments&&!b.state.isFinal&&$('<div class="tau-assignments"/>').insertAfter(a.eq(c).find(".tau-flow")).append(this._getAssignments(b))},this)},_getAssignments:function(a){var c=[];return _.each(a.assignments,function(d){var e=[d.firstName,d.lastName,"("+this._getAssignmentRoles(d)+")"].join(" "),f=b.getApplicationPath()+"/Avatar.ashx?UserId="+d.id+"&size=50",g=this._isActiveAssignment(d,a)?' class="active"':"";c.push("<img"+g+' alt="avatar" title="'+e+'" src="'+f+'"/>')},this),c.join("")},_getAssignmentRoles:function(a){return _.map(a.roles,function(a){return a.name}).join(", ")},_isActiveAssignment:function(a,b){return _.any(a.roles,function(a){return a.id==b.state.roleId})}})})