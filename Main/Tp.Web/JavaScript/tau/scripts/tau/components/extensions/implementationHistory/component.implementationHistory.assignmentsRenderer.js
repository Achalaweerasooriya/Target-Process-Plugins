define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender+stateProgressRendered":function(evt){this._$element=evt.afterRender.data.element,this._data=evt.afterRender.data.data,this._render()},_render:function(){var $historyItems=this._$element.find(".tau-historyGrid .tau-historyItem");_.each(this._data.historyItems,function(historyItem,index){historyItem.assignments&&!historyItem.state.isFinal&&$('<div class="tau-assignments"/>').insertAfter($historyItems.eq(index).find(".tau-flow")).append(this._getAssignments(historyItem))},this)},_getAssignments:function(historyItem){var assignments=[];return _.each(historyItem.assignments,function(assignment){var avatarTitle=[assignment.firstName,assignment.lastName,"("+this._getAssignmentRoles(assignment)+")"].join(" "),avatarUrl=this.config.context.configurator.getApplicationPath()+"/Avatar.ashx?UserId="+assignment.id+"&size=50",activeClass=this._isActiveAssignment(assignment,historyItem)?' class="active"':"";assignments.push("<img"+activeClass+' alt="avatar" title="'+avatarTitle+'" src="'+avatarUrl+'"/>')},this),assignments.join("")},_getAssignmentRoles:function(assignment){return _.map(assignment.roles,function(role){return role.name}).join(", ")},_isActiveAssignment:function(assignment,historyItem){return _.any(assignment.roles,function(role){return role.id==historyItem.state.roleId})}})})