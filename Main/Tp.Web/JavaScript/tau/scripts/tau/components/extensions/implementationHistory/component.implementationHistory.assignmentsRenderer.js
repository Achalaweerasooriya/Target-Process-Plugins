define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/configurator"],function(a,b,c,d){return c.extend({"bus afterRender+stateProgressRendered":function(a){this._$element=a.afterRender.data.element,this._data=a.afterRender.data.data,this._render()},_render:function(){var c=this._$element.find(".tau-historyGrid .tau-historyItem");a.each(this._data.historyItems,function(a,d){a.assignments&&!a.state.isFinal&&b('<div class="tau-assignments"/>').insertAfter(c.eq(d).find(".tau-flow")).append(this._getAssignments(a))},this)},_getAssignments:function(b){var c=[];return a.each(b.assignments,function(a){var e=[a.firstName,a.lastName,"("+this._getAssignmentRoles(a)+")"].join(" "),f=d.getApplicationPath()+"/Avatar.ashx?UserId="+a.id+"&size=50",g=this._isActiveAssignment(a,b)?' class="active"':"";c.push("<img"+g+' alt="avatar" title="'+e+'" src="'+f+'"/>')},this),c.join("")},_getAssignmentRoles:function(b){return a.map(b.roles,function(a){return a.name}).join(", ")},_isActiveAssignment:function(b,c){return a.any(b.roles,function(a){return a.id==c.state.roleId})}})})