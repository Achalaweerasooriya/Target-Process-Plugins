define(["Underscore","jQuery","tau/ui/extensions/editable-base","tau/ui/behaviour/menu/ui.behaviour.menu.actions"],function(_,$,Class,event){return Class.extend({"bus configurator.ready + afterRender + dataBind":function(evt,configurator,renderData,bindData){var self=this;this.bindData=bindData,this.redirect=configurator.getRedirect();var $el=this.$el=renderData.element;this.fire("$el.ready",$el),$el.behaviourMenuActions({keyboardManager:configurator.getKeyBoardManager(),onClick:function(e){self.wasShownBefore?self.fire("menu.show",$el):(self.fire("menu.show.first",$el),self.wasShownBefore=!0)}}),$el.find(".ui-menu__item-action").click(_.bind(this.executeCommand,this))},"bus select":function(){this.$el.behaviourMenuActions("show")},removeEntity:function(){var entity=this.config.context.entity,store=this.config.context.configurator.getStore();store.remove(entity.entityType.name,{id:entity.id}).done(),this.config.context.configurator.getHistory().exclude(entity.id)},redirectTo:function(url,target){this.redirect.redirect(url,target)},split:function(){var generalID=this.config.context.entity.id,data={generalID:generalID};this.fire("split",data)},markAsDuplicate:function(){var generalID=this.config.context.entity.id,data={generalID:generalID};this.fire("markAsDuplicate",data)},attachToRequest:function(){var generalID=this.config.context.entity.id;this.fire("attachToRequest",{generalID:generalID})},moveOrCopy:function(){var id=this.config.context.entity.id;this.fire("moveOrCopy",{generalID:id})},executeCommand:function(evt){if($(evt.target).is("a")||$(evt.target).is("i"))return;var self=this,alias=$(evt.currentTarget).data("alias"),data=_.find(this.bindData.items,function(x){return x.alias==alias});if(!data)return;var commandConfig=data.command,confirmation=data.confirmation||!1;if(confirmation&&window.confirm(confirmation)==0)return;if(_.isFunction(commandConfig))_.bind(commandConfig,self)(self);else if(typeof commandConfig=="object"){var componentsConfig={components:commandConfig,context:self.config.context};self.createComponents(componentsConfig,function(data){var container=data[0].component;container.initialize()})}else data.url&&self.redirectTo(data.url);this.fire("beforeSave",{})}})})