define(["tau/components/extensions/component.extension.base","tau/core/templates-factory","tau/ui/templates/actions/ui.template.moveOrCopy"],function(e,o){var t=0;return e.extend({"bus moveOrCopy":function(e){var o=e.data.generalID;this.moveOrCopy(o)},moveOrCopy:function(e){var n=this;Ext.WindowMgr.zseed=99999;var i=this.config.context.configurator.getActionsService(),c=function(c){function r(o,t){var c=$("#"+p+" #projectSelector").val();0!=c&&i[o](n.config.context.entity.id,c,function(){v.close(),t&&t(e,c)},function(e){v.close();var o;try{o=$.parseJSON(e.responseText).Message}catch(t){o=e.statusText}n.fire("error",{message:o})})}t++;var a=o.get("move-or-copy").bind(n.config,{projects:c.d}).appendTo("body"),p="copyActionPopup"+t;a.find("#copyActionPopup").prop("id",p);var s=a.find(".copy,.move");a.find("#projectSelector").change(function(){var e="disabled";"0"!=$(this).val()?s.removeAttr(e):s.attr(e,e)}),a.find(".copy").click(function(){var e=function(e,o){n.fire("entityWasCopiedToProject",{entity:{id:e},project:{id:o}})};r("copyGeneralToProject",e)}),a.find(".move").click(function(){var e=function(e,o){n.fire("entityWasMovedToProject",{entity:{id:e},project:{id:o}})};r("moveGeneralToProject",e)});var v=showModalPopup(p,{title:"Move or Copy",width:440,height:126})};i.getActiveProjectForEntity(e,c)}})});