define(["tau/components/extensions/component.extension.base","tau/core/templates-factory","tau/ui/templates/actions/ui.template.moveOrCopy"],function(ExtensionBase,templates){var popupId=0;return ExtensionBase.extend({"bus moveOrCopy":function(evt){var generalID=evt.data.generalID;this.moveOrCopy(generalID)},moveOrCopy:function(generalID){var self=this;Ext.WindowMgr.zseed=99999;var service=this.config.context.configurator.getActionsService(),getActiveProjectSuccess=function(data){function doAction(action,success){var projectId=$("#"+popupElementId+" #projectSelector").val();projectId!=0&&service[action](self.config.context.entity.id,projectId,function(r){wnd.close(),success&&success(generalID,projectId)},function(r){wnd.close();var message=$.parseJSON(r.responseText).Message;self.fire("error",{message:message})})}popupId++;var el=templates.get("move-or-copy").bind(self.config,{projects:data.d}).appendTo("body"),popupElementId="copyActionPopup"+popupId;el.find("#copyActionPopup").prop("id",popupElementId);var buttons=el.find(".copy,.move");el.find("#projectSelector").change(function(){var disabled="disabled";$(this).val()!="0"?buttons.removeAttr(disabled):buttons.attr(disabled,disabled)}),el.find(".copy").click(function(){var successDelegate=function(entityId,projectId){self.fire("entityWasCopiedToProject",{entity:{id:entityId},project:{id:projectId}})};doAction("copyGeneralToProject",successDelegate)}),el.find(".move").click(function(){var successDelegate=function(entityId,projectId){self.fire("entityWasMovedToProject",{entity:{id:entityId},project:{id:projectId}})};doAction("moveGeneralToProject",successDelegate)});var wnd=showModalPopup(popupElementId,{title:"Move or Copy",width:440,height:126})};service.getActiveProjectForEntity(generalID,getActiveProjectSuccess)}})})