define(["require","Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date"],function(e){var t=e("Underscore"),i=e("jQuery"),a=e("tau/components/extensions/component.extension.base"),n=e("tau/utils/utils.date");return a.extend({"bus permissionsReady + afterRender":function(e,t,a){if(t.editable){this.fieldData=a.data,this.$editor=a.element.find(":text"),this.defaultValue=this.$editor.val(),i.datepicker.parseDate=function(e,t){return n.parse(t)},i.datepicker.formatDate=function(e,t){return n.formatAs(t,e)};var s=function(){this.$editor.focus()}.bind(this);this.$editor.datepicker({dateFormat:n.getFormatData().date.short,showOn:"button",onSelect:s}),this.$editor.keydown(function(e){13===e.keyCode&&(e.preventDefault(),this._onSave())}.bind(this)),setTimeout(s,0)}},_onSave:function(){var e=this.$editor.val()||"",i=this.defaultValue||"";t.trim(i)===t.trim(e)?this.fire("afterSave"):this.fire("save",{customFields:[{name:this.fieldData.name,type:this.fieldData.type,value:e}]})},"bus validate":function(){this.$editor.removeClass("error")},"bus validationFailed":function(){this.$editor.addClass("error")}})});