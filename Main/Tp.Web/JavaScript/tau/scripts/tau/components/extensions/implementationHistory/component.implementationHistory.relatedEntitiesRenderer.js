define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){var entityTemplateFactory={create:function(entityInfo,isClosed){return $("<a></a>").addClass(this._createClassName(entityInfo,isClosed)).attr("href","#"+entityInfo.type+"/"+entityInfo.id).attr("title",this._createTitle(entityInfo,isClosed)).data("entityInfo",{id:entityInfo.id,type:entityInfo.type,alias:entityInfo.alias||entityInfo.type})},_createTitle:function(entityInfo,isClosed){var title=["["+(entityInfo.alias||entityInfo.type)+"]"," #"+entityInfo.id,entityInfo.name,isClosed?"(closed)":"(added)"].join(" ");return title},_createClassName:function(entityInfo,isClosed){var className=["tau-entity","tau-"+entityInfo.type.toLowerCase(),isClosed?"tau-closed":""].join(" ");return className}};return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render()},_render:function(){var $historyItems=this._$element.find(".tau-historyGrid .tau-historyItem");_.each(this._data.historyItems,function(historyItem,index){var $entityContainer=$historyItems.eq(index).find(".tau-relatedEntities");historyItem.relatedEntities&&(_.each(historyItem.relatedEntities.opened,function(entity){$entityContainer.append(entityTemplateFactory.create(entity))}),_.each(historyItem.relatedEntities.closed,function(entity){$entityContainer.append(entityTemplateFactory.create(entity,!0))}))})}})})