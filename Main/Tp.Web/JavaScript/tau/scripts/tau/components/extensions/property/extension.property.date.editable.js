define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date","tau/ui/behaviour/date/ui.behaviour.dateEditor"],function(t,e,i,n){return i.extend({category:"edit",init:function(){this._super.apply(this,arguments),this.onClickProxy=e.proxy(this.onClickHandler,this)},"bus permissionsReady + afterRender + dataBind":function(i){var a=this;if(this.element=i.afterRender.data.element,this.permissions=i.permissionsReady.data,this.date=i.dataBind.data,this.permissions.editable){this.element.bind("click",this.onClickProxy),this.$widget=this.element.find(".property"),e.datepicker.parseDate=function(t,e){return n.parse(e)},e.datepicker.formatDate=function(t,e){return n.formatAs(e,t)};var r="datetime"==this.config.format?"datetimepicker":"datepicker";this.$widget.dateEditor({delayedSave:t.has(this.config,"delayedDateSave")?this.config.delayedDateSave:!0,keyboardManager:this.config.context.configurator.getKeyBoardManager(),dateFormat:n.getFormatData().date.short,widgetName:r,beforeChange:function(t){a.fire("validateDate",t)},onCancel:function(){a.onCancelEdit()},onSave:function(t){if(a.trimString(t)==a.trimString(a.date.text))a.fire("resetValidationErrors");else{var e=a.config.propertyName,i={};i[e]=t;var n={$set:i,$include:[e]};a.bus.fire("save",n)}}})}},trimString:function(e){return t.trim(e||"")},showEditor:function(){this.$widget.dateEditor("activate"),this.$widget.focus()},"bus edit":function(){this.permissions.editable&&this.showEditor()},onClickHandler:function(){this.showEditor()},onCancelEdit:function(){},removeHandlers:function(){this.element&&this.element.unbind("click",this.onClickProxy)},removeWidget:function(){this.$widget&&this.$widget.data("ui-dateEditor")&&this.$widget.dateEditor("destroy")},destroy:function(){this.removeHandlers(),this.removeWidget(),this._super()}})});