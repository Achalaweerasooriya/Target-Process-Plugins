define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date","tau/ui/behaviour/date/ui.behaviour.dateEditor"],function(t,e,i,a){return i.extend({category:"edit",init:function(){this._super.apply(this,arguments),this.onClickProxy=e.proxy(this.onClickHandler,this)},"bus permissionsReady + afterRender + dataBind":function(i){var n=this;if(this.element=i.afterRender.data.element,this.permissions=i.permissionsReady.data,this.date=i.dataBind.data,this.permissions.editable){this.element.bind("click",this.onClickProxy),this.$widget=this.element.find(".property"),e.datepicker.parseDate=function(t,e){return a.parse(e)},e.datepicker.formatDate=function(t,e){return a.formatAs(e,t)};var r="datetime"==this.config.format?"datetimepicker":"datepicker";this.$widget.dateEditor({delayedSave:t.has(this.config,"delayedDateSave")?this.config.delayedDateSave:!0,keyboardManager:this.config.context.configurator.getKeyBoardManager(),dateFormat:a.getFormatData().date.short,widgetName:r,beforeChange:function(t){n.fire("validateDate",t)},onSave:function(t){if(n.trimString(t)==n.trimString(n.date.text))n.fire("resetValidationErrors");else{var e=n.config.propertyName,i={};i[e]=t;var a={$set:i,$include:[e]};n.bus.fire("save",a)}}})}},trimString:function(e){return t.trim(e||"")},showEditor:function(){this.$widget.dateEditor("activate"),this.$widget.focus()},"bus edit":function(){this.permissions.editable&&this.showEditor()},onClickHandler:function(){this.showEditor()},removeHandlers:function(){this.element&&this.element.unbind("click",this.onClickProxy)},removeWidget:function(){this.$widget&&this.$widget.data("ui-dateEditor")&&this.$widget.dateEditor("destroy")},destroy:function(){this.removeHandlers(),this.removeWidget(),this._super.apply(this,arguments)}})});