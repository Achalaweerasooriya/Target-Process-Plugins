define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date","tau/ui/behaviour/date/ui.behaviour.dateEditor"],function(a,b,c,d){return c.extend({category:"edit",init:function(){this._super.apply(this,arguments),this.onClickProxy=b.proxy(this.onClickHandler,this)},"bus permissionsReady+afterRender+dataBind":function(a){var c=this,e=this.element=a.afterRender.data.element;a.afterRender.data.element.find(".external-view").click(function(a){a.stopPropagation()});var f=this.permissions=a.permissionsReady.data,g=this.date=a.dataBind.data,h=this.config.format;if(f.editable){this.element.bind("click",this.onClickProxy);var i=this.$widget=e.find(".property"),j=null;h=="datetime"?j="datetimepicker":j="datepicker",b.datepicker.parseDate=function(a,b,c){return d.parse(b)},b.datepicker.formatDate=function(a,b,c){return d.format.date.short(b)},i.dateEditor({dateFormat:d.getFormatData().date.short,widgetName:j,beforeChange:function(a){c.fire("validateDate",a)},onSave:function(a){var b={};b[c.config.propertyName]=a;if(c.trimString(a)!=c.trimString(g.text)){var d={$set:b};d.$include=[c.config.propertyName],c.bus.fire("save",d)}else c.fire("resetValidationErrors")}})}},trimString:function(a){return(a||"").trim()},showEditor:function(){this.$widget.dateEditor("activate"),this.$widget.focus()},"bus edit":function(){this.permissions.editable&&this.showEditor()},onClickHandler:function(){this.showEditor()},removeHandlers:function(){this.element&&this.element.unbind("click",this.onClickProxy)},removeWidget:function(){this.$widget&&this.$widget.dateEditor("destroy")},destroy:function(){this.removeHandlers(),this.removeWidget(),this._super.apply(this,arguments)}})})