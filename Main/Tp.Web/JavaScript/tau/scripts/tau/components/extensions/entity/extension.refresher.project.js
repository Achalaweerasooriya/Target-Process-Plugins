define(["Underscore","tau/core/model-base"],function(_,a){return a.extend({onInit:function(){var a=[this.config.entity.type||this.config.context.entityType.name],b=this;b.store.unbind(this),_.forEach(a,function(a){b.store.on({eventName:"beforeSave",type:a,listener:b},function(){b.beforeEntitySave.apply(b,arguments)}),b.store.on({eventName:"afterSave",type:a,listener:b},function(){b.afterEntitySave.apply(b,arguments)})})},"bus contextRetrieved":function(a){this.project=a.data.context.getProject()},beforeEntitySave:function(a){(a.data.changes.userStory||a.data.changes.project)&&a.data.cmd.config.fields.push({project:["id"]})},afterEntitySave:function(a){a.data.changes.project&&(this.fire("evictData"),this.fire("refresh"))}})})