define(["Underscore","tau/core/model-base"],function(a,b){return b.extend({onInit:function(){var b=[this.config.context.entityType.name],c=this;c.store.unbind(this),a.forEach(b,function(a){c.store.on({eventName:"beforeSave",type:a,listener:c},function(){c.beforeEntitySave.apply(c,arguments)}),c.store.on({eventName:"afterSave",type:a,listener:c},function(){c.afterEntitySave.apply(c,arguments)})})},"bus contextRetrieved":function(a){this.project=a.data.context.getProject()},beforeEntitySave:function(a){(a.data.changes.userStory||a.data.changes.project)&&a.data.cmd.config.fields.push({project:["id"]})},afterEntitySave:function(a){a.data.changes.project&&(this.fire("evictData"),this.fire("refresh"))}})})