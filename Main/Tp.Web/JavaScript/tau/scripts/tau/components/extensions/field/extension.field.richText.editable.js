define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(_,$,a){return a.extend({category:"edit","bus prepareChanges":function(a){this.bus.fire("markElementToBeUpdated",{element:this.element})},"bus applyChanges":function(a){var b=this;this.bus.on("afterRender",function(a){a.removeListener(),b.bus.fire("updateElement",{element:b.element})}),this.bus.fire("refresh")},"bus changeText":function(a){var b=this,c={};c[b.config.fieldName]=a.data,b.bus.fire("save",c)},"bus permissionsReady+afterRender":function(a){var b=this;this.element=a.afterRender.data.element;var c=a.permissionsReady.data;if(c.editable){var d=this.element.width(),e=a.afterRender.data.element.find(".ui-description__inner").richeditor({text:this.element.tmplItem().data.html,placeholder:{text:"Double-click to add description...",className:"ui-description__inner_empty_true"},onSave:function(a){b.fire("changeText",a),e.addClass("data-saving")},settings:{fitImgWidth:!1,toolbar:[["Cut","Copy","Paste","PasteText","PasteFromWord","-","Bold","Italic","Underline","Strike","-","Subscript","Superscript"],["NumberedList","BulletedList","-","Outdent","Indent"],["JustifyLeft","JustifyCenter","JustifyRight"],["Link","Unlink","Anchor"],["Image","Table","HorizontalRule","SpecialChar"],["Source","Format","Font","FontSize"],["Replace","-","RemoveFormat","TextColor","BGColor","-","Templates"],["Maximize"]],height:450}});e.bind("richeditorbeforeapply",function(a,c){var d=[],e=0,f=b.element.width(),g=$(a.target).richeditor("getSettings");_.each(g.toolbar,function(a){var b=a.length*28+20;e+b>f&&(e=0,d.push("/")),d.push(a),e+=b}),g.toolbar=d,$(a.target).richeditor("setSettings",g)})}}})})