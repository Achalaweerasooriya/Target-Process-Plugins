define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(a,b,c){return c.extend({category:"edit","bus prepareChanges":function(a){this.bus.fire("markElementToBeUpdated",{element:this.element})},"bus applyChanges":function(a){var b=this;this.bus.on("afterRender",function(a){a.removeListener(),b.bus.fire("updateElement",{element:b.element})}),this.bus.fire("refresh")},"bus changeText":function(a){var b=this,c={};c[b.config.fieldName]=a.data,b.bus.fire("save",c)},"bus permissionsReady+afterRender":function(c){var d=this;this.element=c.afterRender.data.element;var e=c.permissionsReady.data;if(e.editable){var f=this.element.width(),g=c.afterRender.data.element.find(".ui-description__inner").richeditor({text:this.element.tmplItem().data.html,placeholder:{text:"Double-click to add description...",className:"ui-description__inner_empty_true"},onSave:function(a){d.fire("changeText",a),g.addClass("data-saving")},settings:{fitImgWidth:!1,toolbar:[["Cut","Copy","Paste","PasteText","PasteFromWord","-","Bold","Italic","Underline","Strike","-","Subscript","Superscript"],["NumberedList","BulletedList","-","Outdent","Indent"],["JustifyLeft","JustifyCenter","JustifyRight"],["Link","Unlink","Anchor"],["Image","Table","HorizontalRule","SpecialChar"],["Source","Format","Font","FontSize"],["Replace","-","RemoveFormat","TextColor","BGColor","-","Templates"],["Maximize"]],height:450}});g.bind("richeditorbeforeapply",function(c,e){var f=[],g=0,h=d.element.width(),i=b(c.target).richeditor("getSettings");a.each(i.toolbar,function(a){var b=a.length*28+20;g+b>h&&(g=0,f.push("/")),f.push(a),g+=b}),i.toolbar=f,b(c.target).richeditor("setSettings",i)})}}})})