define(["Underscore","tau/core/extension.base"],function(_,ExtensionBase){var fnNoop=function(){};return ExtensionBase.extend({init:function(config){this._super(config),this.config=config},registerPatterns:function(patterns){var self=this;_.each(patterns,function(p){self.fire("registerRoute",p)})},registerNotFoundPattern:function(pattern404){this.fire("registerRouteNotFound",pattern404)},"bus routing.registered":function(eventData){var self=this,configurator=self.config.context.configurator,execute=_.bind(self.execute,self);self.registerPatterns([{pattern:/board\/current/,callback:function(){execute("board",{id:null,entity:"board",action:"current"})}},{pattern:/board\/([\w|0-9]+)/,callback:function(boardId){execute("board",{id:boardId,entity:"board"})}},{pattern:/^$/,callback:function(req){execute("entity",{})}},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,callback:function(entityType,entityId,tail){execute("entity",{entity:entityType,id:parseInt(entityId),action:"show"})}},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,callback:function(entityType,entityId,action){execute("entity",{entity:entityType,id:parseInt(entityId),action:action})}}]),self.registerNotFoundPattern({callback:function(){self.fire("error",{message:"URL is not found"})}}),self.fire("dataBind",{})},execute:function(moduleType,params){var self=this,configurator=self.config.context.configurator;if(!params.id&&!params.entity){var routing=configurator.getRouting(),referrer=routing.getReferer(),url=referrer?referrer.url:null;url&&url!=="#"?routing.redirect("#"+url):self.fire("application.exit");return}var currentCash=configurator.getExternal().getHash();configurator.getRouting().setReferer({url:currentCash}),self.fire("application.navigate."+moduleType,params)},destroyOnCriticalError:function(){this.fire("destroy")},"bus application.error":function(e){this.config.destroyOnError===!0&&this.destroyOnCriticalError()},"bus afterRender":function(e){this.fire("controller.ready")},"bus contentRendered":function(e){this.destroyOnCriticalError=fnNoop},destroy:function(){var self=this;delete self.config,this._super()}})})