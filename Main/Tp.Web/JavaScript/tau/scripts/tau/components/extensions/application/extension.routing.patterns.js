define(["Underscore","tau/core/event.emitter","tau/core/tau"],function(_,a,b){return a.extend({init:function(a){this._super(a),this.config=a},parseQueryParams:function(){var a=b.getValueFromQueryString("type").split("."),c=/\/(\w+?).aspx$/.exec(window.location.pathname);return{id:b.getValueFromQueryString("id"),entity:a[a.length-1],type:a[a.length-1],action:c&&c.length?c[1]:null}},normalizeUrl:function(){var a=this;if(a.config.applicationId){var b=a.config.context.configurator.getExternal(),c=b.getHashParam(a.config.applicationId,null);c||(c=a.config.pageType+"/"+a.config.pageId,b.setHashParam(a.config.applicationId,c))}},"bus routing.registered":function(a){var b=this,c=this.parseQueryParams();b.normalizeUrl();var d=_.bind(this.execute,this);this.fire("registerRoute",{pattern:/board\/([\w|0-9]+)/,callback:function(a,b,c){d("board",{id:c,entity:"board"})}}),this.fire("registerRoute",{pattern:"",callback:function(a){d("entity",c)}});var e;this.fire("registerRoute",{pattern:/(\w+)\/([0-9]+)($|\s|&)/,callback:function(a,b,c,f){f=parseInt(f);if(e!=f){var g={entity:c,id:f,action:"show"};e=f,d("entity",g)}}}),this.fire("registerRoute",{pattern:"{entity}/{id}/{action}",callback:function(a){a.id=parseInt(a.id),d("entity",a)}}),this.fire("registerRouteNotFound",{callback:function(a){b.fire("error",{message:"URL is not found"})}}),this.fire("dataBind",{})},execute:function(a,b){this.fire("application.navigate."+a,b)},"bus afterRender":function(a){this.fire("controller.ready")},destroy:function(){var a=this;if(a.config.applicationId){var b=a.config.context.configurator.getExternal();b.setHashParam(a.config.applicationId,null)}delete a.config,this._super()}})})