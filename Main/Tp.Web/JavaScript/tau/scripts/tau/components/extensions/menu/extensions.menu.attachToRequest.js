define(["Underscore","tau/core/extension.base","tau/components/component.finder.entity","tau/models/finder.entity/model.finder.entity.data.relation"],function(e,t,n,i){return t.extend({"bus beforeInit:last + entity.ready:last + configurator.ready:last + $menu.ready + menu.show.first":function(t,a,r,s,o){var d=o.find(".ui-menu__item").filter(function(){return"Attach to Request"==$(this).data("alias")});if(d.length){{var u=n.createAsChild(this,{entityType:"request",model:i,dependencyType:"master"});d.data("name"),d.data("id")}u.once("afterRender",e.bind(function(e,t){var n=t.element,i=n,a=d.tauBubble({content:i,onPositionConfig:function(e){return e.my="center top",e.at="center bottom",e.collision="flip flip",e},zIndex:10002});this.fire("$requestBubbled.ready",a),u.fire("$outerBubbled.ready",a)},this)),u.on("entitySelected",e.bind(function(e,t){this.fire("request.selected",t.entity)},this)),u.initialize({context:a.config.context}),s.getStore().unbind(this),s.getStore().on({type:"relation",eventName:"afterSave",listener:this,hasChanges:["slave"]},e.bind(function(e){var t=e.data.changes;t.slave.id==r.id&&u.fire("refresh")},this)),s.getStore().on({type:"relation",eventName:"afterRemove",listener:this},e.bind(function(){u.fire("refresh")},this))}},"bus configurator.ready:last + entity.ready:last + request.selected":function(t,n,i,a){n.getStore().save("relation",{fields:["id",{master:["id","name",{entityType:["id","name"]}]}],$set:{master:{id:a.id},slave:{id:i.id},relationType:{id:3}}}).done(e.bind(function(){n.getStore().evictProperties(i.id,i.entityType.name,["masterRelations","slaveRelations"]),this.fire("requestWasAttachedToEntity",{entity:i})},this))},"bus $bubbled.ready:last + $requestBubbled.ready:last + requestWasAttachedToEntity":function(e,t,n){n.tauBubble("hide"),t.tauBubble("hide")},"bus configurator.ready:last + destroy":function(e,t){t.getStore().unbind(this)}})});