define(["Underscore","jQuery","tau/core/event.emitter","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tau/components/extensions/print.convert.extension"],function(_,$,EventEmitter,ProgressIndicator,PrintExtension){return EventEmitter.extend({init:function(config){this._super(config),this.config=config},"bus afterRender:last+innerContentRendered":function(e){var hostElement=e.afterRender.data.element,pageElement=e.innerContentRendered.data.element,classToAdd="",classToDel="";pageElement.hasClass("tau-board-container")?(classToAdd="tau-page-board",classToDel="tau-page-entity"):(classToAdd="tau-page-entity",classToDel="tau-page-board"),hostElement.removeClass(classToDel).addClass(classToAdd).empty().append(pageElement)},"bus afterRender:last+view.dom.ready:last+innerContentRendered":function(e){this.current.fire("view.dom.ready",_.values(e)[1].data)},"bus application.navigate.board":function(evt){this.executeAction({strategy:"board",action:"actionBoard",parameters:evt.data})},"bus application.navigate.entity":function(evt){var args=evt.data,actionName="action"+(args.action||"show").toLocaleLowerCase();actionName=this.hasOwnProperty(actionName)?actionName:"actionshow";var params=this.castEntityParams(args);this.executeAction({strategy:"entity",action:actionName,parameters:params})},castEntityParams:function(params){return{id:params.id?parseInt(params.id):null,entity:params.entity}},executeAction:function(config){var self=this;require(["tau/components/component.page."+config.strategy],function(ComponentModule){var actionName=config.action,parameters=config.parameters;self.fire("controller.preExecute",{action:actionName,parameters:parameters}),self[actionName](ComponentModule,parameters.id,parameters.entity),self.fire("controller.postExecute")})},actionBoard:function(ComponentModule,id){var self=this;if(self.current){var currentRef=self.current;currentRef.fire("destroy")}var appConfig=self._getItemConfig(id,"board"),newCurrent=ComponentModule.create(appConfig);self.current=newCurrent,newCurrent.on("error",function(e){self.fire("application.error")}),newCurrent.on("afterRender",function(e){self.fire("innerContentRendered",{element:e.data.element})}),newCurrent.on("componentsCreated",function(e){self.fire("componentsCreated",e.data)}),newCurrent.initialize()},_getItemConfig:function(id,type){var entity={id:id,type:type};return{context:{configurator:this.config.context.configurator,entity:entity},entity:entity}},actionshow:function(ComponentModule,id,entity){this._action(ComponentModule,id,entity),$("html").toggleClass("tau-html_action_view",!0).toggleClass("tau-html_action_print",!1)},actionprint:function(ComponentModule,id,entity){this._action(ComponentModule,id,entity,{extensions:[PrintExtension]}),$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!0),$("body").addClass("print-mode")},_action:function(ComponentModule,id,entity,componentConfig){$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!1),this.current&&this.current.fire("destroy");var self=this;this.current=ComponentModule.create(this._getItemConfig(id,entity),componentConfig||{}),this.current.on("beforeDelete",function(e){self.fire("initProgress")}),this.current.on("deleted",function(e){var configurator=self.config.context.configurator,history=configurator.getHistory(),redirect=configurator.getRedirect(),item=history.pop();item?(history.setCurrent(null),redirect.redirect(item.url)):self.fire("application.exit")}),this.current.on("error",function(e){self.fire("application.error",e.data)}),this.current.on("afterRender",function(e){self.fire("innerContentRendered",{element:e.data.element})}),this.current.initialize()},destroy:function(){this._super(),this.current&&this.current.fire("destroy"),delete this.current,delete this.config}})})