define(["Underscore","jQuery","tau/core/class","tau/utils/timeline/utils.timeline.date-range","tau/services/boards/view.types","tau/services/customReport/service.customReport.settings.wrapper"],function(e,t,r,i,n,a){return r.extend({init:function(t,r){this.serviceContainer=t,this.storage=t.getRestStorage(),this._viewsMenuService=t.getViewsMenuService(),this._reportSettingsWrapper=new a,this.options=e.defaults(r||{},{groupName:"boards"})},getLoggedUser:function(){return this.serviceContainer.getLoggedUser()},createDefault:function(e){var t=new Date;switch(e){case n.DASHBOARD:return this._createDefaultDashboardData();case n.REPORT:return this._createDefaultReportData();default:return{name:"New View",zoomLevel:{board:3},viewMode:"board",hierarchyMode:"inside",groupName:this.options.groupName,createdAt:t.toGMTString(),isDraft:!0,edit:!1,ownerIds:[],isShared:!1,menuIsVisible:!0,menuNumericPriority:t.getTime(),prioritization:{mode:"shift"},cells:{types:[],filter:"",useFilter:!1},timelineSettings:{showPlannedInPast:!1,showForecast:!0},timelineGlobalDateRange:i.createDefault().toISOString()}}},_createDefaultReportData:function(){var e=new Date,t=this.getLoggedUser();return{name:"New Report",createdAt:e.toGMTString(),ownerIds:[t.id],isShared:!1,menuIsVisible:!0,edit:!0,isDraft:!0,menuNumericPriority:e.getTime(),reportSettings:this._reportSettingsWrapper.getEmpty()}},_createDefaultGroupData:function(){var e=new Date;return{name:"New Group",createdAt:e.toGMTString(),isShared:!1,menuIsVisible:!0,menuNumericPriority:e.getTime()}},createByOwner:function(t){if(!e.isObject(t))throw new Error("Should be owner");var r=this.createDefault();return r.ownerIds=[t.id],r.edit=!0,r},createForLoggedUser:function(){return this.createByOwner(this.getLoggedUser())},createBoard:function(t){t=t||this.createForLoggedUser();var r=e.clone(t);return r.menuIsVisible=!0,this._viewsMenuService.viewsApi.createBoard(r).then(function(e){return t.id=e.data.key,t})},createDashboard:function(){var e=this._createDefaultDashboardData();
return e.layout={id:"columns",columns:[{widgets:[]},{widgets:[]}]},this._viewsMenuService.viewsApi.createDashboard(e).then(function(t){return e.id=t.data.key,e})},_createDefaultDashboardData:function(){var e=new Date,t=this.getLoggedUser();return{name:"New Dashboard",createdAt:e.toGMTString(),ownerIds:[t.id],edit:!0,isDraft:!0,isShared:!1,menuIsVisible:!0,menuNumericPriority:e.getTime()}},createReport:function(){var e=this._createDefaultReportData();return this._viewsMenuService.viewsApi.createReport(e).then(function(t){return e.id=t.data.key,e})},createViewGroup:function(t){var r=e.defaults(e.deepClone(t)||{},this._createDefaultGroupData());return this._viewsMenuService.groupsApi.createViewMenuItem(r)},cloneDefinition:function(t,r){return this.getById(t).then(function(t){var i=["x","y","cells","limits","zoomLevel","viewMode","prioritization","cardSettings","timelineLocalDateRange","timelineGlobalDateRange","timelineSettings"],n=this.createDefault(t.itemType),a=e.pick(e.deepClone(t),i,r);return e.extend(n,a,{isShared:!1,ownerIds:[this.getLoggedUser().id],name:t.name+" Cloned",edit:!0})}.bind(this))},findDefault:function(){return this._viewsMenuService.getViewsMenuForUser().then(function(t){return e.chain(t).flatMap(function(e){return e.getBoardsInSection()}).map(e.property("storedViewData")).filter(e.property("menuIsVisible")).first().value()})},findLast:function(e){var r=t.Deferred();return this._viewsMenuService.viewsApi.getViewMenuItem(e).done(function(e){var t=e.data||{};t&&(t.id=t.key),r.resolve(t)}).fail(function(){r.resolve(null)}),r.promise()},getById:function(e){return this._viewsMenuService.viewsApi.getViewMenuItem(e).then(function(e){var t=e.data||{};return t.id=t.key,t}.bind(this))}})});