define(["require","Underscore","tau/core/class","tau/utils/timeline/utils.timeline.date-range","tau/services/boards/view.types","tau/services/customReport/service.customReport.settings.wrapper"],function(e){var t=e("Underscore"),r=e("tau/core/class"),i=e("tau/utils/timeline/utils.timeline.date-range"),a=e("tau/services/boards/view.types"),n=e("tau/services/customReport/service.customReport.settings.wrapper");return r.extend({init:function(e,r){this.serviceContainer=e,this.storage=e.getRestStorage(),this._viewsMenuService=e.getViewsMenuService(),this._reportSettingsWrapper=new n,this.options=t.defaults(r||{},{groupName:"boards"})},getLoggedUser:function(){return this.serviceContainer.getLoggedUser()},createDefault:function(e){var t=new Date;switch(e){case a.DASHBOARD:return this._createDefaultDashboardData();case a.REPORT:return this._createDefaultReportData();default:return{name:"New View",zoomLevel:{board:3},viewMode:"board",hierarchyMode:"inside",groupName:this.options.groupName,createdAt:t.toGMTString(),isDraft:!0,edit:!1,ownerIds:[],isShared:!1,menuIsVisible:!0,menuNumericPriority:t.getTime(),prioritization:{mode:"shift"},cells:{types:[],filter:"",useFilter:!1},timelineSettings:{showPlannedInPast:!1,showForecast:!0,showMilestones:!0},timelineGlobalDateRange:i.createDefault().toISOString()}}},_createDefaultReportData:function(){var e=new Date,t=this.getLoggedUser();return{acid:"",name:"New Report",createdAt:e.toGMTString(),ownerIds:[t.id],isShared:!1,menuIsVisible:!0,edit:!0,isDraft:!0,menuNumericPriority:e.getTime(),reportSettings:this._reportSettingsWrapper.getEmpty()}},_createDefaultGroupData:function(){var e=new Date;return{name:"New Group",createdAt:e.toGMTString(),isShared:!1,menuIsVisible:!0,menuNumericPriority:e.getTime()}},createByOwner:function(e){if(!t.isObject(e))throw new Error("Should be owner");var r=this.createDefault();return r.ownerIds=[e.id],r.edit=!0,r},createForLoggedUser:function(){return this.createByOwner(this.getLoggedUser())},createBoard:function(e){e=e||this.createForLoggedUser();
var r=t.clone(e);return r.menuIsVisible=!0,this._viewsMenuService.viewsApi.createBoard(r).then(function(t){return e.id=t.data.key,e})},createDashboard:function(){var e=this._createDefaultDashboardData();return e.layout={id:"columns",columns:[{widgets:[]},{widgets:[]}]},this._viewsMenuService.viewsApi.createDashboard(e).then(function(t){return e.id=t.data.key,e})},_createDefaultDashboardData:function(){var e=new Date,t=this.getLoggedUser();return{name:"New Dashboard",createdAt:e.toGMTString(),ownerIds:[t.id],edit:!0,isDraft:!0,isShared:!1,menuIsVisible:!0,menuNumericPriority:e.getTime()}},createReport:function(){var e=this._createDefaultReportData();return this._viewsMenuService.viewsApi.createReport(e).then(function(t){return e.id=t.data.key,e})},createViewGroup:function(e){var r=t.defaults(t.deepClone(e)||{},this._createDefaultGroupData());return this._viewsMenuService.groupsApi.createViewMenuItem(r)},cloneDefinition:function(e,r){return this.getById(e).then(function(e){var i=["x","y","cells","limits","zoomLevel","viewMode","prioritization","cardSettings","timelineLocalDateRange","timelineGlobalDateRange","timelineSettings"],a=this.createDefault(e.itemType),n=t.pick(t.deepClone(e),i,r);return t.extend(a,n,{isShared:!1,ownerIds:[this.getLoggedUser().id],name:e.name+" Cloned",edit:!0})}.bind(this))},getById:function(e){return this._viewsMenuService.viewsApi.getViewMenuItem(e).then(function(e){var t=e.data||{};return t.id=t.key,t}.bind(this))}})});