define(["Underscore","tau/models/model.extension","tau/models/model.impedimentsCountCalculator","tau/models/model.duplicateBugCountCalculator","tau/models/model.duplicateBugRetriever","tau/components/extensions/impedimentList/extension.impedimentList.visibilityController","tau/components/extensions/duplicateBugList/extension.duplicateBugList.visibilityController","tau/models/assignmentsList/extension.model.store.operations","tau/core/termProcessor"],function(_,ModelBase,ImpedimentsCountCalculator,DuplicateBugCountCalculator,DuplicateBugRetriever,VisibilityController,DuplicateBugVisibilityController,StoreOperations,TermProcessor){var actions={impedimentListPanel:function(item,context){var tp=new TermProcessor(context.getTerms());return _.extend(item,{compId:"impediments",type:"container",layout:"list",cssClass:"b-section",disableAnimation:!0,children:[{type:"label",text:tp.getTerms("Impediment").names,hideCounter:!0},{type:"impedimentList",disableModel:!0}],extensions:[VisibilityController,ImpedimentsCountCalculator,StoreOperations]}),item},duplicateBugListPanel:function(item,context){var tp=new TermProcessor(context.getTerms());return _.extend(item,{compId:"duplicateBugs",type:"container",layout:"list",cssClass:"b-section",disableAnimation:!0,children:[{type:"label",text:"Duplicate "+tp.getTerms("Bug").names,hideCounter:!0},{type:"duplicateBugList",disableModel:!0}],extensions:[DuplicateBugVisibilityController,DuplicateBugRetriever,DuplicateBugCountCalculator,StoreOperations]}),item},tabs:function(item){item=_.extend(item,{type:"container",children:[],cssClass:"b-tabs"});var children=[];return _.forEach(item.tabs,function(tab,key){var isSource=!1;tab=_.extend(tab,{type:"container",children:tab.items,cssClass:"b-tab"}),isSource=!_.isUndefined(tab.children)&&tab.children.length&&tab.children[0].type==="revisionList";if(isSource)return;!_.isUndefined(tab.header)&&tab.header.length&&tab.children.unshift({type:"label",text:tab.header[0].text}),item.children.push(tab)}),item},collapsible:function(item){return item=_.extend(item,{type:"container",children:[],cssClass:"b-section"}),item.children=item.items,!_.isUndefined(item.header)&&item.header.length&&item.children.unshift({type:"label",text:item.header[0].text}),item}},liveEach=function(target,iterator){var fnCut=null;if(_.isArray(target)){var i=0;fnCut=function(key){target.splice(key,1),i--};for(i=0;i<target.length;i++)iterator(target[i],i,fnCut)}else{fnCut=function(key){delete target[key]};var targetKeys=_(target).keys(),iterationKey=null;while(iterationKey=targetKeys.pop())iterator(target[iterationKey],iterationKey,fnCut)}},convertConfig=function(config,context){return liveEach(config,function(item,key,fnCut){if(item.type){if(item.printable===!1){fnCut(key);return}_.isFunction(actions[item.type])&&(config[key]=actions[item.type](item,context)),item.children&&(config[key].children=convertConfig(item.children,context)),item.items&&(config[key].items=convertConfig(item.items,context)),config[key].disabledExtensionCategories=["edit"]}else key=="children"&&(config[key]=convertConfig(item,context))}),config};return{convert:function(config){return config=convertConfig(config,config.context),config.children&&config.children.length&&(config.children[0].cssClass="main-container main-container-print i-print"),config}}})