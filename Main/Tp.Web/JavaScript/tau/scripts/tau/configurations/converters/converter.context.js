define(["Underscore"],function(a){var b=function(b,c){var d=[],e=[];a.forEach(b,function(a){a[0]=="~"?d.push(a.slice(1)):e.push(a)});var f=!0;e.length&&(f=a.intersect(c,e).length>0);var g=!1;return d.length&&(g=a.intersect(c,d).length>0),f&&!g?!0:!1},c=function(d,e,f){return a.forEach(d,function(g,h){if(g.type=="tabs")a.forEach(g.tabs,function(a,b){a.header=c(a.header,e,f),g.tabs[b].items=c(a.items,e,f),g.tabs[b].items.length==0&&(g.tabs[b]=!1)}),g.tabs=a.filter(g.tabs,function(a,b){return a!==!1}),g.additionalHeaders=c(g.additionalHeaders,e,f),g.tabs.length==0&&(d[h]=!1);else if(g.type=="additionalInfo")g.children=c(g.children,e,f),g.children.length==0&&(d[h]=!1);else if(g.type=="label"&&a.isArray(g.text))g.text=c(g.text,e,f),g.text.length==0?d[h]=!1:d[h]=g;else if(g.practices)g.practices.length&&b(g.practices,e)==0&&(d[h]=!1);else if(g.editions)g.editions.length&&b(g.editions,f)==0&&(d[h]=!1);else if(g.children)d[h].children=c(g.children,e,f);else if(typeof g.items!="undefined")d[h].items=c(g.items,e,f),g.items.length==0&&(d[h]=!1);else if(h=="children"||h=="items")d[h]=c(g,e,f)}),d=a.filter(d,function(a,b){return a!==!1}),d};return{convert:function(a,b,d){return a=c(a,b,d),a}}})