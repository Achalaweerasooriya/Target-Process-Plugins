define(["Underscore"],function(_){var isMatch=function(itemData,configData){var excluded=[],included=[];_.forEach(itemData,function(conf){conf[0]=="~"?excluded.push(conf.slice(1)):included.push(conf)});var hasIncluded=!0;included.length&&(hasIncluded=_.intersect(configData,included).length>0);var hasExcluded=!1;return excluded.length&&(hasExcluded=_.intersect(configData,excluded).length>0),hasIncluded&&!hasExcluded},convertConfig=function(config,practices,editions){return _.forEach(config,function(item,key){if(item.type=="tabs")_.forEach(item.tabs,function(tab,tabKey){tab.header=convertConfig(tab.header,practices,editions),item.tabs[tabKey].items=convertConfig(tab.items,practices,editions),item.tabs[tabKey].items.length==0&&(item.tabs[tabKey]=!1)}),item.tabs=_.filter(item.tabs,function(item,key){return item!==!1}),item.additionalHeaders=convertConfig(item.additionalHeaders,practices,editions),item.tabs.length==0&&(config[key]=!1);else if(item.type=="additionalInfo")item.children=convertConfig(item.children,practices,editions),item.children.length==0&&(config[key]=!1);else if(item.type=="label"&&_.isArray(item.text))item.text=convertConfig(item.text,practices,editions),item.text.length==0?config[key]=!1:config[key]=item;else if(item.practices||item.editions){var matchPractices=item.practices&&item.practices.length&&!isMatch(item.practices,practices),matchEditions=item.editions&&item.editions.length&&!isMatch(item.editions,editions);if(matchPractices||matchEditions)config[key]=!1}else if(item.children)config[key].children=convertConfig(item.children,practices,editions);else if(typeof item.items!="undefined")config[key].items=convertConfig(item.items,practices,editions),item.items.length==0&&(config[key]=!1);else if(key=="children"||key=="items")config[key]=convertConfig(item,practices,editions)}),config=_.filter(config,function(item,key){return item!==!1}),config};return{convert:function(config,practices,editions){return config=convertConfig(config,practices,editions),config}}})