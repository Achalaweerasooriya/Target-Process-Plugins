define(["Underscore"],function(e){var t=function(t,n){var i=[],r=[];e.forEach(t,function(e){"~"==e[0]?i.push(e.slice(1)):r.push(e)});var s=!0;r.length&&(s=e.intersection(n,r).length>0);var a=!1;return i.length&&(a=e.intersection(n,i).length>0),s&&!a},n=function(i,r,s){return e.forEach(i,function(a,c){if("tabs"==a.type)e.forEach(a.tabs,function(e,t){e.header=n(e.header,r,s),a.tabs[t].items=n(e.items,r,s),0==a.tabs[t].items.length&&(a.tabs[t]=!1)}),a.tabs=e.filter(a.tabs,function(e){return e!==!1}),a.tabs=n(a.tabs,r,s),a.tabs=e.filter(a.tabs,function(e){return e!==!1}),a.additionalHeaders=n(a.additionalHeaders,r,s),0==a.tabs.length&&(i[c]=!1);else if("additionalInfo"==a.type)a.children=n(a.children,r,s),0==a.children.length&&(i[c]=!1);else if("label"==a.type&&e.isArray(a.text))a.text=n(a.text,r,s),i[c]=0==a.text.length?!1:a;else if(a.practices||a.editions){var l=a.practices&&a.practices.length&&!t(a.practices,r),o=a.editions&&a.editions.length&&!t(a.editions,s);(l||o)&&(i[c]=!1)}else a.children?i[c].children=n(a.children,r,s):"undefined"!=typeof a.items?(i[c].items=n(a.items,r,s),0==a.items.length&&(i[c]=!1)):("children"==c||"items"==c)&&(i[c]=n(a,r,s))}),i=e.filter(i,function(e){return e!==!1})};return{convert:function(e,t,i){return n(e,t,i)}}});