define(["Underscore"],function(_){var a=function(a,b){var c=[],d=[];_.forEach(a,function(a){a[0]=="~"?c.push(a.slice(1)):d.push(a)});var e=!0;d.length&&(e=_.intersect(b,d).length>0);var f=!1;return c.length&&(f=_.intersect(b,c).length>0),e&&!f?!0:!1},b=function(c,d,e){return _.forEach(c,function(f,g){if(f.type=="tabs")_.forEach(f.tabs,function(a,c){a.header=b(a.header,d,e),f.tabs[c].items=b(a.items,d,e),f.tabs[c].items.length==0&&(f.tabs[c]=!1)}),f.tabs=_.filter(f.tabs,function(a,b){return a!==!1}),f.additionalHeaders=b(f.additionalHeaders,d,e),f.tabs.length==0&&(c[g]=!1);else if(f.type=="additionalInfo")f.children=b(f.children,d,e),f.children.length==0&&(c[g]=!1);else if(f.type=="label"&&_.isArray(f.text))f.text=b(f.text,d,e),f.text.length==0?c[g]=!1:c[g]=f;else if(f.practices)f.practices.length&&a(f.practices,d)==0&&(c[g]=!1);else if(f.editions)f.editions.length&&a(f.editions,e)==0&&(c[g]=!1);else if(f.children)c[g].children=b(f.children,d,e);else if(typeof f.items!="undefined")c[g].items=b(f.items,d,e),f.items.length==0&&(c[g]=!1);else if(g=="children"||g=="items")c[g]=b(f,d,e)}),c=_.filter(c,function(a,b){return a!==!1}),c};return{convert:function(a,c,d){return a=b(a,c,d),a}}})