define(["Underscore","tau/core/class"],function(t,e){return e.extend({_typeDefaults:{string:""},_containerType:"container",init:function(t){this._context={features:t.context.configurator.getFeaturesService(),mode:t.mode,entityType:t.context.entity.entityType.name.toLowerCase(),isBoard:t.context.configurator.isBoardEdition}},children:function(t){return this.collection(t)},containers:function(t){return this._filterCollection(t,[this._matchContextSpec,this._isNotEmptyContainerSpec])},valueOrDefault:function(t){return this._matchContextSpec(t)?t.value:t.hasOwnProperty("default")?t["default"]:this._default(t.value)},collection:function(t){return this._filterCollection(t,[this._matchContextSpec])},_filterCollection:function(e,n){var i=t.isArray(e),o=i?[]:{},c=i?this._collectArray:this._collectObject;return t.each(e,function(t,e){this._specsAreSatisfiedByItem(n,t)&&c(o,t,e)},this),o},_collectArray:function(t,e){t.push(e)},_collectObject:function(t,e,n){t[n]=e},_specsAreSatisfiedByItem:function(e,n){return t.every(e,function(t){return t.call(this,n)},this)},_matchContextSpec:function(t){return!(t.enabledIf&&!this._matchContextSubSpec(t.enabledIf)||t.disabledIf&&this._matchContextSubSpec(t.disabledIf))},_matchContextSubSpec:function(e){return!(e.feature&&!this._context.features.isEnabled(e.feature)||e.modeIn&&!t.contains(e.modeIn,this._context.mode)||e.entityTypeIn&&!t.contains(e.entityTypeIn,this._context.entityType)||e.isBoard&&e.isBoard!==this._context.isBoard)},_isNotEmptyContainerSpec:function(t){return t.type.toLowerCase()===this._containerType&&t.children&&t.children.length>0},_default:function(t){return this._typeDefaults[typeof t]}})});