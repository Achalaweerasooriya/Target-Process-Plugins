define(["Underscore","tau/core/class","tau/core/termProcessor","tau/utils/utils.urlBuilder","tau/components/extensions/comments/extensions.comments.refresher"],function(a,b,c,d,e){var f=b.extend({init:function(a){var b=a.context.getTerms();this.termProcessor=new c(b),this.collections={};var f=a.context.entity;this.registerAction("Old View",{label:"Old View",url:d.getViewUrl(f.id)}),this.registerAction("Old Edit",{label:"Old Edit",url:d.getEditUrl(f.id,f.entityType.name)}),this.registerAction("Print",{label:"Print View",command:function(a){a.redirectTo(d.getPrintUrlRelative(f.id,f.entityType.name),"_blank")}}),this.registerAction("-----","-----"),this.registerAction("Delete",{label:"Delete",confirmation:"Are you sure?",command:function(a){a.removeEntity()},className:"ui-menu__item-action-delete"}),this.registerAction("Move or Copy",{label:"Move or Copy",command:function(a){a.moveOrCopy()}}),this.registerAction("Convert",{label:"Convert",command:function(a){a.convert()}}),this.registerAction("Attach to Request",{label:"Attach To "+this.getTermName("Request"),command:function(a){a.attachToRequest()},editions:["Pro"]}),this.registerAction("Add Impediment",{label:"Add "+this.getTermName("Impediment"),url:d.getAddImpedimentUrl(f.id)}),this.registerAdditionalInfoItem("Owner",{label:{type:"label",text:"Owner"},field:{type:"property.owner"}}),this.registerAdditionalInfoItem("Assigned Effort",{label:{type:"label",text:"Assigned Effort"},field:{type:"assignedEffort"}}),this.registerAdditionalInfoItem("Velocity",{label:{type:"label",text:"Velocity"},field:{type:"property.velocity"}}),this.registerAdditionalInfoItem("State",{label:{type:"label",text:"State"},field:{type:"property.entityState"}}),this.registerAdditionalInfoItem("Test Plan",{label:{type:"label",text:this.getTermName("TestPlan")},field:{type:"property.testPlan"}}),this.registerAdditionalInfoItem("Responsible",{label:{type:"label",text:"Responsible"},field:{type:"property.responsible"}}),this.registerAdditionalInfoItem("IsPrivate",{label:{type:"label",text:"Private?"},field:{type:"property.isPrivate"}}),this.registerAdditionalInfoItem("LastFailureComment",{label:{type:"label",text:"Last Failure Comment"},field:{type:"property.lastFailureComment"}}),this.registerAdditionalInfoItem("Release",{label:{type:"label",text:this.getTermName("Release")},field:{type:"property.release"},practices:["Planning"]}),this.registerAdditionalInfoItem("ImpedimentDate",{label:{type:"label",text:"Creation Date"},field:{type:"property.impedimentDate"}}),this.registerAdditionalInfoItem("CreationDate",{label:{type:"label",text:"Creation Date"},field:{type:"property.createDate"}}),this.registerAdditionalInfoItem("FinishDate",{label:{type:"label",text:"Finish  Date"},field:{type:"property.completeDate",editable:!0}}),this.registerAdditionalInfoItem("StartDate",{label:{type:"label",text:"Start Date"},field:{type:"property.startDate",editable:!0}}),this.registerAdditionalInfoItem("ResolvedOn",{label:{type:"label",text:"Resolved On"},field:{type:"property.completeDate"}}),this.registerAdditionalInfoItem("CompletionDate",{label:{type:"label",text:"Completion  Date"},field:{type:"property.completeDate"}}),this.registerAdditionalInfoItem("Iteration",{label:{type:"label",text:this.getTermName("Iteration")},field:{type:"property.iteration"},practices:["Iterations"]}),this.registerAdditionalInfoItem("Project",{label:{type:"label",text:this.getTermName("Project")},field:{type:"property.project"}}),this.registerAdditionalInfoItem("Priority",{label:{type:"label",text:this.getTermName("Priority")},field:{type:"property.priority"},practices:["Planning"]}),this.registerAdditionalInfoItem("Business Value",{label:{type:"label",text:"Business Value"},field:{type:"property.priority"},practices:["Planning"]}),this.registerAdditionalInfoItem("Initial Estimate",{label:{type:"label",text:"Initial Estimate"},field:{type:"property.initialEstimate"},practices:["Planning"]}),this.registerAdditionalInfoItem("Feature",{label:{type:"label",text:this.getTermName("Feature")},field:{type:"property.feature"},practices:["Requirements"]}),this.registerAdditionalInfoItem("User Story",{label:{type:"label",text:this.getTermName("userStory")},field:{type:"property.userStory"}}),this.registerAdditionalInfoItem("Assignable",{label:{type:"label",text:this.getTermName("Assignable")},field:{type:"property.assignable"}}),this.registerAdditionalInfoItem("Build",{label:{type:"label",text:this.getTermName("build")},field:{type:"property.build"}}),this.registerAdditionalInfoItem("Last Status",{label:{type:"label",text:"Last Status"},field:{type:"property.lastStatus"}}),this.registerAdditionalInfoItem("Last Run Date",{label:{type:"label",text:"Last Run Date"},field:{type:"property.lastRunDate"}}),this.registerAdditionalInfoItem("User Story For Task",{label:{type:"label",text:this.getTermName("userStory")},field:{type:"property.userStory",resetDisabled:!0}}),this.registerAdditionalInfoItem("Severity",{label:{type:"label",text:this.getTermName("Severity")},field:{type:"property.severity"},practices:["Planning"]}),this.registerTab("Description",{selected:!0,label:"description",header:[{type:"label",text:"Description"}],items:[{type:"tags"},{type:"container",name:"description container",cssClass:"ui-sub-control",children:[{type:"description"}]},this._buildRichTextCustomFieldsSummary(a),{type:"attachments"},{type:"label",text:"Comments",cssClass:"ui-ctrl-title"},{type:"container",name:"comments container",cssClass:"ui-sub-control",children:[{type:"comments",extensions:[e]}]}]}),this.registerTab("Track",{label:"track",header:[{type:"label",text:"Track"}],items:[{type:"audit.history"}],printable:!1}),this.registerTab("Flow",{label:"implementationHistory",printable:!1,header:[{type:"label",text:"Flow"}],items:[{type:"implementationHistory"}]}),this.registerPanel("Additional Info",{type:"collapsible",name:"additional info container",collapsed:!1,header:[{type:"label",text:"Info"}],items:[{type:"additionalInfo",children:this.getAdditionalInfoItems(a)}]});var g=this._buildCustomFieldsSummary(a);g.length&&this.registerPanel("Custom Fields",{type:"collapsible",name:"custom fields collapsible",collapsed:!1,header:[{type:"label",text:"Custom Fields"}],items:g}),window.appIsInDebugMode===!0&&this.registerPanel("Diagnostic",{type:"collapsible",name:"diagnostics container",printable:!1,collapsed:!0,header:[{type:"diagnostics"}],items:[{type:"collapsible",collapsed:!0,header:[{type:"label",text:"Global Bus Listeners"}],items:[{type:"diagnostics.globalListeners"}]},{type:"collapsible",collapsed:!0,header:[{type:"label",text:"Store Listeners"}],items:[{type:"diagnostics.store"}]}]}),this.registerPanel("Look Switcher",{type:"lookswitcher",printable:!1})},getCollection:function(a){var b={};return a in this.collections||(this.collections[a]={}),b=this.collections[a],b},addToCollection:function(a,b,c){var d=this.getCollection(a);return d[b]=c,this},registerAction:function(a,b){this.addToCollection("actions",a,b)},getActions:function(b){var c=this.getActionsAliases(),d=this.getCollection("actions"),e=[];return a.forEach(c,function(a){a in d?e.push(d[a]):e.push({label:"--"+a,command:function(){alert("Still working on it")}})}),e},getActionsAliases:function(){return["Old View","Old Edit","Print","-----","Delete"]},registerAdditionalInfoItem:function(b,c){c.field&&a.defaults(c.field,{name:b+" "+c.field.type}),c.label&&a.defaults(c.label,{name:b+" "+c.label.type}),this.addToCollection("additionalInfo",b,c)},getAdditionalInfoItems:function(b){var c=this.getAdditionalInfoAliases(),d=this.getCollection("additionalInfo"),e=[];return a.forEach(c,function(a){a in d&&e.push(d[a])}),e},getAdditionalInfoAliases:function(){return[]},registerTab:function(a,b){this.addToCollection("tabs",a,b)},getTabs:function(b){var c=this.getTabsAliases(),d=this.getCollection("tabs"),e=[];return a.forEach(c,function(a){a in d&&e.push(d[a])}),e},getTabsAliases:function(){return["Description"]},registerPanel:function(a,b){this.addToCollection("panels",a,b)},getPanels:function(b){var c=this.getPanelsAliases(),d=this.getCollection("panels"),e=[],f=this;return a.forEach(c,function(a){a in d&&(a=="Additional Info"&&(d[a].items[0].children=f.getAdditionalInfoItems(b)),e.push(d[a]))}),e},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Additional Info","Custom Fields"]},_buildCustomFieldsSummary:function(b){var c=b.context,d=c.getCustomFields(),e=c.entity.entityType.name.toLowerCase(),f=a(d).select(function(a){return e===a.entityKind.toLowerCase()&&a.type.toLowerCase()!=="richtext"}),g=[];for(var h=0;h<f.length;h++){var i=f[h],j=i.type.toLowerCase();j==="multipleselectionlist"&&(j="multiselect"),g.push({type:"customField."+j,customField:i})}return g},_buildRichTextCustomFieldsSummary:function(b){var c=b.context,d=c.getCustomFields(),e=c.entity.entityType.name.toLowerCase(),f=a(d).select(function(a){return e===a.entityKind.toLowerCase()&&a.type.toLowerCase()==="richtext"}),g={type:"container",name:"custom fields container",visible:f.length>0,children:[]};for(var h=0;h<f.length;h++){var i=f[h];g.children.push({type:"label",text:i.name,cssClass:"ui-ctrl-title"}),g.children.push({type:"container",name:"custom field container for "+i.type.toLowerCase(),cssClass:"ui-sub-control",children:[{type:"customField."+i.type.toLowerCase(),customField:i}]})}return g},getNames:function(a){return this.termProcessor.getTerms(a).names},getTermName:function(a){return this.termProcessor.getTerms(a).name},getConfig:function(a){var b=a.context.getTerms();return this.termProcessor=new c(b),{children:[{type:"container",name:"main entity container",layout:"table",cssClass:"main-container",cellsCssClass:["general-info","additional-info"],children:[{type:"container",name:"general info column container",layout:"list",children:[{type:"breadcrumbs"},{type:"title"},{type:"tabs",cssClass:"tau-tabs",tabs:this.getTabs(a),additionalHeaders:[{type:"menu.actions",items:this.getActions(a)}]}]},{type:"container",name:"additional info column container",layout:"list",children:this.getPanels(a)}]}]}}});return f})