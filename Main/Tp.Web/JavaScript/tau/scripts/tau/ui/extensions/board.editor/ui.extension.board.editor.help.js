define(["jQuery","tau/components/extensions/component.extension.base","Underscore","tau/ui/templates/board.editor/ui.template.board.editor.filterHelp","tp/codemirror/lib/codemirror","tp/codemirror.stylesheet","tp/codemirror/lib/util/runmode","tp/codemirror/mode/python/python"],function($,ExtensionBase,_,template,CodeMirror){return ExtensionBase.extend({"bus content.ready:last + refresh.help.content":function(evt,contentElements,helpData){var self=this,t=template.get();_.each(contentElements,function($content){_.each(_.keys(helpData),function(name){var elements=$content.find("[role="+name+"_help]");if(elements.length){var $newContent=t.bind({},{name:"rebind",predefinedFilters:helpData[name]});elements.find("table").remove(),elements.append($newContent.find("table")),self.fire("content.$element.ready",elements.parent())}})})},"bus afterRender:last + content.$element.ready":function(evt,data,$content){var $examples=$(".i-role-complex-filter-example",$content),filterType=$(".filter-help",$content).attr("role")+"_button",$helpButton=$("."+filterType,data.element);$examples.length>0?$helpButton.show():$helpButton.hide()},"bus afterRender":function(evt){var self=this,$element=evt.data.element,content=[];$element.find(".i-role-help").each(function(){var $helpEl=$(this),$relatedInput=$helpEl.parent().find(":text"),$content=$helpEl.next(".i-role-help-content").detach();$content.show(),content.push($content),$content.delegate(".i-role-predefined-filter","click",function(){var v=$(this).data("value");$helpEl.tauBubble("hide"),$relatedInput.focus(),setTimeout(function(){$relatedInput.val(v)},1)}),self.fire("content.$element.ready",$content),$helpEl.tauBubble({content:$content,zIndex:999,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow" role="arrow"></div>','<div class="tau-bubble-board__inner tau-container" role="content"></div>',"</div>"].join(""),onResize:function($popup,data){var h=data.height;$popup.find("[role=content]").css({maxHeight:h-20,overflowY:"auto"})},onShow:function($popup){$popup.find(".i-role-output-filter").each(function(){var $output=$(this);$output.data("processed")||(CodeMirror.runMode($output.text(),"python",this),$output.data("processed",!0))})}})}),self.fire("content.ready",content)}})})