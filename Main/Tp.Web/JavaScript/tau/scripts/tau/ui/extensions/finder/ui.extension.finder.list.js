define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/templates/finder/ui.template.finder.resultList"],function(_,$,ExtensionBase,template){return ExtensionBase.extend({appendData:function($element,data){var self=this;self.getShowMoreElement($element).hide();var newElement=template.get().bind(self.config,data),message=data.emptyMessage||"";self._setNoResultsMessage($element,message);var rows=$(".tau-result-list>tbody>tr",newElement);rows.appendTo($(".ui-resultList>table>tbody",$element)),self.bus.fire("dataRendered",{element:$element})},_setScrollingMode:function($element,isAvailable){this.getList($element).data("noScrolling",!isAvailable)},_setNoResultsMessage:function($element,message){var $no=$(".tau-no-results",$element);$no.text(message),message===""||_.isNull(message)||_.isUndefined(message)?$no.hide():$no.show()},"bus elementReady+dataLoaded":function(evt){var $element=evt.elementReady.data.element,data=evt.dataLoaded.data.data;this.appendData($element,data)},"bus dataRendered+nextPageAvailable":function(evt){var $element=evt.dataRendered.data.element;this._setScrollingMode($element,!0)},"bus search+dataLoaded":function(evt){var self=this,$element=evt.search.data.element;this.bus.fire("elementReady",{element:$element})},"bus loadMore+dataLoaded":function(evt){var self=this,$element=evt.loadMore.data.element;this.bus.fire("elementReady",{element:$element})},getList:function($element){return $(".ui-resultList",$element)},attachScrollingEvents:function($element){var self=this,$list=self.getList($element).scroll(function(evt){$list.data("noScrolling")!=1&&$list.scrollTop()+$list.innerHeight()>=$list[0].scrollHeight&&self.bus.fire("scrollToEnd",{element:$element})})},"bus search":function(evt){var $element=evt.data.element;$(".tau-result-list>tbody",$element).html(""),this.getShowMoreElement($element).show(),this._setNoResultsMessage($element,""),this._setScrollingMode($element,!1);var $list=this.getList($element);$list.prop({scrollTop:$list.get(0).scrollHeight})},_signUpOnActionsAndSelection:function($element){var self=this;self.getList($element).click(function(evt){var $row=$(evt.target).parents("tr.tau-result-list-row:first");if(!$row.data)return;var data=$row.data();if(!data)return;if(!data.tmplItem)return;data=data.tmplItem.data;if(!data)return;self.bus.fire("entitySelected",{entity:data})}),$(".action-link",$element).click(function(){var action=$(this).data().tmplItem.data;action.fn.call(self)})},"bus afterRender":function(evt){var $element=evt.data.element,self=this;self.bus.fire("elementReady",{element:$element}),self.attachScrollingEvents($element),self._setScrollingMode($element,!1),this._signUpOnActionsAndSelection($element)},getShowMoreElement:function($element){return $(".tau-resultList-load-more",$element)},"bus scrollToEnd+nextPageAvailable":function(evt){var self=this,$element=evt.scrollToEnd.data.element,$list=self.getList($element);self._setScrollingMode($element,!1),self.getShowMoreElement($element).show(),$list.prop({scrollTop:$list.get(0).scrollHeight}),self.bus.fire("loadMore",{element:$element})}})})