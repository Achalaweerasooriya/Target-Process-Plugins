define(["Underscore","tau/core/extension.base","tau/utils/utils.serverErrorTranslator"],function(t,a,e){return a.extend({"bus beforeInit":function(a,e){var r=e.config.context,i=r.entity,n=r.configurator.getStore();n.unbind(this),n.on({eventName:"failure",listener:this},t.bind(function(t){t.data.cmd.config.failureGlobal!==!1&&(i&&n.evictPersistedObject(i.id,i.type),this.onFailure(t))},this))},"bus beforeInit + destroy":function(t,a){var e=a.config.context.configurator.getStore();e.unbind(this)},onFailure:function(a){var r={};if(a.data&&a.data.data)if(a.data.data.Message)r=e.translateServerError.call(this,a.data.data);else{var i=a.data.data.response;if(i)if(t.isArray(i)){var n=[i[1]];t.isArray(i[4])&&i[4].length>0&&i[4][0]!=n[0]&&n.push(i[4][0]),r={message:n.join(":&nbsp;")}}else i.Message&&(r=e.translateServerError.call(this,i))}var s=0;a.data&&a.data.data&&(s=a.data.data.status||0),this.fire("error",r),(s>=400||0===s)&&this.fire("globalFailure"),a.data&&a.data.cmd&&0===s&&this.fire("destroy")}})});