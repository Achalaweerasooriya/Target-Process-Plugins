define(["Underscore","tau/core/extension.base","tau/libs/store2/store2","./jquery.tauTagsAutocomplete"],function(t,e,i){return e.extend({init:function(t,e,i){this.configurator=e,this.model=i,this._super(t)},"bus beforeInit":function(){$.when(this.model.load()).then(t.bind(function(){this.fire("dataBind",this.model)},this))},"bus afterRender":function(e,n){var o=n.element,l=o.find("input"),s=l.closest("li");this.toggleHolderFullWidth(s,!this.model.items.length),o.on("click",function(){l.focus()}),o.find("form").on("submit",!1),l.on({keydown:this._handleKeyDown.bind(this),input:this._handleInput.bind(this),keyup:this._handleInput.bind(this)}),l.tauTagsAutocomplete({store2:new i(this.configurator)}),o.on("click",".i-role-actiondelete",t.bind(function(t){this._removeTag($(t.currentTarget).parent()),l.tauTagsAutocomplete("close"),this.toggleHolderFullWidth(s,!1)},this))},_handleKeyDown:function(t){var e=$(t.target),i=e.closest("li"),n=e.val(),o=$.ui.keyCode;switch(t.keyCode){case o.ENTER:case o.NUMPAD_ENTER:var l=e.data("ui-tauTagsAutocomplete");l.menu.active||(e.tauTagsAutocomplete("close"),n?(e.val(""),this._fireChangeNotificationWith(function(){return this.model.addByString(n)}),this.toggleHolderFullWidth(i,!1)):this.fire("tags.inline.edit.finished"));break;case o.BACKSPACE:n||(this._removeTag(i.prev()),e.tauTagsAutocomplete("close")),this.toggleHolderFullWidth(i,n);break;default:this.toggleHolderFullWidth(i,n)}},_handleInput:function(t){var e=$(t.target),i=e.closest("li");this.toggleHolderFullWidth(i,e.val())},_removeTag:function(t){var e=t.attr("data-text");this._fireChangeNotificationWith(function(){return this.model.removeByString(e)})},_fireChangeNotificationWith:function(t){this.fire("tags.inline.changing"),$.when(t.call(this)).always(this.fire.bind(this,"tags.inline.changed"))},toggleHolderFullWidth:function(t,e){e=!!e,t.toggleClass("ui-tags__inputholder_line_end",!e).toggleClass("ui-tags__inputholder_line_full",e)}})});