define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(e,t,i){return i.extend({"bus beforeInit + afterRender":function(i,a,n){var r=n.element;this.fire("$el.ready",r);var s=r.find(".i-role-thumb");this.fire("$thumbs.ready",s),r.on("click",".i-role-thumb",e.bind(function(e){this.fire("thumb.selected",t(e.currentTarget).data("id"))},this)),r.on("click","a",e.bind(function(e){e.preventDefault(),e.stopPropagation()},this)),r.on("click",".toolbar .prev",e.bind(function(e){e.stopPropagation(),this.fire("prev")},this)),r.on("click",".toolbar .next",e.bind(function(e){e.stopPropagation(),this.fire("next")},this)),r.on("click",e.bind(function(e){t(e.target).is("img")||this.fire("close")},this));var o=a.config.context.configurator;this.fire("configurator.ready",o),s.length&&o.getKeyBoardManager().pushHandler({handleKeyDown:e.bind(function(e){e.keyCode==t.ui.keyCode.ESCAPE&&this.fire("close"),e.keyCode==t.ui.keyCode.LEFT&&this.fire("prev"),e.keyCode==t.ui.keyCode.RIGHT&&this.fire("next")},this)}),e.delay(e.bind(function(){this.fire("afterChangeImage")},this),100)},"bus $el.ready:last + $thumbs.ready:last + thumb.selected":function(t,i,a,n){var r=a.filter(".selected");if(n!=r.data("id")){a.toggleClass("selected",!1),r=a.filter("[data-id="+n+"]").toggleClass("selected",!0);var s=i.find(".ui-attachment-view-image");s.on("load",e.bind(function(){this.fire("afterChangeImage")},this)),s.attr("src",r.data("big-src"))}},"bus afterRender:last + afterChangeImage":function(e,t){var i=t.element,a=i.find(".ui-attachment-view-image");i.toggleClass("ui-attachments-preview-control_mode_full",!1),i.toggleClass("ui-attachments-preview-control_mode_short",!0),a.unbind("click.resize"),a.data("ui-draggable")&&(a.draggable("destroy"),a.css("position","static"));var n=a.parent().width(),r=a.parent().height();parseInt(a[0].naturalWidth,10)>n||parseInt(a[0].naturalHeight,10)>r?(a.toggleClass("ui-attachment-view-image_resize_true",!0),a.one("click.resize",function(){i.toggleClass("ui-attachments-preview-control_mode_full"),i.toggleClass("ui-attachments-preview-control_mode_short"),a.draggable()
})):a.toggleClass("ui-attachment-view-image_resize_true",!1)},"bus configurator.ready:last + $el.ready:last + $thumbs.ready:last + close":function(e,t,i,a){i.hide(),a.length&&t.getKeyBoardManager().popHandler(),this.fire("closed")},"bus $thumbs.ready:last + next":function(e,t){var i=t.index(t.filter(".selected"))+1;i>=t.length&&(i=0),this.fire("thumb.selected",t.eq(i).data("id"))},"bus $thumbs.ready:last + prev":function(e,t){var i=t.index(t.filter(".selected"))-1;0>i&&(i=t.length-1),this.fire("thumb.selected",t.eq(i).data("id"))}})});