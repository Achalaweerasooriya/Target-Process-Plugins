define(["jQuery","Underscore","tau/core/extension.base","tau/store/testcaserun.status"],function(t,e,s,n){return s.extend({"bus beforeInit":function(t,e){var s=e.config;this.store=s.store,this.entity=s.context.entity},"bus afterRender":function(e,s){var i=s.element,a=i.find(".i-role-results");a.on("click",".tau-btn",function(e){var s=t(e.target),i=n.notRun;s.hasClass("tau-checked")||(i=s.data("result")),this.fire("testCaseRun.status.selected",i)}.bind(this)),s.data.isTestPlanRunStateFinal?a.find(".tau-btn").prop("disabled",!0):this._monitorState(a)},_setState:function(t,e){var s=t.find(this._getButtonSelector(e));s.siblings(".tau-btn").removeClass("tau-checked"),s.addClass("tau-checked")},_resetState:function(t){t.find(".tau-btn").removeClass("tau-checked")},_getButtonSelector:function(t){return"[data-result="+t.toLowerCase()+"]"},_monitorState:function(t){this.store.unbind(this),this.store.on({eventName:"afterSave",type:this.entity.entityType.name,listener:this,hasChanges:["status"],filter:{id:this.entity.id}},function(e){var s=e.data.changes;n.isNotRun(s.status)?this._resetState(t):this._setState(t,s.status)}.bind(this))},"bus afterRender > destroy":function(){this.store.unbind(this)}})});