define(["Underscore","jQuery"],function(e,t){return function(i,s){e.defaults(s,{onResize:t.noop,resetTrigger:t.Deferred});var r=150,o=150,n=150,_=!1,a={__$decreaser:t('<button type="button" class="tau-board-grid-resize-controls__btn tau-board-grid-resize-controls__decreaser">-</button>'),__$increaser:t('<button type="button" class="tau-board-grid-resize-controls__btn tau-board-grid-resize-controls__increaser">+</button>'),__$element:t('<div class="tau-board-grid-resize-controls tau-board-grid-resize-controls_trigger-type-"/>'),__onControlClick:function(e){this.__deactivate(),this.hide(!0),_=!0,this.__$decreaser.is(e.target)&&!this.__$decreaser.is(":disabled")?l.decreaseColSize(this.__showConfig.colIndex):this.__$increaser.is(e.target)&&!this.__$increaser.is(":disabled")&&l.increaseColSize(this.__showConfig.colIndex),setTimeout(function(){_=!1},n)},__onMouseEnter:function(){this.__$element.removeClass("tau-board-grid-resize-controls_hiding"),this.__hideTimeoutId&&(clearTimeout(this.__hideTimeoutId),this.__hideTimeoutId=null)},__onMouseLeave:function(){this.__$element.addClass("tau-board-grid-resize-controls_hiding"),this.hide()},__activate:function(){this.__isActive||(this.__isActive=!0,this.__$element.addClass("tau-active"))},__deactivate:function(){this.__isActive&&(this.__isActive=!1,this.__$element.removeClass("tau-active"))},__setControlsPosition:function(){var e=this.__showConfig.cursorY-this.__$element[0].getBoundingClientRect().top;this.__$element.children().css("top",e)},show:function(e){this.__showConfig=e,this.__$decreaser.attr("disabled",null).removeClass("tau-board-grid-resize-controls__btn__disabled"),this.__$increaser.attr("disabled",null).removeClass("tau-board-grid-resize-controls__btn__disabled"),s.decreaserEnabled(e.x)||(this.__$decreaser.attr("disabled","disabled"),this.__$decreaser.addClass("tau-board-grid-resize-controls__btn__disabled")),s.increaserEnabled(e.x)||(this.__$increaser.attr("disabled","disabled"),this.__$increaser.addClass("tau-board-grid-resize-controls__btn__disabled")),this.__$element.attr("class",function(t,i){return i.replace(/(tau-board-grid-resize-controls_trigger-type-)\w*/g,"$1"+e.triggerType)
}),l.showResizer(this.__$element,e.position),this.__setControlsPosition(),this.__activateTimeoutId||(this.__activateTimeoutId=setTimeout(this.__getActivateTimeoutProxy(),r))},__activateTimeout:function(){this.__activateTimeoutId=null,this.__activate()},__getActivateTimeoutProxy:function(){return this.__showTimeoutProxy||(this.__showTimeoutProxy=t.proxy(this,"__activateTimeout")),this.__showTimeoutProxy},hide:function(t){this.__activateTimeoutId?(clearTimeout(this.__activateTimeoutId),this.__activateTimeoutId=null,this.__hideTimeout()):t?this.__hideTimeout():this.__hideTimeoutId||(this.__hideTimeoutId=setTimeout(e.bind(this.__hideTimeout,this),o))},__hideTimeout:function(){this.__hideTimeoutId=null,this.__deactivate(),l.hideResizer(this.__$element)},tryHide:function(e){e(this.__$element)&&this.hide()},destroy:function(){this.__$element.off(".resizer"),this.__$decreaser.remove(),this.__$increaser.remove(),this.__$element.remove()},init:function(){return this.__$element.append(this.__$decreaser,this.__$increaser),this.__$element.on({"click.resizer":e.bind(this.__onControlClick,this),"mouseenter.resizer":e.bind(this.__onMouseEnter,this),"mouseleave.resizer":e.bind(this.__onMouseLeave,this)}),this}}.init(),d={__$element:t('<span class="tau-board-grid-resize-trigger"></span>'),__$triggerA:t('<div class="tau-board-grid-resize-trigger__a"/>'),__$triggerB:t('<div class="tau-board-grid-resize-trigger__b"/>'),__getResizerConfigInternal:function(e,t,i){return{x:e.data("x"),position:t[0].getBoundingClientRect().left,colIndex:e.index(),triggerType:i}},__getResizerConfig:function(e){var t=null,i=e.target,s=this.__$element.closest(".i-role-cellholder"),r=s.data("x"),o=s.closest(".i-role-board-body"),n=o.find('.i-role-header[data-dimension="x"] .i-role-cellholder[data-x="'+r+'"]');if(this.__$triggerA.is(i)){var _=n.prev(".i-role-cellholder");t=this.__getResizerConfigInternal(_,this.__$triggerA,"a")}else this.__$triggerB.is(i)&&(t=this.__getResizerConfigInternal(n,this.__$triggerB,"b"));
return t.cursorY=e.clientY,t},__onMouseEnter:function(e){_||a.show(this.__getResizerConfig(e))},__onMouseLeave:function(e){_||a.tryHide(function(i){return t(e.relatedTarget).closest(i).length<=0})},attachTo:function(i){if(this.__$element[0].parentNode!==i){this.__$element.on({"mouseenter.resizer":e.bind(this.__onMouseEnter,this),"mouseleave.resizer":e.bind(this.__onMouseLeave,this)}),a.hide();var r=t(i).closest(".i-role-cellholder"),o=s.getLRVisibilityOptions(r),n=this.__$triggerA,_=this.__$triggerB;o.hideL?n.hide():n.show(),o.hideR?_.hide():_.show();var d=r.height();n.height(d),_.height(d),t(i).css("position","relative"),this.__$element.prependTo(i)}},detach:function(){a.hide(),this.__$element.closest(".i-role-cell").css("position",""),this.__$element.detach(),this.__$element.off(".resizer")},destroy:function(){this.__$element.remove(),this.__$triggerA.remove(),this.__$triggerB.remove()},init:function(){return this.__$element.append(this.__$triggerA,this.__$triggerB),this}}.init(),l={__toGridCoordinates:function(e){var t=this.__$element.find(".i-role-grid"),i=e-this.__$element[0].getBoundingClientRect().left,s=t.position(),r=s.left,o=t[0].clientWidth||t.width(),n=r+o-8,_=20,a=0;return Math.abs(r-i)<_?a=1:Math.abs(n-i)<_&&(a=-1),{coordinate:i,shift:a}},increaseColSize:function(e){var t=this.__$element.find(".tau-cols-header, .tau-grid").find(".tau-cellholder:nth-child("+(e+1)+") .tau-cell").eq(0);s.onResize({type:"+",x:t.data("x")})},decreaseColSize:function(e){var t=this.__$element.find(".tau-cols-header, .tau-grid").find(".tau-cellholder:nth-child("+(e+1)+") .tau-cell").eq(0);s.onResize({type:"-",x:t.data("x")})},showResizer:function(e,t){var i=this.__toGridCoordinates(t),s=i.coordinate,r={0:"",1:"tau-board-grid-resize-controls__btn__right-shift","-1":"tau-board-grid-resize-controls__btn__left-shift"};e.removeClass(r[1]).removeClass(r[-1]).addClass(r[i.shift]),e.css("left",s).appendTo(this.__$element.find(".i-role-board-body"))},hideResizer:function(e){e.detach()},init:function(e){return this.__$element=e.find(".i-role-board-body-holder"),this.__$element.find(".i-role-grid").on({"mouseenter.resizer":function(){if(s.isAvailable()){var e=t(this),i=e.find(".i-role-cell");
d.attachTo(i.get(0))}else d.detach()}},".i-role-cellholder"),e.on("remove",function(){this.__$element.find(".i-role-grid").off(".resizer"),d.destroy(),a.destroy()}.bind(this)),s.resetTrigger.progress(function(){d.detach()}),this}}.init(i)}});