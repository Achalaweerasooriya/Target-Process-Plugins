define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({"bus afterRender":function(evt){var self=this;self.element=evt.data.element,$(window).bind("resize",function(){self._resizeImage()});var $wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image");$image.hide(),$wait.show(),this.element.find(".ui-attachment-view-image").bind("load",function(){self._onImageLoad()});var onThumbnailLoad=function(){$(this).parent().removeClass("ui-thumbnail-loading"),$(this).unbind("load",onThumbnailLoad),$(this).fadeIn("slow")};this.element.find(".thumbnail-nav li").addClass("ui-thumbnail-loading"),this.element.find(".thumbnail-nav li > img").each(function(){this.complete?onThumbnailLoad.call(this):$(this).bind("load",onThumbnailLoad).hide()})},_onImageLoad:function(){var self=this,$wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image");self._resizeImage(),$image.fadeIn("slow",function(){$wait.hide()})},_resizeImage:function(){var self=this,$element=self.element;if(!$element)return;var $wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image"),$swapView=$element.find(".image-view");$image.width(""),$image.height("");var width=$swapView.width(),height=$swapView.height(),imageWidth=$image.width(),imageHeight=$image.height();if(imageWidth>width||imageHeight>height){var destWidth=height/imageHeight*imageWidth,destHeight=width/imageWidth*imageHeight;destWidth<width?($image.width(destWidth),$image.height(height)):($image.width(width),$image.height(destHeight))}return{$wait:$wait,$image:$image}},"bus beforeChangeImage":function(evtArgs){var self=this,$wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image");$wait.show();var imgUrl=evtArgs.data;$image.fadeOut("slow",function(){$image.attr("src",imgUrl)}),evtArgs.data=!1}})})