define(["jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.editableText"],function($,ExtensionBase){return ExtensionBase.extend({"bus boardSettings.ready:last + afterRender":function(evt){function selectText(element){var text=element,selection=window.getSelection(),range=document.createRange();range.selectNodeContents(text),selection.removeAllRanges(),selection.addRange(range)}var boardSettings=_.values(evt)[0].data.boardSettings,$el=_.values(evt)[1].data.element,$nameEl=$el.find("[role=name]"),$nameOutputEl=$el.find("[role=name_output]");this.fire("$nameEl.ready",$nameEl),this.fire("$nameOutputEl.ready",$nameOutputEl);if($nameEl.size()!==1)return;$nameEl.editableText({enabled:!1,restoreText:!0,className:" ",classNameActive:" ",maxLength:40,onSave:function(text){var name=_.trim(text.slice(0,40));$nameEl.editableText("setValue",name),$nameEl.prev().text(name),boardSettings.set({set:{name:name},callback:function(){}})}}),$nameEl.editableText("disable"),boardSettings.get({fields:["edit","isDraft"],callback:function(res){res.edit?($nameEl.editableText("enable"),setTimeout(function(){$nameEl.click(),res.isDraft&&selectText($nameEl[0])},1e3)):$nameEl.editableText("disable")}}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["edit"],listener:this,callback:function(res){res.edit?($nameEl.editableText("enable"),$nameEl.click()):$nameEl.editableText("disable")}})},"bus $nameEl.ready:last + name.provided":function(evt,$el,data){$el.text(data.value)},"bus $nameOutputEl.ready:last + name.provided":function(evt,$el,data){$el.text(data.value)}})})