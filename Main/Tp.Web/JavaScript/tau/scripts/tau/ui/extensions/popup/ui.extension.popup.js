define(["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({init:function(config){var self=this;self._super(config);var $body=$("body");self.bodyOverflow=$body.css("overflow"),self.$overlay=$('<div class="ui-popup-overlay" style="display: none;"></div>').appendTo($body),self.$container=$('<div class="ui-popup" style="display: none;"><div class="close"></div></div>').appendTo($body);var integration=self.getIntegration();integration.cssClass&&self.$container.addClass(integration.cssClass),self.keyboardAttached=!1},getIntegration:function(){var integration=this.config.integration||this.config.options.integration;return integration},"bus deleted":function(){var self=this,position=this.$container.position(),top=position.top,left=position.left,width=this.$container.width(),height=this.$container.height();this.$container.animate({opacity:0,top:top+height/2,left:left+width/2,width:0,height:0},800,function(){self.exit()}),this.$overlay.hide()},"bus application.navigate.entity+contentRendered":function(evt,data){var entityType=data.entity||data.type;entityType!="user"&&this.$container.removeClass("tau-user"),this.$container.addClass("tau-"+entityType)},"bus application.navigate.entity":function(evt,data){this.$container.find(".ui-application-viewport").css("visibility","hidden")},"bus contentRendered":function(evt){var self=this;$("body").css("overflow","hidden"),self.$overlay.show(),self.element=evt.data.element,self.element.addClass("ui-popup-content");var $container=self.$container,$closeElement=$(".close",$container);$closeElement.hide(),$container.animate({opacity:"show"},150,function(){self.element.appendTo($container),self.element.css("visibility","visible"),$closeElement.fadeIn(1e3),self._attachHandlers()}),this.keyboardAttached||(this._attachKeyBoardHandling(),this.keyboardAttached=!0)},"bus application.exit":function(){this.$overlay.hide(),this.$container.hide(),$("body").css("overflow",this.bodyOverflow)},_attachKeyBoardHandling:function(){var keyBoardHandler={handleKeyDown:_.bind(this._onDocumentKeyDown,this)};this.config.context.configurator.getKeyBoardManager().pushHandler(keyBoardHandler)},_onDocumentKeyDown:function(event){event.keyCode==$.ui.keyCode.ESCAPE&&this.exit()},_attachHandlers:function(){if(this._attached)return;this._attached=!0,this._onBodyClickHandler=$.proxy(this._onBodyClick,this),this._onCloseButtonClickHandler=$.proxy(this._onCloseButtonClick,this),$(document).bind("click",this._onBodyClickHandler),this.$container.find(".close").bind("click",this._onCloseButtonClickHandler),this._removeElements=this._removeElementsInnerImpl},_onBodyClick:function(e){if(e.target!=this.$overlay[0])return;this.exit()},_onCloseButtonClick:function(){this.exit()},_detachHandlers:function(){$(document).unbind("click",this._onBodyClickHandler),this.element&&this.element.parents(".ui-popup").unbind("click",this._onElementClickHandler),this.config.context.configurator.getKeyBoardManager().popHandler(),this.$container.find(".close").unbind("click",this._onCloseButtonClickHandler)},_removeElementsInnerImpl:function(){this.$overlay.remove(),this.$container.remove(),$("body").css("overflow",this.bodyOverflow)},_removeElements:$.noop,exit:function(){this.keyboardAttached=!1,this.config.context.configurator.getKeyBoardManager().popHandler();var integration=this.getIntegration();integration.keepAlive?this.fire("application.exit"):this.fire("destroy")},destroy:function(){this._detachHandlers(),this._removeElements(),this._super()}})})