define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/configurator","tau/utils/utils.textConverter"],function(a,b,c,d,e){var f=c.extend({"bus dataBind+afterRender":function(a){this.element=a.afterRender.data.element,this.dataToBind=a.dataBind.data},"bus focus.before":function(){this.element.find(".ui-entity-state-comment").remove()},"bus updateState":function(c){var d=this.entityStateId=c.data.id,e=a(this.dataToBind.states).detect(function(a){return a.id===d&&a.isCommentRequired});if(!e)return;c.cancel();var f=this.element;if(f.find(".ui-entity-state-comment").length>0){f.find(".ui-state-comment-field").focus();return}var g=f;g.find(".drop-down-list").listSelectable("disable");var h=b("<div class='ui-entity-state-comment'></div>").append(b("<div class='ui-state-comment-header'>Please, provide comment</div>")).append(b("<div class='ui-state-comment-field-container'></div>").append("<textarea rows='5' class='ui-state-comment-field'></textarea>")).append(b("<div class='button-group'></div>").append(b("<button type='button' class='save button'>Save</button>").click(b.proxy(this._save,this))).append(b("<button type='button' class='cancel button'>Cancel</button>").click(b.proxy(this._cancel,this)))).appendTo(f),i=h.find(".ui-state-comment-field").focus(),j=h.find(".save"),k=function(){window.setTimeout(function(){var a=i.val()||"",b=a.trim().length===0;b?j.attr("disabled","disabled"):j.attr("disabled")&&j.removeAttr("disabled"),b?j.addClass("disable"):j.removeClass("disable")},50)};k(),j.bind("focus",k),i.bind("change keyup click propertychange paste",k)},_save:function(a){a.stopPropagation();var b=new e,c=this,d=this.element.find(".ui-state-comment-field").val(),f=b.convert(d,!0);c.fire("save",{id:null,typeName:"comment",$set:{description:f,general:{id:c.config.context.entity.id}},$include:["id","description","createDate","parentId",{owner:["id","firstName","lastName"]}]}),c.fire("save",{$set:{entityState:{id:c.entityStateId}}})},_cancel:function(a){a.stopPropagation(),this.element.find(".ui-entity-state-comment").remove();var b=this.element.find(".ui-drop-down");b.find(".drop-down-list").listSelectable("enable"),b.show()}});return f})