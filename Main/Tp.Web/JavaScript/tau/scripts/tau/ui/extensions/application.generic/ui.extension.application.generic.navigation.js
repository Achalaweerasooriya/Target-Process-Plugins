define(["Underscore","jQuery","tau/core/class","tau/core/extension.base","libs/parseUri"],function(_,$,Class,ExtensionBase,parseUri){return ExtensionBase.extend({"bus initialize":function(){this._id=_.uniqueId("navigator")},"bus options.ready:last + view.dom.ready:last + configurator.ready:last + afterRender":function(e,options,domData,configurator,renderData){if(!options.routing.silent)return;var $el=renderData.element;$el.parent().off("click."+this._id,"a"),$el.parent().on("click."+this._id,"a",_.bind(function(configurator,e){if(e.ctrlKey||e.metaKey)return;var $a=$(e.currentTarget),href=_.asString($a.attr("href"));if(href==="#")return;var hash="";href.charAt(0)==="#"?hash=href.substr(1):$a.data("target")||(hash=parseUri(href).anchor),hash&&(e.preventDefault(),e.stopPropagation(),configurator.service("navigator").to(hash))},this,configurator))},"bus configurator.ready:last + routes.bound:last + application.navigate.entity":function(evt,configurator,routes,data){var url=_.compact([data.entity||data.type,data.id,data.action]).join("/");configurator.service("navigator").to(url)},"bus configurator.ready":function(e,configurator){configurator.service("navigator").on("back",_.bind(function(){var history=configurator.getHistory(),item=history.pop();item?(history.setCurrent(null),configurator.service("navigator").to(parseUri(item.url).anchor)):this.fire("application.exit"),_.delay(_.bind(this.fire,this,"clearError"),100)},this),this)},"bus configurator.ready:last + destroy":function(e,configurator){configurator.service("navigator").removeAllListeners(this)},"bus contentRendered + destroy":function(evt,renderData){var $el=renderData.element;$el.parent().off("click."+this._id,"a")}})})