define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(_,$,a){var b=a.extend({category:"edit",destroy:function(){var a=this;a.destroyDynamicComponents(),a._super()},lifeCycleCleanUp:function(){var a=this;a.destroyDynamicComponents(),a._super()},destroyDynamicComponents:function(){var a=this;a.commentNewEditorComponent&&(a.commentNewEditorComponent.destroy(),delete a.commentNewEditorComponent)},"bus initialize":function(a){this.config=a.data},"bus afterRender+permissionsReady+dataBind":function(a){this.element=a.afterRender.data.element;var b=a.permissionsReady.data;this.data=a.dataBind.data,this.initializeAddCommentLink()},initializeAddCommentLink:function(){this.$addLink=$("<span class='ui-comments-add-link'>Add Comment</span>").click($.proxy(this.addNewComment,this)).insertAfter(this.element.find(".ui-all-comments"))},onCloseEditor:function(a){this.$addLink.show()},addNewComment:function(){var a=this;a.$addLink.hide();var b={components:[{type:"comment.new.editor"}],context:a.config.context};a.createComponents(b,function(b){var c=a.commentNewEditorComponent=b[0].component;c.on("afterRender",function(b){var c=b.data.element;c.insertAfter(a.$addLink)}),c.on("destroy",$.proxy(a.onCloseEditor,a)),c.initialize()})}});return b})