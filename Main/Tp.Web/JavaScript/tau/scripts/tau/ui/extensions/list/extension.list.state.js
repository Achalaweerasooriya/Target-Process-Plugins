define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/configurator"],function(_,$,a,b){return a.extend({name:"extension.list.state",initialState:{},"bus preDataBind":function(a){var c=a.data,d=b.getRouting().getStateParameter("list")||{},e=this;_.forEach(c.groups,function(a){var b=(new String(a.key)).toString();e.initialState[b]=a.collapsed,_.isUndefined(d[b])==0&&(a.collapsed=d[b])})},"bus afterInit+afterRender":function(a){this.$el=a.afterRender.data.element},"bus toggled":function(a){var c=this.$el.find("[role=group]"),d={},e=this;c.each(function(){var a=$(this),b=a.hasClass("tau-list__group_collapsed_true"),c=a.data("tmplItem").data,f=(new String(c.key)).toString();_.isUndefined(e.initialState[f])==0&&e.initialState[f]!==b&&(d[f]=b)}),b.getRouting().setStateParameter("list",d,!0),b.getHistory().updateCurrent({url:b.getRouting().getUrl().source})}})})