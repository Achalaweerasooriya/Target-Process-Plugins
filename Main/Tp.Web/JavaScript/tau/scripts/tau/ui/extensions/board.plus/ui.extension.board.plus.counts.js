define(["jQuery","tau/components/extensions/component.extension.base","Underscore","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,ExtensionBase,_,boardUtils){return ExtensionBase.extend({getMessage:function(counts,axisName,hasShowMore){var cards=" cards",are=" are";counts===1&&(cards=" card",are=" is");var weNotKnow=hasShowMore?" are visible, we don't know the real total so far...":"";return hasShowMore||(cards+=are),counts+cards+" in this "+(axisName==="x"?"column":"row")+weNotKnow},appendBubble:function($header,title,counts){var $countElement=$('<div class="tau-axiscell__item tau-cards-count" title="'+title+'"><span>'+counts+"</span></div>");return $header.append($countElement),$countElement},updateCount:function($countElement,title,counts){return $countElement.html("<span>"+counts+"</span>"),$countElement.attr("title",title),$countElement},refreshCounts:function(cells){var hash={x:{},y:{}},self=this;_.each(["x","y"],function(axisName){_.each(cells.cells,function(cell){var id=cell.data[axisName];if(!id||id==="null")return;hash[axisName].hasOwnProperty(id)||(hash[axisName][id]={id:id,header:null,count:0,hasShowMore:!1});var o={};o[axisName]=id;var elementId=boardUtils.generateId(o);cell.element.attr("id")==elementId?hash[axisName][id].header=cell.element:(hash[axisName][id].count+=cell.element.children(".tau-card").length,!hash[axisName][id].hasShowMore&&cell.element.parent().children(".i-role-cell-paging-more").length>0&&(hash[axisName][id].hasShowMore=!0))}),_.each(_.values(hash[axisName]),function(line){var $countBubble=line.header.children(".tau-cards-count"),message=self.getMessage(line.count,axisName,line.hasShowMore);if(line.count===0){$countBubble.hide();return}$countBubble.length===0?$countBubble=self.appendBubble(line.header,message,line.count):self.updateCount($countBubble,message,line.count),line.count>0?$countBubble.show():$countBubble.hide()})})},"bus overview.cells.skeletons.ready":function(evt,cells){this.refreshCounts(cells)},"bus overview.cells.skeletons.ready:last > view.card.batch.move.completed":function(evt,cells){this.refreshCounts(cells)},"bus overview.cells.skeletons.ready:last > view.cell.skeleton.updated":function(evt,cells){this.refreshCounts(cells)}})})