define(["tau/components/extensions/component.extension.base","tau/ui/templates/assignmentsList/ui.template.assignments.effortsOnly","tau/ui/behaviour/common/ui.behaviour.editableText"],function(ExtensionBase,templateAssignmentsEfforts){return ExtensionBase.extend({category:"edit",normalizeEffort:function(effortVal){return Math.abs(Math.round(parseFloat(effortVal)*100)/100)||0},"bus afterRender+beforeChangeProperty":function(evt){var $element=evt.afterRender.data.element;this.fire("markElementToBeUpdated",{element:$element})},"bus propertyChanged":function(evt){this.fire("refresh")},"bus refresh+afterRender":function(evt){var $element=evt.afterRender.data.element;this.fire("updateElement",{element:$element})},hasEffortIterator:function(roleEffort){return roleEffort.role.hasEffort},"bus permissionsReady+dataBind+afterRender":function(eventData){var self=this,permissions=eventData.permissionsReady.data,dataToBind=eventData.dataBind.data;if(permissions.editable){var rolesCount=_(dataToBind.roleEfforts).chain().select(self.hasEffortIterator).size().value();permissions.editMode="disabled",rolesCount&&(permissions.editMode=rolesCount===1&&self.config.entitiesCount==0?"inline":"roleEfforts");var $element=eventData.afterRender.data.element,$effortText=$element.find(".entity-effort");if(permissions.editMode==="inline")$effortText.editableText({mask:/^\d*\.?\d*$/,restoreText:!0,onSave:function(effortText){var effortValue=self.normalizeEffort(effortText),theRoleEffort=_(dataToBind.roleEfforts).detect(self.hasEffortIterator),cmd={typeName:"roleEffort",id:theRoleEffort.id,$set:{effort:effortValue}};self.bus.fire("save",cmd)},onEditStart:function(){self._$additionalInfo=$effortText.find(".entity-effort-info").detach()},onEditEnd:function(){self._$additionalInfo.appendTo($effortText)}});else if(permissions.editMode==="roleEfforts"){var componentsConfig={components:[{type:"assignmentsList",template:templateAssignmentsEfforts}],context:self.config.context},bubbleConfig={target:$effortText,componentsConfig:componentsConfig};self.fire("initBubble",bubbleConfig)}}}})})