define(["require","tau/utils/utils.convertUserName","jQuery","Underscore"],function(t){var e=t("tau/utils/utils.convertUserName"),r=t("jQuery"),s=t("Underscore");return{_getData:function(t){var e="?select={"+["id",'"User" as __type',"firstName","lastName","email","login","avatarUri"].join(",")+this.options.autocompleteFieldsQueryAdd+"}&where=("+this._getUserIdsQueryFilter()+'(firstName.startsWith("'+this.options.store2.arg(t)+'")  OR lastName.startsWith("'+this.options.store2.arg(t)+'")  OR email.startsWith("'+this.options.store2.arg(t)+'") OR login.startsWith("'+this.options.store2.arg(t)+'")) '+this.options.autocompleteQueryAdd+" AND deleteDate == NULL AND isActive == True )"+this.options.autocompleteTakeQueryAdd,i=s.map(this.options.userTypes,function(t){return this.options.store2.findAll(t+e)},this);return r.when.all(i).then(function(t){return s.flatten(t)})},_getUserIdsQueryFilter:function(){var t=this.options.rejectUserIdsGetter();return t&&t.length>0?"(not (id in ["+t.join(",")+"])) AND ":""},_processItems:function(t,r){var i=r.toLowerCase();return s.chain(t).map(s.bind(function(t){return t.name=e.getFullName(t),t},this)).sortBy(function(t){var e=t.name.toLowerCase();return(s.startsWith(e,i)?"0":"1")+e}).value()}}});