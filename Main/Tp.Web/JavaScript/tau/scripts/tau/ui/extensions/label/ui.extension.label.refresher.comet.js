define(["require","Underscore","tau/core/extension.base"],function(e){var t=e("Underscore"),i=e("tau/core/extension.base");return i.extend({"bus beforeInit":function(e,t){this.configurator=t.config.context.configurator,this.configurator.getFeaturesService().isEnabled("comet.notifications")&&(this._comet=this.configurator.getComet(),this.fire("comet.enabled"),this._comet.refreshRequired.add(function(){this.fire("refresh")},this))},"bus comet.parameters.ready + comet.enabled:last":function(e,t){this._subscribe(t)},destroy:function(){this._unsubscribe(),this._super()},_subscribe:function(e){this._unsubscribe(),this._subscription=this._comet.subscribe("slice",{parameters:e,callback:function(e){var i=t.some(e.data.items,function(e){var t=e.modification.toLowerCase();return"added"===t||"deleted"===t});i&&this.fire("entity.changed")}.bind(this)})},_unsubscribe:function(){this.configurator.getFeaturesService().isEnabled("comet.notifications")&&(this._subscription&&this._subscription.stop(),this._comet.removeEventHandlers(this))}})});