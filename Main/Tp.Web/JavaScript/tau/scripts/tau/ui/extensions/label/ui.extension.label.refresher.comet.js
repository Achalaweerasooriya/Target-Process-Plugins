define(["require","Underscore","tau/core/extension.base"],function(t){var e=t("Underscore"),i=t("tau/core/extension.base");return i.extend({"bus beforeInit":function(t,e){this.configurator=e.config.context.configurator,this.configurator.getFeaturesService().isEnabled("comet.notifications")&&this.fire("comet.enabled")},"bus comet.parameters.ready + comet.enabled:last":function(t,e){this._subscribe(e)},"bus destroy":function(){this._unsubscribe()},_subscribe:function(t){this._unsubscribe(),this.subscription=this.configurator.getComet().listen("slice",{parameters:t}).on({callback:function(t){var i=e.some(t.data.items,function(t){var e=t.modification.toLowerCase();return"added"===e||"deleted"===e});i&&this.fire("entity.changed")}.bind(this)}).aborted(function(){e.defer(this._subscribe.bind(this,t))}.bind(this)).start()},_unsubscribe:function(){this.subscription&&(this.subscription.stop(),this.subscription=null)}})});