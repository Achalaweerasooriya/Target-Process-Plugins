define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,i){return i.extend({_fireItemsReady:function(e){this.fire("$items.ready",e.find(".i-role-item")),this.fire("$links.ready",e.find(".i-role-item a"))},"bus afterRender":function(e,t){var i=t.element.find(".tau-boardselector__group");this._fireItemsReady(i),this.fire("$groups.ready",i),this.fire("$el.ready",t.element)},"bus view.dom.ready + $el.ready + $items.ready":function(e,t,i){setTimeout(function(){var e=i.find(".tau-boardselector__item_active_true");if(0!==e.length){var t=i.find(".i-role-list");if(e.offset().top>t[0].scrollTop+i.innerHeight()){var a=e.offset().top+e.innerHeight()-t.innerHeight();t[0].scrollTop=a}}},0)},"bus $el.ready:last + $bubbled.ready:last + $items.ready:last + board.removed":function(e,t,i,a,r){var s=a.filter("[data-id="+r.id+"]");s.remove(),this.fire("refresh")},"bus $el.ready:last + $bubbled.ready:last + $items.ready:last + currentBoard.changed":function(e,t,i,a,r){var s=a.filter("[data-id="+r.id+"]"),d="tau-boardselector__item_active_true";s.length?(s.hasClass(d)||(a.removeClass(d),s.addClass(d)),i.tauBubble("hide"),this._updateShowMore(t)):this.fire("refresh")},"bus $el.ready:last + edit.completed":function(e,t){this._updateShowMore(t)},_updateShowMore:function(e){var t=e.find(".i-role-action-showmore"),i=t.tauBubble("widget").find(".tau-boardselector__item_active_true");t.find("span:first").text(i.length?i.text():""),t.parent().toggleClass("tau-boardselector__headermenu__item_focused_true",i.length>0)},"bus boardUpdated + boardItemService.ready:last + currentBoard.ready:last + $groups.ready:last + $el.ready:last":function(t,i,a,r,s,d){var n=e.defaults(a.getItemData(i,r.id===i.key),i),o=s.find("li[data-id="+n.key+"]");n.edit=o.find(".tau-board-settings-toggle").hasClass("tau-checked");var l=a.renderItem(n);l.insertAfter(o),o.remove(),this._fireItemsReady(s),this._updateShowMore(d)},"bus $el.ready:last + _boardSettings.ready":function(e,t,i){this._bindToggleSettingsButton(t,i)},"bus afterRender + _boardSettings.ready":function(e,t,i){this._bindToggleSettingsButton(t.element,i)},_bindToggleSettingsButton:function(e,t){var i=function(t){e.find(".tau-board-settings-toggle").toggleClass("tau-checked",!!t.edit)};e.off("click.toggleSettings",".tau-board-settings-toggle"),e.on("click.toggleSettings",".tau-board-settings-toggle",function(){e.find(".tau-boardselector__action-more").tauBubble("hide"),t.get({fields:["edit"],callback:function(e){t.set(e.edit&&e.cells&&0===e.cells.types.length?{set:{emptyCardsSet:+new Date}}:{set:{edit:!e.edit}})}})}),t.unbind({listener:this}),t.bind({fields:["edit"],listener:this,callback:i}),t.get({fields:["edit"],callback:i})}})});