define(["jQuery","Underscore","tau/core/extension.base","tau/ui/templates/board.editor/ui.template.board.editor.autocomplete.item"],function($,_,ExtensionBase,autocompleteItemTemplate){return ExtensionBase.extend({"bus configurator.ready:last + view.dom.ready:last + $form.ready":function(evt,configurator,dom,$form){var $inputs=$form.find(":text"),self=this;$form.delegate(".i-role-clear","click",function(){var $relatedInput=$(this).parent().find(":text");$relatedInput.val("")}),$inputs.bind("click keydown keyup",function(e){var hasText=$(this).val().length>0,$f=$(this).parent();$f.toggleClass("tau-boardsettings__filter_empty_false",hasText)}),$inputs.each(function(){var $input=$(this);$.browser.msie&&$input.bind("keyup",function(event){$(this).data("selectionEnd",this.selectionEnd)}),$input.bind("keydown",function(event){event.keyCode===$.ui.keyCode.TAB&&$(this).data("autocomplete").menu.active&&event.preventDefault(),event.keyCode===$.ui.keyCode.SPACE&&event.ctrlKey&&$(this).autocomplete("search"),event.keyCode===$.ui.keyCode.ESCAPE&&$(this).autocomplete("close")}).bind("clear",function(e){$(this).autocomplete("close")}).bind("focusin",function(event){}).autocomplete({minLength:0,source:function(request,next){var $input=$(this.element);self.fire("filter.autocomplete.resolve",{$input:$input,request:request,next:next})},change:function(e,ui){var $input=$(this);$input.trigger("_change")},focus:function(){return!1},select:function(event,ui){var $input=$(this),selected=ui.item,oldVal=$input.val(),newVal=selected.Source.slice(0,selected.Position.Value);newVal+=selected.LangValue;var endVal=newVal,cursorShouldBe=newVal.length;return newVal+=oldVal.slice($input[0].selectionEnd>0?$input[0].selectionEnd:$input.data("selectionEnd")||0),$input.val(newVal),$input[0].focus(),$input[0].setSelectionRange(cursorShouldBe,cursorShouldBe),$input.data("selectionEnd",cursorShouldBe),_.contains(["ObjectAttribute","ObjectsCollectionAttribute","Method"],selected.SuggestionType)&&setTimeout(function(){$input.autocomplete("search",endVal)},100),self.fire("filter.autocomplete.preload",{value:newVal,$input:$input}),event.stopPropagation(),!1}});var template=configurator.getTemplateFactory().get(autocompleteItemTemplate.name);$input.data("autocomplete")._change=function(a){this._trigger("change",a,{item:this.selectedItem})},$input.data("autocomplete")._renderItem=function(ul,item){return template.bind({},item).data("item.autocomplete",item).appendTo(ul)},$input.data("autocomplete")._renderMenu=function(ul,items){$(ul).addClass("tau-autocomplete__menu").addClass("drop-down-list").css("maxHeight",$(window).height()*.4);var that=this;$.each(items,function(index,item){that._renderItem(ul,item)})}})}})})