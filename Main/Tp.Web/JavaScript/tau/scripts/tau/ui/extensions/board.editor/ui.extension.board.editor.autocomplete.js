define(["require","jQuery","Underscore","tau/core/extension.base","tau/ui/templates/board.editor/ui.template.board.editor.autocomplete.item","./board.editor.filter.utils"],function(e){function t(e,i){null!=e&&(e.type==i?e.stopImmediatePropagation():t(e.originalEvent,i))}var i=e("jQuery"),o=e("Underscore"),n=e("tau/core/extension.base"),a=e("tau/ui/templates/board.editor/ui.template.board.editor.autocomplete.item"),r=e("./board.editor.filter.utils");return n.extend({"bus view.dom.ready:last + $form.ready":function(e,t,n){var a=r.getFilterInputs(n),s=this.fire.bind(this);a.on("focus",function(){s("preloading.execute")}),n.on("click",".i-role-clear",function(){var e=i(this).parent().find(":text");e.val("")}),a.on("click keydown keyup",function(){var e=i(this),t=e.val().length>0;e.parent().toggleClass("boardsettings-filter--empty-false",t)}),o.each(a,this._initializeForInput,this)},_initializeForInput:function(e){var n=i(e),s=this.fire.bind(this);i.ui.ie&&n.on("keyup",function(){i(this).data("selectionEnd",this.selectionEnd)});var l=function(){n.autocomplete("close")};n.on("keydown",function(e){switch(e.keyCode){case i.ui.keyCode.TAB:i(this).data("ui-autocomplete").menu.active&&e.preventDefault();break;case i.ui.keyCode.SPACE:e.ctrlKey&&(e.preventDefault(),i(this).autocomplete("search"));break;case i.ui.keyCode.ESCAPE:i(this).data("ui-autocomplete").menu.element.is(":visible")&&(i(this).autocomplete("close"),e.preventDefault(),e.stopPropagation())}}).on("clear",l).autocomplete({minLength:0,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(e,t){var o=this.element,n=i(o);s("filter.autocomplete.resolve",{term:e.term.slice(0,o.selectionStart),typesProperty:r.getFilterInputTypesPropertyName(n),request:e,next:t})},change:function(){i(this).trigger("_change")},focus:function(){return!1},select:function(e,n){var a=i(this),l=n.item,u=a.val(),c=l.Source.slice(0,l.Position.Value)+l.LangValue,d=c,p=c.length;return c+=u.slice(a[0].selectionEnd>0?a[0].selectionEnd:a.data("selectionEnd")||0),a.val(c),a[0].focus(),a[0].setSelectionRange(p,p),a.data("selectionEnd",p),o.contains(["ObjectAttribute","ObjectsCollectionAttribute","Method"],l.SuggestionType)&&setTimeout(function(){a.autocomplete("search",d)
},100),s("filter.autocomplete.preload",{value:c,typesProperty:r.getFilterInputTypesPropertyName(a)}),e.stopPropagation(),t(e,"keydown"),!1}});var u=n.autocomplete("instance"),c=n.val();u._change=function(e){var t=n.val();t!==c&&(this._trigger("change",e,{item:this.selectedItem}),c=t)},u._renderItem=function(e,t){return a.render(t).data("ui-autocomplete-item",t).appendTo(e)},u._renderMenu=function(e,t){i(e).addClass("tau-autocomplete__menu drop-down-list").css({maxHeight:.4*i(window).height(),zIndex:this.element.zIndex()+10}),o.each(t,function(t){this._renderItem(e,t)},this)}}})});