define(["Underscore","tau/core/class","tau/components/extensions/component.extension.base","tau/models/relations/model.relations.data.fetcher","tau/ui/templates/relations/ui.template.relations.denied"],function(e,t,n,i,a){var o=n.extend({blockerRelationTypeId:2,"bus initialize + beforeInit":function(e,t,n){var a=n.config;this.dependencyType=a.dependencyType,this.dataFetcher=new i(a,this.dependencyType),this.dataFetcher.fetchRelationCounts().done(function(e){this.fire("relation.counts.fetched",e[0].data)}.bind(this))},"bus public.relationsReady + relation.counts.fetched":function(e,t,n){n[this.dependencyType+"Relations-count"]!=t[this.dependencyType].length&&this.dataFetcher.fetchRelations().done(function(e){this.fire("relations.fetched",e[0].data)}.bind(this))},"bus afterRender:last + difference.ready":function(e,t,n){var i=a.get().bind(null,this._getDataForTemplate(n));t.element.after(i),i.slideDown("fast")},"bus public.relationsReady + relations.fetched":function(t,n,i){var a=i[this._getDependencyTypePropertyName()],o=e.map(n[this.dependencyType],function(e){return e.relation.id}),r=e.chain(a).filter(function(t){return!e.contains(o,t.id)}).map(function(e){return{id:e.id,relationType:e.relationType.id}}).value();this.fire("difference.ready",r)},_getDependencyTypePropertyName:function(){return this.dependencyType.concat("Relations")},_getRelationTypeName:function(){return"master"==this.dependencyType?"inbound":"outbound"},_getDataForTemplate:function(t){return{relationType:this._getRelationTypeName(),count:t.length,blockersCount:e.filter(t,function(e){return e.relationType==this.blockerRelationTypeId}.bind(this)).length}}});return o});