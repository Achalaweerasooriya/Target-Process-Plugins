define(["Underscore","jQuery","tau/ui/extensions/board.plus/ui.extension.board.plus.dragndrop.base","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function(e,i,r){return r.extend({_appendToGroupDelay:500,_addCardToGroup:function(e,i){e.appendTo(i),this.fire("view.card.group.changed")},_resetAppendToGroupTimer:function(){clearTimeout(this._appendToGroupTimer),this._appendToGroupTimer=null},_processToGroup:function(e,i,r){if(!i.is(r)){var o=r;if(r.is(".i-role-cellholder")&&(o=r.children(".i-role-cell")),!i.is(o)){o.data("emptyBeforeDrop",!this.cellHasCards(o));var t=this.dndOptions.isPrioritizable,s=t===!0||"shift"===t&&this.isShiftPressed,n=s||this._isDragBeingStopped;n?e.appendTo(o):(this._$currentGroup=o,this._$draggedItem=e,this._appendToGroupTimer=setTimeout(function(){this._addCardToGroup(e,o)}.bind(this),this._appendToGroupDelay))}}},onSortableReady:function(){this._super(),this.$sortable.on("tausortablestart.board",function(){this._isDragBeingStopped=!1}.bind(this)),this.$sortable.on("tausortablebeforegroupentered.board",function(e,i){var r=i.group.is(this._$currentGroup);!r&&this._appendToGroupTimer&&this._resetAppendToGroupTimer()}.bind(this)),this.$sortable.on("tausortablebeforestop.board",function(){this._appendToGroupTimer&&(this._resetAppendToGroupTimer(),this._$draggedItem.appendTo(this._$currentGroup)),this._isDragBeingStopped=!0}.bind(this))},_highlightNotAvailableCells:function(e){this.fire("view.card.batch.move.before",e)}})});