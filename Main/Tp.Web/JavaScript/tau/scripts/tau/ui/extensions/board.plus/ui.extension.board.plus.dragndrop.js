define(["jQuery","tau/components/extensions/component.extension.base"],function($,a){return a.extend({classes:{DRAG_SOURCE:"tau-drag-source",DRAG_HELPER:"tau-drag-helper"},"bus afterRender":function(a){this.selectedCards={};var b=a.data.element.find(".i-role-grid"),c=b.find("tbody");this.$grid=b,this.cardOptions={addClasses:!1,appendTo:b,containment:c,cursor:"move",helper:"clone",distance:8,scrollSensitivity:100,start:_.bind(this.onDragStart,this),drag:_.bind(this.onDrag,this),stop:_.bind(this.onDragStop,this)},this.__options={},this.__options.sortItemsSelector=".i-role-card",this.__options.dropTargetSelector=".i-role-cell",this.__options.dragZone=b;var d=this;b.delegate(".i-role-card","mouseenter",function(){$(this).draggable(d.cardOptions)})},onDragStart:function(a,b){var c=this.classes,d=$(a.target);d.addClass(c.DRAG_SOURCE),b.helper.addClass(c.DRAG_HELPER),this.__dropTarget=d.parentsUntil(this.__options.dragZone,this.__options.dropTargetSelector),this.__intervalId=setInterval(_.bind(this.__updateDragSourceLocation,this,d),50),this.fire("view.card.drag.start",{element:d,helper:b.helper})},onDrag:function(a,b){this.__cursorPosition={x:a.pageX,y:a.pageY}},onDragStop:function(a,b){var c=this.classes,d=$(a.target);clearInterval(this.__intervalId),this.__intervalId=null,d.removeClass(c.DRAG_SOURCE),this.fire("view.card.drag.stop",{element:d})},__updateDragSourceLocation:function(a){this.__updateDropTarget(a),this.__sortItems(a)},__updateDropTarget:function(a){if(!this.__isElementUnderCursor(this.__dropTarget.get(0))){var b=this.__getDropTargetUnderCursor(this.__dropTarget);b.size()>0&&(this.__dropTarget=b.append(a))}},__sortItems:function(a){var b=this.__getSortItemUnderCursor(a);b.size()>0&&(a.index()<b.index()?a.insertAfter(b):a.insertBefore(b))},__isPointInRect:function(a,b,c,d,e,f){return a>=c&&b>=d&&a<=e&&b<=f},__isElementUnderCursor:function(a){var b=a.getBoundingClientRect();return this.__isPointInRect(this.__cursorPosition.x,this.__cursorPosition.y,b.left,b.top,b.right,b.bottom)},__getDropTargetUnderCursor:function(a){return $(_.find(this.__options.dragZone.find(this.__options.dropTargetSelector).not(a),function(a){return this.__isElementUnderCursor(a)},this))},__getSortItemUnderCursor:function(a){return $(_.find(a.siblings(this.__options.sortItemsSelector),function(a){return this.__isElementUnderCursor(a)},this))}})})