define(["Underscore","jQuery","tau/core/extension.base.stateful","tau/ui/extensions/board.plus/ui.board.plus.utils"],function(e,t,l,n){var i=l.extend({name:"view.board.plus","bus view.build.skeleton":function(e){n.resetCardIds();var t=e.data;this.fire("template.bind",{name:"boardplus.skeleton",data:t})},getCoords:function(e){var t={};return e.hasAttribute("data-x")&&(t.x=e.getAttribute("data-x")),e.hasAttribute("data-y")&&(t.y=e.getAttribute("data-y")),t},bound:function(e){var t=this,l=e.data.element;this.fire("view.skeleton.built",{element:l});var n=l.find(".i-role-cell");t.fire("view.cellSlot.built.start",{cells:n}),n.each(function(e,l){var n=t.getCoords(l);t.fire("view.cellSlot.built",{element:this,data:n,id:this.id})}),t.fire("view.cellSlot.built.end",{cells:n})},"bus template.boardplus.skeleton.bound":function(e){this.bound(e)},"bus template.boardplus.skeleton.customized.bound":function(e){this.bound(e)},createFireBindTemplateHandler:function(){return e.bind(function(e){this.fire("template.bind",e)},this)},buildCellSkeleton:function(e,l,n){t.when(this.getCellTemplateConfig(e,l,n)).then(this.createFireBindTemplateHandler())},"bus configurator.ready:last + cardLayoutFactory.ready:last + view.build.cell.skeleton + view.skeleton.built:last":function(e,t,l,n,i){this.buildCellSkeleton(t,l,n,i)},buildAxisSkeleton:function(e,l,n){t.when(this.getAxisTemplateConfig(e,l,n)).then(this.createFireBindTemplateHandler())},"bus configurator.ready:last + cardLayoutFactory.ready:last + view.build.axis.skeleton + view.skeleton.built:last":function(e,t,l,n,i){this.buildAxisSkeleton(t,l,n,i)},getAxisTemplateConfig:function(e,t,l){return{name:"boardplus.cell.axis.skeleton",data:n.convertCellAxisData(l)}},getCellTemplateConfig:function(l,n,i){var a="boardplus.cell.grid.skeleton",o=t.Deferred();return n.getLayoutFactory().done(function(t){var n=e.extend({getLayout:t,configurator:l},i);o.resolve({name:a+".customized",data:n})}),o},getCellElement:function(e,t){var l=n.generateId(e),i=t.find("#"+l);
return i},appendCellToBoardSkeleton:function(e,t){var l=e.data,n=e.element,i=this.getCellElement(l,t),a={cell:i,content:n};this.fire("view.cell.skeleton.element.beforeUpdate",a),i.append(n),this.fire("view.cell.skeleton.element.afterUpdate",a),this.fireCellSkeletonBuilt({element:i,data:l})},fireCellSkeletonBuilt:function(e){this.fire("view.cell.skeleton.built",e)},"bus view.skeleton.built:last + template.boardplus.cell.grid.skeleton.customized.bound":function(e){var t=e["view.skeleton.built"].data.element,l=e["template.boardplus.cell.grid.skeleton.customized.bound"].data;this.appendCellToBoardSkeleton(l,t)},"bus view.skeleton.built:last+template.boardplus.cell.axis.skeleton.bound":function(e){var t=e["view.skeleton.built"].data.element,l=e["template.boardplus.cell.axis.skeleton.bound"].data;this.appendCellToBoardSkeleton(l,t)},"bus view.cell.skeleton.built":function(e){var l=this,n=e.data,i=n.data,a=i.hasOwnProperty("x"),o=i.hasOwnProperty("y");if(a&&o){var r=n.element;r.find(".i-role-card").each(function(){var e=t(this);l.fire("view.card.skeleton.built",{element:e,data:{id:e.attr("data-id"),type:e.attr("data-type")}})})}}});return i});