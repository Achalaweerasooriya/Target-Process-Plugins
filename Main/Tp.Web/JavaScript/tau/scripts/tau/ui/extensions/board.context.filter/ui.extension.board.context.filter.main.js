define(["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){this.fire("$el.ready",renderData.element)},"bus $el.ready":function(evt,$el){var $popover=$el.find(".i-role-popupcontent"),self=this,$submitButton=$popover.find(".i-role-action-submit");self.fire("$submitButton.ready",$submitButton),$submitButton.on("click",function(){self.fire("filter.submitted")}),$popover.detach(),$el.tauBubble({dontCloseSelectors:[".ui-autocomplete"],content:$popover,zIndex:999,template:['<div class="tau-bubble-board tau-teams-projects-manager-wrapper">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join(""),onShow:function(){self.fire("$popup.shown",$popover)},onHide:function(){self.fire("$popup.hidden",$popover)},onArrowPositionConfig:function(config){return config.at="left bottom",config.offset="26 0",config},onResize:function($popup,data){var h=data.height;$popup.find(".i-role-list").css({maxHeight:h-$popup.find(".tau-teams-projects-search").height()-$popup.find(".tau-teams-projects-updater").height()-300,overflowY:"auto"})}}),$(window).resize(_.throttle(function(){$el.tauBubble("adjustSize")},100)),this.fire("$bubbled.ready",$el),this.fire("$popup.ready",$popover)},"bus $popup.ready":function(evt,$el){this.fire("$teamSection.ready",$el.find(".tau-teams")),this.fire("$projectSection.ready",$el.find(".tau-projects")),this.fire("$sections.ready",$el.find(".tau-teams, .tau-projects")),this.fire("$assignSection.ready",$el.find(".tau-teams-projects-updater"))},"bus $bubbled.ready:last + $sections.ready":function(evt,$bubbled,$el){var self=this;$el.on("click",".i-role-selecttrigger",function(e){e.stopPropagation(),e.stopImmediatePropagation();var item=$(e.currentTarget).data();$bubbled.tauBubble("option","onHide",$.noop),$bubbled.tauBubble("hide");var teams=item.entityType=="team"?[item.entityId]:[],projects=item.entityType=="project"?[item.entityId]:[];self.fire("model.setFilter",{selectedTeamsIds:teams,selectedProjectsIds:projects}),$bubbled.tauBubble("option","onHide",function(){self.fire("$popup.hidden",$popup)})})},"bus $bubbled.ready:last + $popup.ready:last + filter.submitted":function(evt,$bubbled,$popup){var self=this;$bubbled.tauBubble("option","onHide",$.noop),$bubbled.tauBubble("hide"),this.fire("model.setFilter",this.getCurrentState($popup)),$bubbled.tauBubble("option","onHide",function(){self.fire("$popup.hidden",$popup)})},"bus $bubbled.ready:last + $popup.ready:last + $popup.hidden":function(evt,$bubbled,$popup){this.fire("model.setFilter",this.getCurrentState($popup))},"bus $assignSection.ready:last + project.add.completed":function(evt,$section){$section.addClass("tau-teams-projects-updater_state_enabled")},"bus $assignSection.ready:last + team.add.completed":function(evt,$section){$section.addClass("tau-teams-projects-updater_state_enabled")},"bus $sections.ready + $submitButton.ready":function(evt,$sections,$submitButton){$sections.on("change",":checkbox",function(){$submitButton.hasClass("tau-teams-projects-submit_highlighted_true")||$submitButton.animateWithCss({cssClassName:"tau-teams-projects-submit_highlighted_true"})})},getCurrentState:function($list){var data={},$checked=$list.find(".tau-teams .i-role-list :checked");return data.selectedTeamsIds=$checked.map(function(){return parseInt(this.value,10)}).toArray(),$checked=$list.find(".tau-projects .i-role-list :checked"),data.selectedProjectsIds=$checked.map(function(){return parseInt(this.value,10)}).toArray(),data}})})