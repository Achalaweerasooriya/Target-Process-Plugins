define(["jQuery","Underscore","tau/components/extensions/component.extension.base","tau/services/boards/view.types"],function(e,t,i,a){return i.extend({getProjectsAndTeams:function(e){function i(e){return parseInt(e.value,10)}return t.map(e.find(".i-role-list :checked"),i)},"bus afterRender + configurator.ready":function(t,i,s){var o=i.data,n=i.element,r=n.find(".i-role-popupcontent"),d=r.find(".i-role-section-teams"),c=r.find(".i-role-section-projects");this.toggleCustomSharedPanel(n,!o.access.customSharedData.isActive),n.on("change","[role=action-share]",function(t){this.handlers[e(t.target).val()].bind(this)(n)}.bind(this));var h=n.find("[role=action-bord-access-notify]");this.getProjectsAndTeams(c).length<1&&this.getProjectsAndTeams(d).length<1&&h.prop("disabled",!0),n.on("click",".i-role-popupcontent :checkbox",function(t){var i=this.getProjectsAndTeams(d),a=this.getProjectsAndTeams(c);e(t.target).is(":checked")?h.prop("disabled",!1):i.length<1&&a.length<1&&h.prop("disabled",!0),this.fireCustomSharedData(!0,!0,i,a)}.bind(this)),this.fire("$el.ready",r),this.fire("$teamSection.ready",d),this.fire("$projectSection.ready",c),this.fire("$sections.ready",r.find(".tau-teams, .tau-projects"));var l=s.getSliceFactory().create({});h.on("click",function(){h.prop("disabled",!0);var e=this.getProjectsAndTeams(d),t=this.getProjectsAndTeams(c),i=s.getUrlBuilder().getBoardPageRelativePath()+s.getUrlBuilder().getRelativeViewUrl(o.boardId,o.itemType,o.boardAcid);l.notifyViewAccess({teamIds:e,projectIds:t,viewUrl:i,viewName:o.boardName,viewType:o.itemType}).done(function(){this.fire("notification",{message:"People will be notified that you've shared a "+a.getViewTypeName(o.itemType)+" with them.",delay:3e3})}.bind(this)).fail(function(e){this.fire("error",{message:e.data.responseText.Message,delay:3e3})}.bind(this))}.bind(this))},fireCustomSharedData:function(e,t,i,a){this.fire("form.submitted",{isShared:e,customSharedData:{isActive:t,teamIds:i||[],projectIds:a||[]}})},handlers:{"public":function(e){this.toggleCustomSharedPanel(e,!0),this.fireCustomSharedData(!0,!1)
},"private":function(e){this.toggleCustomSharedPanel(e,!0),this.fireCustomSharedData(!1,!1)},custom:function(e){this.toggleCustomSharedPanel(e,!1),this.fireCustomSharedData(!0,!0)}},toggleCustomSharedPanel:function(e,t){var i=e.find(".i-role-popupcontent");i.toggleClass("tau-disabled",t),i.find("input,button:not([role=action-bord-access-notify])").prop("disabled",t),t&&i.find(":checkbox").prop("checked",!1)}})});