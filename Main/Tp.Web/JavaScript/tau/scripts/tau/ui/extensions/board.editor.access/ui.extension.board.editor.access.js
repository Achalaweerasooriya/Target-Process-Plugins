define(["jQuery","Underscore","tau/components/extensions/component.extension.base","tau/slice/api"],function($,_,ExtensionBase,SliceApi,ErrorExtension){return ExtensionBase.extend({getProjectsAndTeams:function($list){function intValue(input){return parseInt(input.value,10)}return _.map($list.find(".i-role-list :checked"),intValue)},"bus afterRender+configurator.ready":function(evt,renderData,configurator){var dataBind=renderData.data,$el=renderData.element,$filter=$el.find(".i-role-popupcontent"),$sectionTeams=$filter.find(".i-role-section-teams"),$sectionProjects=$filter.find(".i-role-section-projects");this.toggleCustomSharedPanel($el,!dataBind.access.customSharedData.isActive),$el.on("change","[role=action-share]",function(e){this.handlers[$(e.target).val()].bind(this)($el)}.bind(this));var notifyButton=$el.find("[role=action-bord-access-notify]");this.getProjectsAndTeams($sectionProjects).length<1&&this.getProjectsAndTeams($sectionTeams).length<1&&notifyButton.prop("disabled",!0),$el.on("click",".i-role-popupcontent :checkbox",function(e){var teamIds=this.getProjectsAndTeams($sectionTeams),projectIds=this.getProjectsAndTeams($sectionProjects);$(e.target).is(":checked")?notifyButton.prop("disabled",!1):teamIds.length<1&&projectIds.length<1&&notifyButton.prop("disabled",!0),this.fireCustomSharedData(!0,!0,teamIds,projectIds)}.bind(this)),this.fire("$popup.ready",$filter),this.fire("$teamSection.ready",$sectionTeams),this.fire("$projectSection.ready",$sectionProjects),this.fire("$sections.ready",$filter.find(".tau-teams, .tau-projects"));var dataBind=renderData.data,sliceApi=configurator.getSliceFactory().create({});notifyButton.on("click",function(){notifyButton.prop("disabled",!0);var teamIds=this.getProjectsAndTeams($sectionTeams),projectIds=this.getProjectsAndTeams($sectionProjects),url=configurator.getUrlBuilder().getBoardPageRelativePath()+configurator.getUrlBuilder().getRelativeBoardUrl(dataBind.boardId,dataBind.boardAcid);sliceApi.notifyBoardAccess({$set:{teamIds:teamIds,projectIds:projectIds,boardUrl:url,boardName:dataBind.boardName}}).done(function(data){this.fire("notification",{message:"People will be notified that you've shared a board with them",delay:3e3})}.bind(this)).fail(function(data){this.fire("error",{message:data.data.responseText.Message,delay:3e3})}.bind(this))}.bind(this))},fireCustomSharedData:function(isShared,isActive,teamIds,projectIds){this.fire("form.submitted",{isShared:isShared,customSharedData:{isActive:isActive,teamIds:teamIds||[],projectIds:projectIds||[]}})},handlers:{"public":function($renderElement){this.toggleCustomSharedPanel($renderElement,!0),this.fireCustomSharedData(!0,!1)},"private":function($renderElement){this.toggleCustomSharedPanel($renderElement,!0),this.fireCustomSharedData(!1,!1)},custom:function($renderElement){this.toggleCustomSharedPanel($renderElement,!1),this.fireCustomSharedData(!0,!0)}},toggleCustomSharedPanel:function($renderElement,disabled){var $filter=$renderElement.find(".i-role-popupcontent");$filter.toggleClass("tau-disabled",disabled),$filter.find("input,button:not([role=action-bord-access-notify])").prop("disabled",disabled),disabled&&$filter.find(":checkbox").prop("checked",!1)}})})