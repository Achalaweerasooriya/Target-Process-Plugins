define(["Underscore","jQuery","tau/core/extension.base","tau/ui/extensions/finder.entity/widgets/widget.text","tau/ui/extensions/finder.entity/widgets/widget.select","tau/ui/extensions/finder.entity/widgets/widget.entityState","tau/ui/extensions/finder.entity/widgets/widget.entityType","tau/ui/extensions/finder.entity/widgets/widget.releaseIteration","tau/ui/extensions/finder.entity/widgets/widget.project","tau/ui/extensions/finder.entity/widgets/widget.team"],function(e,t,i,a,n,r,l,u,o,d){return i.extend({"bus beforeInit + afterRender + dataBind":function(i,n,f,s){var m=e.bind(this.fire,this),b=n.config.context.configurator,c=f.element,y=c.find("form"),p=y.find(".tau-filter-line"),g={_id:new a(p.filter("[data-filter-name=_id]"),b,{name:"_id",value:s.filter._id,placeholder:"id",bubbleClassName:"tau-bubble-lookup-id tau-bubble-auto-width"}),"entityType.name":new l(p.filter('[data-filter-name="entityType.name"]'),b,{name:"entityType.name",value:s.filter["entityType.name"],query:s.filterValues.entityType,editable:e.indexOf(s.filterDisabled,"entityType.name")<0}),name:new a(p.filter("[data-filter-name=name]"),b,{name:"name",value:s.filter.name,placeholder:"Name",bubbleClassName:"tau-bubble-lookup-name"}),firstName:new a(p.filter("[data-filter-name=firstName]"),b,{name:"firstName",value:s.filter.firstName,placeholder:"First Name",bubbleClassName:"tau-bubble-lookup-name"}),lastName:new a(p.filter("[data-filter-name=lastName]"),b,{name:"lastName",value:s.filter.lastName,placeholder:"Last Name",bubbleClassName:"tau-bubble-lookup-name"}),email:new a(p.filter("[data-filter-name=email]"),b,{name:"email",value:s.filter.email,placeholder:"Email",bubbleClassName:"tau-bubble-lookup-name"}),"entityState.name":new r(p.filter('[data-filter-name="entityState.name"]'),b,{name:"entityState.name",value:s.filter["entityState.name"],query:s.filterValues.entityState,bubbleClassName:"tau-bubble-auto-width"}),"project.id":new o(p.filter('[data-filter-name="project.id"]'),b,{name:"project.id",value:s.filter["project.id"],query:s.filterValues["project.id"],bubbleClassName:"tau-bubble-lookup-project"}),"release.id":new u(p.filter('[data-filter-name="release.id"]'),b,{onlyReleases:!0,name:"release_iteration",collectionName:"release",value:{"release.id":s.filter["release.id"],"iteration.id":s.filter["iteration.id"]},query:s.filterValues.releaseIteration}),"iteration.id":new u(p.filter('[data-filter-name="iteration.id"]'),b,{name:"release_iteration",collectionName:"release",value:{"release.id":s.filter["release.id"],"iteration.id":s.filter["iteration.id"]},query:s.filterValues.releaseIteration}),"team.id":new d(p.filter('[data-filter-name="team.id"]'),b,{name:"team.id",value:s.filter["team.id"],query:s.filterValues["team.id"],collectionName:"team",bubbleClassName:"tau-bubble-lookup-team"})};
e.forEach(g,function(e){e.options.onEditStart=function(e){m("$filter.loaded",e)},e.options.onRender=function(e){e.$bubbled&&e.$bubbled.tauBubble("option","appendTo",y)}});var h=e.throttle(function(e){m("search.parametersBound",e)},200),w=y.serialize();t.whenList(e.map(g,function(e){return e.render()})).done(function(){w=y.serialize(),m("$filters.rendered",y)}),this.fire("widgets.ready",g),y.off(".filter").on("submit.filter",function(e){e.preventDefault(),e.stopPropagation()}).on("input.filter",".i-role-filter-input",function(e){var i=e.currentTarget;i.value||t(i).trigger("specialChange")}).on("keydown.filter",".i-role-filter-input",function(e){if(e.keyCode==t.ui.keyCode.ENTER){var i=t(this);i.trigger("specialChange")}}).on("keyup.filter",".i-role-filter-input",function(i){var a=i.keyCode;if(16!=a&&17!=a&&18!=a){var n=t(this),r=n.val();e.startsWith(e.trim(r),"?")||n.trigger("specialChange")}}).on("change.filter _change.filter specialChange.filter",function(){var i=y.serializeArray(),a=t.param(i);if(w!==a){w=a;var n={};e.each(i,function(e){n[e.name]=e.value}),h(n)}}),this.fire("$form.ready",y)},"bus widgets.ready:last + search.parametersBound":function(e,t,i){var a=i["entityType.name"];t["entityState.name"].refresh(a?{query:{"entityType.name":a}}:{query:null});var n=i["project.id"];n?(t["release.id"].refresh({editable:-1!=n,query:{"project.id":n}}),t["iteration.id"].refresh({editable:-1!=n,query:{"project.id":n}})):(t["release.id"].refresh({editable:!0,query:!1}),t["iteration.id"].refresh({editable:!0,query:!1}))},"bus $form.ready + $listholder.ready + content.ready":function(e,i){var a=i.find(".i-role-filter-input"),n=i.find(".i-role-help");n.data("ui-tauBubble")&&n.tauBubble("option","content").on("click",function(e){t(e.target).attr("contenteditable")||a.focus()});var r=a.data("ui-autocomplete");delete r._change}})});