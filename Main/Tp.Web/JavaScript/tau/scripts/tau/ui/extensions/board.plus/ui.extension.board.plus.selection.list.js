define(["jQuery","Underscore","tau/core/extension.base"],function(e,t,a){return a.extend({init:function(){this._super.apply(this,arguments),this.fire("view.card.selection.ref",{last:{position:-1},stack:[]})},"bus configurator.ready:last + view.card.selection.ref:last + domWrapper.ready":function(e,a,s,i){var l=this,c="tau-selected",r=i.getGrid();r.tauSelectable({items:".i-role-card",triggerSelector:":not([contenteditable=true])",ctrl:!0,forceSelection:!0,className:c,changed:function(e,a){var i=a.item,c=a.selected,r=i.data();if(c)s.last.position=i.index(),s.stack[s.stack.length-1]!==r.id&&s.stack.push(r.id);else{var n=t.indexOf(s.stack,r.id);s.stack.splice(n,1)}l.fire("view.card.selected",{element:i,selected:c})}}),l.fire("$selectable.ready",r)},"bus $selectable.ready + domWrapper.ready + overview.board.ready":function(e,t,a){var s=a.getCardByPositionOrLast(0);t.tauSelectable("select",s)},"bus domWrapper.ready:last + $selectable.ready:last + view.card.selection.ref:last + selection.reapply":function(a,s,i,l){var c=i.tauSelectable("getSelected");i.tauSelectable("option","fireEvents",!1),i.tauSelectable("select",c),i.tauSelectable("option","fireEvents",!0);var r=[];c.each(function(){r.push(e(this).data("id"))}),l.stack=t.intersection(l.stack,r);var n=null;if(0===l.stack.length)n=s.getCardByPositionOrLast(l.last.position),n.size()>0?i.tauSelectable("select",n):this.fire("view.empty.cardDetails");else{var o=l.stack[l.stack.length-1];n=s.getCardBySliceId(o),l.last.position=n.index()}},"bus $selectable.ready:last + view.card.selected":function(e,t,a){t.tauSelectable("option","fireEvents",!1),t.tauSelectable(a.selected?"select":"reset",a.element),t.tauSelectable("option","fireEvents",!0)}})});