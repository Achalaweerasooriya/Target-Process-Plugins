define(["Underscore"],function(a){return{coeffs:null,availableCards:0,freeCards:0,absoluteCardsIncrementation:null,_createFilledArray:function(a,t){for(var e=0,r=new Array(a);a>e;e++)r[e]=t;return r},_translateCoeff:function(a,t){var e=Math.min(this.availableCards,Math.round(this.freeCards*a));this.absoluteCardsIncrementation[t]+=e,this.availableCards-=e},_translateCoeffs:function(){this.freeCards=this.availableCards,a.each(this.coeffs,this._translateCoeff,this),this.coeffs.pop()},_normalizeCoeffs:function(){var t=1/a.sum(this.coeffs);this.coeffs=a.map(this.coeffs,function(a){return a*t})},_distributionByCardsCount:function(t){var e=a.reduce(t,function(a,t){return a+t.cardsNum},0);e=e||1;var r=!0,s=a.map(t,function(t){var s=t.cardsNum>0?a.chain(t.items).pluck("cardsNum").max().value()/e:0;return 0!==s&&(r=!1),s});if(r){var n=1/s.length;s=this._createFilledArray(s.length,n)}return s},calculate:function(a,t){for(this.coeffs=this._distributionByCardsCount(a),this.absoluteCardsIncrementation=this._createFilledArray(a.length,0),this.availableCards=t;this.availableCards>0;)this._normalizeCoeffs(),this._translateCoeffs();return this.absoluteCardsIncrementation}}});