define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.htmlConverter"],function(_,$,BaseExtension,htmlConverter){return BaseExtension.extend({"bus beforeInit + afterRender":function(evt,initConfig,renderData){var $el=renderData.element,contentSelector=initConfig.config.shortcutProcessorTarget,$content=$el.find(contentSelector),store=initConfig.config.context.configurator.getStore(),entitiesIds=[],self=this,re=/\b(?:id):(?:\W|&nbsp;){0,5}(\d+)\b/gi;$content.each(function(i,item){var $item=$(item),itemHtml=$item.html(),changed=!1;itemHtml=itemHtml.replace(re,function(){changed=!0;var id=arguments[1];return entitiesIds.push(id),"<span class='tau-shortcut-loading' data-entity-id='"+id+"'>id:"+id+"</span>"});var processedHtml=htmlConverter.replacePlainTextUrlWithHTML(itemHtml);itemHtml!=processedHtml&&(itemHtml=processedHtml,changed=!0),changed&&$item.html(itemHtml)}),entitiesIds=_.uniq(entitiesIds);var self=this;entitiesIds.length?(_.forEach(entitiesIds,function(id){store=store.get("general",{id:id,fields:["id","name",{entityType:["id","name"]}],silent:!0},{success:function(res){self.fire("shortcut.readyToInsert",res.data)}})}),store.done(function(){self.fire("shortcuts.completed",{})})):this.fire("shortcuts.completed",{})},"bus afterRender:last + shortcut.readyToInsert":function(obj,renderData,shortcut){var $el=renderData.element,$link=$('<a href="#'+shortcut.entityType.name.toLowerCase()+"/"+shortcut.id+'">'+"#"+shortcut.id+"&nbsp;"+$.jqotenc(shortcut.name)+"</a>");$el.find("[data-entity-id="+shortcut.id+"]").each(function(){$(this).replaceWith($link.clone())})}})})