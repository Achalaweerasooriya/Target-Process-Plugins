define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.listSelectable"],function(_,$,a){return a.extend({"bus afterRender":function(a){var b=a.data.element,c=b.find("[role=list]"),d=b.find("[role=list-placeholder]");this.$list=c,this.$listPlaceholder=d,this.first=!0,this.$listPlaceholder.listSelectable({items:"[role=option]",className:"tau-result-list-row_hover",inner:"table"}),this.attachScrollingEvents(d),this.attachSortingEvents(b.find("[role=list-sorting]")),this.setScrollAvailable(!1),this._signUpOnActionsAndSelection(b)},"bus result.ready":function(a){var b=this.$listPlaceholder.data("listSelectable")._index;this.$listPlaceholder.listSelectable("disable");var c=this,d=this.$list,e=a.data.data.result,f=this.config.templateList,g=f.get().bind(this.config,e);e.paging.start==0&&(d.empty(),b=-1,e.paging.count==0&&this.$listPlaceholder.toggleClass("tau-finder__result_state_empty",!0)),this.setScrollAvailable(e.paging.hasNext),g.find("[role=option]").appendTo(d),this.$listPlaceholder.toggleClass("tau-finder__result_state_loading",!1),e.paging.count>0&&this.$listPlaceholder.toggleClass("tau-finder__result_state_empty",!1),this.$listPlaceholder.listSelectable("enable",{saveScroll:!0}),this.$listPlaceholder.data("listSelectable")._index=b,this.first&&(setTimeout(function(){c.$listPlaceholder.scrollTop(0)},100),this.first=!1)},"bus scroll.reachEnd":function(a){this.scrollAvailable&&this.bus.fire("search.pagingBound")},setScrollAvailable:function(a){this.scrollAvailable=a},attachScrollingEvents:function(a){var b=this,c=function(c){a.scrollTop()+a.innerHeight()>=a[0].scrollHeight&&b.bus.fire("scroll.reachEnd")};a.scroll(c)},attachSortingEvents:function(a){var b=a.find("[role=sorting]"),c=this;a.delegate("[role=sorting]","click",function(){var a=$(this),d="desc";a.hasClass("tau-finder__sorttrigger_dir_"+d)&&(d="asc"),b.toggleClass("tau-finder__sorttrigger_dir_desc",!1),b.toggleClass("tau-finder__sorttrigger_dir_asc",!1),b.toggleClass("tau-finder__sorttrigger_state_active",!1),a.toggleClass("tau-finder__sorttrigger_dir_"+d,!0),a.toggleClass("tau-finder__sorttrigger_state_active",!0);var e=a.val();c.bus.fire("search.orderBound",{value:e,dir:d})})},_signUpOnActionsAndSelection:function(a){var b=this;a.delegate("[role=option]","click",function(a){var c=$(this),d=c.data();if(!d)return;if(!d.tmplItem)return;d=d.tmplItem.data;if(!d)return;b.bus.fire("entitySelected",{entity:d})})}})})