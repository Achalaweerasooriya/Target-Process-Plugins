define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.listSelectable"],function(t,e,i){return i.extend({"bus afterRender":function(t){var e=t.data.element;this.$list=e.find("[role=list]");var i=e.find("[role=list-placeholder]");this.$listPlaceholder=i,this.first=!0,this.$listPlaceholder.listSelectable({items:"[role=option]",className:"tau-result-list-row_hover",inner:"table",keyboardManager:this.config.context.configurator.getKeyBoardManager()}),this.attachScrollingEvents(i),this.attachSortingEvents(e.find("[role=list-sorting]")),this.setScrollAvailable(!1),this._signUpOnActionsAndSelection(e)},"bus result.ready":function(t){var e=this.$listPlaceholder,i=e.data("ui-listSelectable")._index;e.listSelectable("disable");var s=t.data.data.result,l=this.config.templateList,a=l.get().bind(this.config,s);0==s.paging.start&&(this.$list.empty(),i=-1,0==s.paging.count&&e.toggleClass("tau-finder__result_state_empty",!0)),this.setScrollAvailable(s.paging.hasNext),a.find("[role=option]").appendTo(this.$list),e.toggleClass("tau-finder__result_state_loading",!1),s.paging.count>0&&e.toggleClass("tau-finder__result_state_empty",!1),e.listSelectable("enable",{saveScroll:!0}),e.data("ui-listSelectable")._index=i,this.first&&(setTimeout(function(){e.scrollTop(0)},100),this.first=!1)},"bus scroll.reachEnd":function(){this.scrollAvailable&&this.bus.fire("search.pagingBound")},setScrollAvailable:function(t){this.scrollAvailable=t},attachScrollingEvents:function(t){var e=this;t.scroll(function(){t.scrollTop()+t.innerHeight()>=t[0].scrollHeight&&e.bus.fire("scroll.reachEnd")})},attachSortingEvents:function(t){var i=t.find("[role=sorting]"),s=this;t.delegate("[role=sorting]","click",function(){var t="tau-finder__sorttrigger_dir_",l=e(this),a=l.hasClass(t+"desc")?"asc":"desc";i.toggleClass(t+"desc",!1),i.toggleClass(t+"asc",!1),i.toggleClass("tau-finder__sorttrigger_state_active",!1),l.toggleClass(t+a,!0),l.toggleClass("tau-finder__sorttrigger_state_active",!0);
var n=l.val();s.bus.fire("search.orderBound",{value:n,dir:a})})},_signUpOnActionsAndSelection:function(t){var i=this;t.delegate("[role=option]","click",function(){var t=e(this),s=t.data("tmplItem");if(s){var l=s.data;l&&i.bus.fire("entitySelected",{entity:l})}})}})});