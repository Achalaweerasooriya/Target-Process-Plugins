define(["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evtArgs){var config=this.config=evtArgs.data.config;if(config.hasOwnProperty("stateName")){var state=config[config.stateName];if(_.isNull(state)||_.isUndefined(state))return;var collapsed=state.toString().toLowerCase()=="true";config.collapsed=collapsed,this.collapsed=collapsed}},getStateName:function(){return this.config.stateName},onStateChanged:function(stateObject){var state=stateObject[this.getStateName()];if(_.isNull(state)||_.isUndefined(state))state=this.collapsed;var collapsed=state.toString().toLowerCase()=="true",eventName=collapsed?"collapse":"expand",config=this.config;config.collapsed=collapsed;var stateName=config.stateName;stateName&&(config[stateName]=collapsed),this.fire(eventName)},"bus childrenRendered":function(evt){var children=evt.data.children,header=children[0];header.on("expanded",this.onExpanded,this),header.on("collapsed",this.onCollapsed,this)},onCollapsed:function(){this.saveState(!0)},onExpanded:function(){this.saveState(!1)},saveState:function(collapsed){var stateName=this.getStateName();if(stateName&&this.config[stateName]!=collapsed){var self=this,componentSettings=self.config.context.componentSettings;if(componentSettings){var set={};set[stateName]=collapsed,componentSettings.set({set:set})}}},"bus destroy":function(evt){var self=this,componentSettings=self.config.context.componentSettings;componentSettings&&componentSettings.unbind({listener:self})},"bus initialize":function(evtArgs){var self=this,componentSettings=self.config.context.componentSettings;componentSettings&&componentSettings.bind({fields:[this.getStateName()],listener:self,callback:self.onStateChanged})}})})