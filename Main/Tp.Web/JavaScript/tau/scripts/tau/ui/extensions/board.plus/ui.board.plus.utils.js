define(["Underscore"],function(_){var cache={},esc=function(str){return _.trim(str)},cardsIds={};return{esc:esc,getDomNodeByIdFast:function($parent,domId){return window.document.getElementById(domId)},generateId:function(dataItem){var idParts=[];return dataItem.hasOwnProperty("x")&&(idParts.push("x"),idParts.push(dataItem.x),idParts.push("-")),dataItem.hasOwnProperty("y")&&(idParts.push("y"),idParts.push(dataItem.y),idParts.push("-")),esc(idParts.join(""))},generateElementData:function(src){var result=[];return _.forEach(src,function(val,key){_.isUndefined(val)||result.push("data-"+key+'="'+val+'"')}),result.join(" ")},getCardIds:function(item){return cardsIds[item.id]||[]},getCardId:function(item){return cardsIds[item.id]||[]},getLatestCardId:function(itemId){var ids=cardsIds[itemId];return ids[ids.length-1]},resetCardIds:function(){cardsIds={}},getCardSeed:function(item){return item.type.toLowerCase()+"-"+item.id},generateCardId:function(item){var cardIdCollection=cardsIds[item.id]=cardsIds[item.id]||[],id=this.getCardSeed(item)+"-"+cardIdCollection.length;return cardIdCollection.push(id),id},dimension:function($grid,$headerCell){var gId=$grid.attr("id");cache[gId]={};var gridCache=cache[gId],data={x:$headerCell.attr("data-x"),y:$headerCell.attr("data-y")},role=$headerCell.attr("role");gridCache.all||(gridCache.all=$grid.find("td.i-role-"+role));var s=function(){return!1};data.x&&(s=function(){return this.getAttribute("data-x")==data.x}),data.y&&(s=function(){return this.getAttribute("data-y")==data.y});var id=$headerCell.attr("id");return gridCache[id]||(gridCache[id]=gridCache.all.filter(s)),gridCache[id]},isHidden:function($cell){return $cell.attr("data-is-hidden")||!1},isSupportedCardForView:function(cardData){var notSupportedTypes=["role","requesttype","severity","tag","process"];return!_.include(notSupportedTypes,cardData.entityType)},convertCellAxisData:function(dataDynamicItems){var item=dataDynamicItems.dynamic&&dataDynamicItems.dynamic.items&&dataDynamicItems.dynamic.items.length?dataDynamicItems.dynamic.items[0]:null,id=null,name="",isEntity=!1,entity={id:null,type:null},isSupportView=!1,itemData={};if(item){itemData=item.data,name=item.name||"";if(itemData)if(itemData.name)name=itemData.name;else if(_.isArray(itemData.names))name=itemData.names.join(", ");else if(itemData.type.toLowerCase()=="user"||itemData.hasOwnProperty("firstName")&&itemData.hasOwnProperty("lastName"))name=_.trim(_.asString(itemData.firstName)+" "+_.asString(itemData.lastName))||_.asString(itemData.email);id=item.id,entity={id:itemData.id?itemData.id:null,type:item.type?item.type.toLowerCase():null},isEntity=!!entity.id&&!!entity.type,isEntity&&(isSupportView=this.isSupportedCardForView({entityType:entity.type})),item.type.toLowerCase()=="team"&&(itemData.users=itemData.users||[],itemData.users=_.map(itemData.users,function(user){return _.extend(user,{name:_.trim(_.asString(user.firstName)+" "+_.asString(user.lastName))||_.asString(user.email),avatarUri:user.avatarUri})}))}return _.extend(dataDynamicItems,{id:id,name:name,itemData:itemData,isEntity:isEntity,isSupportView:isSupportView,entity:entity})}}})