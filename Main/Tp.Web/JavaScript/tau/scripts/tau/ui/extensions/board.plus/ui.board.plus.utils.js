define(["Underscore","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/models/board.customize.units/board.customize.units.settings.default","tau/ui/templates/board.plus/customized/ui.template.boardplus.card-fake.customized","tau/models/board.customize.units/const.card.sizes"],function(t,e,n,r,a){var i=["feature","userstory","task","bug","request","testcase","testcaserun","testplan","testplanrun","impediment","user","team","project","release","iteration","teamiteration","build","projectmember"],s={},u=function(e){return t.trim(e)},o={};return{esc:u,getDomNodeByIdFast:function(t,e){return window.document.getElementById(e)},generateId:function(t){var e=[];return t.hasOwnProperty("x")&&(e.push("x"),e.push(t.x),e.push("-")),t.hasOwnProperty("y")&&(e.push("y"),e.push(t.y),e.push("-")),u(e.join(""))},generateElementData:function(e){var n=[];return t.forEach(e,function(e,r){t.isUndefined(e)||n.push("data-"+r.toLowerCase()+'="'+t.escape(e)+'"')}),n.join(" ")},getCardIds:function(t){return o[t.id]||[]},getCardId:function(t){return o[t.id]||[]},getLatestCardId:function(t){var e=o[t];return e[e.length-1]},resetCardIds:function(){o={}},getCardSeed:function(t){return t.type.toLowerCase()+"-"+t.id},generateCardId:function(t){var e=o[t.id]=o[t.id]||[],n=this.getCardSeed(t)+"-"+e.length;return e.push(n),n},dimension:function(t,e){var n=t.attr("id");s[n]={};var r=s[n],a={x:e.attr("data-x"),y:e.attr("data-y")},i=e.attr("role");r.all||(r.all=t.find(".i-role-"+i));var u=function(){return!1};a.x&&(u=function(){return this.getAttribute("data-x")==a.x}),a.y&&(u=function(){return this.getAttribute("data-y")==a.y});var o=e.attr("id");return r[o]||(r[o]=r.all.filter(u)),r[o]},isHidden:function(t){return t.attr("data-is-hidden")||!1},isSupportedCardForView:function(e){var n=t.isString(e)?e:e.entityType;return t.include(i,n.toLowerCase())},convertCellAxisData:function(e){var n,r=e.dynamic&&e.dynamic.items&&e.dynamic.items.length?e.dynamic.items[0]:null;return r?(n={id:r.id,name:this._getCellAxisName(r),itemData:this._getItemDataTypeSpecificAugmented(r),entity:{id:this._getEntityId(r),type:this._getEntityType(r)}},n.isEntity=!(!n.entity.id||!n.entity.type),n.isSupportView=n.isEntity&&this.isSupportedCardForView({entityType:n.entity.type})):n={id:null,name:"",itemData:{},entity:{id:null,type:null},isEntity:!1,isSupportView:!1},t.extend(e,n)},getOperationLocation:function(t){var e=(t.items[0].location||"card").toLowerCase(),n=e;return"card"!==e&&(n=e.charAt(0)),n},isCardReBuildOperation:function(e){var n=this.getOperationLocation(e);return t.contains(["updated","added","cascade"],e.name)&&"card"===n},getClassForCustomizeSection:function(t){var e="";return t.forEach(function(t){2==t.unit.sections?e="tau-card-v2__section_double":3==t.unit.sections&&(e="tau-card-v2__section_triple")}),e},orderListUnits:function(e){return t.sortBy(e,function(t){return-t.rank})},getListKeyByTypes:function(t){return t=t||[],"list_"+t.join("_")},getCardRenderData:function(t,e,n){return e?{dataItem:t,layout:e,configurator:n}:t},getCardSize:t.memoize(function(t,e,i){var s=i||0,u=n.get(e,t).length,o=r.get().bind({},{size:e,countSections:u,type:t});o.appendTo("body");var d,c=o.find(".i-role-card");d=e===a.XL?parseInt(c.css("minWidth"),10):c.outerWidth();var m={width:Math.ceil(d+s),height:Math.ceil(c.outerHeight()+2*s)};return o.remove(),m},function(t,e,n){return t+e+n}),_getItemDataTypeSpecificAugmented:function(e){var n=e.data;return"team"==e.type.toLowerCase()&&(n.users=n.users||[],n.users=t.map(n.users,function(e){return t.extend(e,{name:t.trim(t.asString(e.firstName)+" "+t.asString(e.lastName))||t.asString(e.email),avatarUri:e.avatarUri})})),n},_getCellAxisName:function(e){var n=e.name||"",r=e.data;return r&&(r.name?n=r.name:t.isArray(r.names)?n=r.names.join(", "):("user"==r.type.toLowerCase()||r.hasOwnProperty("firstName")&&r.hasOwnProperty("lastName"))&&(n=t.trim(t.asString(r.firstName)+" "+t.asString(r.lastName))||t.asString(r.email))),n},_getEntityId:function(t){return t.data&&t.data.id?t.data.id:null},_getEntityType:function(t){return t.data&&t.data.type?t.data.type.toLowerCase():t.type?t.type.toLowerCase():""}}});