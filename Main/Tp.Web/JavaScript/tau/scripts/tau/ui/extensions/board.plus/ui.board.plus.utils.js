define(["require","Underscore","tau/models/board.customize.units/board.customize.units.settings.default.repository","tau/ui/templates/board.plus/customized/ui.template.boardplus.card-fake.customized","tau/models/board.customize.units/const.card.sizes","tau/utils/utils.convertUserName"],function(t){var e=t("Underscore"),r=t("tau/models/board.customize.units/board.customize.units.settings.default.repository"),n=t("tau/ui/templates/board.plus/customized/ui.template.boardplus.card-fake.customized"),a=t("tau/models/board.customize.units/const.card.sizes"),i=t("tau/utils/utils.convertUserName"),u=["epic","feature","userstory","task","bug","request","testcase","testcaserun","testplan","testplanrun","impediment","user","requester","team","project","release","iteration","teamiteration","build","projectmember","program"],o={},s=function(t){return e.trim(t)},d={};return{esc:s,getDomNodeByIdFast:function(t,e){return window.document.getElementById(e)},generateId:function(t){var e=[];return t.hasOwnProperty("x")&&e.push("x",t.x,"-"),t.hasOwnProperty("y")&&e.push("y",t.y,"-"),s(e.join(""))},generateHolderId:function(t){return"ch_"+this.generateId(t)},generateElementData:function(t){var r=[];return e.forEach(t,function(t,n){e.isUndefined(t)||r.push("data-"+n.toLowerCase()+'="'+e.escape(t)+'"')}),r.join(" ")},getCardIds:function(t){return d[t.id]||[]},getCardId:function(t){return d[t.id]||[]},getLatestCardId:function(t){var e=d[t];return e[e.length-1]},resetCardIds:function(){d={}},getCardSeed:function(t){return t.type.toLowerCase()+"-"+t.id},generateCardId:function(t){var e=d[t.id]=d[t.id]||[],r=this.getCardSeed(t)+"-"+e.length;return e.push(r),r},dimension:function(t,e){var r=t.attr("id");o[r]={};var n=o[r],a={x:e.attr("data-x"),y:e.attr("data-y")},i=e.attr("role");n.all||(n.all=t.find(".i-role-"+i));var u=e.attr("id");if(!n[u]){var s=function(){return!1};a.x&&(s=function(){return this.getAttribute("data-x")==a.x}),a.y&&(s=function(){return this.getAttribute("data-y")==a.y}),n[u]=n.all.filter(s)
}return n[u]},isHidden:function(t){return t.attr("data-is-hidden")||!1},isSupportedCardForView:function(t){var r=e.isString(t)?t:t.entityType;return e.include(u,r.toLowerCase())},convertCellAxisData:function(t){var r,n=t.dynamic&&t.dynamic.items&&t.dynamic.items.length?t.dynamic.items[0]:null;return n?(r={id:n.id,name:this._getCellAxisName(n),itemData:this._getItemDataTypeSpecificAugmented(n),entity:{id:this._getEntityId(n),type:this._getEntityType(n)}},r.isEntity=!(!r.entity.id||!r.entity.type),r.isSupportView=r.isEntity&&this.isSupportedCardForView({entityType:r.entity.type})):r={id:null,name:"",itemData:{},entity:{id:null,type:null},isEntity:!1,isSupportView:!1},e.extend(t,r)},getOperationLocation:function(t){var e=(t.items[0].location||"card").toLowerCase(),r=e;return"card"!==e&&(r=e.charAt(0)),r},isCardReBuildOperation:function(t){var r=this.getOperationLocation(t);return e.contains(["updated","added","cascade"],t.name)&&"card"===r},getClassForCustomizeSection:function(t){var e="";return t.forEach(function(t){2==t.unit.sections?e="tau-card-v2__section_double":3==t.unit.sections&&(e="tau-card-v2__section_triple")}),e},orderListUnits:function(t){return e.sortBy(t,function(t){return-t.rank})},getListKeyByTypes:function(t){t=t||[];var e="list_"+t.join("_");return e.toLowerCase()},getCardRenderData:function(t,e,r){return e?{dataItem:t,layout:e,configurator:r}:t},getCardSize:e.memoize(function(t,e,i){var u=i||0,o=r.get(e,t).length,s=n.get().bind({},{size:e,countSections:o,type:t});s.appendTo("body");var d,c=s.find(".i-role-card");d=e===a.XL?parseInt(c.css("minWidth"),10):c.outerWidth();var l={width:Math.ceil(d+u),height:Math.ceil(c.outerHeight()+2*u)};return s.remove(),l},function(t,e,r){return t+e+r}),_getItemDataTypeSpecificAugmented:function(t){var r=t.data;return"team"==t.type.toLowerCase()&&(r.users=r.users||[],r.users=e.map(r.users,function(t){return e.extend(t,{name:i.getFullName(t),avatarUri:t.avatarUri})})),r},_getCellAxisName:function(t){var r=t.name||"",n=t.data;
return n&&(n.name?r=n.name:e.isArray(n.names)?r=n.names.join(", "):("user"==n.type.toLowerCase()||n.hasOwnProperty("firstName")&&n.hasOwnProperty("lastName"))&&(r=i.getFullName(n))),r},_getEntityId:function(t){return t.data&&t.data.id?t.data.id:null},_getEntityType:function(t){return t.data&&t.data.type?t.data.type.toLowerCase():t.type?t.type.toLowerCase():""}}});