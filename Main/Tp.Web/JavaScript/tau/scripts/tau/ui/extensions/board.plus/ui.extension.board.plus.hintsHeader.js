define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,a){return a.extend({"bus $el.ready":function(e,t){var a=t.find(".i-role-header");a.length&&this.fire("$headers.ready",a)},"bus $headers.ready":function(e,t){var a=function(e){e.my="center top",e.at="center-1 bottom+5"};t.tauBubble({className:"tau-cardtooltip tau-cardtooltip-header",showEvent:"nothing",template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow" role="arrow"></div>','<div class="tau-bubble-board__inner tau-container" role="content"></div>',"</div>"].join(""),zIndex:1e3,onPositionConfig:a,onArrowPositionConfig:a}),this.fire("$bubbledHeader.ready",t),this.fire("hintHeader.enable",t)},"bus $bubbledHeader.ready:last + sort.started":function(e,t){this._disableHints(t)},"bus $bubbledHeader.ready:last + view.card.batch.move.after":function(t,a){e.delay(e.bind(this.fire,this,"hintHeader.enable",a),100)},"bus hintHeader.enable":function(e,t){this._enableHints(t)},destroy:function(){clearTimeout(this.timeout),this._super()},_showHint:function(e,a){var i=a.find(".i-role-cellaxis-viewtrigger"),n=i.data("entityType");if(n){var d=e.tauBubble("widget");d.length&&n!=d.data("entityType")&&(d.removeClass("tau-cardtooltip-header-"+d.data("entityType")),d.data("entityType",n),d.addClass("tau-cardtooltip-header-"+n)),"y"==e.data("dimension")&&i.children().length&&(i=i.children().first());var r=a.find(".i-role-name").text(),o=['<div class="tau-card-v2  tau-card-v2_type_'+n+'">','<div class="tau-card-v2__section tau-card-v2__section_double">','<div class="tau-board-unit tau-board-unit_format_max tau-board-unit_alignment_base tau-board-unit_type_entity-name-extended">','<div class="tau-board-unit__value tau-name">'+r+"</div>","</div>","</div>",'<div class="tau-card-v2__section"></div>',"</div>"].join(""),s={content:t(o),alignTo:i};d.length||(s.className="tau-cardtooltip tau-cardtooltip-header tau-cardtooltip-header-"+n),e.tauBubble("option",s),e.tauBubble("show")}},_showHandler:function(a,i){var n=t(i.currentTarget);
if("y"==a.data("dimension")){if(!a.parents(".rows-h-collapsed:first").length)return void a.tauBubble("disable");a.tauBubble("enable")}else{if(!n.parents(".i-role-cellholder:first").hasClass("tau-collapsed"))return void a.tauBubble("disable");a.tauBubble("enable")}clearTimeout(this.timeout),this.timeout=setTimeout(e.bind(this._showHint,this,a,n),500)},_hideHandler:function(e){clearTimeout(this.timeout),e.data("ui-tauBubble")&&e.tauBubble("hide")},_enableHints:function(t){this._disableHints(t);var a=".tau-label";t.on("mouseenter.headerHint",a,e.bind(this._showHandler,this,t)),t.on("mouseleave.headerHint",a,e.bind(this._hideHandler,this,t))},_disableHints:function(e){this._hideHandler(e),e.off(".headerHint")}})});