define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.tauBubble"],function(a,b,c,d){return c.extend({"bus afterRender":function(a){this.$root=a.data.element,this.$el=a.data.element.find("[role=comment-form]")},"bus prioritize.updateGroupsCommentRequirements":function(b){var c=b.data.groups,d=this.$root.find("[role=group]");d.data("isCommentRequired",!1),a.forEach(c,function(a,b){d.eq(b).data("isCommentRequired",a.isCommentRequired)})},"bus prioritize.checkAvailability":function(b){var c=b.data.$targetGroup,d=b.data.$prevGroup;if(!c.data("isCommentRequired")||c[0]===d[0]){this.fire("prioritize.isAvailable.comment");return}var e=b.data.$item;this.$item=e;var f=b.data.item;this.item=f;var g=this.$el,h=b.data.isCollapsed,i=!1;h==0?i=e.find("[role=sortable-handler]"):i=c.find("[role=title]"),e.tauBubble({showOnCreation:!0,alignTo:i}),g.detach(),e.tauBubble("widget").find("[role=content]").append(g),g.show();var j=g.find("textarea");j.val("").focus();var k=g.find(":button"),l=k.eq(0);l.bind("click",a.bind(this._save,this));var m=k.eq(1);m.bind("click",a.bind(this._cancel,this)),e.bind("taububblehide",a.bind(this._cancel,this));var n=function(){window.setTimeout(function(){var a=j.val()||"",b=a.trim().length===0;l.attr("disabled",b?"disabled":!1),b?l.addClass("disable"):l.removeClass("disable")},50)};n(),l.bind("focus",n),j.bind("change keypress",n)},_save:function(a){a.stopPropagation();var b=this,c=this.$el,d=c.find("textarea").val(),e=b.config.store,f=b.item;c.addClass("updating"),e.save("comment",{$set:{description:d,general:{id:f.id}},$include:["id","description","createDate","parentId",{owner:["id","firstName","lastName"]}]}).done({success:function(){c.removeClass("updating"),b.fire("prioritize.isAvailable.comment"),b.$item.tauBubble("destroy")},failure:function(){b.fire("prioritize.isNotAvailable")}})},_cancel:function(){var a=this;a.fire("prioritize.isNotAvailable")}})})