define(["Underscore","tau/libs/store2/store2","tau/core/extension.base"],function(e,t,a){return a.extend({category:"edit","bus configurator.ready":function(e,a){this.fire("store2.ready",new t(a))},"bus store2.ready:last + tagsProcessor.ready:last + autocomplete.resolve":function(t,a,n,o){var r=o.$input[0].selectionEnd;if(e.isUndefined(r)&&document.selection){var s=document.selection.createRange(),i=document.selection.createRange().text.length;s.moveStart("character",-o.$input.val().length),r=s.text.length-i}var u=o.request.term.substr(0,r),c=e.ltrim(e.strRightBack(u,","));c.length>1?(r-=c.length,o.$input.data("acTerm",c),o.$input.data("acPos",r),a.findAll("Tag?select={"+["name"].join(",")+'}&where=name.startsWith("'+a.arg(c.toLowerCase())+'")').done(function(t){var a=n.asArray(e.pluck(t,"name"));a=e.sortBy(a,function(e){return e.toLowerCase()}),o.next(a)})):o.next([])},"bus tagsProcessor.ready:last + $editor.shown":function(t,a,n){var o=n.find(":text"),r=e.bind(this.fire,this);o.autocomplete({minLength:2,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(e,t){r("autocomplete.resolve",{$input:o,request:e,next:t})},focus:function(){return!1},select:function(e,t){var n=t.item.value,r=o.val(),s=r.substr(0,o.data("acPos"))+r.slice(o.data("acPos")+o.data("acTerm").length);return s=a.asArray(s),s.push(n),s=a.asString(s),o.val(s),o.focus(),!1}});var s=o.data("ui-autocomplete");s._renderItem=function(t,a){return $("<li class='tau-autocomplete__item'></li>").data("ui-autocomplete-item",a).append("<a class='tau-autocomplete__itemtrigger drop-down-option'>"+e.escape(a.label)+"</a>").appendTo(t)},s._renderMenu=function(e,t){$(e).addClass("tau-autocomplete__menu drop-down-list tau-autocomplete__menu__tags").css({maxHeight:.4*$(window).height(),zIndex:this.element.zIndex()+1});var a=this;$.each(t,function(t,n){a._renderItem(e,n)})}}})});