define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,n){return n.extend({_selectText:function(e){e[0].setSelectionRange(0,e.val().length)},_initForm:function(e){var t=e.find(".i-role-form");setTimeout(function(){t.find(":submit:first").focus(),t.find(":text:first").focus()},10),e.find(".i-role-formtrigger").toggleClass("tau-active"),e.toggleClass("tau-managed-category_formactive_true"),t.on("reset",function(){t.find(":input").removeClass("tau-error"),t.find(":submit:first").focus(),t.find(":text:first").focus()}),t.on("click","[type=reset]",function(){e.removeClass("tau-managed-category_formactive_true"),e.find(".i-role-formtrigger").removeClass("tau-active")});var n=function(){t.find(":not(.disabled)").prop("disabled",!1),t.tauProgressIndicator("hide")};return t.on("entity.add.completed",n),t.on("entity.add.failed",n),t.tauProgressIndicator(),t},_parseForm:function(t){var n={};return t.find(":input").each(function(){n[this.name]=this.value}),n.members=t.find("[name=users]").tauInviter("getValue",!0),e.extend(n,this.parseConnected(t))},parseConnected:function(e){var n={};n.connected=[];var i=e.find(".i-role-list :checked");return i.each(function(){n.connected.push({id:t(this).val()})}),n},_addSubmitDataListener:function(e,t){e.on("submit",function(n){n.preventDefault();var i=this._parseForm(e);e.find(":not(.disabled)").prop("disabled",!0),e.tauProgressIndicator("show"),t(i)}.bind(this))},_initRichSelect:function(e,n){var i=e.find(".i-role-currenticon");return n.on("change",function(){var e=n.val();i.trigger("change",e),i.attr("data-value",e||"default")}),e.delegate(".i-role-richselect .i-role-option","click",function(){var t=this.getAttribute("data-value");n.val(t),n.trigger("change"),e.find(":text:first").focus()}),i.parent().on("click",function(){t(this).toggleClass("tau-active"),e.find(".i-role-richselect").toggle()}),e.on("reset",function(){n.val(""),n.trigger("change")}),i},_addToList:function(t,n,i){i.selected=!0,i.isSupportView=!0;var r=n.bind({},i),a=(t.find(".i-role-form"),t.find(".i-role-list")),o=a.find(".i-role-item:first");
o.length?o.after(r):a.append(r),a.parent().scrollTo(0,{duration:500}),r.addClass("tau-added"),e.delay(function(){r.removeClass("tau-added")},1500)}})});