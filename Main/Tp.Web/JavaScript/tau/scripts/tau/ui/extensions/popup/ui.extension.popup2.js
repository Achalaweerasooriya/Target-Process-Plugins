define(["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus initialize":function(){var self=this,$body=$("body");$body.data("prevOverflow",$body.css("overflow")),self.fire("$body.ready",$body)},"bus $body.ready":function(evt,$body){var self=this,id=_.uniqueId(),$overlay=$('<div class="ui-popup-overlay" id="ui_popup_overlay_'+id+'" style="display: none;"></div>'),$container=$('<div class="ui-popup"  id="ui_popup_'+id+'" style="display: none;"><div class="close"></div></div>'),$closeButton=$container.find(".close");$overlay.appendTo($body),$container.appendTo($body),self.fire("$overlay.ready",$overlay),self.fire("$container.ready",$container),self.fire("$closeButton.ready",$container)},"bus    $body.ready:last        +                 $overlay.ready:last     +                 $container.ready:last   +                 $closeButton.ready:last +                 contentRendered":function(evt,$body,$overlay,$container,$closeButton,content){console.log(evt);var self=this,$content=content.element;$body.css("overflow","hidden"),$overlay.show(),$content.addClass("ui-popup-content"),$content.appendTo($container),$container.show(),this.fire("popup.visible")},"bus $overlay.ready:last+popup.visible":function($overlay){var _exit=_.bind(function(){this.fire("popup.close")},this),_handler=_.bind(function($overlay,cb,e){$overlay.is(e.target)&&cb()},this,$overlay,_exit);$(document).bind("click",this._handler)},"bus $overview.ready:last+popup.hide":function(evt,$overlay){$overlay.hide(),$(document).unbind("click")},"bus configurator.ready:last+popup.visible":function(evt,configurator){var _exit=_.bind(function(){this.fire("popup.close")},this),keyBoardHandler={handleKeyDown:_.bind(function(event){event.keyCode==$.ui.keyCode.ESCAPE&&_exit()},this)};configurator.getKeyBoardManager().pushHandler(keyBoardHandler)},"bus configurator.ready:last+popup.hide":function(evt,configurator){configurator.getKeyBoardManager().popHandler()},"bus $closeButton.ready:last+popup.visible":function(evt,$button){var _handler=_.bind(function(){this.fire("popup.close")},this);$button.bind("click",_handler)},"bus $closeButton.ready:last+popup.hide":function(evt,$button){$button.unbind("click")},"bus config.ready:last+popup.close":function(evt,config){config.integration.keepAlive?this.fire("application.exit"):this.fire("destroy")},"bus application.exit":function(){this.fire("popup.hide",{remove:!1})},"bus destroy":function(){this.fire("popup.hide",{remove:!0})},"bus $body.ready:last+$overlay.ready:last+$container.ready:last+popup.hide":function(evt,$body,$overlay,$container,hideConf){hideConf.remove?($overlay.remove(),$container.remove()):($overlay.hide(),$container.hide()),$body.css("overflow",$body.data("prevOverflow"))},"bus $overlay.ready:last+$container.ready:last+deleted":function(evt,$overlay,$container){var self=this,position=$container.position(),top=position.top,left=position.left,width=$container.width(),height=$container.height(),afterAnimation=_.bind(function(){this.fire("popup.close")},this);$container.animate({opacity:0,top:top+height/2,left:left+width/2,width:0,height:0},800,afterAnimation),$overlay.hide()}})})