define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,i){return i.extend({"bus entityFinder.afterInit":function(){this.fire("multiple.changed",{entityIds:[]})},"bus entityFinder.$el.ready:last + entityFinder.item.selected":function(e,t,i){this._toggleSelection(t,[i])},"bus entityFinder.$el.ready:last + multiple.changed:last + entityFinder.result.rendered":function(t,i,n,l){var r=e.intersection(n.entityIds,e.pluck(l.items,"id"));this._toggleSelection(i,r,!0)},"bus entityFinder.$el.ready:last + multiple.changed:last + multiple.reset":function(e,t,i){this._toggleSelection(t,i.entityIds,!1),this.fire("multiple.changed",{entityIds:[]})},"bus multiple.changed > entityFinder.item.selected":function(t,i,n){var l=i.entityIds;e.contains(l,n)?l=e.without(l,n):l.push(n),this.fire("multiple.changed",{entityIds:l})},"bus afterRender:last + entityFinder.result.rendered":function(e,t){var i=t.element,n=i.find("form");i.find(".i-role-selection-counter").click(function(){return!1}),"hidden"===n[0].style.visibility&&(n.css({visibility:"visible"}),n.find(".i-role-filter-input").focus())},"bus afterRender:last + multiple.changed":function(e,t,i){var n=i.entityIds.length,l=0===n,r=t.element.find(".i-role-selection-counter"),s=t.element.find(".i-role-relation-type"),d=t.element.find(".i-role-selection-counter-clear");r.text(n).toggleClass("tau-selected",!l),d.toggleClass("hidden",l),s.prop("disabled",l)},"bus afterInit:last + multiple.changed:last + relations.add":function(t,i,n,l){var r=i.config.context.configurator.getStore(),s=i.config.context.entity,d=i.config.dependencyType,o=l.relationTypeId,a="slave"===d?"master":"slave",c="slave"===d?"slave":"master",u=e.map(n.entityIds,function(e){var t={relationType:{id:o}};return t[a]={id:s.id},t[c]={id:e},t});r.save("relation",{$set:u,fields:[{master:["id",{entityType:["id","name"]}]},{slave:["id",{entityType:["id","name"]}]}]}).done(e.bind(function(){this.fire("close")},this))},"bus afterRender":function(i,n){var l=n.element,r=l.find(".cf-input");
this._entityBehavior(r),l.on("click",".i-role-relation-type",e.bind(function(e){var i=t(e.target);this.fire("relations.add",{relationTypeId:i.data("id")})},this)),l.on("click",".i-role-selection-counter-clear",e.bind(function(e){e.preventDefault(),e.stopPropagation(),this.fire("multiple.reset")},this))},_entityBehavior:function(e){this.fire("applyFinder",e)},_toggleSelection:function(t,i,n){e.each(i,function(e){t.find(".i-role-option[data-id="+e+"]").toggleClass("tau-selected",n)})}})});