define(["Underscore","jQuery","tau/configurator","tau/components/extensions/component.extension.base","tau/ui/templates/comments/ui.template.comments.comment"],function(_,$,a,b,c){var d=b.extend({category:"edit",destroy:function(){var a=this;a.destroyDynamicComponents(),a._super()},destroyDynamicComponents:function(){var a=this;a.commentListComponent&&(a.commentListComponent.destroy(),delete a.commentListComponent)},"bus dataBind+afterRender":function(a){var b=this;b.destroyDynamicComponents();var c={comments:a.dataBind.data.items},d=this.element=a.afterRender.data.element,e=".ui-all-comments",f=d.find(e),g={components:{type:"commentList"},context:this.config.context};b.createComponents(g,function(a){b.commentListComponent=a[0].component;var d={element:f,data:c,config:g};b.commentListComponent.fire("applyTo",d)})},getGUIDSelector:function(a){return"guid-comment-"+a},getCommentIdClass:function(a){return"comment-id-"+a},"bus prepareUpdate":function(a){var b=a.data.cmd,c=null,d=b.config.$set.parentId,e=".ui-all-comments"+(d?" ."+this.getCommentIdClass(d)+" .ui-comments":""),f=this.getGUIDSelector(b.guid);if(!b.config.id)c=$("<div class='ui-comment "+f+"'><div class='ui-comment-body'>Adding new comment. Please wait...</div></div>").appendTo(this.element.find(e));else{var g=this.getCommentIdClass(b.config.id);c=this.element.find(".ui-all-comments ."+g)}this.fire("markElementToBeUpdated",{element:c})},"bus applyUpdate":function(a){var b=this,c=a.data.cmd,d=c.guid,e=this.getCommentIdClass(a.data.id);if(!c.config.id){var f=this.getGUIDSelector(d),g=this.element.find(".ui-all-comments").find("."+f);g.addClass(e).removeClass(f)}this.on("afterRender",function(a){a.removeListener();var c=a.data.element,d=c.find("."+e+" > .ui-comment-body");b.fire("updateElement",{element:d})}),this.fire("refresh")},"bus prepareRemove":function(a){var b=a.data.cmd,c=this.getCommentIdClass(b.config.id),d=this.element.find(".ui-all-comments ."+c);this.fire("markElementToBeDeleted",{element:d})},"bus applyRemove":function(a){var b=this,c=a.data.cmd,d=this.getCommentIdClass(c.config.id),e=this.element.find(".ui-all-comments ."+d);this.fire("deleteElement",{element:e,callback:function(){b.fire("refresh")}})}});return d})