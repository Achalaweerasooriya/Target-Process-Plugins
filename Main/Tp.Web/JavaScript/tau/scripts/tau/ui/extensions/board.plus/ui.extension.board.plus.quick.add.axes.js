define(["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add-axes"],function($,ExtensionBase,AxesQuickAddDecorator){return ExtensionBase.extend({resetLifecycle:!0,"bus slice.axes.quickadd.api.ready:last + domWrapper.ready:last + model.axesActions.ready":function(e,sliceQuickAddApi,domWrapper,axesActions){var self=this,$buttonPanel=domWrapper.createQuickAddPanel();$buttonPanel.hide();var api=sliceQuickAddApi;api.on("after.addAxisData",_.bind(self.onAfterAddAxisData,self)),domWrapper.decorate(AxesQuickAddDecorator,{$buttonPanel:$buttonPanel,items:axesActions.items,onActivate:function(e){var param={target:$buttonPanel.find(".tau-btn"),actionItems:e.data.actionItems,ctrl:e};self.showQuickAddPopup(api,domWrapper,param)}})},setupBatchAddOperation:function(){this.itemsToAdd=[]},onAfterAddAxisData:function(e){var result=e.data.result,axisItem=result[0];this.itemsToAdd.push({data:axisItem.dataItem,location:axisItem.location})},triggerBatchAddOperation:function(){if(this.itemsToAdd.length===0)return;this.fire("operation.added",{options:{force:!0},items:this.itemsToAdd})},showQuickAddPopup:function(slice,domWrapper,activationData){var self=this,button=activationData.target,findCellActionItemInData=function(cellData){return _.find(cellData.fixed.items,function(item){return item.type==="AddAction"})},actionItems=activationData.actionItems,addActionItem=findCellActionItemInData(actionItems),CONST_ADDEXPAND_CLASS="tau-quick-add_expand",viewMode="axis",$gridView=domWrapper.getGrid().parents(".tau-board-grid-view,.tau-entity-list"),isXAxis=(activationData.actionItems.location||"").toLowerCase()==="xaxis",bubbleConfig={target:button,cleanupOnHide:!0,stackName:"quickAdd",showOnCreation:!0,zIndex:1e4,onShow:function(){$gridView.prop("disabled",!0),button.parent().addClass(CONST_ADDEXPAND_CLASS),self.setupBatchAddOperation()},onHide:function(){$gridView.prop("disabled",!1),button.parent().removeClass(CONST_ADDEXPAND_CLASS),self.triggerBatchAddOperation(),activationData.ctrl.deactivate()},onPositionConfig:function(){var my="left "+(isXAxis?"top":"bottom"),at="left "+(isXAxis?"bottom":"top");return{of:button,collision:"fit flip",my:my,at:at,offset:"-30 0"}},onArrowPositionConfig:function(arrowPositionConfig){if(isXAxis){var offset=arrowPositionConfig.offset,parts=offset.split(" ");parts[0]=-5,arrowPositionConfig.offset=parts.join(" ")}return arrowPositionConfig},dontCloseSelectors:["#ui-datepicker-div"],componentsConfig:{components:[{type:"board.cell.quick.add",options:{slice:slice,action:actionItems,addAction:addActionItem,viewMode:viewMode}}]}};self.fire("initBubble",bubbleConfig)}})})