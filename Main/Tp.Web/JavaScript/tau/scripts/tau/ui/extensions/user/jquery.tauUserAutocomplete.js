define(["require","jQuery","Underscore","./userAutocomplete.mixin","template!tau/ui/extensions/user/ui.tauUsersAutocomplete.item.template","template!tau/ui/extensions/user/ui.tauUsersAutocomplete.item.loading.template"],function(e){var t=e("jQuery"),i=e("Underscore"),n=e("./userAutocomplete.mixin"),r=e("template!tau/ui/extensions/user/ui.tauUsersAutocomplete.item.template"),o=e("template!tau/ui/extensions/user/ui.tauUsersAutocomplete.item.loading.template"),s={position:{my:"left top",at:"left bottom+5",collision:"none"},rejectUserIdsGetter:function(){return[]},itemRenderer:{_itemTemplate:null,renderItem:function(e){return this._itemTemplate||(this._itemTemplate=r),this._itemTemplate.render(e)}},itemLoadingRenderer:{_itemTemplate:null,renderItem:function(e){return this._itemTemplate||(this._itemTemplate=o),this._itemTemplate.render(e)}}};return t.widget("ui.tauUserAutocomplete",t.ui.autocomplete,i.extend({options:{store2:null,minLength:2,autoFocus:!0,showLoading:!1,autocompleteQueryAdd:"",autocompleteFieldsQueryAdd:"",autocompleteTakeQueryAdd:"",position:s.position,delayLoading:250,userTypes:["User"],rejectUserIdsGetter:s.rejectUserIdsGetter,itemRenderer:s.itemRenderer,itemLoadingRenderer:s.itemLoadingRenderer,focus:function(){return!1},source:function(e,t){if(" "!=i.last(e.term)){var n=i.last(i.compact(i.trim(e.term).split(/[\s,]+/)))||"",r=null;this.options.showLoading&&(r=i.delay(function(){t([{isLoading:!0}])},this.options.delayLoading)),this._trigger("found",null,{term:"",items:[]}),this._getData(n).done(i.bind(function(e){e.length?(e=this._processItems(e,n),this._trigger("found",null,{term:n,items:e})):(this.close(),this._trigger("nothing",null,{term:n})),t(e)},this)).fail(function(){t([])}).always(function(){clearTimeout(r)})}}},_create:function(){this._super()},_renderMenu:function(e,n){t(e).addClass("tau-user-autocomplete").css({maxHeight:.5*t(window).height(),zIndex:this.element.zIndex()+1}),i.each(n,i.bind(function(t){this._renderItem(e,t)},this))},_renderItem:function(e,t){var i=t.isLoading?this.options.itemLoadingRenderer:this.options.itemRenderer;
return i.renderItem(t).data("ui-autocomplete-item",t).appendTo(e)}},n))});