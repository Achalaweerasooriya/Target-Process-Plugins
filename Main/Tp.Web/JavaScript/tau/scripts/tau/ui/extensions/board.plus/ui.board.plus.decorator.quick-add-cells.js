define(["Underscore","jQuery","tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add.base"],function(t,e,i){var n=2,o=i.extend({activatedScope:null,lastScope:null,sharedState:null,findElements:function(t){this.element=t.getGrid(),this.$buttonPanel=this.createQuickAddPanel(),this.$buttonPanel.css({top:0,left:0}).appendTo(this.element),this.buttonPanelHeight=this.$buttonPanel.height(),this.buttonPanelWidth=this.$buttonPanel.width(),this.$button=this.$buttonPanel.find(".tau-btn"),this.element.find(".i-role-cellholder").addClass("i-role-ch-quickadd-target")},deactivate:function(){this.isActivated=!1,this.activatedScope!==this.lastScope&&this.$buttonPanel.hide()},setPosition:function(i){var o=this.element,s=e(i.currentTarget),l=s.position(),h=s.height(),a=s.width(),c=s.offset(),u=o.offset(),d=o[0],r=d.offsetHeight-d.clientHeight,f=d.offsetWidth-d.clientWidth,b=h-this.buttonPanelHeight,v=l.top+b+o.scrollTop()-1.5*n,p=u.top+o.height()-r,g=c.top+h,k=t.max([0,g-p]);v-=k;var m=t.max([0,this.buttonPanelHeight+2*n-(h-k)]);v+=m;var P=a-this.buttonPanelWidth,S=l.left+P+o.scrollLeft()-n,$=u.left+o.width()-f,A=c.left+a,M=t.min([0,$-A]);S+=M;var B=t.max([0,this.buttonPanelWidth-(a-M)-n]);S+=B,this.$buttonPanel.css({top:v,left:S}).appendTo(s)},showButton:t.throttle(function(t){this.sharedState&&(this.setPosition(t),this.$buttonPanel.show())},500),hideButton:function(){this.$buttonPanel.hide()},onClick:function(){this.sharedState&&!this.isActivated&&(taus.track("cell.quick.add",{method:"plus button"}),this.activatedScope=this.lastScope,this.activate(this.$button,this.sharedState))},onDblClick:function(t){var i=e(t.target);i.is(".i-role-ch-quickadd-target, .i-role-cell, .footer-pillow")&&this.onMouseEnter(t).actionAllowed&&(taus.track("cell.quick.add",{method:"cell double click"}),this.$button.click())},onMouseEnter:function(t){var i=this.getCellData(e(t.currentTarget));if(this.lastScope="enter_"+i.x+"_"+i.y,!this.isActivated){var n=this.predicateAddAction(i);if(n)return this.sharedState={actionItems:n},this.showButton(t),{actionAllowed:!0}
}return{}},onMouseLeave:function(t){var i=this.getCellData(e(t.currentTarget));if(this.lastScope="leave_"+i.x+"_"+i.y,!this.isActivated){var n=this.predicateAddAction(i);n&&(this.sharedState=null,this.hideButton())}},onScroll:t.throttle(function(){var t=this.$buttonPanel.closest(".i-role-ch-quickadd-target");t.length&&this.setPosition({currentTarget:t})},150),attachEvents:function(){this.$button.on("click",this.onClick.bind(this)),this.onScrollBound=this.onScroll.bind(this),this.element.on("sync-scroll",this.onScrollBound),this.onDblclickBound=this.onDblClick.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.element.on({dblclick:this.onDblclickBound,mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave},".i-role-ch-quickadd-target")},detachEvents:function(){this.element.off("sync-scroll",this.onScrollBound),this.element.off({dblclick:this.onDblclickBound,mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave},".i-role-ch-quickadd-target")},getCellData:function(t){return t.data()}});return o});