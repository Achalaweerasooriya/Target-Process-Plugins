define(["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){var self=this,$form=$el.find("form.i-role-filterform"),$tagInput=$form.find("[name=tag]");$form.on("submit",function(e){e.preventDefault(),self.fire("filter.submitted",$(this).serializeArray())}),$el.delegate("input[name=name]","keyup",function(){$form.submit()}),$el.delegate("input[name=name]","keydown",function(e){e.keyCode==$.ui.keyCode.ESCAPE&&e.stopPropagation(),e.which==$.ui.keyCode.ENTER&&$(this).trigger("blur")});var $more=$el.find(".i-role-moretagstrigger"),$moreList=$el.find(".i-role-moretagslist").detach();$el.on("click",".i-role-tag",function(){var $tag=$(this);$el.find(".i-role-tag.tau-active").not(this).toggleClass("tau-active",!1),$tag.toggleClass("tau-active",!0),$tagInput.val($tag.text()),$form.submit()}),$more.length&&($el.on("click",".i-role-tag",function(){$more.toggleClass("tau-active",!1),$more.text($more.data("labelText"))}),$more.tauBubble({zIndex:130,content:$moreList}),$moreList.find("ul").css("maxHeight",$(window).height()*.4),$moreList.on("click",".i-role-tag",function(){$el.find(".i-role-tag.tau-active").not(this).toggleClass("tau-active",!1);var $tag=$(this),text=$tag.text();$more.toggleClass("tau-active",!0),$more.text(text),$more.tauBubble("hide"),$tagInput.val($tag.text()),$form.submit()}))},matchName:function(source,filter){var index=source.toLowerCase();return filter.length==0||_.any(filter,function(v){return index.indexOf(v)>=0})},matchTag:function(source,filter){var index=source.toLowerCase();return filter.length==0||_.any(filter,function(v){return index==v})},"bus $el.ready:last + items.ready:last + filter.submitted":function(evt,$el,items,filterData){var filter={};_.forEach(filterData,function(v){filter[v.name]=v.value});var indexes={name:_.compact(_.trim(filter.name).toLowerCase().split(/\s+/g)),tag:_.compact(_.trim(filter.tag).toLowerCase()!="all"?[_.trim(filter.tag).toLowerCase()]:[])},matches={name:this.matchName,tag:this.matchTag},$items=$el.find(".i-role-item"),found=0;_.any(indexes,function(v){return v.length>0})?(_.forEach(items,function(item){var matchedByTags=item.tags.length==0&&indexes["tag"].length==0||_.any(item.tags||[],function(v){return matches.tag(v,indexes.tag)}),matchedByName=matches.name(item.name,indexes.name)||matches.name(item.description,indexes.name),matched=matchedByTags&&matchedByName,$item=$items.filter("[data-id="+item.id+"]");matched&&$item.length&&(found+=1),$item.toggleClass("tau-templates-settings__item_filtered_false",!matched),$item.toggleClass("tau-templates-settings__item_filtered_true",matched)}),$el.toggleClass("tau-templates-settings_filtered_none",found==0)):($el.toggleClass("tau-templates-settings_filtered_none",!1),$items.toggleClass("tau-templates-settings__item_filtered_false",!1),$items.toggleClass("tau-templates-settings__item_filtered_true",!1)),this.fire("filter.completed")}})})