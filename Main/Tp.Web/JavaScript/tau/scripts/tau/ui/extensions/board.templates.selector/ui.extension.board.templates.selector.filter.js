define(["Underscore","jQuery","tau/core/extension.base"],function(t,e,a){return a.extend({"bus $el.ready":function(t,a){var i=this,n=a.find("form.i-role-filterform"),s=n.find("[name=tag]");n.on("submit",function(t){t.preventDefault(),i.fire("filter.submitted",e(this).serializeArray())}),a.delegate("input[name=name]","keyup",function(){n.submit()}),a.delegate("input[name=name]","keydown",function(t){t.keyCode==e.ui.keyCode.ESCAPE&&t.stopPropagation(),t.which==e.ui.keyCode.ENTER&&e(this).trigger("blur")});var l=a.find(".i-role-moretagstrigger"),r=a.find(".i-role-moretagslist").detach();a.on("click",".i-role-tag",function(){var t=e(this);a.find(".i-role-tag.tau-active").not(this).toggleClass("tau-active",!1),t.toggleClass("tau-active",!0),s.val(t.text()),n.submit()}),l.length&&(a.on("click",".i-role-tag",function(){l.toggleClass("tau-active",!1),l.text(l.data("labelText"))}),l.tauBubble({zIndex:130,content:r}),r.find("ul").css("maxHeight",.4*e(window).height()),r.on("click",".i-role-tag",function(){a.find(".i-role-tag.tau-active").not(this).toggleClass("tau-active",!1);var t=e(this),i=t.text();l.toggleClass("tau-active",!0),l.text(i),l.tauBubble("hide"),s.val(t.text()),n.submit()}))},matchName:function(e,a){var i=e.toLowerCase();return 0==a.length||t.any(a,function(t){return i.indexOf(t)>=0})},matchTag:function(e,a){var i=e.toLowerCase();return 0==a.length||t.any(a,function(t){return i==t})},"bus $el.ready:last + items.ready:last + filter.submitted":function(e,a,i,n){var s={};t.forEach(n,function(t){s[t.name]=t.value});var l={name:t.compact(t.trim(s.name).toLowerCase().split(/\s+/g)),tag:t.compact("all"!=t.trim(s.tag).toLowerCase()?[t.trim(s.tag).toLowerCase()]:[])},r={name:this.matchName,tag:this.matchTag},o=a.find(".i-role-item"),g=0;t.any(l,function(t){return t.length>0})?(t.forEach(i,function(e){var a=0==e.tags.length&&0==l.tag.length||t.any(e.tags||[],function(t){return r.tag(t,l.tag)}),i=r.name(e.name,l.name)||r.name(e.description,l.name),n=a&&i,s=o.filter("[data-id="+e.id+"]");
n&&s.length&&(g+=1),s.toggleClass("tau-templates-settings__item_filtered_false",!n),s.toggleClass("tau-templates-settings__item_filtered_true",n)}),a.toggleClass("tau-templates-settings_filtered_none",0==g)):(a.toggleClass("tau-templates-settings_filtered_none",!1),o.toggleClass("tau-templates-settings__item_filtered_false",!1),o.toggleClass("tau-templates-settings__item_filtered_true",!1)),this.fire("filter.completed")}})});