define(["Underscore","tau/core/class","tau/ui/extensions/relations/ui.extension.relations.observer"],function(t,e,n){var s=n.Listener.extend({_start:function(e){return 0===e.entityIds.length?!1:(this.config.store.on({type:this.config.type,eventName:"afterSave",hasChanges:this.config.hasChanges,listener:this},function(n){t.contains(e.entityIds,n.data.id)&&this.config.callback(n)}.bind(this)),!0)}}),i=n.extend({"bus beforeInit":function(){this._super.apply(this,arguments),this._relationTypesChangeListener=new s(this._createConfig({type:"relation",hasChanges:["relationType"]})),this._entityStatesChangeListener=new s(this._createConfig({type:"general",hasChanges:["entityState"]})),this.store.freeze(!0).done(this.safeCallback(function(t){this.fire("updateBadge",{}),t.unfreeze()}))},"bus afterInit:last + updateBadge":function(){this._trackRelationsChangesStop()},_trackRelationsChangesStop:function(){this._relationTypesChangeListener.stopListening(),this._entityStatesChangeListener.stopListening()},"bus afterInit:last + badgeDataRetrieved":function(t,e,n){var s=n.badgeData;this._trackRelationsChangesStart(s)},_trackRelationsChangesStart:function(e){this._relationTypesChangeListener.startListening({entityIds:t.pluck(e.masterRelations,"id")}),this._entityStatesChangeListener.startListening({entityIds:t.pluck(e.masterRelations,"masterId")})},"bus afterInit > badgeDataRetrieved > destroy":function(){this._trackRelationsChangesStop()}});return i});