define(["require","Underscore","jQuery","tau/ui/extensions/board.editor/ui.extension.board.editor.autocomplete","libs/jquery/jquery.placeholder","libs/jquery/jquery.tau.resetableInput","libs/jquery/jquery.toggleFilter"],function(e){var t=e("Underscore"),i=e("jQuery"),r=e("tau/ui/extensions/board.editor/ui.extension.board.editor.autocomplete");return e("libs/jquery/jquery.placeholder"),e("libs/jquery/jquery.tau.resetableInput"),e("libs/jquery/jquery.toggleFilter"),r.extend({SHORT_PLACEHOLDER:"filter off","bus afterRender":function(e,t){var i=t.element,r=i.find(".i-role-filter-input");this.defaultPlaceholder=r.attr("placeholder"),r.attr("placeholder",this.SHORT_PLACEHOLDER),i.find(".i-role-filter-control").toggleFilter({defaultExpand:!0}),this.fire("$form.ready",i),this.fire("$el.ready",i)},"bus $el.ready":function(e,t){var r=this.$filter=t.find("[name=cells_filter]");this.$filterControl=t.find(".i-role-filter-control"),r.on("focus",function(){this.fire("preloading.execute"),this.expandFilter()}.bind(this)),r.on("_change clear",function(){var e=r.val();this.updateFilterState(e),this.fire("user.filter.changed",e)}.bind(this)),t.on("keydown","[name=cells_filter]",function(e){e.which==i.ui.keyCode.ENTER&&i(e.target).blur(),(e.which==i.ui.keyCode.ENTER||e.which==i.ui.keyCode.TAB)&&this.shrinkFilter()}.bind(this)),this.updateFilterState()},"bus cell.types + afterRender:last + view.dom.ready:last":function(e,t,r){i("[name=cells_filter]",r.element).prop("disabled",0===t.length),i(".i-role-help",r.element).prop("disabled",0===t.length)},expandFilter:function(){this.$filterControl.addClass("active"),this.$filter.attr("placeholder",this.defaultPlaceholder),i(document).off("mousedown.expandFilter").on("mousedown.expandFilter",t.bind(this.onDocumentClick,this))},shrinkFilter:function(){this.$filterControl.removeClass("active"),this.$filter.attr("placeholder",this.SHORT_PLACEHOLDER),i(document).off("mousedown.expandFilter")},onDocumentClick:function(e){i.contains(this.$filterControl[0],e.target)||i(e.target).closest(".filter-help,.tau-bubble-tooltipArticle,.tau-autocomplete__menu").length||this.shrinkFilter()
},updateFilterState:function(e){e=e||this.$filter.val()||"",this.$filterControl.toggleClass("full",!!e)}})});