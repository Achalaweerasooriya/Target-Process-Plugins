define(["Underscore","jQuery","tau/core/extension.base","tau/ui/templates/tabsHeader/ui.template.tabsHeader.item.more"],function(e,t,i,n){return i.extend({"bus $el.ready":function(e,i){t.when.elementIsInDom(i).then(function(){this.fire("view.dom.ready",i)}.bind(this));var a=i.find(".i-role-tabheaders"),r=i.find(".i-role-tabheader");n.render().hide().appendTo(a),i.addClass("entity-tabs_more_enable");var o=i.find(".i-role-moretrigger"),d=i.find(".i-role-moreholder");o.tauBubble({content:d.detach(),zIndex:3,onShow:function(){d.find(".i-role-tabheader").each(function(e,i){var n=t(i).find(".ui-quantity");n.length&&n.text(r.filter("[data-label="+t(i).data("label")+"]").find(".ui-quantity").text())})}}),this.on("destroy",function(){d.remove()}),d.on("click",".i-role-tabheader",function(e){var i=t(e.currentTarget).data("label");i&&this.fire("switched",i)}.bind(this))},"bus view.dom.ready":function(i,n){var a=n.find(".i-role-tabheaders"),r=n.find(".i-role-tabheader"),o=n.find(".i-role-moretrigger"),d=o,l=d.find(".i-role-morelabel"),s=o.tauBubble("option","content");r.each(function(){var e=t(this).clone();e.addClass("drop-down-option"),s.append(e)});var u=s.find(".i-role-tabheader"),f=function(e){return e.offset().top==a.offset().top},c=function(){o.tauBubble("instance")&&o.tauBubble("hide");for(var e=!1,i=0;!e&&100!=i;){i++;var n=t();u.each(function(e,i){var a=t(i),o=function(e,i){return t(i).data("label")==a.data("label")},s=r.filter(o),u=f(s);if(u?(n=s,s.css("visibility","visible")):s.css("visibility","hidden"),a.attr("hidden",u),a.toggleClass("selected",s.is(".selected")),s.is(".selected")){d.toggleClass("selected",!u);var c=l.data("text");u||(c=[s.find(".ui-label").text(),c].join(" - ")),l.text(c)}}),n.length?n.after(d):a.prepend(d);var s=0===u.filter(":not([hidden])").length;d.toggle(!s),s||f(d)?e=!0:d.prev().before(d)}};c(),t(window).on("resize.more",e.debounce(c,100)),this.bus.on("switched.after",c,this),this.bus.globalBus.on(["setBadgeData","expanded","collapsed","zoom.updated","collapser.switched"],function(){setTimeout(c,100)
},this)},destroy:function(){t(window).off("resize.more"),this._super()}})});