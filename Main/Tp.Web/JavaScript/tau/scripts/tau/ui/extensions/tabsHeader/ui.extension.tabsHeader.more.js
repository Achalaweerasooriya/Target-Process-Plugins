define(["Underscore","jQuery","tau/core/extension.base","tau/ui/templates/tabsHeader/ui.template.tabsHeader.item.more"],function(e,t,i,n){function a(e){return function(){setTimeout(e,100)}}return i.extend({"bus $el.ready":function(t,i){var n=e.bind(function(){i.parents("body").length?this.fire("view.dom.ready"):e.delay(n,100)},this);n()},"bus beforeInit + $el.ready":function(i,a,o){var r=o.find(".i-role-tabheaders"),d=o.find(".i-role-tabheader"),s=a.config.context.configurator.getTemplateFactory().get(n.name).bind({},{});s.hide(),s.appendTo(r),o.addClass("entity-tabs_more_enable");var l=o.find(".i-role-moretrigger"),u=o.find(".i-role-moreholder");l.tauBubble({content:u.detach(),zIndex:3,onShow:function(){u.find(".i-role-tabheader").each(function(e,i){var n=t(i).find(".ui-quantity");n.length&&n.text(d.filter("[data-label="+t(i).data("label")+"]").find(".ui-quantity").text())})}}),this.on("destroy",function(){u.remove()}),u.on("click",".i-role-tabheader",e.bind(function(e){var i=t(e.currentTarget).data("label");i&&this.fire("switched",i)},this))},"bus $el.ready + view.dom.ready":function(i,n){var o=n.find(".i-role-tabheaders"),r=n.find(".i-role-tabheader"),d=n.find(".i-role-moretrigger"),s=d,l=s.find(".i-role-morelabel"),u=d.tauBubble("option","content");r.each(function(){var e=t(this).clone();e.addClass("drop-down-option"),u.append(e)});var b=u.find(".i-role-tabheader"),f=function(e){return e.offset().top==o.offset().top},c=function(){d.data("ui-tauBubble")&&d.tauBubble("hide");for(var e=!1,i=0;!e&&100!=i;){i++;var n=t();b.each(function(e,i){var a=t(i),o=r.filter(function(e,i){return t(i).data("label")==a.data("label")}),d=f(o);if(d?(n=o,o.css("visibility","visible")):o.css("visibility","hidden"),a.attr("hidden",d),a.toggleClass("selected",o.is(".selected")),o.is(".selected")){s.toggleClass("selected",!d);var u=l.data("text");d||(u=[o.find(".ui-label").text(),u].join(" - ")),l.text(u)}}),n.length?n.after(s):o.prepend(s);var a=0==b.filter(":not([hidden])").length;s.toggle(!a),a||f(s)?e=!0:s.prev().before(s)}};c(),t(window).on("resize.more",e.debounce(c,100)),this.bus.on("switched.after",c,this),this.bus.globalBus.on("setBadgeData",a(c),this),this.bus.globalBus.on("expanded",a(c),this),this.bus.globalBus.on("collapsed",a(c),this),this.bus.globalBus.on("zoom.updated",a(c),this),this.bus.globalBus.on("collapser.switched",a(c),this)},destroy:function(){t(window).off("resize.more"),this._super()}})});