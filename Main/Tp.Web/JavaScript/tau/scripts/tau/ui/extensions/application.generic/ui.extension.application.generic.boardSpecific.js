define(["Underscore","jQuery","tau/core/extension.base","tau/configurations/definitions/board.definition.factory","tau/services/boards/view.types"],function(e,t,i,r,n){var o="none";return i.extend({"bus configurator.ready":function(e,t){t.getBoardDefinitionFactory=function(){return this.boardDefinitionFactory=this.boardDefinitionFactory||new r(t),this.boardDefinitionFactory}},"bus afterRender":function(t,i){this.initializeFeedback(),this.processBody(i.element).done(e.bind(function(e){this.fire("view.dom.ready",{element:e})},this))},"bus configurator.ready + application.exit":function(e,t){this.fire("initProgress"),t.getRouting().redirect(t.getUrlBuilder().getDashboardUrl())},"bus configurator.ready:last > application.navigate > controller.postExecute":function(e,t,i,r){var s=i.requestArgs||{},a=function(e){if(e.settings.id!==o&&e.settings.id!==s.id)throw taus.track("wrong boardSettings retrieved for view",{expectedViewId:s.id,passedViewId:e.settings.id,passedViewName:e.settings.name,passedViewMode:e.settings.viewMode}),console.error("Wrong boardSettings",e.settings,"retrieved for view",s.id),new Error("Wrong boardSettings "+e.settings.id+" retrieved for view "+s.id);var t={boardSettings:e};this.fire("boardSettings.ready",t),r.hostBus.fire("boardSettings.ready",t),r.pageBus.fire("boardSettings.ready",t)}.bind(this),d=n.isKnownViewType(s.entity);if(d){var c=s.id;this._processViewSettings(c,s.entity,t).done(a)}else{var f=this._createDefaultBoardSettings(o,t);f.markFieldsRetrieved(this._getDefaultBoardFields()),f.settings.viewMode="list",a(f)}},processBody:function(e){t(":root").addClass("tau-app-frame");var i=t("body").prepend(e);return t.Deferred().resolve(i)},_processViewSettings:function(e,i,r){var n=t.Deferred(),o=r.getBoardDefinitionFactory().createDefault(i);r.setBoardSettingsOptions(o);var s=r.getBoardSettingsFactory().create(e);return s.get({fields:this._getDefaultBoardFields(),callback:function(){n.resolve(s)}}),n},_createDefaultBoardSettings:function(e,t){var i=t.getBoardDefinitionFactory().createDefault();
return t.setBoardSettingsOptions(i),t.getBoardSettingsFactory().create(e)},_getDefaultBoardFields:function(){return["name","x","y","cells","viewMode","zoomLevel","collapse","focus","itemType"]},initializeFeedback:function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://":"http://")+"widget.uservoice.com/rywvig4l55Tifwaw7wk3Ag.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}})});