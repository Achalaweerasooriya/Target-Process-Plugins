define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,i){return i.extend({init:function(e){this._super(e),this.config=e},"bus afterRender":function(i,a){this.toggleScroll(!1);var l=a.element;this.fire("$el.ready",l);var r=l.find("[role=list]"),s=l.find(".i-role-listholder");this.fire("$listholder.ready",s);var o=e.bind(this.fire,this);r.on("click",".i-role-option",function(e){o("item.selected",t(e.currentTarget).data("id"))});var n=e.throttle(function(){o("paging.tryNext")},100);s.on("scroll.finder",function(e){e.preventDefault(),e.stopPropagation(),n()}),this.toggleScroll(!0),this.fire("$list.ready",r);var d=l.find(".i-role-header");if(this.fire("$header.ready",d),this.config.allData&&this.config.allData.isAddPossible){var c=l.find(".i-role-add-entity");c.on("click",function(){this.fire("add.entity.request")}.bind(this))}this.fire("view.dom.ready")},"bus beforeInit + $el.ready + $list.ready + $listholder.ready":function(e,t,i,a,l){l.listSelectable({items:".i-role-option",className:"hover",saveScroll:!0,keyboardManager:t.config.context.configurator.getKeyBoardManager(),inner:a}),this.fire("$listSelectable.ready",l)},"bus $listSelectable.ready:last + $outerBubbled.shown":function(t,i){i.on("focus",function(){e.delay(function(){if(i.length&&i.data("ui-listSelectable")){i.listSelectable("enable",{saveScroll:!0});var e=0;i.data("ui-listSelectable")._index=e,i.data("ui-listSelectable").$items.eq(e).addClass("hover")}},100)}),i.on("blur",function(){i.length&&i.data("ui-listSelectable")&&(i.listSelectable("disable"),i.data("ui-listSelectable").$items&&i.data("ui-listSelectable").$items.removeClass("hover"))})},"bus $listSelectable.ready:last + $outerBubbled.hidden":function(e,t){t.length&&t.data("ui-listSelectable")&&t.data("ui-listSelectable").$items&&(t.listSelectable("disable"),t.data("ui-listSelectable").$items.removeClass("hover"))},"bus beforeInit:last + options.ready:last + $el.ready:last + $list.ready:last + $listSelectable.ready:last + $header.ready:last + result.ready":function(t,i,a,l,r,s,o,n){var d=0===n.paging.start,c=i.config.context.configurator.getTemplateFactory().getTermProcessor();
if(d){var u=e.isFunction(a.allowToReset)?a.allowToReset(a.context.entity):a.allowToReset;u&&a.data&&a.data.id&&n.items.splice(0,0,{isAction:!0,name:c.replaceTermTags(a.clearValueLabel)})}var f=i.config.templateList,h=f.get().bind({},{columnsDisabled:a.columnsDisabled,result:n});d&&r.data("tryNext",!0).empty(),this.toggleScroll(!1),h.appendTo(r),this.toggleScroll(!0),this.fire("result.rendered",n),d&&l.toggleClass("tau-lookup-body_state_empty",0===n.paging.count),e.delay(e.bind(this.fire,this,"headers.toSync"),200),n.paging.hasNext?this.fire("paging.tryNext"):r.data("tryNext",!1),e.delay(e.bind(function(){if(s.is(":focus")){var e=s.data("ui-listSelectable")._index;0>e&&(e=-1),s.listSelectable("reset",{saveScroll:!0}),s.data("ui-listSelectable")._index=e,e>=0&&s.data("ui-listSelectable").$items.eq(e).addClass("hover")}},this),100)},"bus $el.ready:last + $list.ready:last + $header.ready:last + headers.toSync":function(e,t){var i=t.find("table");i.eq(1).width(i.eq(2).width()),this.fire("adjustPosition")},"bus $el.ready:last + $list.ready:last + $listholder.ready:last + paging.tryNext":function(e,t,i,a){if(this.scrollAvailable&&i.data("tryNext")&&t.is(":visible")){var l=i[0].getBoundingClientRect(),r=a[0].getBoundingClientRect();l.bottom<=r.bottom+50&&this.fire("search.pagingBound")}},"bus $form.ready:last + search.readyToExecute":function(e,t){var i=t.find(".i-role-listholder");i.tauProgressIndicator(),i.tauProgressIndicator("show",{hover:!0})},"bus $form.ready:last + search.completed":function(e,t){var i=t.find(".i-role-listholder");i.data("ui-tauProgressIndicator")&&i.tauProgressIndicator("hide")},"bus afterRender:last + options.ready:last + builder.ready:last + remove.entity.item":function(e,t,i,a,l){var r=t.element;r.find(".i-role-option[data-id="+l.entityId+"]").remove(),this.fire("options.ready",i),this.fire("builder.ready",a),this.fire("search.readyToExecute")},toggleScroll:function(e){this.scrollAvailable=e}})});