define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,$list=$element.find("[role=list]"),$listPlaceholder=$element.find("[role=list-placeholder]");this.$list=$list,this.$listPlaceholder=$listPlaceholder;var _move=_.bind(function(direction,event){if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){this.menu.deactivate();return}this.menu[direction](event)},this);this.menu=$list.menuEntity({selected:$.proxy(this,"_signUpOnActionsAndSelection")}).data("menuEntity"),this.first=!0,$listPlaceholder.keydown(_.bind(function(event){var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:_move("previousPage",event);break;case keyCode.PAGE_DOWN:_move("nextPage",event);break;case keyCode.UP:_move("previous",event);break;case keyCode.DOWN:_move("next",event);break;case keyCode.ENTER:this.menu.select(event),event.preventDefault()}},this)),this.attachScrollingEvents($list),this.attachSortingEvents($element.find("[role=list-sorting]")),this.setScrollAvailable(!1)},"bus afterRender:last+result.ready:last":function(evt,afterRender,data){var $list=this.$list,result=data.data.result,template=this.config.templateList,$newList=template.get().bind(this.config,result);result.paging.start==0&&$list.empty();var options=$newList.find("[role=option]");this.setScrollAvailable(result.paging.hasNext),options.appendTo($list),this.$listPlaceholder.toggleClass("tau-finder__result_state_loading",!1),result.paging.count>0&&this.$listPlaceholder.toggleClass("tau-finder__result_state_empty",!1),$list.children().length?$list.find(".tau-finder__result_state_empty").remove():$list.append('<li class="tau-finder__result_state_empty">No entity found.</li>'),this.menu.deactivate(),this.menu.refresh(),options.eq(0).mouseenter()},"bus scroll.reachEnd":function(){this.scrollAvailable&&this.bus.fire("search.pagingBound")},setScrollAvailable:function(value){this.scrollAvailable=value},attachScrollingEvents:function($list){var _handler=_.bind(function(){$list.scrollTop()+$list.innerHeight()+18>=$list[0].scrollHeight&&this.bus.fire("scroll.reachEnd")},this);$list.scroll(_handler)},attachSortingEvents:function($header){var $buttons=$header.find("[role=sorting]"),self=this;$header.delegate("[role=sorting]","click",function(){var $button=$(this),dir="desc";$button.hasClass("tau-finder__sorttrigger_dir_"+dir)&&(dir="asc"),$buttons.toggleClass("tau-finder__sorttrigger_dir_desc",!1),$buttons.toggleClass("tau-finder__sorttrigger_dir_asc",!1),$buttons.toggleClass("tau-finder__sorttrigger_state_active",!1),$button.toggleClass("tau-finder__sorttrigger_dir_"+dir,!0),$button.toggleClass("tau-finder__sorttrigger_state_active",!0);var value=$button.val();self.bus.fire("search.orderBound",{value:value,dir:dir})})},_signUpOnActionsAndSelection:function(event,$element){var data=$element.item&&$element.item.data();if(!data)return;if(!data.tmplItem)return;data=data.tmplItem.data;if(!data)return;this.bus.fire("entitySelected",{entity:data})}})})