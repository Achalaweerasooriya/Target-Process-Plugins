define(["jQuery","tau/components/extensions/component.extension.base"],function($,a){return a.extend({classes:{HIDING:"tau-hidden",SELECTION:"tau-selected",HIGHLIGHTING:"tau-highlighted",COLLAPSING:"tau-collapsed",DRAG_SOURCE:"tau-drag-source",DRAG_HELPER:"tau-drag-helper"},"bus afterRender":function(a){var b=this,c=a.data.element.find("[role=grid]");this.__options={},this.__options.sortItemsSelector="[role=card]",this.__options.dropTargetSelector="[role=cell]",this.__options.dragZone=c,c.delegate("[role=card]","dragstart",function(a){console.log("start");var c=a.originalEvent;return c.dataTransfer.effectAllowed="copy",c.dataTransfer.setData("Text","234234"),b.onDragStart(a),a.preventDefault(),a.stopPropagation(),!0}),c.find("[role=cell]").bind("dragover",function(a){return console.log("ovver"),a.preventDefault(),b.onDrag(a.originalEvent),a.preventDefault(),a.stopPropagation(),!1}),c.delegate("[role=cell]","dragenter",function(a){return console.log("enter"),a.preventDefault(),b.onDrag(a.originalEvent),a.preventDefault(),a.stopPropagation(),!1}),c.delegate("[role=cell]","drop",function(a){a.stopPropagation();var c=a.originalEvent;return b.onDragStop(a),a.preventDefault(),a.stopPropagation(),!1})},onDragStart:function(a,b){var c=this.classes,d=$(a.target);d.addClass(c.DRAG_SOURCE),this.__dropTarget=d.parentsUntil(this.__options.dragZone,this.__options.dropTargetSelector),this.__intervalId=setInterval(_.bind(this.__updateDragSourceLocation,this,d),50)},onDrag:function(a,b){this.__cursorPosition={x:a.pageX,y:a.pageY}},onDragStop:function(a,b){var c=this.classes,d=$(a.target);clearInterval(this.__intervalId),this.__intervalId=null,d.removeClass(c.DRAG_SOURCE)},__updateDragSourceLocation:function(a){this.__updateDropTarget(a),this.__sortItems(a)},__updateDropTarget:function(a){if(!this.__isElementUnderCursor(this.__dropTarget.get(0))){var b=this.__getDropTargetUnderCursor(this.__dropTarget);console.log("new",b),b.size()>0&&(this.__dropTarget=b.append(a))}},__sortItems:function(a){var b=this.__getSortItemUnderCursor(a);b.size()>0&&(a.index()<b.index()?a.insertAfter(b):a.insertBefore(b))},__isPointInRect:function(a,b,c,d,e,f){return a>=c&&b>=d&&a<=e&&b<=f},__isElementUnderCursor:function(a){console.log(this.__cursorPosition);var b=a.getBoundingClientRect();return this.__isPointInRect(this.__cursorPosition.x,this.__cursorPosition.y,b.left,b.top,b.right,b.bottom)},__getDropTargetUnderCursor:function(a){return $(_.find(this.__options.dragZone.find(this.__options.dropTargetSelector).not(a),function(a){return this.__isElementUnderCursor(a)},this))},__getSortItemUnderCursor:function(a){return $(_.find(a.siblings(this.__options.sortItemsSelector),function(a){return this.__isElementUnderCursor(a)},this))}})})