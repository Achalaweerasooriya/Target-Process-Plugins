define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(e,t,i){return i.extend({category:"edit","bus beforeInit + afterRender":function(i,n,r){var a=r.element,o=this.config.imagePreviewContentSelector,s=a.find(o).find("img");if(s.size()>0)var d=setInterval(e.bind(function(){t.contains(document.body,a[0])&&(clearInterval(d),this.fire("view.dom.ready"))},this),1e3);n.config.context.configurator.getComponentBusRegistry().getByName("imagePreview").done(e.bind(function(e){this.fire("previewBus.ready",e)},this))},"bus afterRender + view.dom.ready":function(e,i){var n=i.element,r=this.config.imagePreviewContentSelector,a=n.find(r).find("img"),o=n.width(),s=t('<div class="tau-lightbox-container" />'),d=t('<a target="_blank" class="i-role-fullview tau-lightbox-full-size">View Full Size</a>'),f=a.filter(function(){return parseInt(this.naturalWidth,10)>o});f.each(function(e){var i=t(this);i.data("id",e),i.wrap(s).after(d.clone().attr("href",i.attr("src")).data("id",e))}),this.fire("$imagesToPreview.ready",a)},"bus previewBus.ready + afterRender + $imagesToPreview.ready":function(e,i,n,r){var a=n.element;a.on("click",".i-role-fullview",function(e){e.preventDefault(),i.fire("refresh",{items:r.map(function(){var e=t(this);return{id:e.data("id"),uri:e.attr("src"),thumbnailUri:e.attr("src")}}),selectedId:t(this).data("id")})})}})});