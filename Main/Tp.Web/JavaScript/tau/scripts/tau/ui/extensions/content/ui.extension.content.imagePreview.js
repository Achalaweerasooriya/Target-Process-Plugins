define(["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(e,i,t){return t.extend({category:"edit",onInit:function(){this._isSwitchedOn=!0},"bus beforeInit + afterRender":function(t,n,r){var a=r.element,o=this.config.imagePreviewContentSelector,s=a.find(o+" img");if(s.size()>0)var l=setInterval(e.bind(function(){i.contains(document.body,a[0])&&(clearInterval(l),this.fire("view.dom.ready"))},this),1e3);n.config.context.configurator.getComponentBusRegistry().getByName("imagePreview").done(e.bind(function(e){this.previewBus=e,this.fire("previewBus.ready",e)},this))},"bus afterRender + view.dom.ready + previewBus.ready":function(e,i){this._toggleFullPreviewMode(i.element)},"bus toggle.full.preview.mode + previewBus.ready:last":function(e,i){this._isSwitchedOn=i.on,this._toggleFullPreviewMode(i.element)},_toggleFullPreviewMode:function(e){var t=this.config.imagePreviewContentSelector;if(this._isSwitchedOn){var n=e.find(t+" img"),r=n.filter(function(){return parseInt(this.naturalWidth,10)>this.width||parseInt(this.naturalHeight,10)>this.height});if(r.length>0){var a=i('<div class="tau-lightbox-container" />'),o=i('<a target="_blank" class="i-role-fullview tau-lightbox-full-size">View Full Size</a>');r.each(function(e){var t=i(this);t.data("id",e),t.wrap(a).after(o.clone().attr("href",t.attr("src")).data("id",e))})}this._bindImageHandler(e,n)}else{var s=e.find(t+" .i-role-fullview");s.length>0&&(s.unwrap(),s.remove())}},_bindImageHandler:function(e,t){e.off("click mousedown",".i-role-fullview");var n=this.previewBus;e.on("click mousedown",".i-role-fullview",function(e){e.preventDefault(),e.stopPropagation(),"click"==e.type&&n.fire("refresh",{items:t.map(function(){var e=i(this),t=e.attr("src");return{id:e.data("id"),uri:t,thumbnailUri:t}}),selectedId:i(this).data("id")})})}})});