define(["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){var onViewCellSkeletonBuiltTickHandler=function(meta,cell){var ext=this;meta.refActualCellsCount+=1,meta.refActualCellsData.push(cell),meta.refActualCellsCount===meta.expectedCellsCount&&ext.fire("overview.cells.skeletons.ready",{cells:meta.refActualCellsData,cardGroups:meta.refActualCellsCardsGroupedHash})};return ExtensionBase.extend({init:function(config){this._super(config),this.config=config},"bus initialize":function(evt,initConfig){var options=this._extractOptions(initConfig.options,{dragndrop:{containmentRefreshTimeout:null},clipboard:{processTimeout:null}});this.fire("options.ready",options),this.fire("configurator.ready",evt.data.context.configurator),this.fire("board.configurator.initialized",{configurator:evt.data.context.configurator}),this.startLifeCycle(evt.data)},"bus refresh":function(evt){this.startLifeCycle(this.config)},"bus configurator.ready > refresh":function(evt,configurator){this.fire("configurator.ready",configurator)},"bus options.ready > refresh":function(evt,options){this.fire("options.ready",options)},startLifeCycle:function(data){var self=this;self.fire("start.lifecycle",data)},"bus start.lifecycle":function(){var self=this;self.fire("afterInit",{}),self.fire("model.get.sliceInfo")},"bus pastElement:last+afterRender":function(evt){var newElement=evt.afterRender.data,pastElement=evt.pastElement.data,$newElement=newElement.element,$pastElement=pastElement.element;$pastElement!==$newElement&&this.fire("board.element.updated",{newElement:$newElement,oldElement:$pastElement})},"bus view.skeleton.built":function(evt){var self=this;self.fire("afterRender",evt.data),self.fire("pastElement",evt.data)},"bus afterRender":function(evt){var $el=evt.data.element,$grid=$el.find(".i-role-grid");this.fire("$el.ready",$el),this.fire("$grid.ready",$grid)},"bus model.sliceInfo.retrieved":function(evt){var self=this,data=evt.data;self.fire("view.build.skeleton",data);var eColsCount=data.x.onPage,eRowsCount=data.y.onPage,iColsCount=eColsCount||1,iRowsCount=eRowsCount||1,expectedCellsCount=iColsCount*iRowsCount+eColsCount+eRowsCount;self.fire("metaInfo",{expectedCellsCount:expectedCellsCount,refActualCellsCount:0,refActualCellsData:[]})},"bus model.cell.basicInfo.retrieved":function(evt){var cellDataItem=evt.data;this.fire("view.build.cell.skeleton",cellDataItem)},"bus view.cellSlot.built.start":function(){this.fire("model.get.cell.basicInfo.start",{})},"bus view.cellSlot.built.end":function(){this.fire("model.get.cell.basicInfo.end",{})},fireOverviewCardsReady:function(metaInfo){this.fire("overview.cards.ready",{cards:metaInfo.refActualCellsCardsHash,cardGroups:metaInfo.refActualCellsCardsGroupedHash})},"bus metaInfo":function(){this.onViewCellSkeletonBuiltTick=onViewCellSkeletonBuiltTickHandler},"bus overview.cells.skeletons.ready":function(){this.onViewCellSkeletonBuiltTick=$.noop},"bus metaInfo:last+view.cell.skeleton.built":function(e){var meta=e.metaInfo.data,cell=e["view.cell.skeleton.built"].data;this.onViewCellSkeletonBuiltTick(meta,cell)},"bus metaInfo+view.cards.update.complete":function(e){var meta=e.metaInfo.data;this.fireOverviewCardsReady(meta)},"bus view.skeleton.built+overview.cells.skeletons.ready":function(e){var element=e["view.skeleton.built"].data.element,cells=e["overview.cells.skeletons.ready"].data.cells;this.fire("overview.board.ready",{element:element,cells:cells})}})})