define(["Underscore","jQuery","tau/core/extension.base","tau/ui/extensions/board.plus/ui.board.plus.dom.utils"],function(e,t,i,o){return i.extend({"bus $el.ready + $groups.ready":function(i,r,a){var n=this;this.editMode=!1;var d=r.find(".i-role-list"),s=r.find(".i-role-moreitems").detach(),u=r.find(".i-role-action-showmore");d.delegate(".i-role-item a","click",function(e){t(this).closest(".tau-boardselector__group_mode_configure").length&&e.preventDefault()}),u.bind("click",function(e){t(this).closest(".tau-boardselector__group_mode_configure").length&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())});var l=e.bind(this._setLayout,this,s);l(),u.tauBubble({alignTo:r,content:s,showEvent:"click",appendTo:r,onShow:function(){l(),r.addClass("tau-boardselector_expanded_true"),t(window).bind("resize.boardselector",e.throttle(l,200)),t(window).trigger("resize.boardadd")},onHide:function(){r.removeClass("tau-boardselector_expanded_true"),t(window).unbind("resize.boardselector")},onPositionConfig:function(e){e.my="left top",e.at="right top"},template:['<div class="tau-bubble-board tau-boardselector__bubble">','<div class="tau-bubble-board__inner tau-container" role="content"></div>',"</div>"].join("")}),this.fire("$bubbled.ready",u);var c=e.bind(u.data("ui-tauBubble").hide,u.data("ui-tauBubble"));u.data("ui-tauBubble").hide=e.bind(function(e){this.editMode||e()},this,c),t("body").find(".tau-boardselector__overlay").remove(),s.delegate(".i-role-action-configure","click",e.bind(function(){this.editMode=!0,a.addClass("tau-boardselector__group_mode_configure"),t("body").append('<div class="ui-popup-overlay ui-popup-overlay_active_true tau-boardselector__overlay"></div>'),r.addClass("tau-boardselector_mode_configure"),r.tauSortable({groups:d,items:a.find(".i-role-item"),zIndex:300,distance:5,appendTo:r.parent(),createPlaceholderContent:o.createDragNDropPlaceholderContent,processToGroup:function(e,t,i){e.appendTo(i)},helper:function(){return t(this).clone().addClass("tau-view-ghost")},stop:l})},this)),s.delegate(".i-role-action-done, .i-role-action-collapse","click",e.bind(function(){r.hasClass("tau-boardselector_mode_configure")&&(this.editMode=!1,a.removeClass("tau-boardselector__group_mode_configure"),t("body").find(".tau-boardselector__overlay").remove(),r.removeClass("tau-boardselector_mode_configure"),n.fire("edit.done"),r.tauSortable("destroy"),this._setHeight(a,"redraw")),u.tauBubble("hide")},this)),r.bind("tausortablestop",function(e,t){n.fire("sort.stopped",[e,t]),n.fire("dragndrop.completed")})},"bus configurator.ready:last + $groups.ready:last + storageConfig.ready:last + edit.done":function(i,o,r,a){var n=this,d=o.getRestStorage(),s=[],u=1,l=r.eq(0);l.find(".i-role-item").each(function(){var i=t(this),o={id:i.attr("data-id"),menuIsVisible:1,menuNumericPriority:u++};s.push(e.bind(function(e,t){d.data(a.groupName,e.id,{scope:"Public",userData:{menuIsVisible:e.menuIsVisible,menuNumericPriority:e.menuNumericPriority}}).done(function(){t(!1)})},this,o))});var c=r.eq(1);c.find(".i-role-item").each(function(){var i=t(this),o={id:i.attr("data-id"),menuIsVisible:0,menuNumericPriority:u++};s.push(e.bind(function(e,t){d.data(a.groupName,e.id,{scope:"Public",userData:{menuIsVisible:e.menuIsVisible,menuNumericPriority:e.menuNumericPriority}}).done(function(){t(!1)})},this,o))}),e.series(s,function(){n.fire("edit.completed")})},_setLayout:function(e){var i=0,o=0,r=e.find(".i-role-item").length;if(r){var a=t(window).height(),n=t(window).width();o=Math.round(a/47/3),i=Math.floor(r/o);var d=Math.floor(n/220)-1,s=Math.floor(r/5);e.find(".i-role-list").parent().css("maxWidth",13.75*(Math.min(s,d,i)||1)+"rem")}},_setHeight:function(e,i){var o=99,r={redraw:{"max-height":t(window).height()-e[0].getBoundingClientRect().top-o,height:""},edit:{height:t(window).height()-e[0].getBoundingClientRect().top,"max-height":""}};e.eq(0).find(".i-role-list").css(r[i]||{})},destroy:function(){t(window).off("resize.boardadd"),this._super()},"bus $el.ready + view.dom.ready:last":function(i,o){var r=e.bind(this._setHeight,this,o,"redraw");r(),t(window).off("resize.boardadd"),t(window).on("resize.boardadd",e.throttle(r,250))}})});