define(["jQuery","tau/components/extensions/component.extension.base","tau/ui/templates/getting.started/ui.template.getting.started","Underscore",""],function($,ExtensionBase,Template,_){return ExtensionBase.extend({_getKeyShown:function(){return"bgs_was_shown_for_"+this._getConfigurator().getLoggedUser().id},_loadImagesAndInitialize:function($gettingStarted){var self=this,images=[],pushImage=function(){var path=$(this).css("background-image");if(path){var parts=path.split('"');parts.length!==3&&(parts=path.split("'")),parts.length===3&&(path=parts[1],images.push(path))}};$(".ui-popup-overlay",$gettingStarted).each(pushImage),$(".close",$gettingStarted).each(pushImage),$(".ui-popup",$gettingStarted).each(pushImage),$(".tau-gs-slide",$gettingStarted).each(pushImage);var deferredLoads=[];_.each(images,function(src){var d=$.Deferred(),i=new Image;i.src=src,i.onload=d.resolve,deferredLoads.push(d)}),$.when.apply(null,deferredLoads).then(function(){self.fire("getting.started.ready",$gettingStarted)})},"bus initialize":function(){var self=this,$html=this.config.context.configurator.getTemplateFactory().get(Template.name).bind({},{}),$gettingStarted=$('<div id="board_getting_started_content"></div>').hide().html($html).appendTo("body"),fireClose=function(){self.fire("hide.getting.started")};$(".close",$gettingStarted).click(fireClose),$(".ui-popup-overlay",$gettingStarted).click(fireClose),$(".tau-gs-skip-and-go",$gettingStarted).click(fireClose),this._loadImagesAndInitialize($gettingStarted);var storage=self._getConfigurator().getRestStorage();storage.data("help",this._getKeyShown()).done(function(r){r.data===null&&(self.fire("getting.started.my.first.time"),self.fire("show.getting.started"))})},_getConfigurator:function(){return this.config.context.configurator},"bus afterRender:last + getting.started.my.first.time + hide.getting.started":function(evt,data){var storage=this._getConfigurator().getRestStorage();storage.data("help",this._getKeyShown(),{})},"bus hide.getting.started":function(){$("#board_getting_started_content").hide(),this._getConfigurator().getKeyBoardManager().popHandler()},"bus getting.started.ready:last + show.getting.started + afterRender:last":function(evt){var self=this,keyBoardHandler={handleKeyDown:function(event){event.keyCode==$.ui.keyCode.ESCAPE&&self.fire("hide.getting.started")}};self._getConfigurator().getKeyBoardManager().pushHandler(keyBoardHandler),$("#board_getting_started_content").show(),self._isSlided||(self._isSlided=!0,$("#tau-gs-slider").rhinoslider({effect:"slide",easing:"easeInOutQuart",controlsPlayPause:!1,cycled:!1,showBullets:"always",showControls:"always",slidePrevDirection:"toRight",slideNextDirection:"toLeft"}))}})})