define(["Underscore","tau/core/extension.base","tau/models/board.editor/board.filter.suggestionManager"],function(_,ExtensionBase){return ExtensionBase.extend({changeAcid:function($form,currentAcid,boardAcid){$form.find("[name=selected_acid]").val(currentAcid);var rememberButton=$form.find("[name=remember_context]");boardAcid==currentAcid?rememberButton.addClass("tau-checked"):rememberButton.removeClass("tau-checked");if(currentAcid==""){var button=$form.find("[name=remember_context]");button.tauBubble("option","disabled",!0)}},"bus afterRender:last + dataBind:last + acid.changed":function(evt,afterRender,data,acid){var sliceAcid=data.acid;this.changeAcid(afterRender.element,acid,sliceAcid)},createTooltip:function(button,content){button.tauBubble({content:content,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join(""),zIndex:999,className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mouseleave",mode:"tooltip",onPositionConfig:function(config){return config.at="center top",config.my="center bottom",config.offset="0 0",config},onShow:function(){this.adjustPosition()}})},"bus dataBind + afterRender":function(evt,data,afterRender){var element=afterRender.element;this.createTooltip(element.find("[name=remove_context]"),"Remove context"),data.acid||this.createTooltip(element.find("[name=remember_context]"),"Remember selected teams and projects")},"bus afterRender + dataBind":function(evt,afterRender,data){var element=afterRender.element;if(!data.editable){element.find("select, input, button").prop("disabled",!0).addClass("permission-denied");return}var self=this,setAcidValue=function($form,newAcidValue){var currentAcid=element.find("[name=acid]").val();if(currentAcid==newAcidValue)return;newAcidValue==""?(element.find("[name=remember_context]").tauBubble("option","disabled",!0),element.find("[name=remove_context]").attr("disabled",!0),element.find("[name=remember_context]").removeClass("tau-checked")):(element.find("[name=remove_context]").attr("disabled",!1),element.find("[name=remember_context]").addClass("tau-checked")),element.find("[name=acid]").val(newAcidValue),self.fire("remember.acid",newAcidValue)};element.on("click","[name=remember_context]",function(){var newAcidValue=element.find("[name=selected_acid]").val();setAcidValue(element,newAcidValue)}),element.on("click","[name=remove_context]",function(){setAcidValue(element,"")})},createBubble:function(button,html){var timeoutId=null,activeElement=$([]),removeTimeout=function(){timeoutId&&(window.clearTimeout(timeoutId),timeoutId=null)},mouseEnterHandler=function(evt){activeElement=$(this),removeTimeout()},mouseLeaveHandler=function(evt){activeElement=$([]),removeTimeout(),timeoutId=window.setTimeout(hideBubble,500)},hideBubble=function(){button.tauBubble("hide")};button.on("mouseleave",mouseLeaveHandler),button.on("mouseenter",mouseEnterHandler),button.tauBubble({zIndex:999,template:['<div class="tau-bubble tau-bubble-important">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble__inner" role="content"></div>',"</div>"].join(""),onPositionConfig:function(){var offset="0 -6",position={of:button,collision:"fit none",my:"center top",at:"center bottom",offset:offset};return position},onShow:function($popup){activeElement.is(".tau-remember-context")||hideBubble(),$popup.on("mouseleave",mouseLeaveHandler),$popup.on("mouseenter",mouseEnterHandler)},onHide:function($popup){$popup.off("mouseleave",mouseLeaveHandler),$popup.off("mouseenter",mouseEnterHandler)},onResize:function($popup,data){var h=data.height;$popup.find(".tau-bubble__inner").css({maxHeight:h-50,overflowY:"auto"})},className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mousedown",mode:"tooltip",delay:500,content:html,stackName:"tooltip"})},"bus beforeInit:last + afterRender:last + context.data.ready":function(evt,beforeInit,afterRender,context){var configurator=beforeInit.config.context.configurator,html=configurator.getTemplateFactory().get("board.editor.remember.context.data").bind({},context),button=afterRender.element.find("[name=remember_context]");button.prop("disabled",!1),this.createBubble(button,html),button.tauBubble("option","disabled",!1)}})})