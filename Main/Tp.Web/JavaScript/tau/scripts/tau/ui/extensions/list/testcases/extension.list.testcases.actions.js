define(["Underscore","tau/components/extensions/component.extension.base","tau/configurator","tau/utils/utils.date"],function(a,b,c,d){return b.extend({_toggle:function(b,c){var d=b.find(".ui-richeditor:visible");d.length&&d.prev().richeditor("hideEditor"),a.isBoolean(c)?(b.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open",c).toggleClass("tau-list__itemexpander_state_closed",!c),b.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open",c).toggleClass("tau-list__table-additional_state_closed",!c)):(b.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open").toggleClass("tau-list__itemexpander_state_closed"),b.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open").toggleClass("tau-list__table-additional_state_closed"))},"bus prioritize.start":function(){var a=this.$el.find(".ui-richeditor:visible");a.length&&a.prev().richeditor("hideEditor")},"bus preDataBind":function(a){var b=a.data;b.labelAdd=this.config.labelAdd||"Add"},"bus testCaseWasAdded":function(){this.fire("evictTestCases")},"bus evictTestCases":function(){var a=this.config.context.entity;c.getStore().evictProperties(a.id,a.entityType.name,["testCases","testCases-count"]),this.fire("refresh")},"bus afterRender":function(b){var e=b.data.element;this.$el=e;var f=e.find("[role=item]"),g=this;e.delegate("[role=item-expander-all]","click",function(){g._toggle(f,!0)}),e.delegate("[role=item-collapser-all]","click",function(){g._toggle(f,!1)});var h=c.getStore(),i=function(a,b){h.save("testcase",{id:a.id,$set:{lastStatus:b,lastFailureComment:null,lastRunDate:d.format.datetime.short(c.getCurrentDate())},fields:["id","lastStatus","lastRunDate"]}).done({success:function(){}})},j=a.bind(this.addTestCaseClickHandler,this);e.delegate("[role=action-add]","click",function(a){a.preventDefault(),a.stopPropagation(),j()}),e.delegate("[role=item-expander]","click",function(a){var b=$(this),c=b.parents("[role=item]:first");g._toggle(c)}),e.delegate("[role=action-pass]","click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parents("[role=item]:first"),c=b.data("tmplItem").data;i(c,!0),g._toggle(b,!1);var d=b.next("[role=item]");d.length&&g._toggle(d,!0)}),e.delegate("[role=action-fail]","click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parents("[role=item]:first"),c=b.data("tmplItem").data,d=!1;i(c,d),g._toggle(b,!1);var e=b.next("[role=item]");e.length&&g._toggle(e,!0)})},addTestCaseClickHandler:function(){this.bus.fire("action.add",{entity:this.config.context.entity})}})})