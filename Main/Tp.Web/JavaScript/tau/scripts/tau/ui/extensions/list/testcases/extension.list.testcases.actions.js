define(["Underscore","tau/components/extensions/component.extension.base","tau/configurator","tau/utils/utils.date"],function(_,a,b,c){return a.extend({_toggle:function(a,b){var c=a.find(".ui-richeditor:visible");c.length&&c.prev().richeditor("hideEditor"),_.isBoolean(b)?(a.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open",b).toggleClass("tau-list__itemexpander_state_closed",!b),a.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open",b).toggleClass("tau-list__table-additional_state_closed",!b)):(a.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open").toggleClass("tau-list__itemexpander_state_closed"),a.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open").toggleClass("tau-list__table-additional_state_closed"))},"bus prioritize.start":function(){var a=this.$el.find(".ui-richeditor:visible");a.length&&a.prev().richeditor("hideEditor")},"bus preDataBind":function(a){var b=a.data;b.labelAdd=this.config.labelAdd||"Add"},"bus testCaseWasAdded":function(){this.fire("evictTestCases")},"bus evictTestCases":function(){var a=this.config.context.entity;b.getStore().evictProperties(a.id,a.entityType.name,["testCases","testCases-count"]),this.fire("refresh")},"bus afterRender":function(a){var d=a.data.element;this.$el=d;var e=d.find("[role=item]"),f=this;d.delegate("[role=item-expander-all]","click",function(){f._toggle(e,!0)}),d.delegate("[role=item-collapser-all]","click",function(){f._toggle(e,!1)});var g=b.getStore(),h=function(a,d){g.save("testcase",{id:a.id,$set:{lastStatus:d,lastFailureComment:null,lastRunDate:c.format.datetime.short(b.getCurrentDate())},fields:["id","lastStatus","lastRunDate"]}).done({success:function(){}})},i=_.bind(this.addTestCaseClickHandler,this);d.delegate("[role=action-add]","click",function(a){a.preventDefault(),a.stopPropagation(),i()}),d.delegate("[role=item-expander]","click",function(a){var b=$(this),c=b.parents("[role=item]:first");f._toggle(c)}),d.delegate("[role=action-pass]","click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parents("[role=item]:first"),c=b.data("tmplItem").data;h(c,!0),f._toggle(b,!1);var d=b.next("[role=item]");d.length&&f._toggle(d,!0)}),d.delegate("[role=action-fail]","click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parents("[role=item]:first"),c=b.data("tmplItem").data,d=!1;h(c,d),f._toggle(b,!1);var e=b.next("[role=item]");e.length&&f._toggle(e,!0)})},addTestCaseClickHandler:function(){this.bus.fire("action.add",{entity:this.config.context.entity})}})})