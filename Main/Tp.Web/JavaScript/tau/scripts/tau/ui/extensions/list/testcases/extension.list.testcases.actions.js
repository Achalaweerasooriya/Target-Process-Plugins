define(["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({_toggle:function($items,show){var $editors=$items.find(".ui-richeditor:visible");$editors.length&&$editors.prev().richeditor("hideEditor"),_.isBoolean(show)?($items.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open",show).toggleClass("tau-list__itemexpander_state_closed",!show),$items.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open",show).toggleClass("tau-list__table-additional_state_closed",!show)):($items.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open").toggleClass("tau-list__itemexpander_state_closed"),$items.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open").toggleClass("tau-list__table-additional_state_closed"))},"bus prioritize.start":function(){var $editors=this.$el.find(".ui-richeditor:visible");$editors.length&&$editors.prev().richeditor("hideEditor")},"bus preDataBind":function(evt){var data=evt.data;data.labelAdd=this.config.labelAdd||"Add"},"bus testCaseWasAdded":function(){this.fire("evictTestCases")},"bus evictTestCases":function(){var assignable=this.config.context.entity;this.config.context.configurator.getStore().evictProperties(assignable.id,assignable.entityType.name,["testCases","testCases-count"]),this.fire("refresh")},"bus afterRender":function(evt){var $el=evt.data.element;this.$el=$el;var $items=$el.find("[role=item]"),self=this;$el.delegate("[role=item-expander-all]","click",function(){self._toggle($items,!0)}),$el.delegate("[role=item-collapser-all]","click",function(){self._toggle($items,!1)});var store=this.config.context.configurator.getStore(),changeState=function(itemData,lastStatus){store.save("testcase",{id:itemData.id,$set:{lastStatus:lastStatus,lastFailureComment:null},fields:["id","lastStatus","lastRunDate"]}).done({success:function(){}})},_handler=_.bind(this.addTestCaseClickHandler,this);$el.delegate("[role=action-add]","click",function(e){e.preventDefault(),e.stopPropagation(),_handler(e)}),$el.delegate("[role=item-expander]","click",function(e){var $exp=$(this),$item=$exp.parents("[role=item]:first");self._toggle($item)}),$el.delegate("[role=action-pass]","click",function(e){e.preventDefault(),e.stopPropagation();var $item=$(this).parents("[role=item]:first"),itemData=$item.data("tmplItem").data;changeState(itemData,!0),self._toggle($item,!1);var $next=$item.next("[role=item]");$next.length&&self._toggle($next,!0)}),$el.delegate("[role=action-fail]","click",function(e){e.preventDefault(),e.stopPropagation();var $item=$(this).parents("[role=item]:first"),itemData=$item.data("tmplItem").data,lastStatus=!1;changeState(itemData,lastStatus),self._toggle($item,!1);var $next=$item.next("[role=item]");$next.length&&self._toggle($next,!0)})},addTestCaseClickHandler:function(evt){this.bus.fire("action.add",{originalEvent:evt,entity:this.config.context.entity})}})})