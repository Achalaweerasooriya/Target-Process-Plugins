define(["Underscore","tau/components/extensions/component.extension.base","tau/configurator","tau/utils/utils.date"],function(_,a,b,c){return a.extend({_toggle:function(a,b){var c=a.find(".ui-richeditor:visible");c.length&&c.prev().richeditor("hideEditor"),_.isBoolean(b)?(a.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open",b).toggleClass("tau-list__itemexpander_state_closed",!b),a.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open",b).toggleClass("tau-list__table-additional_state_closed",!b)):(a.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open").toggleClass("tau-list__itemexpander_state_closed"),a.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open").toggleClass("tau-list__table-additional_state_closed"))},"bus prioritize.start":function(){var a=this.$el.find(".ui-richeditor:visible");a.length&&a.prev().richeditor("hideEditor")},"bus preDataBind":function(a){var b=a.data;b.labelAdd=this.config.labelAdd||"Add"},"bus testCaseWasAdded":function(){this.fire("evictTestCases")},"bus evictTestCases":function(){var a=this.config.context.entity;b.getStore().evictProperties(a.id,a.entityType.name,["testCases","testCases-count"]),this.fire("refresh")},"bus afterRender":function(a){var c=a.data.element;this.$el=c;var d=c.find("[role=item]"),e=this;c.delegate("[role=item-expander-all]","click",function(){e._toggle(d,!0)}),c.delegate("[role=item-collapser-all]","click",function(){e._toggle(d,!1)});var f=b.getStore(),g=function(a,b){f.save("testcase",{id:a.id,$set:{lastStatus:b,lastFailureComment:null},fields:["id","lastStatus","lastRunDate"]}).done({success:function(){}})},h=_.bind(this.addTestCaseClickHandler,this);c.delegate("[role=action-add]","click",function(a){a.preventDefault(),a.stopPropagation(),h()}),c.delegate("[role=item-expander]","click",function(a){var b=$(this),c=b.parents("[role=item]:first");e._toggle(c)}),c.delegate("[role=action-pass]","click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parents("[role=item]:first"),c=b.data("tmplItem").data;g(c,!0),e._toggle(b,!1);var d=b.next("[role=item]");d.length&&e._toggle(d,!0)}),c.delegate("[role=action-fail]","click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).parents("[role=item]:first"),c=b.data("tmplItem").data,d=!1;g(c,d),e._toggle(b,!1);var f=b.next("[role=item]");f.length&&e._toggle(f,!0)})},addTestCaseClickHandler:function(){this.bus.fire("action.add",{entity:this.config.context.entity})}})})