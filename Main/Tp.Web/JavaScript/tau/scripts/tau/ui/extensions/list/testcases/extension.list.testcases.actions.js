define(["Underscore","tau/components/extensions/component.extension.base"],function(t,e){return e.extend({_toggle:function(e,i){var a=e.find(".ui-richeditor:visible");a.length&&a.prev().richeditor("hideEditor"),t.isBoolean(i)?(e.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open",i).toggleClass("tau-list__itemexpander_state_closed",!i),e.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open",i).toggleClass("tau-list__table-additional_state_closed",!i)):(e.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open").toggleClass("tau-list__itemexpander_state_closed"),e.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open").toggleClass("tau-list__table-additional_state_closed"))},"bus prioritize.start":function(){var t=this.$el.find(".ui-richeditor:visible");t.length&&t.prev().richeditor("hideEditor")},"bus preDataBind":function(t){var e=t.data;e.labelAdd=this.config.labelAdd||"Add"},"bus testCaseWasAdded":function(){this.fire("evictTestCases")},"bus evictTestCases":function(){var t=this.config.context.entity;this.config.context.configurator.getStore().evictProperties(t.id,t.entityType.name,["testCases","testCases-count"]),this.fire("refresh")},"bus afterRender":function(e){var i=e.data.element;this.$el=i;var a=i.find("[role=item]"),s=this;i.delegate("[role=item-expander-all]","click",function(){s._toggle(a,!0)}),i.delegate("[role=item-collapser-all]","click",function(){s._toggle(a,!1)});var n=this.config.context.configurator.getStore(),l=function(t,e){n.save("testcase",{id:t.id,$set:{lastStatus:e,lastFailureComment:null},fields:["id","lastStatus","lastRunDate"]}).done({success:function(){}})},o=t.bind(this.addTestCaseClickHandler,this);i.delegate("[role=action-add]","click",function(t){t.preventDefault(),t.stopPropagation(),o(t)}),i.delegate("[role=item-expander]","click",function(){var t=$(this),e=t.parents("[role=item]:first");s._toggle(e)}),i.delegate("[role=action-pass]","click",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).parents("[role=item]:first"),i=e.data("tmplItem").data;l(i,!0),s._toggle(e,!1);var a=e.next("[role=item]");a.length&&s._toggle(a,!0)}),i.delegate("[role=action-fail]","click",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).parents("[role=item]:first"),i=e.data("tmplItem").data,a=!1;l(i,a),s._toggle(e,!1);var n=e.next("[role=item]");n.length&&s._toggle(n,!0)})},addTestCaseClickHandler:function(t){this.bus.fire("action.add",{originalEvent:t,entity:this.config.context.entity})}})});