define(["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){var $clearAction=$el.find("[role=action_clear]");this.fire("$clearAction.ready",$clearAction);var $collapseAction=$el.find(".i-role-collapser");this.fire("$collapseAction.ready",$collapseAction);var $removeAction=$el.find("[role=action_remove]");this.fire("$removeAction.ready",$removeAction)},"bus $clearAction.ready+$selectable.ready":function(evt,$clearAction,$selectable){var self=this,handler=_.bind(function($selectable,$action){var $selected=$selectable.tauSelectable("getSelected");$action.toggleClass("tau-boardclipboard__action-clear-selected",$selected.length>0)},this,$selectable,$clearAction);$selectable.bind("tauselectablechanged",_.debounce(handler,400)),$clearAction.on("click",function(){var $selected=$selectable.tauSelectable("getSelected");$selected.length==0&&($selected=$selectable.find(".i-role-card"));var cards=[];$selected.each(function(){cards.push($(this).data())}),self.fire("cards.readyToClear",cards)})},"bus $clearAction.ready:last+$selectable.ready:last+cards.ready":function(evt,$clearAction,$selectable){var $selected=$selectable.tauSelectable("getSelected");$clearAction.toggleClass("tau-boardclipboard__action-clear-selected",$selected.length>0)},"bus $removeAction.ready+$selectable.ready":function(evt,$action,$selectable){var self=this,handler=_.bind(function($selectable,$action){var $selected=$selectable.tauSelectable("getSelected");$action.toggleClass("tau-boardclipboard__action-remove-selected",$selected.length>0)},this,$selectable,$action);$selectable.bind("tauselectablechanged",_.debounce(handler,400)),$action.on("click",function(){if(!window.confirm($(this).data("confirmation")))return;var $selected=$selectable.tauSelectable("getSelected");$selected.length==0&&($selected=$selectable.find(".i-role-card"));var cards=[];$selected.each(function(){cards.push($(this).data())}),self.fire("cards.readyToRemove",cards)})},"bus $el.ready:last + $selectable.ready:last + cards.readyToRemove.after":function(evt,$el,$selectable,cards){var self=this,cardsToSelect=cards.failure,$cards=$el.find(".i-role-card"),$failed=$();_.forEach(cardsToSelect,function(card){$failed=$failed.add($cards.filter("[data-_id="+card._id+"]"))}),self._animateWithClass($failed,"tau-card_failed")},"bus $removeAction.ready:last+$selectable.ready:last+cards.ready":function(evt,$clearAction,$selectable){var $selected=$selectable.tauSelectable("getSelected");$clearAction.toggleClass("tau-boardclipboard__action-remove-selected",$selected.length>0)},"bus $collapseAction.ready":function(evt,$action){$action.on("click",_.bind(function($action){this.fire("collapseState.set",$action.hasClass("tau-collapsed"))},this,$action))},"bus $collapseAction.ready:last+collapseState.updated":function(evt,$action,state){$action.toggleClass("tau-collapsed",state=="collapsed")},_animateWithClass:function($el,className){$el.removeClass(className),$el.addClass(className);var timeout=parseFloat($el.css("MozAnimationDuration")||$el.css("WebkitAnimationDuration")||1,10)*parseFloat($el.css("MozAnimationIterationCount")||$el.css("WebkitAnimationIterationCount")||1,10)*1e3;_.delay(_.bind(function(){this.removeClass(className)},$el),timeout)}})})