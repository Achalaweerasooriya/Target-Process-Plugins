define(["Underscore","jQuery","tau/core/extension.base","tau/ui/extensions/board.clipboard/ui.board.clipboard.helper"],function(t,a,e,n){return e.extend({"bus $el.ready + $selectable.ready + configurator.ready":function(t,a,e,n){this.addHandlerClearClipboard(a),this.addHandlerMenuAction(a,e,n.getTemplateFactory().getTermProcessor()),this.addHandlerAfterRemove(a),this.addHandlerCollapse(a)},addHandlerCollapse:function(a){var e=n.getCollapseButton(a);e.on("click",t.bind(function(){var t=e.hasClass("tau-collapsed");this.fire("collapseState.set",t),taus.track({action:"click clipboard collapser",tags:["click","clipboard",t?"expand":"collapse"]})},this))},addHandlerClearClipboard:function(t){var a=this;t.on("click","."+n.CLASS_MAP.ROLE_ACTION_CLEAR,function(){var e=n.getSelectedCards(t),i=n.getCardsData(e);a.fire("cards.readyToClear",i),taus.track({action:"click clipboard clear",tags:["click","clipboard","clear"]})}.bind(this))},addHandlerAfterRemove:function(e){this.on("cards.readyToRemove.after",function(i,r){var c=r.failure,o=e.find(".i-role-card"),d=t.reduce(c,function(t,a){return t.add(o.filter("[data-_id="+a._id+"]")),t},a());n.animateWithClass(d,"tau-card_failed")})},addHandlerMenuAction:function(t,a,e){var i=t.find(".clipboard__actions-list"),r=n.getActionsButton(t);r.tauBubble({onPositionConfig:function(t){return t.my="right top+2",t.at="right bottom",t},template:i,zIndex:999,onShow:function(){var a=i.find('[data-action="remove"] a'),e=i.find('[data-action="print"] a'),r=n.getSelectedCards(t).length,c=r+" card"+(r>1?"s":""),o="Delete "+c,d="Print "+c;a.text(o),e.html(d+'<span class="tau-icon-general tau-icon-loading"></span>'),i.focus()}}),i.menu({select:function(n,i){var c=i.item.data("action");this.handlersAction[c]&&this.handlersAction[c].call(this,i.item,t,r,a,e)}.bind(this)}),a.on("tauselectablechanged",function(){var a=n.getSelectedCards(t).length;n.toggleActionsButton(t,a)}),i.detach()},handlersAction:{remove:function(a,e,i,r,c){var o=t.bind(function(t){this.fire("cards.readyToRemove",t)
},this);taus.track({action:"click clipboard delete",tags:["click","clipboard","delete"]}),a.tauConfirm({onShow:function(r){var d=n.getSelectedCards(e),l=n.getCardsData(d),s=function(t,a){return c.getTerm(t,a>1?"names":"name")},u=["project","team"],f=[],h=t.groupBy(l,function(t){return t.entityType});t.forEach(h,function(t,a){var e=-1!==u.indexOf(a),n=t.length+" "+s(a,t.length);e&&(n='<span class="tau-clipboard__highlight-message">'+n+"</span>"),f.push(n)});var p="<h3>Are you sure you want to delete "+f.join(", ")+"?</h3>";r.find(".i-role-actioncancel").focus(),a.tauConfirm("option",{content:p,callbacks:{success:function(){o(l)},always:function(){i.tauBubble("hide")}}})},zIndex:130}),a.tauConfirm("show")},print:function(a,e,i){var r=n.getSelectedCards(e);a.addClass("ui-state-disabled"),i.one("taububblehide",function(){this.fire("clearPrintBlock")}.bind(this)),this.fire("printCards",{cards:t.pluck(n.getCardsData(r),"cardData"),$button:a}),taus.track({action:"click clipboard print",tags:["click","clipboard","print"]})}}})});