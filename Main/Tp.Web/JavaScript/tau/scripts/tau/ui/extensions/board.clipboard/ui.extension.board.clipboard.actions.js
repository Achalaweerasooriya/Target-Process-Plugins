define(["Underscore","jQuery","tau/core/extension.base","tau/ui/extensions/board.clipboard/ui.board.clipboard.helper"],function(a,t,e,n){return e.extend({"bus $el.ready + $selectable.ready + configurator.ready":function(a,t,e,n){this.addHandlerClearClipboard(t),this.addHandlerMenuAction(t,e,n.getTemplateFactory().getTermProcessor()),this.addHandlerAfterRemove(t),this.addHandlerCollapse(t)},addHandlerCollapse:function(t){var e=n.getCollapseButton(t);e.on("click",a.bind(function(){var a=e.hasClass("tau-collapsed");this.fire("collapseState.set",a),taus.track({action:"click clipboard collapser",tags:["click","clipboard",a?"expand":"collapse"]})},this))},addHandlerClearClipboard:function(a){var t=this;a.on("click","."+n.CLASS_MAP.ROLE_ACTION_CLEAR,function(){var e=n.getSelectedCards(a),i=n.getCardsData(e);t.fire("cards.readyToClear",i),taus.track({action:"click clipboard clear",tags:["click","clipboard","clear"]})}.bind(this))},addHandlerAfterRemove:function(e){this.on("cards.readyToRemove.after",function(n,i){var r=i.failure,c=e.find(".i-role-card"),o=a.reduce(r,function(a,t){return a.add(c.filter("[data-_id="+t._id+"]")),a},t());o.animateWithCss({cssClassName:"tau-card_failed"})})},addHandlerMenuAction:function(a,t,e){var i=a.find(".clipboard__actions-list"),r=n.getActionsButton(a);r.tauBubble({onPositionConfig:function(a){a.my="right top+2",a.at="right bottom"},template:i,onShow:function(){var t=i.find('[data-action="remove"] a'),e=i.find('[data-action="print"] a'),r=n.getSelectedCards(a).length,c=r+" card"+(r>1?"s":""),o="Delete "+c,d="Print "+c;t.text(o),e.html(d+'<span class="tau-icon-general tau-icon-loading"></span>'),i.focus()}}),i.menu({select:function(n,i){var c=i.item.data("action");this.handlersAction[c]&&this.handlersAction[c].call(this,i.item,a,r,t,e)}.bind(this)}),t.on("tauselectablechanged",function(){var t=n.getSelectedCards(a).length;n.toggleActionsButton(a,t)}),i.detach()},handlersAction:{remove:function(t,e,i,r,c){var o=a.bind(function(a){this.fire("cards.readyToRemove",a)
},this);taus.track({action:"click clipboard delete",tags:["click","clipboard","delete"]}),t.tauConfirm({onShow:function(r){var d=n.getSelectedCards(e),l=n.getCardsData(d),s=function(a,t){return c.getTerm(a,t>1?"names":"name")},u=["project","team"],f=[],h=a.groupBy(l,function(a){return a.entityType});a.forEach(h,function(a,t){var e=-1!==u.indexOf(t),n=a.length+" "+s(t,a.length);e&&(n='<span class="tau-clipboard__highlight-message">'+n+"</span>"),f.push(n)});var p="<h3>Are you sure you want to delete "+f.join(", ")+"?</h3>";r.find(".i-role-actioncancel").focus(),t.tauConfirm("option",{content:p,callbacks:{success:function(){o(l)},always:function(){i.tauBubble("hide")}}})}}),t.tauConfirm("show")},print:function(t,e,i){var r=n.getSelectedCards(e);t.addClass("ui-state-disabled"),i.one("taububblehide",function(){this.fire("clearPrintBlock")}.bind(this)),this.fire("printCards",{cards:a.pluck(n.getCardsData(r),"cardData"),$button:t}),taus.track({action:"click clipboard print",tags:["click","clipboard","print"]})}}})});