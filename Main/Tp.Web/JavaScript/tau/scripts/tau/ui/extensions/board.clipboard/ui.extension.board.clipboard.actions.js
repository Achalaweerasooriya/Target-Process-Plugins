define(["Underscore","jQuery","tau/core/extension.base","tau/ui/extensions/board.clipboard/ui.board.clipboard.helper"],function(t,e,a,n){return a.extend({"bus $el.ready + $selectable.ready + dataSpace":function(t,e,a,n){this.addHandlerClearClipboard(e),this.addHandlerMenuAction(e,a,n),this.addHandlerAfterRemove(e),this.addHandlerCollapse(e)},addHandlerCollapse:function(e){var a=n.getCollapseButton(e);a.on("click",t.bind(function(){this.fire("collapseState.set",a.hasClass("tau-collapsed"))},this))},addHandlerClearClipboard:function(t){var e=this;t.on("click","."+n.CLASS_MAP.ROLE_ACTION_CLEAR,function(){var a=n.getSelectedCards(t),i=n.getCardsData(a);e.fire("cards.readyToClear",i)}.bind(this))},addHandlerAfterRemove:function(a){this.on("cards.readyToRemove.after",function(i,r){var o=r.failure,d=a.find(".i-role-card"),c=t.reduce(o,function(t,e){return t.add(d.filter("[data-_id="+e._id+"]")),t},e());n.animateWithClass(c,"tau-card_failed")})},addHandlerMenuAction:function(t,e,a){var i=t.find(".clipboard__actions-list"),r=n.getActionsButton(t);r.tauBubble({onPositionConfig:function(t){return t.my="right top+2",t.at="right bottom",t},template:i,zIndex:999,onShow:function(){var e=i.find('[data-action="remove"] a'),a=i.find('[data-action="print"] a'),r=n.getSelectedCards(t).length,o=r+" card"+(r>1?"s":""),d="Delete "+o,c="Print "+o;e.text(d),a.html(c+'<span class="tau-icon-general tau-icon-loading"></span>'),i.focus()}}),i.menu({select:function(n,i){var o=i.item.data("action");this.handlersAction[o]&&this.handlersAction[o].call(this,i.item,t,r,e,a)}.bind(this)}),e.on("tauselectablechanged",function(){var e=n.getSelectedCards(t).length;n.toggleActionsButton(t,e)}),i.detach()},handlersAction:{remove:function(e,a,i,r,o){var d=t.bind(function(t){this.fire("cards.readyToRemove",t)},this);e.tauConfirm({onShow:function(r){var c=n.getSelectedCards(a),s=n.getCardsData(c),l=function(t,e){return e>1&&(t=t.replace(/y$/,"ie")+"s"),t},u=["project","team"],f=[],h=t.groupBy(s,function(t){return t.entityType});t.forEach(h,function(e,a){var n=t.find(o.cells.items,function(t){return t.id==a}).name,i=-1!==u.indexOf(a),r=e.length+" "+l(n,e.length);i&&(r='<span class="tau-clipboard__highlight-message">'+r+"</span>"),f.push(r)});var p="<h3>Are you sure you want to delete "+f.join(", ")+"?</h3>";r.find(".i-role-actioncancel").focus(),e.tauConfirm("option",{content:p,callbacks:{success:function(){d(s)},always:function(){i.tauBubble("hide")}}})},zIndex:130}),e.tauConfirm("show")},print:function(e,a,i){var r=n.getSelectedCards(a);e.addClass("ui-state-disabled"),i.one("taububblehide",function(){this.fire("clearPrintBlock")}.bind(this)),this.fire("printCards",{cards:t.pluck(n.getCardsData(r),"cardData"),$button:e})}}})});