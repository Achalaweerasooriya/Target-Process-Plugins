define(["jQuery","Underscore","tau/core/extension.base","tau/ui/extensions/ui.context-menu","tau/ui/extensions/board.plus/card-context-menu/menu-action-open-new-tab","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-rename","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-change-tags","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-add","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-assignments","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-delete","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-convert","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-copy-to-project","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-plan","tau/ui/extensions/board.plus/card-context-menu/menu-action-item-unplan","tau/ui/behaviour/common/ui.behaviour.editableText"],function(t,e,n,s,i,a,o,u,c,r,d,l,m,p){return n.extend({resetLifecycle:!0,cardMenuActionActivatedCssClass:"i-role-permanent-context-menu-action-activated","bus slice.ready + domWrapper.ready:last + viewMode.ready:last + model.zoomLevelChanged:last + cardLayoutFactory.ready:last":function(t,e,n,g,x,h){this.options={bus:this,sliceReady:e,configurator:h.configurator,domWrapper:n,viewMode:g,zoomLevelData:x,boardSettings:{boardSettings:h.boardSettings},layout:h,activationCssClass:this.cardMenuActionActivatedCssClass,propertiesToEvict:[]};var v={context:this._getContext(n),handlers:{open:new i(this.getSettings()),rename:new a(this.getSettings()),changeTagsAction:new o(this.getSettings({propertiesToEvict:["tags"],activationCssClass:["i-role-permanent-context-menu-tags",this.cardMenuActionActivatedCssClass].join(" ")})),assignments:new c(this.getSettings({propertiesToEvict:["entityState","assignments","roleEfforts"],activationCssClass:["i-role-permanent-context-menu-assignments",this.cardMenuActionActivatedCssClass].join(" ")})),addAction:new u(this.getSettings()),convert:d.createMenuItem(this.getSettings()),copyToProject:new l(this.getSettings()),plan:new m(this.getSettings()),sep1:"---------",unplan:new p(this.getSettings()),del:new r(this.getSettings())},showSelectors:[".i-role-card"],skipShowSelectors:[".tau-id"]};
"timeline"!==this.options.viewMode&&(delete v.handlers.plan,delete v.handlers.unplan),this.contextMenu=new s(v)},getSettings:function(t){return e.extend(e.clone(this.options),t)},_getContext:function(e){var n=e.board.closest(".tau-app-main-pane");if(!n.length){var s=t(".tau-app-main-pane");n=s.length?s:t(".tau-app")}return n},destroy:function(){this.contextMenu&&this.contextMenu.destroy(),this._super()}})});