define(["Underscore","jQuery","tau/ui/extensions/board.plus/ui.extension.board.plus.view","tau/ui/extensions/timeline/dom-wrapper/timeline.dom-wrapper","tau/ui/extensions/board.plus/ui.extension.board.plus.operations.strategies","tau/components/board.timeline/models/cell/model.cell-paging.extension"],function(e,t,i,n,o,l){var a=i.extend({resetLifecycle:!0,init:function(e){this._timelineWidthDeferred=t.Deferred(),this.modelCellPagingExtension=new l,this._super(e)},_getCustomizedBacklogTemplateConfig:function(i,n,o){var l=t.Deferred();return n.getLayoutFactory().done(function(t){var n=e.extend({getLayout:t,configurator:i},o);l.resolve({name:"boardplus.cell.grid.skeleton.customized",data:n})}),l},buildCellSkeleton:function(e,t,i,n){this.fire("build.timeline.cell.skeleton",{configurator:e,boardLayout:t,buildCellCommand:i,boardSkeleton:n,timelineWidthDeferred:this._timelineWidthDeferred})},buildAxisSkeleton:function(e,t,i,n){this.fire("build.timeline.axis.skeleton",{configurator:e,boardLayout:t,buildAxisCellCommand:i,boardSkeleton:n})},getCellTemplateConfig:function(e,t,i){return this._getCustomizedBacklogTemplateConfig(e,t,i)},getCoords:function(e){var t=this._super(e);return e.hasAttribute("data-istimeline")&&(t.isTimeline="true"===e.getAttribute("data-istimeline")),t},createDomWrapper:function(e,t,i,o){return new n(e,i,o,t)},"bus configurator.ready + definition.ready + model.cells.metaInfo.ready + view.skeleton.built + board.paging.settings + cardLayoutFactory.ready":function(e,t,i,n,o,l,a){var r=this.createDomWrapper(o.element,t,i,n);r.getPagingSettings=function(){return l},r.cardLayoutFactory=a,this.fire("domWrapper.ready",r)},"bus configurator.ready:last + operation.execute.done":function(e,t,i){o.applyCompleteHandler(this,t,i)},fireModelGetCellBasicInfo:function(t){var i=e.deepClone(t);e.has(i,"x")&&(i.x=null===i.x?"null":i.x),e.has(i,"y")&&(i.y=null===i.y?"null":i.y),this.fire("model.get.cell.basicInfo",i)},"bus definition.ready:last + boardSettings.ready:last + view.cellSlot.built":function(t,i,n,o){var l,a=n.boardSettings.settings.collapse||{x:[],y:[]};
if(-1!==e(a.x).indexOf(o.data.x)||-1!==e(a.y).indexOf(o.data.y))l=this.modelCellPagingExtension.getMaxPageSize();else{var r=0;this.modelCellPagingExtension.isAxisExist(i,"y")&&++r,l=this.modelCellPagingExtension.getPageSize(r,i.zoomLevel)}var s=o.data;s.from=0,s.to=l-1,this.fireModelGetCellBasicInfo(s)},"bus overview.board.ready:last > view.cell.skeleton.built":function(e,t,i){this.fire("view.cell.skeleton.updated",i)},"bus overview.board.ready:last > view.cell.skeleton.element.beforeUpdate":function(e,t,i){i.scrollToTarget&&i.content.css("opacity",.15)},"bus scrollManager.ready:last > view.cell.skeleton.element.afterUpdate > resize.completed":function(t,i,n){var o=n.content;n.scrollToTarget&&o.size()>0&&e.defer(function(){i.scrollToVisibility(o.last(),{axis:"y",duration:1e3,easing:"easeInSine",offset:{top:20},onAfter:function(){o.animate({opacity:1},"slow","easeOutBounce")}})})},"bus view.skeleton.built + view.dom.ready:last":function(e,t){var i=t.element.find(".tau-timeline-flow").width();this._timelineWidthDeferred.resolve(i)}});return a});