define(["require","Underscore","jQuery","tau/ui/extensions/board.plus/ui.extension.board.plus.view","tau/ui/extensions/timeline/dom-wrapper/timeline.dom-wrapper","tau/ui/extensions/board.plus/ui.extension.board.plus.operations.strategies","tau/components/board.timeline/models/cell/model.cell-paging.extension","tau/ui/templates/board.plus/customized/ui.template.boardplus.cell.grid.skeleton.customized"],function(e){var t=e("Underscore"),i=e("jQuery"),n=e("tau/ui/extensions/board.plus/ui.extension.board.plus.view"),o=e("tau/ui/extensions/timeline/dom-wrapper/timeline.dom-wrapper"),l=e("tau/ui/extensions/board.plus/ui.extension.board.plus.operations.strategies"),a=e("tau/components/board.timeline/models/cell/model.cell-paging.extension"),r=e("tau/ui/templates/board.plus/customized/ui.template.boardplus.cell.grid.skeleton.customized"),s=n.extend({resetLifecycle:!0,init:function(e){this._timelineWidthDeferred=i.Deferred(),this.modelCellPagingExtension=new a,this._super(e)},_getCustomizedBacklogTemplateConfig:function(e,n,o){var l=i.Deferred();return n.getLayoutFactory().done(function(i){var n=t.extend({getLayout:i,configurator:e},o);l.resolve({template:r,data:n})}),l},buildCellSkeleton:function(e,t,i,n){this.fire("build.timeline.cell.skeleton",{configurator:e,boardLayout:t,buildCellCommand:i,boardSkeleton:n,timelineWidthDeferred:this._timelineWidthDeferred})},buildAxisSkeleton:function(e,t,i,n){this.fire("build.timeline.axis.skeleton",{configurator:e,boardLayout:t,buildAxisCellCommand:i,boardSkeleton:n})},getCellTemplateConfig:function(e,t,i){return this._getCustomizedBacklogTemplateConfig(e,t,i)},getCoords:function(e){var t=this._super(e);return e.hasAttribute("data-istimeline")&&(t.isTimeline="true"===e.getAttribute("data-istimeline")),t},createDomWrapper:function(e,t,i,n){return new o(e,i,n,t)},"bus configurator.ready + definition.ready + model.cells.metaInfo.ready + view.skeleton.built + board.paging.settings + cardLayoutFactory.ready":function(e,t,i,n,o,l,a){var r=this.createDomWrapper(o.element,t,i,n);
r.getPagingSettings=function(){return l},r.cardLayoutFactory=a,this.fire("domWrapper.ready",r)},"bus configurator.ready:last + operation.execute.done":function(e,t,i){l.applyCompleteHandler(this,t,i)},fireModelGetCellBasicInfo:function(e){var i=t.deepClone(e);t.has(i,"x")&&(i.x=null===i.x?"null":i.x),t.has(i,"y")&&(i.y=null===i.y?"null":i.y),this.fire("model.get.cell.basicInfo",i)},"bus definition.ready:last + boardSettings.ready:last + view.cellSlot.built":function(e,i,n,o){var l,a=n.boardSettings.settings.collapse||{x:[],y:[]};if(-1!==t(a.x).indexOf(o.data.x)||-1!==t(a.y).indexOf(o.data.y))l=this.modelCellPagingExtension.getMaxPageSize();else{var r=this.modelCellPagingExtension.isAxisExist(i,"y"),s=r?1:0;l=this.modelCellPagingExtension.getPageSize(s,i.zoomLevel)}var u=o.data;u.from=0,u.to=l-1,this.fireModelGetCellBasicInfo(u)},"bus overview.board.ready:last > view.cell.skeleton.built":function(e,t,i){this.fire("view.cell.skeleton.updated",i)},"bus overview.board.ready:last > view.cell.skeleton.element.beforeUpdate":function(e,t,i){i.scrollToTarget&&i.content.css("opacity",.15)},"bus scrollManager.ready:last > view.cell.skeleton.element.afterUpdate > resize.completed":function(e,i,n){var o=n.content;n.scrollToTarget&&o.size()>0&&t.defer(function(){i.scrollToVisibility(o.last(),{axis:"y",duration:1e3,easing:"easeInSine",offset:{top:20},onAfter:function(){o.animate({opacity:1},"slow","easeOutBounce")}})})},"bus view.skeleton.built + view.dom.ready:last":function(e,t){var i=t.element.find(".tau-timeline-flow").width();this._timelineWidthDeferred.resolve(i)}});return s});