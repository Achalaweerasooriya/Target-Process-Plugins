define(["Underscore","jQuery","tau/core/extension.base","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tau/core/event-dispatcher"],function(e,t,n,r,a){return n.extend({"bus beforeInit":function(){this.fire("controller.hostType",null),this.fire("controller.app.host.prev",null),this.fire("controller.app.page.prev",null)},"bus controller.app.host.prev > controller.app.host":function(e){var t=e["controller.app.host"].data,n=e["controller.app.host.prev"].data;n&&n.destroy(),this.fire("controller.app.host.prev",t)},"bus controller.app.page.prev > controller.app.page":function(e){var t=e["controller.app.page"].data,n=e["controller.app.page.prev"].data;n&&n.destroy(),this.fire("controller.app.page.prev",t)},"bus configurator.ready:last + application.navigate":function(e,t){t.service("errorBar").fire("clearError")},"bus controller.hostType:last + application.navigate":function(t,n,r){var a=r.requestArgs||{},o=a.entity,i=a.action,s=e.isObject(o)?o.type:e.asString(o);r.requestArgs&&r.requestArgs.cssClass||!(s&&i||"reports"==o)||(r.applicationClassName="tau-page-entity"),r.requestArgs&&r.requestArgs.applicationClassName&&(r.applicationClassName=r.requestArgs.applicationClassName);var l=r.host,p=!n||l.name!==n.name;p&&this.fire("controller.hostType",l);var d=p?"full":"partial";this.fire("controller.load."+d,r)},"bus options.ready:last + configurator.ready:last + controller.load.full":function(n,r,o,i){var s=o.getComponentBuilder(),l=i.requestArgs,p=l.handlers||{},d=this._getInitConfig(o,r,e.omit(l,"handlers"));t.when(s.create(i.host,d),s.create(i.type,d)).done(e.bind(function(t,n){this.fire("controller.preExecute",{}),this.fire("controller.app.host",t),this.fire("controller.app.page",n),this.addListeners(t,"Host"),this.addListeners(n,"Page");var r=new a([t,n]);r.listen("afterRender",e.bind(function(t){var r=t.argsArr[0].element,a=t.argsArr[1].element;this.fire("innerContentRendered",{element:r,$host:r,$page:a,applicationClassName:i.applicationClassName}),this.fire("host.ready"),n.on("afterRender",e.bind(function(e,t){this.fire("innerContentRendered",{element:this.$host,$host:this.$host,$page:t.element,applicationClassName:i.applicationClassName})
},this),this),n.on("afterRenderAll",e.bind(function(e,t){this.fire("innerContentRenderedAll",{element:this.$host,$host:this.$host,$page:t.element,applicationClassName:i.applicationClassName}),p.onPageLoaded&&p.onPageLoaded()},this),this)},this)),t.initialize(d),n.initialize(d),this.fire("controller.postExecute",{})},this))},"bus options.ready:last + configurator.ready:last + host.ready:last + controller.load.partial":function(n,r,a,o,i){var s=a.getComponentBuilder(),l=i.requestArgs,p=l.handlers||{},d=this._getInitConfig(a,r,e.omit(l,"handlers"));t.when(s.create(i.type,d)).done(e.bind(function(t){this.fire("controller.preExecute",{}),this.fire("controller.app.page",t),this.addListeners(t,"Page"),t.on("afterRender",e.bind(function(e,t){this.fire("innerContentRendered",{element:this.$host,$host:this.$host,$page:t.element,applicationClassName:i.applicationClassName}),p.onPageLoaded&&p.onPageLoaded()},this),this),t.initialize(d),this.fire("controller.postExecute",{})},this))},"bus afterRender:last + innerContentRendered":function(e,t,n){var r=t.element,a=n.$host,o=n.$page;a.is(this.$host)&&o.is(this.$page)||(a.is(this.$host)||(this._appendHost(r,a),this.$host=a,this._appendPage(r,a,o),this.$page=o),o.is(this.$page)||(this._appendPage(r,this.$host,o),this.$page=o),this.fire("applyClasses",{$el:r,controllersRenderData:n}),this.fire("controller.appContent.rendered",r),this.fire("contentRendered",{element:r}))},"bus view.dom.ready:last + applyClasses":function(e,t,n){var r=n.$el,a=n.controllersRenderData,o=r.parents(".ui-popup:first");o=o.length?r.add(o):r,a.applicationClassName?r.data("classname")!=a.applicationClassName&&(o.removeClass(o.data("classname")||""),o.addClass(a.applicationClassName),o.data("classname",a.applicationClassName)):(o.removeClass(o.data("classname")||""),o.data("classname",""))},"bus controller.load.partial > controller.host.rendered":function(e,t,n){this.toggleProgressIndicator(n.element,!0)},"bus controller.load.partial > controller.host.rendered > innerPageRendered":function(e,t,n){this.toggleProgressIndicator(n.element,!1)
},toggleProgressIndicator:function(e,t){var n=e.find("[role=main]"),a=this.config.integration||{};!0!==a.disableProgressIndicator&&r.get(n).toggle(!!t)},"bus configurator.ready:last + controller.app.page":function(e,t,n){n.on("entity.beforeDelete",function(){this.fire("initProgress")},this),n.on("entity.deleted",function(){t.service("navigator").back()},this),n.on("error",function(e){this.fire("application.error",e.data)},this)},"bus view.dom.ready:last + controller.app.host:last + innerHostRendered + controller.appContent.rendered":function(e,t,n){n.fire("view.dom.ready",t)},"bus view.dom.ready:last + controller.app.page:last + innerPageRendered + controller.appContent.rendered":function(e,t,n){n.fire("view.dom.ready",t)},"bus controller.app.host:last > destroy":function(e,t){t.fire("destroy")},"bus controller.app.page:last > destroy":function(e,t){t.fire("destroy")},"bus controller.app.page:last > application.exit":function(e,t){t.fire("destroy"),taus.track({action:"close entity",tags:["entity","close entity"]})},_getInitConfig:function(t,n,r){var a=e.defaults({context:{configurator:t}},r);return a.turnOffLoadingIndicator=n.turnOffLoadingIndicator||!1,a.comet=n.comet||{},a},_appendHost:function(e,t){e.empty().append(t)},_appendPage:function(e,t,n){t.find("[role=main]").append(n)},addListeners:function(t,n){return t.on("afterRender",e.bind(function(e){this.fire("inner"+n+"Rendered",e.data)},this),this),t}})});