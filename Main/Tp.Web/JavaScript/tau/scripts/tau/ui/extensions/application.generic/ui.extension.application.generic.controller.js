define(["Underscore","jQuery","tau/core/extension.base","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tau/core/event-dispatcher"],function(e,t,r,n,a){return r.extend({"bus beforeInit":function(){this.fire("controller.hostType",null),this.fire("controller.app.host.prev",null),this.fire("controller.app.page.prev",null)},"bus controller.app.host.prev > controller.app.host":function(e){var t=e["controller.app.host"].data,r=e["controller.app.host.prev"].data;r&&r.destroy(),this.fire("controller.app.host.prev",t)},"bus controller.app.page.prev > controller.app.page":function(e){var t=e["controller.app.page"].data,r=e["controller.app.page.prev"].data;r&&r.destroy(),this.fire("controller.app.page.prev",t)},"bus configurator.ready:last + application.navigate":function(e,t){t.service("errorBar").fire("clearError")},"bus controller.hostType:last + application.navigate":function(t,r,n){var a=n.requestArgs||{},o=a.entity,i=a.action,s=e.isObject(o)?o.type:e.asString(o);n.requestArgs&&n.requestArgs.cssClass||!(s&&i||"reports"==o)||(n.applicationClassName="tau-page-entity"),n.requestArgs&&n.requestArgs.applicationClassName&&(n.applicationClassName=n.requestArgs.applicationClassName);var l=n.host,p=!r||l.name!==r.name;p&&this.fire("controller.hostType",l);var d=p?"full":"partial";this.fire("controller.load."+d,n)},"bus options.ready:last + configurator.ready:last + controller.load.full":function(r,n,o,i){var s=o.getComponentBuilder(),l=i.requestArgs,p=l.handlers||{},d=this._getInitConfig(o,n,e.omit(l,"handlers"));t.when(s.create(i.host,d),s.create(i.type,d)).done(e.bind(function(t,r){this.fire("controller.preExecute",{}),this.fire("controller.app.host",t),this.fire("controller.app.page",r),this.addListeners(t,"Host"),this.addListeners(r,"Page");var n=new a([t,r]);n.listen("afterRender",e.bind(function(t){var n=t.argsArr[0].element,a=t.argsArr[1].element;this.fire("innerContentRendered",{element:n,$host:n,$page:a,applicationClassName:i.applicationClassName}),this.fire("host.ready"),r.on("afterRender",e.bind(function(e,t){this.fire("innerContentRendered",{element:this.$host,$host:this.$host,$page:t.element,applicationClassName:i.applicationClassName})},this),this),r.on("afterRenderAll",e.bind(function(e,t){this.fire("innerContentRenderedAll",{element:this.$host,$host:this.$host,$page:t.element,applicationClassName:i.applicationClassName}),p.onPageLoaded&&p.onPageLoaded()},this),this)},this)),t.initialize(d),r.initialize(d),this.fire("controller.postExecute",{})},this))},"bus options.ready:last + configurator.ready:last + host.ready:last + controller.load.partial":function(r,n,a,o,i){var s=a.getComponentBuilder(),l=i.requestArgs,p=l.handlers||{},d=this._getInitConfig(a,n,e.omit(l,"handlers"));t.when(s.create(i.type,d)).done(e.bind(function(t){this.fire("controller.preExecute",{}),this.fire("controller.app.page",t),this.addListeners(t,"Page"),t.on("afterRender",e.bind(function(e,t){this.fire("innerContentRendered",{element:this.$host,$host:this.$host,$page:t.element,applicationClassName:i.applicationClassName}),p.onPageLoaded&&p.onPageLoaded()},this),this),t.initialize(d),this.fire("controller.postExecute",{})},this))},"bus afterRender:last + innerContentRendered":function(e,t,r){var n=t.element,a=r.$host,o=r.$page;a.is(this.$host)&&o.is(this.$page)||(a.is(this.$host)||(this._appendHost(n,a),this.$host=a,this._appendPage(n,a,o),this.$page=o),o.is(this.$page)||(this._appendPage(n,this.$host,o),this.$page=o),this.fire("applyClasses",{$el:n,controllersRenderData:r}),this.fire("controller.appContent.rendered",n),this.fire("contentRendered",{element:n}))},"bus view.dom.ready:last + applyClasses":function(e,t,r){var n=r.$el,a=r.controllersRenderData,o=n.parents(".ui-popup:first");o=o.length?n.add(o):n,a.applicationClassName?n.data("classname")!=a.applicationClassName&&(o.removeClass(o.data("classname")||""),o.addClass(a.applicationClassName),o.data("classname",a.applicationClassName)):(o.removeClass(o.data("classname")||""),o.data("classname",""))},"bus controller.load.partial > controller.host.rendered":function(e,t,r){this.toggleProgressIndicator(r.element,!0)},"bus controller.load.partial > controller.host.rendered > innerPageRendered":function(e,t,r){this.toggleProgressIndicator(r.element,!1)},toggleProgressIndicator:function(e,t){var r=e.find("[role=main]"),a=this.config.integration||{};!0!==a.disableProgressIndicator&&n.get(r).toggle(!!t)},"bus configurator.ready:last + controller.app.page":function(e,t,r){r.on("entity.beforeDelete",function(){this.fire("initProgress")},this),r.on("entity.deleted",function(){t.service("navigator").back()},this),r.on("error",function(e){this.fire("application.error",e.data)},this)},"bus view.dom.ready:last + controller.app.host:last + innerHostRendered + controller.appContent.rendered":function(e,t,r){r.fire("view.dom.ready",t)},"bus view.dom.ready:last + controller.app.page:last + innerPageRendered + controller.appContent.rendered":function(e,t,r){r.fire("view.dom.ready",t)},"bus controller.app.host:last > destroy":function(e,t){t.fire("destroy")},"bus controller.app.page:last > destroy":function(e,t){t.fire("destroy")},"bus controller.app.page:last > application.exit":function(e,t){t.fire("destroy")},_getInitConfig:function(t,r,n){var a=e.defaults({context:{configurator:t}},n);return a.turnOffLoadingIndicator=r.turnOffLoadingIndicator||!1,a.comet=r.comet||{},a},_appendHost:function(e,t){e.empty().append(t)},_appendPage:function(e,t,r){t.find("[role=main]").append(r)},addListeners:function(t,r){return t.on("afterRender",e.bind(function(e){this.fire("inner"+r+"Rendered",e.data)},this),this),t}})});