define(["Underscore","jQuery"],function(e,t){function s(e,s){var n=t('<div class="tau-message tau-danger">Error: '+e+"</div>");s.setText(n)}var n=function(t,n){for(var r=t;r.InnerException;)r=r.InnerException;return e.isUndefined(r)||"Tp.BusinessObjects.InvalidLicenseException"!==r.Type?!1:(s(r.Message,n),!0)},r=function(s,n,r,a){if(!(s.Details&&s.Details.ServerErrorCodes&&e.contains(s.Details.ServerErrorCodes,"ProjectNotAssignedToTeam")))return!1;var i=a.getStore(),o=t('<div class="tau-message tau-danger">'+s.Message+' <a class="i-role-assign-team-to-project" href="#">Assign</a></div>'),c=s.InnerException.Details.Suggest,d=e.findWhere(c,{id:"project"}).value,u=e.findWhere(c,{id:"team"}).value;return o.find("a").on("click",function(){i.save("teamProject",{$set:{project:{id:d},team:{id:u}},fields:["id","project","team"]}).done({success:function(e){var s=e[0].data.team.name,r=e[0].data.project.name,a=t('<div class="tau-message tau-success"> Success! The '+s+" team is now assigned to the "+r+" project.</div>");n.setText(a)}})}),n.setText(o),!0},a=function(s,n,r,a){if(!(s.Details&&s.Details.ServerErrorCodes&&e.contains(s.Details.ServerErrorCodes,"WorkflowHasNoResponsibleRolesBrokenRule")))return!1;var i=a.getUrlBuilder(),o=s.InnerException.Details.Suggest,c=e.findWhere(o,{id:"process"}).value,d=e.findWhere(o,{id:"entityKind"}).value,u=t('<div class="tau-message tau-danger">'+s.Message+' <a href="'+i.getWorkflowSetupPage(c,d.toLowerCase())+'" title="link will be opened in the same window">Workflow setup</a></div>');return n.setText(u),!0},i=function(t,n){var r=t.InnerException&&e.isString(t.InnerException.Details)?t.Message+" "+t.InnerException.Details:t.Message;s(r,n)};return{handle:function(e,t,s,o){n(e,s)||r(e,s,t,o)||a(e,s,t,o)||i(e,s)}}});