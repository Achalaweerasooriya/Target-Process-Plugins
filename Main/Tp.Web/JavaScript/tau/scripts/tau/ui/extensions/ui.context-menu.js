define(["jQuery","Underscore","tau/core/class"],function(t,n,e){return e.extend({cardContextMenuCssClass:"tau-context-menu-selected",init:function(n){this.context=n.context,!this.context&&window.console&&window.console.error&&console.error("DOM container for context menu should be specified"),this.handlers=n.handlers,this.onShow=n.onShow,this.onHide=n.onHide,this._destroyContextMenu(),t.contextMenu({context:this.context,selector:n.showSelectors.join(", "),skipShowSelector:n.skipShowSelectors.join(", "),callback:this.onContextMenuClick.bind(this),items:this.filterActions(this.handlers),events:{show:this.onContextMenuShow.bind(this),hide:this.onContextMenuHide.bind(this)},animation:{duration:0},zIndex:9999})},onContextMenuClick:function(t,n){this.trackContextMenuClick(t);var e=this.find(t,this.handlers),i=this.find(t,n.items);return e.itemClickCallback&&e.itemClickCallback(n,i)},trackContextMenuClick:function(t){taus.track({action:"click context menu",name:t,tags:["context menu",t,"click"]})},onContextMenuShow:function(t){this.onShow&&this.onShow(t);var e=t.$trigger;e.addClass(this.cardContextMenuCssClass),e.attr("data-card-selector","#"+e.parent().uniqueId().attr("id")+' .i-role-card[data-entity-id="'+e.data("entityId")+'"]'),n.each(this.flatten(this.handlers),function(n,e){if(n.onShow){var i=this.find(e,t.items);n.onShow(t,i)}},this)},onContextMenuHide:function(e){this.onHide&&this.onHide(e),t(".i-role-card").removeClass(this.cardContextMenuCssClass),n.each(this.flatten(this.handlers),function(t,n){if(t.onHide){var i=this.find(n,e.items);t.onHide(i,e)}},this)},find:function(t,n){var e=this.flatten(n);return e[t]},flatten:function(t){var e=function(t,n,i,o){return t[i]=n,null!==n&&n.hasOwnProperty("items")?o(n.items,e,t):t},i=function(t,e,i){return n.reduce(t,e,i,t)};return i(t,function(t,n,o){return e(t,n,o,i)},{})},filterActions:function(t){for(var n in t)if(t.hasOwnProperty(n)){var e=t[n];e.hasOwnProperty("isDisabled")&&e.isDisabled&&delete t[n]}return t},_destroyContextMenu:function(){t.contextMenu("destroy",{context:this.context})
},destroy:function(){this._destroyContextMenu(),this.context=null,this.handlers=null}})});