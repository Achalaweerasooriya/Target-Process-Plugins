define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,s){return s.extend({COUNT_OF_VISIBLE_CARDS:5,"bus configurator.ready + $el.ready":function(s,i,n){var o=n.find(".i-role-statesetup"),a=e.bind(this.fire,this);o.on("click",function(){var e=t(this);a("$stateTrigger.executed",e)}),i.getTemplateFactory().register({name:"board.editor.stateSetup.chooseProcess",engine:"jqote2",markup:["<div>","<h3>Please select processes to customize:</h3>",'<div class="tau-buttons">',"<% _.forEach(this.processes, function(v){%>",'<button type="button" class="tau-btn tau-primary" data-id="<%= v.id %>"><%! v.name %></button>',"<% }); %>","</div>","</div>"].join("")})},"bus $form.ready":function(e,s){s.find("[name=x_types], [name=y_types]").each(function(){t(this).parent().find(".i-role-statesetup").toggle("entitystate"==t(this).val().toLowerCase())}),s.on("change","[name=x_types], [name=y_types]",function(){t(this).parent().find(".i-role-statesetup").toggle("entitystate"==t(this).val().toLowerCase())}),s.on("_submit",function(){s.find("[name=x_types], [name=y_types]").each(function(){t(this).parent().find(".i-role-statesetup").toggle("entitystate"==t(this).val().toLowerCase())})})},"bus $form.ready + boardSettings.ready:last":function(e,t,s){this._hideCardsIntoMoreAction(t),s.boardSettings.unbind(this),s.boardSettings.bind({fields:["edit"],listener:this,callback:function(e){e.edit&&this._hideCardsIntoMoreAction(t)}.bind(this)})},"bus configurator.ready:last + $form.ready:last + $stateTrigger.executed":function(t,s,i,n){var o=i.find(".tau-board-settings-cards :checkbox:checked").val();o||(o="userstory"),this.fire("card.ready",o),this.getProcess(s,n).done(e.bind(function(e){this.fire("processId.ready",e)},this))},"bus configurator.ready:last + $stateTrigger.executed:last + card.ready + processId.ready":function(e,t,s,i,n){t.getTp2Service().showPopupToChangeProcessWorkflow(t,s,i,n)},getProcess:function(s,i){var n=t.Deferred();return s.getAppStateStore().get({fields:["acid"],callback:e.bind(function(t){var o=t.acid;s.getApplicationContextService().getApplicationContext({acid:o},{success:e.bind(function(e){this.chooseProcess(s,i,e.processes).done(n.resolve)},this),failure:e.bind(function(){this.chooseProcess(s,i,[]).done(n.resolve)},this)})},this)}),n},chooseProcess:function(e,s,i){var n,o=t.Deferred();return 1==i.length?(o.resolve(i[0].id),o):(n=e.getTemplateFactory().get("board.editor.stateSetup.chooseProcess").bind({},{processes:i}),s.tauBubble({template:['<div class="tau-bubble tau-warning-bubble">','<div class="tau-bubble__arrow"  role="arrow"></div>','<div class="tau-bubble__inner tau-container">','<div role="content">',"</div>","</div>","</div>"].join(""),showOnCreation:!0,content:n}),s.tauBubble("widget").on("click","button",function(){o.resolve(t(this).data("id"))}),o)},_hideCardsIntoMoreAction:function(e){var t=e.find(".tau-board-settings-cards button.i-role-cell-type").slice(this.COUNT_OF_VISIBLE_CARDS),s=e.find("button.tau-more");t.filter(":not(.tau-checked)").addClass("hidden").parent().addClass("collapsed"),s.removeClass("hidden").on("click",function(){t.removeClass("hidden").parent().removeClass("collapsed"),s.addClass("hidden")})}})});