define(["jQuery","Underscore","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,_,ExtensionBase,boardUtils){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,self=this,$header=$el.find(".i-role-header"),$grid=$el.find(".i-role-grid");$header.delegate(".i-role-collapser","click",function(e){var $cell=$(this).parents(".i-role-cellholder:first"),dimension=$cell.attr("data-x")?"x":"y",id=$cell.attr("data-"+dimension);self.fire("view.axis.collapser.executed.before"),self.toggleCollapsing($grid,$cell,dimension),self.fire("view.axis.collapser.executed.after");var action=$cell.hasClass("tau-collapsed")?"collapse":"expand";self.fire("board.save.header.collapsing.settings",{id:id,dimension:dimension,setting:action})}),$el.find(".tau-x-header .i-role-collapser").click(function(){var $cell=$(this);$cell.toggleClass("tau-collapsed").closest(".tau-board-grid-view").toggleClass("rows-h-collapsed"),self.fire("view.axis.collapser.executed.after");var action=$cell.hasClass("tau-collapsed")?"collapse":"expand";self.fire("board.save.header.collapsing.settings",{id:0,dimension:"axisY",setting:action})})},toggleCollapsing:function($grid,$headerCell,dimension){$headerCell.toggleClass("tau-collapsed");var $cells=boardUtils.dimension($grid,$headerCell);$cells.toggleClass("tau-collapsed_"+dimension),$headerCell.toggleClass("tau-collapsed_"+dimension),$cells.each(function(){var $cell=$(this),realCollapsed=$cell.hasClass("tau-collapsed_x")||$cell.hasClass("tau-collapsed_y");$cell.toggleClass("tau-collapsed",realCollapsed)})},"bus afterRender + view.collapsed.axis":function(evt){var $el=_.values(evt)[0].data.element,settings=_.values(evt)[1].data;this.collapseHeaders({element:$el,settings:settings})},"bus view.cell.skeleton.element.afterUpdate":function(evt,update){var cell=update.cell,moreCollapsed=cell.find(".more-collapsed");moreCollapsed.length||(moreCollapsed=$('<span class="more-collapsed">...</span>')),cell.find(".i-role-card:last").after(moreCollapsed)},collapseHeaders:function(collapseConfig){var self=this,dimensions={},$el=collapseConfig.element,settings=collapseConfig.settings,$grid=$el.find(".i-role-grid"),$headerCells=$el.find(".i-role-header .i-role-cellholder");$headerCells.each(function(){var $headerCell=$(this),dimension=$headerCell.attr("data-x")?"x":"y",id=$headerCell.attr("data-"+dimension),shouldBeCollapsed=_.indexOf(settings[dimension],id)>-1||!1;if(!shouldBeCollapsed)return;self.toggleCollapsing($grid,$headerCell,dimension)});var $header=$el.find(".tau-x-header .i-role-collapser"),shouldBeCollapsed=_.indexOf(settings.axisY,0)>-1||!1;$header.length&&shouldBeCollapsed&&$header.toggleClass("tau-collapsed").closest(".tau-board-grid-view").toggleClass("rows-h-collapsed"),self.fire("view.axis.collapser.executed.after",dimensions)}})})