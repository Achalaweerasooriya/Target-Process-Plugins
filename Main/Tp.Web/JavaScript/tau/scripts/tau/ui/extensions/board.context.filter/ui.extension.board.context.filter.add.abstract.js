define(["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({_selectText:function($input){$input[0].setSelectionRange(0,$input.val().length)},_initForm:function($section){var $form=$section.find(".i-role-form");return $section.on("click",".i-role-formtrigger",function(){$form.toggleClass("tau-new-item_active_false").toggleClass("tau-new-item_active_true"),$form.find(":submit:first").focus(),$form.find(":text:first").focus(),$section.find(".i-role-formtrigger").toggleClass("tau-active"),$section.toggleClass("tau-managed-category_formactive_true")}),$form.on("reset",function(){$form.find(":input").removeClass("tau-error"),$form.find(":submit:first").focus(),$form.find(":text:first").focus()}),$form.on("click","[type=reset]",function(){$form.addClass("tau-new-item_active_false"),$section.removeClass("tau-managed-category_formactive_true"),$section.find(".i-role-formtrigger").removeClass("tau-active")}),$form},_addSubmitDataListener:function($form,cb){$form.on("submit",function(e){e.preventDefault();var data={};$form.find(":input").each(function(){data[this.name]=this.value}),data.members=[],$form.find(".i-role-members-widget").trigger("process");var $members=$form.find(".i-role-member");$members.each(function(){data.members.push($(this).data())}),cb(data)})},_initRichSelect:function($form,$select){var $rich=$form.find(".i-role-currenticon");return $select.on("change",function(){var current=$select.val();$rich.trigger("change",current),$rich.attr("data-value",current||"default")}),$form.delegate(".i-role-richselect .i-role-option","click",function(){var ic=this.getAttribute("data-value");$select.val(ic),$select.trigger("change"),$form.find(":text:first").focus()}),$rich.parent().on("click",function(){$(this).toggleClass("tau-active"),$form.find(".i-role-richselect").toggle()}),$form.on("reset",function(){$select.val(""),$select.trigger("change")}),$rich},_addToList:function($section,template,data){data.selected=!0,data.isSupportView=!0;var $item=template.bind({},data),$form=$section.find(".i-role-form"),$list=$section.find(".i-role-list"),$f=$list.find(".i-role-item:first");$f.length?$f.after($item):$list.append($item),$list.parent().scrollTo(0,{duration:500}),$item.addClass("tau-added"),_.delay(function(){$item.removeClass("tau-added")},1500)}})})