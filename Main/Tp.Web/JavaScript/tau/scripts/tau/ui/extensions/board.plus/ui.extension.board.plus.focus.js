define(["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils","Underscore"],function($,ExtensionBase,boardUtils,_){return ExtensionBase.extend({focusCells:function($grid,$input){var $cell=$input.parents(".i-role-cellholder:first"),dimension=$cell.parents(".i-role-header:first").data("dimension"),$allCells=boardUtils.dimension($grid,$cell).add($cell);return $allCells.toggleClass("tau-selected_"+dimension),$allCells.each(function(){var $cell=$(this);$cell.toggleClass("tau-selected",$cell.hasClass("tau-selected_x")||$cell.hasClass("tau-selected_y"))}),{cell:$cell,dimension:dimension}},_processSelectedMarks:function(axisName,marks,$el,$grid){var self=this;_.each(marks,function(mark){var idObj={};idObj[axisName]=mark;var id=boardUtils.generateId(idObj),$i=$("#"+id,$el).find("[name=focus]");$i.prop("checked",!0),self.focusCells($grid,$i)})},"bus board.selection.defaults.process":function(evt){var self=this,selectedMarks=_.defaults(evt.data.selectedMarks||{},{x:[],y:[]}),$el=evt.data.element,$grid=$el.find(".i-role-grid");_.each(["x","y"],function(axis){self._processSelectedMarks(axis,selectedMarks[axis],$el,$grid)}),self.fire("board.selection.defaults.ready",evt.data)},"bus board.selection.saveChanges":function(evt){var mark=evt.data.mark,boardSettings=evt.data.boardSettings,selected=_.defaults(evt.data.selectedMarks||{},{x:[],y:[]});mark.checked?selected[mark.dimension].push(mark.value):selected[mark.dimension]=_.without(selected[mark.dimension],mark.value),boardSettings.set({set:{selectedMarks:selected}})},"bus board.selection.defaults.ready":function(evt){var boardSettings=evt.data.boardSettings,$el=evt.data.element,self=this,$grid=$el.find(".i-role-grid"),$headers=$el.find(".i-role-header");$headers.delegate("[name=focus]","change",function(){var $input=$(this),focusCells=self.focusCells($grid,$input),dimension=focusCells.dimension,mark={checked:$input.prop("checked"),dimension:dimension,value:focusCells.cell.attr("data-"+dimension)};boardSettings.get({fields:["selectedMarks"],callback:function(r){var selectionArgs={selectedMarks:r.selectedMarks,boardSettings:boardSettings,mark:mark};self.fire("board.selection.saveChanges",selectionArgs)}})})},"bus boardSettings.ready:last+overview.board.ready":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings,$el=_.values(evt)[1].data.element,self=this;boardSettings.get({fields:["selectedMarks"],callback:function(res){self.fire("board.selection.defaults.process",{selectedMarks:res.selectedMarks,element:$el,boardSettings:boardSettings})}})},"bus boardSettings.ready:last+destroy":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings;boardSettings.unbind({listener:this})}})})