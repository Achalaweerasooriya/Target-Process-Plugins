define(["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils","Underscore"],function(e,s,a,t){return s.extend({focusCells:function(s,t){var n=t.closest(".i-role-cellholder"),d=n.closest(".i-role-header").data("dimension"),i=a.dimension(s,n).add(n);return i.toggleClass("tau-selected_"+d),i.each(function(){var s=e(this);s.toggleClass("tau-selected",s.hasClass("tau-selected_x")||s.hasClass("tau-selected_y"))}),{cell:n,dimension:d}},_processSelectedMarks:function(s,n,d,i){var r=this;t.each(n,function(t){var n={};n[s]=t;var o=a.generateId(n),l=e("#"+o,d).find("[name=focus]");l.prop("checked",!0),r.focusCells(i,l)})},"bus board.selection.defaults.process":function(e){var s=this,a=t.defaults(e.data.selectedMarks||{},{x:[],y:[]}),n=e.data.element,d=n.find(".i-role-grid");t.each(["x","y"],function(e){s._processSelectedMarks(e,a[e],n,d)}),s.fire("board.selection.defaults.ready",e.data)},"bus board.selection.saveChanges":function(e){var s=e.data.mark,a=e.data.boardSettings,n=t.defaults(e.data.selectedMarks||{},{x:[],y:[]});s.checked?n[s.dimension].push(s.value):n[s.dimension]=t.without(n[s.dimension],s.value),a.set({set:{selectedMarks:n}})},"bus board.selection.defaults.ready":function(s){var a=s.data.boardSettings,t=s.data.element,n=this,d=t.find(".i-role-grid"),i=t.find(".i-role-header");i.delegate("[name=focus]","change",function(){var s=e(this),t=n.focusCells(d,s),i=t.dimension,r={checked:s.prop("checked"),dimension:i,value:t.cell.attr("data-"+i)};a.get({fields:["selectedMarks"],callback:function(e){var s={selectedMarks:e.selectedMarks,boardSettings:a,mark:r};n.fire("board.selection.saveChanges",s)}})})},"bus boardSettings.ready:last+overview.board.ready":function(e){var s=t.values(e)[0].data.boardSettings,a=t.values(e)[1].data.element,n=this;s.get({fields:["selectedMarks"],callback:function(e){n.fire("board.selection.defaults.process",{selectedMarks:e.selectedMarks,element:a,boardSettings:s})}})},"bus boardSettings.ready:last+destroy":function(e){var s=t.values(e)[0].data.boardSettings;s.unbind({listener:this})}})});