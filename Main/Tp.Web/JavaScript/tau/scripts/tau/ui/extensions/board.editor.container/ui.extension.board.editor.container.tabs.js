define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,a){var s=function(e,t){this.tabHeaderClass=e,this.setStateCustomAction=t};return s.prototype.setState=function(e,t,a,s){var i=a.getBoardAccessService().isEditable(t,a.getLoggedUser());e.toggleClass(this.tabHeaderClass,!i),this.setStateCustomAction(e,t,a,s)},a.extend({resetLifecycle:!0,configTab:{limits:{isActive:function(t){return e.some([t.x,t.y],function(e){return e&&"entitystate"===e.types[0]})},setState:function(e,t){e.toggleClass("tau-disabled",!this.isActive(t))}},templates:new s("tau-disabled",t.noop),access:new s("tau-hide",t.noop),customize:new s("tau-hide",function(e,t){var a=t.cells.types.length;e.toggleClass("tau-disabled",!a)}),timeline:new s("tau-hide",function(e,t,a,s){var i=e.hasClass("tau-active"),n="timeline"!==t.viewMode;e.toggleClass("tau-hide",n),n&&i&&s.fire("tab.activate","setup")})},"bus beforeInit":function(e,t){var a=t.config.context.configurator;this.fire("configurator.ready",a)},"bus afterRender":function(e,t){var a=t.element;this.fire("$el.ready",a)},"bus $el.ready":function(e,a){var s=this;a.on("click",".i-role-tabheader:not(.tau-disabled)",function(){s.fire("tab.activate",t(this).data("label"))}),a.on("click",".tau-settings-close",function(){s.fire("settings.close",t(this).data("label"))})},"bus boardSettings.ready:last + settings.close":function(e,t){var a=this;t.boardSettings.get({fields:["edit"],callback:function(e){e.edit&&0===e.cells.types.length?a.fire("boardSettings.cardSetIsEmpty"):t.boardSettings.set({set:{edit:!1}})}})},"bus $el.ready:last + tab.activate":function(e,t,a){var s=t.find(".i-role-tab"),i=s.filter("[data-label="+a+"]:not(.tau-active)"),n=t.find(".i-role-tabheaders .i-role-tabheader"),l=n.filter("[data-label="+a+"]:not(.tau-active)");i.length&&l.length&&(s.not(i).removeClass("tau-active"),i.addClass("tau-active"),n.not(l).removeClass("tau-active"),l.addClass("tau-active"),this.fire("tab.activate.completed",a))},"bus configurator.ready + componentsCreated":function(a,s){t.when(s.getComponentBusRegistry().getByName("board_editor"),s.getComponentBusRegistry().getByName("board_templates")).done(e.bind(function(e,t,a){var s={setup:e,templates:t,limits:a};this.fire("tabBusesInternal.ready",s)},this));var i=s.getConfig("tmpBoardIsJustAdded",!1);s.setConfig("tmpBoardIsJustAdded",!1),i?(this.fire("tab.activate","templates"),this.fire("justAdded.opened")):this.fire("alreadyAdded.opened")},"bus $el.ready + tabBusesInternal.ready":function(e,t,a){a.templates.on("item.selected",function(){t.parent().toggleClass("tau-full-cell-settings",!1),a.templates.fire("external.setFocusOnSelected")}),a.templates.on("item.selected.completed",function(){a.setup.fire("refresh")});var s=this;a.templates.on("setup.pressed",function(){s.fire("tab.activate","setup")})},"bus tabBusesInternal.ready:last + tab.activate.completed + justAdded.opened":function(e,t){t.templates.once("afterRender",function(){t.templates.fire("external.selectDefault"),t.templates.fire("confirmation.toggle",!1)}),t.templates.fire("external.selectDefault"),t.templates.fire("confirmation.toggle",!1)},"bus tabBusesInternal.ready:last + tab.activate.completed":function(e,t,a){"templates"==a&&(t.templates.fire("external.selectNone"),t.templates.fire("confirmation.toggle",!0))},"bus view.dom.ready:last + $el.ready:last + childrenBuses.ready:last + tab.activate.completed + configurator.ready:last":function(e,t,a,s,i){var n=a.parent();n.toggleClass("tau-full-cell-settings","templates"==i||"encoding"==i),n.toggleClass("tau-access","access"==i),n.toggleClass("tau-customize","customize"==i),s[i].fire("show")},"bus boardSettings.ready:last + destroy":function(e,t){t.boardSettings.unbind({listener:this})},"bus configurator.ready + $el.ready + boardSettings.ready":function(a,s,i,n){var l=i.find(".i-role-tabheader"),o=e.bind(function(a){l.each(e.bind(function(e,i){var n=t(i),l=n.data("label");this.configTab[l]&&this.configTab[l].setState(n,a,s,this)},this))},this),r=n.boardSettings,d=function(){r.get({fields:["x","y","cells","ownerIds","viewMode"],callback:o})};d(),r.unbind({listener:this}),r.bind({fields:["x","y","cells","ownerIds","viewMode"],listener:this,callback:d})}})});