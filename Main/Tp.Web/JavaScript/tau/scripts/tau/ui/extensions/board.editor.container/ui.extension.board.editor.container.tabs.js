define(["jQuery","tau/core/extension.base"],function($,BaseExtension){return BaseExtension.extend({resetLifecycle:!0,configTab:{limits:{isActive:function(data){var result=!1;return data.x&&data.x.types[0]==="entitystate"&&(result=!0),data.y&&data.y.types[0]==="entitystate"&&(result=!0),result},setState:function($element,data){$element.toggleClass("tau-disabled",!this.isActive(data))}},templates:{setState:function($tabHeader,data,configurator){var user=configurator.getLoggedUser(),templatesActive=data.ownerId==user.id||user.isAdministrator;$tabHeader.toggleClass("tau-disabled",!templatesActive)}},access:{setState:function($tabHeader,data,configurator){var user=configurator.getLoggedUser(),templatesActive=data.ownerId==user.id||user.isAdministrator;$tabHeader.toggleClass("tau-hide",!templatesActive)}}},"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator)},"bus afterRender":function(e,renderData){var $el=renderData.element;this.fire("$el.ready",$el)},"bus $el.ready":function(evt,$el){var self=this;$el.on("click",".i-role-tabheader:not(.tau-disabled)",function(){self.fire("tab.activate",$(this).data("label"))})},"bus $el.ready:last + tab.activate":function(evt,$el,id){var $tabs=$el.find(".i-role-tab"),$tab=$tabs.filter("[data-label="+id+"]:not(.tau-active)"),$tabHeaders=$el.find(".i-role-tabheaders .i-role-tabheader"),$tabHeader=$tabHeaders.filter("[data-label="+id+"]:not(.tau-active)");$tab.length&&$tabHeader.length&&($tabs.not($tab).removeClass("tau-active"),$tab.addClass("tau-active"),$tabHeaders.not($tabHeader).removeClass("tau-active"),$tabHeader.addClass("tau-active"),this.fire("tab.activate.completed",id))},"bus configurator.ready + componentsCreated":function(evt,configurator,childrenBusesData){var tabBuses={};_.forEach(childrenBusesData,function(childrenBusesData){var config=childrenBusesData.config,bus=childrenBusesData.component;_.has(config,"label")&&(tabBuses[config.label]=bus)}),this.fire("tabBuses.ready",tabBuses),$.when(configurator.getComponentBusRegistry().getByName("board_editor"),configurator.getComponentBusRegistry().getByName("board_templates")).done(_.bind(function(b1,b2,b3){var tabBuses={setup:b1,templates:b2,limits:b3};this.fire("tabBusesInternal.ready",tabBuses)},this));var isNew=configurator.getConfig("tmpBoardIsJustAdded",!1);configurator.setConfig("tmpBoardIsJustAdded",!1),isNew?(this.fire("tab.activate","templates"),this.fire("justAdded.opened")):this.fire("alreadyAdded.opened")},"bus $el.ready + tabBusesInternal.ready":function(evt,$el,tabBuses){tabBuses.templates.on("item.selected",function(){$el.parent().toggleClass("tau-full-cell-settings",!1),tabBuses.templates.fire("external.setFocusOnSelected")}),tabBuses.templates.on("item.selected.completed",function(){tabBuses.setup.fire("refresh")});var self=this;tabBuses.templates.on("setup.pressed",function(){self.fire("tab.activate","setup")})},"bus tabBusesInternal.ready:last + tab.activate.completed + justAdded.opened":function(evt,tabBuses){tabBuses.templates.once("afterRender",function(){tabBuses.templates.fire("external.selectDefault"),tabBuses.templates.fire("confirmation.toggle",!1)}),tabBuses.templates.fire("external.selectDefault"),tabBuses.templates.fire("confirmation.toggle",!1)},"bus tabBusesInternal.ready:last + tab.activate.completed":function(evt,tabBuses,tabId){tabId=="templates"&&(tabBuses.templates.fire("external.selectNone"),tabBuses.templates.fire("confirmation.toggle",!0))},"bus view.dom.ready:last + $el.ready:last + tabBuses.ready:last + tab.activate.completed":function(evt,$body,$el,tabBuses,tabId){tabId=="templates"||tabId=="customize"||tabId=="encoding"?$el.parent().toggleClass("tau-full-cell-settings",!0):$el.parent().toggleClass("tau-full-cell-settings",!1),tabId=="access"?$el.parent().toggleClass("tau-access",!0):$el.parent().toggleClass("tau-access",!1),tabBuses[tabId].fire("show")},"bus configurator.ready + $el.ready + boardSettings.ready":function(evt,configurator,$element,bs){var $tabs=$element.find(".i-role-tabheader"),setStateTabs=_.bind(function(data){$tabs.each(_.bind(function(index,element){var $element=$(element),role=$element.data("label");this.configTab[role]&&this.configTab[role].setState($element,data,configurator)},this))},this),boardSettings=bs.boardSettings,getSetting=function(){boardSettings.get({fields:["x","y","ownerId"],callback:setStateTabs})};getSetting(),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["x","y","ownerId"],listener:this,callback:getSetting})}})})