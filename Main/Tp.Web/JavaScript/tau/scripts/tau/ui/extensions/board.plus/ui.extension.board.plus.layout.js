define(["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,a,b){return a.extend({"bus afterRender+model.zoomLevelChanged":function(a){var c=_.values(a)[0].data.element;this.zoomLevel=_.values(a)[1].data.zoomLevel,c.css("visibility","hidden");var d=$("html"),e=c.find(".i-role-grid"),f=c.find(".i-role-header[data-dimension=x]"),g=f.find("ul"),h=c.find(".i-role-header[data-dimension=y]"),i=h.find("ul"),j=this.scroll=function(){var a={x:e.scrollLeft(),y:e.scrollTop()};g.css("margin-left",-1*a.x),i.css("margin-top",-1*a.y)};e.bind({scroll:j});var k={width:330,height:250},l=function(a,c){var d=_.capitalize(c),f=e[c]()-e[0]["client"+d],g=a[c]()-f-1,h=a.find(".i-role-cellholder"),i=h.length;h.each(function(a){var d=$(this);(b.isHidden(d)||b.isCollapsed(d))&&i--,b.isHidden(d)==0&&b.isCollapsed(d)&&(g=g-d[c]()-1)});var j=g/i;h.each(function(a){var f=$(this);if(b.isHidden(f)||b.isCollapsed(f))return;var g=f.children(),h=f["outer"+d]()-g[c](),i=j-h,k=f.attr("data-"+c)||!1;k!=i&&(g.css(c,i),b.dimension(e,f,a).children().css(c,i)),f.attr("data-"+c,i)})},m=function(a){switch(a){case 1:case 2:return 6;case 3:case 4:case 5:return 4;case 6:return 3;default:return 2}},n=function(a,d,g,h){var i=_.capitalize(d),j=e[d]()-e[0]["client"+i],k=a[d]()-j-1,l=a.find(".i-role-cellholder"),n=l.length;l.each(function(a){var c=$(this),e=b.isHidden(c),f=b.isHidden(c);(f||e)&&n--,f&&!e&&(k-=c[d]())});var o=m(g),p=Math.min(n,o);h&&(l=l.filter(h));var q=c[d]()-f[d]()-j-1-100,r=Math.floor(q/p),s=16;l.each(function(){var a=$(this);if(b.isHidden(a)||b.isCollapsed(a))return;var c=a.children(),f=b.dimension(e,a).children().add(c);f.css("max"+i,r-s),f.each(function(){this.style[d]=""});var g=_.map(f.toArray(),function(a){return a["scroll"+i]-s}),h=Math.max.apply(null,g);f.css(d,h)});var t=Math.max(0,q-e.children().get(0).getBoundingClientRect().height-2);t>0&&l.each(function(){var a=$(this);if(b.isHidden(a)||b.isCollapsed(a))return;var c=a.children(),d=b.dimension(e,a).children().add(c);d.css("maxHeight",r+t)})},o=this.equalWidth=function(a){l(f,"width")},p=this,q=this.equalHeight=function(a){n(h,"height",p.zoomLevel,a)},r=function(){},s={height:window.innerHeight,width:window.innerWidth},t=!1;$(window).resize(function(a){setTimeout(function(){if(t)return;t=!0;var a={height:window.innerHeight,width:window.innerWidth};Math.abs(a.height-s.height)>20&&(r(),q(),s.height=a.height),Math.abs(a.width-s.width)>20&&(o(),s.width=a.width),t=!1},100)}),setTimeout(function(){r(),o(),q(),j(),c.fadeOut(0),c.css("visibility",""),c.fadeIn("fast")},500)},"bus model.zoomLevelChanged":function(a){if(!this.zoomLevel)return;var b=a.data.zoomLevel;this.zoomLevel=b;var c=this;setTimeout(function(){c.equalHeight(),c.equalWidth()},2e3)},"bus view.axis.collapser.executed.after":function(a){var b=a.data;b.x&&(this.equalWidth(),this.scroll()),b.y&&(this.equalHeight(),this.scroll())},"bus view.axis.focus.executed.after":function(a){var b=a.data;b.x&&(this.equalWidth(),this.scroll()),b.y&&(this.equalHeight(),this.scroll())},"bus view.card.batch.move":function(a){var b=a.data,c=[],d=[];_.forEach(b,function(a){c.push(a.sourceData.y,a.cellData.y)}),_.forEach(b,function(a){d.push(a.sourceData.x,a.cellData.x)}),c=_.uniq(c),d=_.uniq(d),this.equalHeight(function(a,b){return _.indexOf(c,parseInt(b.getAttribute("data-y")))>-1}),this.equalWidth(function(a,b){return _.indexOf(d,parseInt(b.getAttribute("data-x")))>-1})}})})