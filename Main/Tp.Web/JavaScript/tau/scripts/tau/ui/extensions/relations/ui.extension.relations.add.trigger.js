define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/models/quick.add/model.relations.quick.add"],function(e,t,n,i){return n.extend({"bus afterInit":function(){this.fire("dataBind")},"bus afterRender":function(e,t){this._initRelationLookupBubble(this._getButtonWithDefaultPrevented(t.element,".i-role-add-lookup")),this._initRelationQuickAddBubble(this._getButtonWithDefaultPrevented(t.element,".i-role-quick-add"))},"bus afterInit:last + relations-quick-add-general.model.data.item.did.add":function(e,t){var n=t.config;this.store.evictProperties(n.context.entity.id,n.context.entity.entityType.name,[n.dependencyType+"Relations"]);var i=this.config.context.configurator.getGlobalBus();i.fire("relation.items.added",{dependencyType:t.config.dependencyType})},_getButtonWithDefaultPrevented:function(e,t){var n=e.find(t);return n.on("click",function(e){e.preventDefault()}),n},_initRelationLookupBubble:function(e){var t=this.config.dependencyType,n=function(){e.toggleClass("tau-checked")},i={target:e,className:"tau-bubble__inner_without_scroll tau-bubble-lookup",applyBubbleClasses:!1,cleanupOnHide:!0,onShow:n,onHide:n,onPositionConfig:function(n){return n.of=e,n.collision="flipfit fit",n.within=this._$getPage(e),"slave"===t&&(n.my="right center+30",n.at="left center+30"),n}.bind(this),onArrowPositionConfig:function(n){return"slave"===t?{of:e,my:"right center",at:"left center",collision:"flipfit fit"}:n}.bind(this),componentsConfig:{components:[{type:"relations.add",dependencyType:t}]}};this.fire("initBubble",i)},_initRelationQuickAddBubble:function(e){var t=this.config.dependencyType,n={target:e,applyBubbleClasses:!1,cleanupOnHide:!0,stackName:"quickAddGeneral",showOnCreation:!1,zIndex:1e4,onShow:function(){e.removeClass("tau-quick-add-collapse"),e.toggleClass("tau-checked")},onHide:function(){e.addClass("tau-quick-add-collapse"),e.toggleClass("tau-checked")},className:"tau-quick-add-dialog-general",onPositionConfig:function(){return{of:e,my:"left top",at:"left-12 bottom+1",collision:"flipfit fit",within:this._$getPage(e)}
}.bind(this),dontCloseSelectors:["#ui-datepicker-div"],componentsConfig:{components:[{name:"relations-quick-add-general",type:"board.cell.quick.add",QuickAddModel:i,dependencyType:t}]}};this.fire("initBubble",n)},_$getPage:function(e){return this._$pageWrapper||(this._$pageWrapper=e.closest(".tau-page-entity")),this._$pageWrapper}})});