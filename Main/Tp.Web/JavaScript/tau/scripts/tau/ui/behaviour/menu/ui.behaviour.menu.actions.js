define(["Underscore","jQuery","tau/core/tau-widget"],function(_,$,a){a.widget("ui.behaviourMenuActions",{_create:function(){this.init()},init:function(){var a=$(this.element);this.$element=a,this.$popup=a.find(".ui-menu__popup");var b=this;this.$items=this.$element.find(".ui-menu__item-action"),this.currentIndex=-1,b.isOpened=!1,this.$element.find(".ui-menu__trigger").click(function(a){b.show()}),this._bindEvents()},show:function(){var a=this;a.$popup.slideToggle(100,function(){a.isOpened=!a.isOpened,a.isOpened?a._mapKeyboard():a._unmapKeyboard()})},_bindEvents:function(){var a=this;a.$items.hover(function(){a.$items.not(this).removeClass("ui-menu__item-action-hover"),$(this).addClass("ui-menu__item-action-hover"),a.currentIndex=a.$items.index(this)},function(){$(this).removeClass("ui-menu__item-action-hover")}),$("body").click(function(b){a.isOpened&&a.close();if($(b.target).parents(".ui-menu:first").length)return})},_mapKeyboard:function(){this.mapper=_.bind(this._keyboardEvents,this),$(document).bind("keydown",this.mapper)},_unmapKeyboard:function(){$(document).unbind("keydown",this.mapper)},_keyboardEvents:function(a){var b=this;switch(a.keyCode){case $.ui.keyCode.ESCAPE:b.close();break;case $.ui.keyCode.DOWN:b.currentIndex++,b.currentIndex=b.currentIndex>=b.$items.length?0:b.currentIndex,b.$items.removeClass("ui-menu__item-action-hover"),b.$items.eq(b.currentIndex).addClass("ui-menu__item-action-hover");break;case $.ui.keyCode.UP:b.currentIndex--,b.currentIndex=b.currentIndex<0?b.$items.length-1:b.currentIndex,b.$items.removeClass("ui-menu__item-action-hover"),b.$items.eq(b.currentIndex).addClass("ui-menu__item-action-hover");break;case $.ui.keyCode.ENTER:var c=b.$items.filter(".ui-menu__item-action-hover");c&&c.trigger("click")}},close:function(){var a=this;this.$popup.slideUp(100,function(){a.isOpened=!1,a._unmapKeyboard()})},destroy:function(){}})})