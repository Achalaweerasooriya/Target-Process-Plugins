define(["Underscore","jQuery","tau/core/tau","tau/configurator"],function(a,b,c,d){b.widget("ui.dateEditor",{options:{onSave:function(){},validation:{required:!1},dateFormat:"m/dd/yy"},errors:[],_create:function(){this.init()},init:function(){var a=b(this.element);this.$element=a,a.click(b.proxy(this.showEditor,this)),a.addClass("ui-dateeditor-source")},setValidationErrors:function(b){this.element.addClass("ui-validationerror"),a.isString(b)&&this.element.attr("title",b)},resetValidationErrors:function(a){this.element.removeClass("ui-validationerror"),this.element.removeAttr("title",a)},activate:function(){this._justActivated=!0,this.showEditor(),this.$editor.find(":text").focus()},_attachKeyBoardHandling:function(){var a=this,b={handleKeyDown:function(){a.mapKeys.apply(a,arguments)}};d.getKeyBoardManager().pushHandler(b)},showEditor:function(a){var d=this;if(!this._editorIsVisible){if(!this.$editor){var e=b(c.concat('<span class="ui-dateeditor">','    <input type="text" maxlength="20" />',"</span>")),f=e.find(":text");f.focus();var g=b("body"),h=function(a){d._onDocumentClick.apply(d,arguments),g.unbind("click",h)},i=function(){g.click(h)};f.datepicker({dateFormat:this.options.dateFormat,buttonText:"choose",showOn:"button",beforeShow:i,onSelect:function(a){f.focus()}}),e.insertAfter(this.$element),this.$editor=e}this._attachKeyBoardHandling(),d._documentClickDelegate||(d._documentClickDelegate=function(a){d._onDocumentClick(a)},b(document.body).click(d._documentClickDelegate)),this.$element.hide(),this._editorIsVisible=!0,this.$editor.show(),this.$editor.find(":text").val(this.$element.text())}},_onSave:function(){var a=this.$editor.find(":text").val();this.hideEditor(),this.$element.text(a),this.$element.show(),this.options.onSave(a),d.getKeyBoardManager().popHandler()},_onCancel:function(){d.getKeyBoardManager().popHandler();var a=this.$editor.find(":text").val();this.hideEditor(),this.$element.show(),this.options.onCancel&&this.options.onCancel()},hideEditor:function(){this.$editor&&this._editorIsVisible&&(this.$editor.hide(),this._editorIsVisible=!1),this._documentClickDelegate&&(b(document.body).unbind("click",this._documentClickDelegate),delete this._documentClickDelegate)},_onDocumentClick:function(a){var c=this,d=b(a.target);if(!!this._editorIsVisible){if(this._justActivated&&a.target!=document.body){this._justActivated=!1;return}if(d.hasClass("ui-dateeditor-source")||d.hasClass("ui-dateeditor")||d.parents(".ui-dateeditor").length>0||d.parents(".ui-datepicker").length>0||d.parents(".ui-datepicker-header").length>0)return;c._onSave(),c.hideEditor(),a.stopPropagation(),a.preventDefault()}},mapKeys:function(a){switch(a.which){case 13:a.preventDefault(),this._onSave();break;case 27:a.preventDefault(),this._onCancel()}}})})