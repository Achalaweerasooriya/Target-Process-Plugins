define(["Underscore","jQuery","tau/core/tau"],function(a,b,c){b.widget("ui.tagsEditor",{options:{selector:".ui-tags__tag",onSave:function(){}},_create:function(){this.init()},init:function(){this.$list=b(this.element);var c=this.options.selector,d=this.$list.find(c);d.append('<a href="#" class="ui-tags__control-delete" title="Delete tag">Delete tag</a>');var e=this;this.$list.delegate(".ui-tags__control-delete","click",function(a){a.preventDefault(),b(this).parents(c).eq(0).remove(),e.options.onSave(e.getTags())}),this.$widget=b('<li class="ui-tags__editor"><a href="#" title="Add tag" class="ui-tags__editor__control-show"><i>Add tag</i></a></li>'),this.$widget.find("a:first").click(a.bind(this.showEditor,this)),this.$list.append(this.$widget)},_processAddTag:function(a){var b=this,c=b.parseTags(a.find(":text").val());b.hideEditor();var d=b.getTags();d=d.concat(c),b.options.onSave(d)},showEditor:function(d){d.preventDefault();if(!this._editorIsVisible){if(!this.$editor){var e=b(c.concat('<span class="ui-tags__editor__inner">','    <input type="text" maxlength="50" class="ui-tags__editor__input" />','    <div class="button-group" style="position: relative; top: 5px; left: 3px;"><a title="Add" class="button small ui-tags__editor__button-submit" >Add&nbsp;</a>','    <a title="Cancel" class="button small ui-tags__editor__button-cancel"  >x</a></div>',"</span>")),f=this;e.find(".ui-tags__editor__button-submit").click(function(){f._processAddTag(e)}),e.find(".ui-tags__editor__button-cancel").click(function(){f.hideEditor()}),e.find(":text").keydown(a.bind(this.mapKeys,this)),e.appendTo(this.$widget),this.$editor=e}this.resetEditor(),this.$widget.toggleClass("ui-tags__editor-active",!0),this._editorIsVisible=!0,this.$editor.find(":text").focus()}},hideEditor:function(){this.$editor&&this._editorIsVisible&&(this.$editor.find(":text").blur(),this.$widget.toggleClass("ui-tags__editor-active",!1),this._editorIsVisible=!1,this.resetEditor())},resetEditor:function(){this.$editor&&this.$editor.find(":text").val("")},mapKeys:function(a){switch(a.which){case 13:a.preventDefault();var b=this;this._processAddTag(this.$editor);break;case 27:a.preventDefault(),this.hideEditor(a)}},getTagsElements:function(){var a=[],c=this;return this.$list.find(this.options.selector).each(function(d,e){a.push({value:c.getTagText(b(e)),$el:b(e)})}),a},getTagText:function(a){return b.trim(a.find("span:first").text())},getTags:function(){var a=[],c=this;return this.$list.find(this.options.selector).each(function(d,e){var f=b(e);a.push(c.getTagText(f))}),a},addTags:function(a){},parseTags:function(b){b=b||"";var c=b.split(",");return c=a(c).map(function(a){return a.trim()}),c=a.uniq(c),c=a.compact(c),c}})})