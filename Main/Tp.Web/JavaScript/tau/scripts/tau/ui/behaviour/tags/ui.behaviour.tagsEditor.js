define(["Underscore","jQuery","tau/core/tau"],function(_,$,a){$.widget("ui.tagsEditor",{options:{selector:".ui-tags__tag",onSave:function(){}},_create:function(){this.init()},init:function(){this.$list=$(this.element);var a=this.options.selector,b=this.$list.find(a);b.append('<a href="#" class="ui-tags__control-delete" title="Delete tag">Delete tag</a>');var c=this;this.$list.delegate(".ui-tags__control-delete","click",function(b){b.preventDefault(),$(this).parents(a).eq(0).remove(),c.options.onSave(c.getTags())}),this.$widget=$('<li class="ui-tags__editor"><a href="#" title="Add tag" class="ui-tags__editor__control-show"><i>Add tag</i></a></li>'),this.$widget.find("a:first").click(_.bind(this.showEditor,this)),this.$list.append(this.$widget)},_processAddTag:function(a){var b=this,c=b.parseTags(a.find(":text").val());b.hideEditor();var d=b.getTags();d=d.concat(c),b.options.onSave(d)},showEditor:function(b){b.preventDefault();if(!this._editorIsVisible){if(!this.$editor){var c=$(a.concat('<span class="ui-tags__editor__inner">','    <input type="text" maxlength="50" class="ui-tags__editor__input" />','    <div class="button-group" style="position: relative; top: 5px; left: 3px;"><a title="Add" class="button small ui-tags__editor__button-submit" >Add&nbsp;</a>','    <a title="Cancel" class="button small ui-tags__editor__button-cancel"  >x</a></div>',"</span>")),d=this;c.find(".ui-tags__editor__button-submit").click(function(){d._processAddTag(c)}),c.find(".ui-tags__editor__button-cancel").click(function(){d.hideEditor()}),c.find(":text").keydown(_.bind(this.mapKeys,this)),c.appendTo(this.$widget),this.$editor=c}this.resetEditor(),this.$widget.toggleClass("ui-tags__editor-active",!0),this._editorIsVisible=!0,this.$editor.find(":text").focus()}},hideEditor:function(){this.$editor&&this._editorIsVisible&&(this.$editor.find(":text").blur(),this.$widget.toggleClass("ui-tags__editor-active",!1),this._editorIsVisible=!1,this.resetEditor())},resetEditor:function(){this.$editor&&this.$editor.find(":text").val("")},mapKeys:function(a){switch(a.which){case 13:a.preventDefault();var b=this;this._processAddTag(this.$editor);break;case 27:a.preventDefault(),this.hideEditor(a)}},getTagsElements:function(){var a=[],b=this;return this.$list.find(this.options.selector).each(function(c,d){a.push({value:b.getTagText($(d)),$el:$(d)})}),a},getTagText:function(a){return $.trim(a.find("span:first").text())},getTags:function(){var a=[],b=this;return this.$list.find(this.options.selector).each(function(c,d){var e=$(d);a.push(b.getTagText(e))}),a},addTags:function(a){},parseTags:function(a){a=a||"";var b=a.split(",");return b=_(b).map(function(a){return a.trim()}),b=_.uniq(b),b=_.compact(b),b}})})