define(["require","tau/configurator","Underscore","tau/ui/extensions/user/userAutocomplete.mixin","template!tau/ui/extensions/user/ui.tauUsersAutocomplete.item.template","tau/ui/extensions/user/jquery.tauUserAutocompleteTextarea","vendors/jquery-textrange/jquery-textrange"],function(e){var t=e("tau/configurator").getStore2(),r=e("Underscore"),u=e("tau/ui/extensions/user/userAutocomplete.mixin"),n=e("template!tau/ui/extensions/user/ui.tauUsersAutocomplete.item.template");e("tau/ui/extensions/user/jquery.tauUserAutocompleteTextarea"),e("vendors/jquery-textrange/jquery-textrange");var i=function(e){return e.login||e.email};return function(e){return r.extend({init:function(r){this.options={store2:t,autocompleteQueryAdd:"",autocompleteFieldsQueryAdd:"",autocompleteTakeQueryAdd:"",userTypes:["User"],rejectUserIdsGetter:function(){return[]}};var u=r.find(".i-role-textarea");if(this.$textarea=u,e&&e.mentionUser&&!u.val()){var o="@"+i(e.mentionUser)+" ";u.val(o),u.textrange("setcursor",o.length),u.trigger("input")}u.tauUserAutocompleteTextarea([{match:/\B@(\S*)$/,search:function(e,t){e.length>0?this._getData(e).then(function(r){t(this._processItems(r,e))}.bind(this)):t([])}.bind(this),index:1,template:function(e){return n.render(e).find("a").html()},replace:function(e){return"@"+i(e)+" "}},{}],{zIndex:99999})},destroy:function(){this.$textarea.tauUserAutocompleteTextarea("destroy")}},u)}});