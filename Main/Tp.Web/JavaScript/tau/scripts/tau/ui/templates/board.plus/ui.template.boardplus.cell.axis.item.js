define(["Underscore","tau/core/templates-factory","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/utils/utils.date","tau/utils/utils.translation","tau/ui/templates/board.plus/ui.template.boardplus.card.assignedUsers"],function(t,e,i,a,s){var n={name:"boardplus.cell.axis.item",engine:"jqote2",customFunctions:{generateCardData:i.generateElementData,generateFinishButtonOnDemand:function(e){var i="",a=["iteration","teamiteration"];return e&&e.canBeFinished&&t.contains(a,e.type.toLocaleLowerCase())&&(i=[' <span class="i-role-finish-iteration tau-label__finish tau-linkentity__inner" data-entity-id="',e.id,'" data-entity-type="',e.type,'">Finish</span>'].join("")),i},processDates:function(t,e,i,n){function r(t,e){t=a.parse(t),e=a.parse(e);var i=Math.floor((e-t)/36e5),n=Math.ceil(i/24);return n?n+" "+s.pluralize("day|days",n)+" left":i+" "+s.pluralize("hour|hours",i)+" left"}var l=a.convertToTimezone(t),o=a.convertToTimezone(e),u=i?"tau-label__date_current":"",c=i?' <span class="time-left">'+r(new Date,o)+"</span>":"",p=l.getYear()==o.getYear()?"d-MMM":a.getFormatData().date.short;return'<span class="tau-label tau-label__date '+u+'">'+a.formatAs(l,p)+" &mdash; "+a.formatAs(o,p)+c+this.generateFinishButtonOnDemand(n)+"</span>"},velocity:function(t){var e=t.units||"",i=t.effortSum||0;i=Math.round(i);var a=Math.round(t.velocity),s="tau-label__velocity_perfect",n="Perfect match!",r=a-i;if(0!==a&&0!==r){var l=100*Math.abs(r)/a;r>0&&(n="left."),0>r&&(n="overhead."),5>l?s="tau-label__velocity_warning":0>r&&(s="tau-label__velocity_overhead")}else 0!==r&&(r>0&&(n="left."),0>r&&(n="overhead."),0>r&&(s="tau-label__velocity_overhead"));var o="";return!t.id||"Iteration"!=t.type&&"TeamIteration"!=t.type||(o=this.burnDownIcon(t)),r=Math.abs(r),r=r?r+" "+e+" ":"",'<span class="tau-label tau-label__text tau-label__velocity">'+o+'<span class="tau-label_mark">'+i+'</span> of <span class="tau-label_mark">'+a+" "+e+'</span> assigned. <span class="'+s+'">'+r+n+"</span></span>"},effort:function(t){var e="",i=" done.",a="";(!t.effortCompleted&&t.isCurrent||t.isPrevious||t.effortCompleted)&&(a='<span class="tau-label_mark">'+t.effortCompleted+"</span> of "),t.isCurrent&&(e="tau-label__effort_current"),t.isNext&&(e="tau-label__effort_next",t.effortCompleted||(i=" assigned.")),t.isPrevious&&(e="tau-label__effort_previous",t.effortCompleted==t.effortTotal&&(a=""));var s="";return"Release"==t.type&&t.id&&(s=this.burnDownIcon(t)),'<span class="tau-label tau-label__effort '+e+'">'+s+a+'<span class="tau-label_mark">'+t.effortTotal+" "+t.units+"</span>"+i+"</span>"},burnDownIcon:function(t){return'<span class="tau-icon tau-icon_type_svg tau-icon_name_burn-down tau-label__burnDown" data-entity-id="'+t.id+'" data-entity-type="'+t.type.toLowerCase()+'"></span>'},processTags:function(e){return t.compact(t.asString(e).split(","))}},markup:['<% var axis = this.itemData.hasOwnProperty("effort") ? "Y" : "X"; %>','<% if (this.entity.type == "user"){ %>','<div class="i-role-axis-item tau-axiscell__item tau-label i-role-focustrigger">',"<% if (this.isSupportView){ %>",'<span <% if (this.isSupportView){ %> class="i-role-cellaxis-viewtrigger" <% } %> <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %>>',"<% if (this.itemData.avatarUri){ %>",'<span class="tau-avatar tau-avatar_<%= this.entity.id %>" >','<img src="<%= this.itemData.avatarUri %>24" />',"</span>","<% } %>",'<span class="tau-label__text tau-name i-role-name"><%! this.name %></span>',"</span>","<% } else { %>",'<span class="i-role-name tau-name"><%! this.name %></span>',"<% } %>","</div>",'<% } else if (axis == "Y" && (this.entity.type == "userstory" || this.entity.type == "feature") && this.itemData.id){ %>','<div class="i-role-axis-item tau-axiscell__item tau-label i-role-focustrigger">',"<% var item = this.itemData; %>",'<% if (item.hasOwnProperty("id")) { %>','<span class="<% if (this.isSupportView){ %>i-role-cellaxis-viewtrigger <% } %>ui-type-icon ui-type-icon-<%= this.entity.type %>" <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %>>',"<%= item.id %>","</span>","<% } %>",'<div class="tau-state"><%! item.entityState.name %></div>','<div class="<% if (this.isSupportView){ %>i-role-cellaxis-viewtrigger <% } %> tau-name  i-role-name"  <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %>><%! this.name %></div>',"<% if (item.project && item.project.abbreviation) {%>",'<div <% if (item.project.color){ %> style="background-color: <%= item.project.color %>;"<% } %> ','class="tau-project-abbr" title="<%! item.project.name %>"',">","<%! item.project.abbreviation %>","</div>","<% } %>","<% var usersCount = item.assignedUsers.length - 2;%>",'<%if (item.hasOwnProperty("assignedUsers")) {%>','<div class="tau-people">','<%= fn.sub("boardplus.card.assignedUsers",{count:usersCount,items:item.assignedUsers.slice(0,2),viewTrigger:true}) %>',"</div>","<% } %>",'<% if (item.hasOwnProperty("effort")){ %>','<div class="tau-effort">',"<%= item.effort %>",'<%= item.units || "pt" %>',"</div>","<% } %>","</div>",'<% } else if (this.entity.type === "entitystate" || this.entity.type === "priority") { %>','<div class="i-role-axis-item">','<div class="tau-axiscell__item tau-label i-role-focustrigger">',"<% if (this.isSupportView){ %>",'<span class="i-role-cellaxis-viewtrigger" <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %> >','<% if (this.entity.type == "team"){ %>',"<span>","<% if (this.itemData.icon){ %>","<i class=\"tau-icon tau-icon_type_svg tau-icon_name_<%= this.itemData.icon || '' %>\"></i>","<% } else { %>",'<i class="tau-icon tau-icon_type_svg tau-icon_name_trihead"></i>',"<% } %>","</span>",'<% } else if (this.entity.type == "project") { %>',"<% if (this.itemData.color){ %>",'<i class="tau-icon tau-icon_type_color ui-type-icon-project" style="background-color: <%= this.itemData.color %>;"></i>',"<%} else {%>",'<i class="tau-icon tau-icon_type_color ui-type-icon-project tau-icon_name_empty"></i>',"<%}%>","<% } else { %>",'<span class="ui-type-icon ui-type-icon-<%= this.entity.type %>" >',"<%= this.entity.id %>","</span>","<% } %>",'<span class="tau-label__text  i-role-name"><%! this.name %><%if(this.itemData.isCurrent){%> <span class="tau-label__text_current">(Current)</span><%}%></span></span>',"<% } else { %>",'<span class="i-role-name" <%= fn.generateCardData({ids: this.itemData.ids}) %>><%! this.name %><%if(this.itemData.isCurrent){%> <span class="tau-label__text_current">(Current)</span><%}%></span>',"<% } %>","</div>","<% } else { %>",'<div class="i-role-axis-item">','<div class="tau-axiscell__item tau-label i-role-focustrigger">',"<% if (this.isSupportView){ %>",'<span class="i-role-cellaxis-viewtrigger" <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %> >','<% if (this.entity.type == "team"){ %>',"<span>","<% if (this.itemData.icon){ %>","<i class=\"tau-icon tau-icon_type_svg tau-icon_name_<%= this.itemData.icon || '' %>\"></i>","<% } else { %>",'<i class="tau-icon tau-icon_type_svg tau-icon_name_trihead"></i>',"<% } %>","</span>",'<% } else if (this.entity.type == "project") { %>',"<% if (this.itemData.color){ %>",'<i class="tau-icon tau-icon_type_color ui-type-icon-project" style="background-color: <%= this.itemData.color %>;"></i>',"<%} else {%>",'<i class="tau-icon tau-icon_type_color ui-type-icon-project tau-icon_name_empty"></i>',"<%}%>","<% } else { %>",'<span class="ui-type-icon ui-type-icon-<%= this.entity.type %>" >',"<%= this.entity.id %>","</span>","<% } %>",'<span class="tau-label__text  i-role-name"><%! this.name %><%if(this.itemData.isCurrent){%> <span class="tau-label__text_current">(Current)</span><%}%></span></span>',"<% } else { %>",'<span class="i-role-name"><%! this.name %><%if(this.itemData.isCurrent){%> <span class="tau-label__text_current">(Current)</span><%}%></span>',"<% } %>","</div>",'<% if (this.entity.type == "team"){ %>','<div class="tau-team-members">',"<% var users = this.itemData.users || []; _.forEach(users, function(user,index,users){ %>","<%if(index < 7){%>",'<span class="tau-avatar i-role-cellaxis-viewtrigger" <%= fn.generateCardData({ id: user.id, "entity-id": user.id, "entity-type": "user"}) %> ><img title="<%= user.name %>" src="<%= user.avatarUri %>24" /></span>',"<%}%>","<%if(index == 7){%>",'<span class="count-users">+ <%=users.length - index%></span>',"<%}%>","<% });  %>","</div>","<% } %>","<% if (this.itemData.startDate && this.itemData.endDate){ %>","<%= fn.processDates(this.itemData.startDate, this.itemData.endDate, this.itemData.isCurrent, {id:this.entity.id, type:this.entity.type, canBeFinished:this.itemData.canBeFinished})%>","<% } %>","<% if (this.itemData.velocity !== undefined){%>","<%= fn.velocity(this.itemData)%>","<%}%>","<% if (this.itemData.effortCompleted !== undefined && this.itemData.effortTotal !== undefined){%>","<%= fn.effort(this.itemData)%>","<%}%>","</div>","<% } %>"],dependencies:[]};return e.register(n)});