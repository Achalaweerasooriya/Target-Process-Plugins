define(["Underscore","tau/core/templates-factory"],function(_,templates){var config={name:"boardplus.card.connectedItems",engine:"jqote2",customFunctions:{_:_,createGroups:function(type,list,limit){var conf={team:{criteria:"icon"},project:{criteria:"color"},user:{criteria:"avatarUri"}}[type],show=_.chain(list).filter(function(v){return v.criteria=_.asString(v[conf.criteria]).trim(),!!v.criteria}).value().slice(0,limit);return show.length==0&&(show=list.slice(0,1)),{type:type,show:show,restLength:list.length-show.length}}},markup:["<% var groups = fn.createGroups(this.type, this.items, 5); %>","<% if (groups.show.length){ %>",'<ul <% if (groups.restLength > 0) { %>class="tau-more"<% } %> >',"<% _.forEach(groups.show, function(item){ %>","<li>","<% if (item.criteria) { %>",'<% if (groups.type == "team") { %>','<i class="tau-icon tau-icon_type_svg tau-icon_name_<%! _.asString(item.criteria).trim() %> " title="<%! item.name %>"></i>','<% } else if (groups.type == "project") { %>','<i class="tau-icon tau-icon_type_color" stype="background-color: <%! item.criteria %>" title="<%! item.name %>"></i>','<% } else if (groups.type == "user") { %>','<span class="tau-avatar">','<img title="<%! item.name %>" src="<%! item.criteria %>20" />',"</span>","<% } %>","<% } %>",'<% if (groups.show.length == 1 && groups.type != "user" && groups.restLength == 0) { %>',"<span><%! item.name %></span>","<% } %>","</li>","<% }); %>","</ul>","<% } %>"]};return templates.register(config)})