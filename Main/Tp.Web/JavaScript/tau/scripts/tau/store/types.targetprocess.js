define(["Underscore","tau/store/types","tau/store/types.targetprocess.generated"],function(_,tauTypes,generated){var pascalCaseAndSplit=function(name){var result=[];for(var i=0,len=name.length;i<len;i++){var chr=name.charAt(i);i===0?chr=chr.toUpperCase():chr===chr.toUpperCase()&&result.push(" "),result.push(chr)}return result.join("")},generateTermType=function(key){return{key:key,val:key}},generatePluralTermType=function(key){var lastIndex=key.length-1;if(key.charAt(lastIndex)==="y"){var car=key.substring(0,lastIndex),cdr="ies";key=car+cdr}else key+="s";return{key:key,val:key}},generateBigIconText=function(key){return{key:key+" Big Icon Text",val:key}},generateSmallIconText=function(key){var parts=key.split(" "),len=parts.length,index=len-1||0,seed=parts[index];return{key:key+" Small Icon Text",val:seed.charAt(0)}},detectGeneralType=function(obj){if(obj&&obj.entityType&&obj.entityType.name)return obj.entityType.name;throw"type of entity is not detected"},generateTerms=function(typeName){var key=pascalCaseAndSplit(typeName);return{name:generateTermType(key),names:generatePluralTermType(key),iconBig:generateBigIconText(key),iconSmall:generateSmallIconText(key)}};return _.each(generated,function(type){type.name==="userStory"&&(type.aliases.unshift("story","stories","us"),type.simpleFields.push("tasks-effort-sum","tasks-effortToDo-sum"));if(type.name==="general"||type.name==="assignable")type.isParentType=!0,type.discriminator={entityType:["id","name"]},type.detectType=detectGeneralType;(type.parent==="general"||type.parent==="assignable")&&type.simpleFields.push("customFields"),type.terms=generateTerms(type.name),type.name==="processInfo"&&type.refs&&(type.refs={}),type.name==="context"&&(type.refs||(type.refs={}),type.refs.culture&&delete type.refs.culture,type.refs.appContext&&delete type.refs.appContext,type.refs.selectedProjects={list:!0,name:"project"},type.simpleFields=["id","acid"]),tauTypes.register(type)}),tauTypes.register({name:"implementationHistory",aliases:["stats"]}),tauTypes.register({name:"solution"}),tauTypes.register({name:"prioritizer",fields:["id"],refs:[]}),tauTypes})