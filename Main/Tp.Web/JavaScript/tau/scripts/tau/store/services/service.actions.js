define(["jQuery","Underscore","tau/core/class"],function(e,t,n){var r=n.extend({init:function(e){this.config=e},getActionUrl:function(e){return this.config.appPath+"/PageServices/ActionsService.asmx/"+e},getActiveProjectForEntity:function(e,t,n){var r={generalId:e};this.sendRequest("GetActiveProjectForEntity",r,t,n)},copyGeneralToProject:function(e,t,n,r){var s={generalId:e,projectId:t};this.sendRequest("CopyGeneralToProject",s,n,r)},getProjectIds:function(e,t){var n={};this.sendRequest("GetProjectIds",n,e,t)},moveGeneralToProject:function(e,t,n,r){var s={generalId:e,projectId:t};this.sendRequest("MoveGeneralToProject",s,n,r)},attachGeneralToRequest:function(e,t,n,r){var s={generalId:e,requestId:t};this.sendRequest("AttachGeneralToRequest",s,n,r)},detachRequest:function(n){var r={generalId:n.generalId,requestId:n.requestId};n=t(n).defaults({success:e.noop,error:e.noop}),this.sendRequest("DetachRequestFromGeneral",r,n.success,n.error)},_mapEntityTypes:function(e){return t.map(e.d,function(e){return{id:e.ID,name:e.EntityTypeName,term:e.Name}})},getEntityTypesToConvert:function(e){return this.sendRequestDef("GeneralCanConvertTo",{generalId:e}).then(this._mapEntityTypes)},getEntityTypesToCreateFromRequest:function(e){return this.sendRequestDef("CanCreateFromRequest",{requestId:e}).then(this._mapEntityTypes)},convertGeneralToTask:function(e,t){var n={generalId:e,userStoryId:t};return this.sendRequestDef("ConvertGeneralToTask",n)},createFromRequest:function(e,t){var n={requestId:e,entityTypeId:t};return this.sendRequestDef("CreateFromRequest",n)},createTaskFromRequest:function(e,t){var n={requestId:e,userStoryId:t};return this.sendRequestDef("CreateTaskFromRequest",n)},convertGeneralToType:function(e,t){var n={generalId:e,entityTypeId:t};return this.sendRequestDef("ConvertGeneralToType",n)},finishIteration:function(e,t,n,r,s){var o={from:e,to:t,useMoveInsteadSplit:n};this.sendRequest("FinishIteration",o,r,s)},finishTeamIteration:function(e,t,n,r,s){var o={from:e,to:t,useMoveInsteadSplit:n};this.sendRequest("FinishTeamIteration",o,r,s)},splitUserStory:function(e,t,n){var r={generalId:e};this.sendRequest("SplitUserStory",r,t,n)},sendFeedback:function(e,t){var n={viewMode:e,message:t};return this.sendRequestDef("SendFeedback",n)},sendRequest:function(t,n,r,s){e.ajax(this.getActionUrl(t),{contentType:"application/json",type:"POST",data:JSON.stringify(n),success:r,error:s})},sendRequestDef:function(t,n){return e.ajax({url:this.getActionUrl(t),contentType:"application/json",type:"POST",data:JSON.stringify(n)})}});return r});