define(["Underscore","tau/store/header","tau/store/services/formatProperties"],function(e,t,a){return{convertArray:function(a,r){var n=this,s=[],i=[];return r.next&&i.push(t.getNextPage(s,r.next,a.header)),r=r.items?r.items:r,e.each(r,function(e){var t=n.convert(a,e);s.push(t.data),i=i.concat(t.nextPages)}),{data:s,nextPages:i}},convert:function(r,n){for(var s={},i=this,o=[],h=0,c=r.header.length;c>h;h++){var d=n[h];e.isUndefined(d)&&(d=null);var u=r.header[h];if(t.header.isSimple(u))a.hasOwnProperty(u)&&(d=t.formatObject(d).data),s[u]=d;else{var l=t.header.getFieldName(u),v=u.list===!0;if(e.isNull(d)||!d.hasOwnProperty("items")&&!d.hasOwnProperty("Items")||(v=!0),!e.isEmpty(d)||v){if(!e.isNull(d)){var f={header:u[l]},P=d;if((d.hasOwnProperty("items")||d.hasOwnProperty("Items"))&&(d=d.items||d.Items),v){var m=[];e.each(d,function(e){var t=i.convert(f,e);o=o.concat(t.nextPages),m.push(t.data)}),d=m,P.next&&o.push(t.getNextPage(m,P.next,f.header))}else{var p=i.convert(f,d);o=o.concat(p.nextPages),d=p.data}}e.isNull(d)&&v&&(d=[]),s.hasOwnProperty(l)?e.extend(s[l],d):s[l]=d}else s[l]=null}}return{data:s,nextPages:o}}}});