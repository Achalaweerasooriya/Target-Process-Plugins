define(["Underscore","tau/store/header","tau/store/services/formatProperties"],function(_,a,b){return{convertArray:function(b,c){var d=this,e=[],f=[];return c.next&&f.push(a.getNextPage(e,c.next,b.header)),c=c.items?c.items:c,_.each(c,function(a){var c=d.convert(b,a);e.push(c.data),f=f.concat(c.nextPages)}),{data:e,nextPages:f}},convert:function(c,d){var e={},f=this,g=[];for(var h=0,i=c.header.length;h<i;h++){var j=d[h];_.isUndefined(j)&&(j=null);var k=c.header[h];if(a.header.isSimple(k)){b.hasOwnProperty(k)&&(j=a.formatObject(j).data),e[k]=j;continue}var l=a.header.getFieldName(k),m=k.list===!0;!_.isNull(j)&&(j.hasOwnProperty("items")||j.hasOwnProperty("Items"))&&(m=!0);if(_.isEmpty(j)&&!m){e[l]=null;continue}if(!_.isNull(j)){var n={header:k[l]},o=j;if(j.hasOwnProperty("items")||j.hasOwnProperty("Items"))j=j.items||j.Items;if(m){var p=[];_.each(j,function(a){var b=f.convert(n,a);g=g.concat(b.nextPages),p.push(b.data)}),j=p,o.next&&g.push(a.getNextPage(p,o.next,n.header))}else{var q=f.convert(n,j);g=g.concat(q.nextPages),j=q.data}}_.isNull(j)&&m&&(j=[]),e.hasOwnProperty(l)?_.extend(e[l],j):e[l]=j}return{data:e,nextPages:g}}}})