define(["require","jQuery","Underscore","tau/core/class","tau/const/entityType.names"],function(t){var e=t("jQuery"),n=t("Underscore"),r=t("tau/core/class"),i=t("tau/const/entityType.names");return r.extend({_baseUrl:"/linkedtestplan/v1/",_createEmptyUrlMethod:"createEmpty",_createWithChildTestPlansUrlMethod:"createWithChildTestPlans",_createWithInboundRelationTestPlansUrlMethod:"createWithInboundRelationTestPlans",_createWithOutboundRelationTestPlansUrlMethod:"createWithOutboundRelationTestPlans",_migrateUserStoryUrlMethod:"migrateUserStory",init:function(t,e,n){this._appPath=t,this._store=e,this._onError=n},createEmpty:function(t){return this._invokePost(this._createEmptyUrlMethod,this._createBasePostData(t))},createWithChildTestPlans:function(t,e){return this._invokePost(this._createWithChildTestPlansUrlMethod,this._createExtendedPostData(t,{childEntityKinds:e}))},createWithInboundRelationTestPlans:function(t){return this._invokePost(this._createWithInboundRelationTestPlansUrlMethod,this._createBasePostData(t))},createWithOutboundRelationTestPlans:function(t){return this._invokePost(this._createWithOutboundRelationTestPlansUrlMethod,this._createBasePostData(t))},migrateUserStory:function(t){return this._invokePost(this._migrateUserStoryUrlMethod,{userStoryId:t.id})},_invokePost:function(t,n){return e.ajax({url:this._makeUrl(t),contentType:"application/json",type:"POST",data:JSON.stringify(n)}).then(this._done.bind(this),this._fail.bind(this))},_createBasePostData:function(t){return{entityId:t.id,entityKind:t.entityType.name}},_createExtendedPostData:function(t,e){return n.extend(this._createBasePostData(t),e)},_makeUrl:function(t){return this._appPath.concat(this._baseUrl,t)},_done:function(t){this._store.evictProperties(t.linkedGeneral.id,t.linkedGeneral.entityType.name,["linkedTestPlan"]),this._store.registerWithEvents(n.extend(t,{__type:i.TEST_PLAN}))},_fail:function(t){var n=t.responseJSON&&t.responseJSON.Message;return this._onError&&this._onError(n),e.Deferred().reject(n)
}})});