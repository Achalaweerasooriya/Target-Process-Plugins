define(["Underscore","app.path","tau/core/class","tau/store/store","tau/store/repository","tau/store/services/service.rest","tau/core/global.bus","tau/rules/core","tau/rules/rule.auto-include-before-save","tau/rules/rule.auto-action-after-save","tau/rules/rule.auto-include-before-remove","tau/target.process.rules.registrator","tau/store/types","tau/store/db","tau/store/types.targetprocess"],function(t,e,i,s,r,n,a,u,l,o,h,c,p,g){var d=null;return i.extend({rulesDisabled:!1,clearSingles:function(){d=null,this.rulesEngine&&(this.rulesEngine.destroy&&this.rulesEngine.destroy(),delete this.rulesEngine),delete this.proxy,delete this.service,delete this.store},clear:function(){this.clearSingles(),delete this.initialData,delete this.appPath,delete this.rulesDisabled},setApplicationPath:function(t){this.appPath!==t&&(this.appPath=t)},getApplicationPath:function(){return this.appPath?this.appPath:e.get()},setInitialData:function(t){this.initialData=t},setService:function(t){this.service!==t&&(this.clearSingles(),this.service=t)},getService:function(){return this.service||(this.service=new n({appPath:this.getApplicationPath(),path:this.getRestPath()})),this.service},getRestPath:function(){return this.getApplicationPath()+"/api/v1"},getDb:function(){return d||(d=new g({types:p.getDictionary()})),d},setProxy:function(t){this.proxy=t},getProxy:function(){return this.proxy||(this.proxy=new r({db:this.getDb(),service:this.getService()})),this.initialData&&(this.proxy.registerData(this.initialData),delete this.initialData),this.proxy},disableRules:function(){this.rulesDisabled=!0},enableRules:function(){this.rulesDisabled=!1},initRules:function(t){this.rulesDisabled!==!0&&(this.rulesEngine=new u({store:this.store,rules:[],rulesImpl:[l,o,h]}),c.registerRules(this.rulesEngine,t))},getStore:function(t){return this.store||(t=t||{},t.proxy=this.getProxy(),t.eventEmitter=t.eventEmitter||a.get(),this.store=new s(t),this.initRules(t.services)),this.store},setStore:function(t){this.store=t}})
});