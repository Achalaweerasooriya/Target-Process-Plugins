define(["jQuery","Underscore","tau/core/class"],function(i,t,e){var n=e.extend({_isActive:!0,init:function(){this._eventName=this._getVisibilityChangedInfo()+" mouseup mousemove keydown",this._inactiveSince=null,this._onInactivity=t.Callbacks(),this._onActivity=t.Callbacks(),this._onEvent=function(){this._activityHandler(),this._inactivityHandler()}.bind(this),i(document).on(this._eventName,this._onEvent)},_activityHandler:t.throttle(function(){this._isActive=!0,this._inactiveSince=null,this._onActivity.fire()},1e3,{trailing:!1}),_inactivityHandler:t.debounce(function(){this._isActive=!1,this._inactiveSince=t.now(),this._onInactivity.fire()},1e3),_getVisibilityChangedInfo:function(){return"hidden"in document?"visibilitychange":"msHidden"in document?"msvisibilitychange":""},active:function(){var t=i.Deferred();return this._isActive?t.resolve():this._onActivity.once(function(){t.resolve()},this),t},inactive:function(e){var n=i.Deferred(),s=this._isActive?e:e-(t.now()-this._inactiveSince);return this._schedule(n,s),n},_schedule:function(i,e){if(this._isActive||t.now()-this._inactiveSince<e){var n=window.setTimeout(function(){i.resolve()},e);this._postponeIfNecessary(i,e,n)}else i.resolve()},_postponeIfNecessary:function(i,e,n){this._onActivity.once(function(){"pending"===i.state()&&(window.clearTimeout(n),t.defer(this._schedule.bind(this),i,e))},this)},destroy:function(){i(document).off(this._eventName,this._onEvent)}});return new n});