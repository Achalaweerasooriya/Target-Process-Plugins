define(["Underscore","tau/core/class"],function(e,t){return t.extend({init:function(){this._currentPrototype={}},updateContextPrototype:function(t){var r=e.clone(this._currentPrototype);this._currentPrototype=t,this._extendProcess(this._currentPrototype,r.processes)},_extendProcess:function(t,r){var n=t.processes,s=e.pluck(n,"id"),o=e.pluck(r,"id"),c=e.difference(o,s);if(0!==c.length){var i=e.reduce(r,function(t,r){return e.contains(c,r.id)&&t.push(r),t},[]);this._currentPrototype.processes=n.concat(i)}},tryBuildContextFromContextPrototype:function(t,r){var n=this._currentPrototype;if(e.isEmpty(n)||void 0===t)return!1;var s=e.clone(n);s.projectIdsAvailable=[t||null],s.teamIdsAvailable=[r||null],s.selectedProjects=e.filter(s.selectedProjects,function(e){return e.id==t}),s.selectedTeams=e.filter(s.selectedTeams,function(e){return e.id==r});var o;if(t){var c=e.find(s.selectedProjects,function(e){return e.id==t}),i=c&&c.process&&c.process.id;o=function(e){return e.id==i}}else o=function(e){return e.isDefault===!0};return s.processes=e.filter(n.processes,o),0===s.processes.length?!1:s}})});