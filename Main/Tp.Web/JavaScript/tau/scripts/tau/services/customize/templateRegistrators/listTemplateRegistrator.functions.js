define(["require","Underscore","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/utils/utils.customFields.list","tau/models/board.customize.units/const.sorting.applying","tau/components/board.new.list/views/sortingItem","tau/models/board.customize.units/board.customize.units.interaction"],function(t){function e(t){return"tau-list-"+t+"-cell"}var i=t("Underscore"),n=t("tau/ui/extensions/board.plus/ui.board.plus.utils"),r=t("tau/utils/utils.customFields.list"),s=t("tau/models/board.customize.units/const.sorting.applying"),a=t("tau/components/board.new.list/views/sortingItem"),o=t("tau/models/board.customize.units/board.customize.units.interaction");return{itemFunctions:function(t){return{isApplicable:function(e){return t.isApplicableByType(e.type)},shouldRenderUnitValue:function(t){return this.isApplicable(t)&&!this.isEmptyUnit(t)},isEditable:function(e){return o.isUnitEditable(t,e)},isEmptyUnit:function(t){return this.hideIf(t.data||{})},isNoValueUnit:function(t){return t.data&&t.data.empty},createCellClassName:function(t){var e=["tau-elems-cell"],i=this.isApplicable(t);return i||e.push("tau-elems-cell_unit-not-applicable"),t.first&&e.push("ui-resizable"),this.isNoValueUnit(t)?e.push("tau-elems-cell-no-value"):i&&this.isEditable(t)&&e.push("tau-elems-cell_unit-editable"),e.join(" ")},canDisplayNameControls:function(t){return t.first},canDisplayOpenDetailsButton:function(t){return!this.isNoValueUnit(t)&&n.isSupportedCardForView(t.type)},createUnitClassName:function(n){var r=[this.unitClass(n),e(n.unit?n.unit.id:t.id),"tau-board-unit_overflow","tau-board-unit_list",i.isFunction(t.classId)?t.classId(n.data):t.classId];return r.join(" ").replace(" tau-board-unit_format_max "," ")},getUnitName:function(){return t.name},LIST_UNIT_TITLE_PREFIX:'<div title="',LIST_UNIT_TITLE_SUFFIX:'"></div>',LIST_UNIT_TITLE_REGEX:/<[^<%>]+(<%[^%>]+%>[^<%>]*)*[^<%>]*>/g,getTitleTemplateName:function(){return"list.unit."+t.id+".title"},createTitleTemplateMarkup:function(){var e=i.complexKey(t,"listSettings.title")||(t.template.markup||t.template).join("").replace(this.LIST_UNIT_TITLE_REGEX,"");
return i.flatten([this.LIST_UNIT_TITLE_PREFIX,"<% if (fn.isApplicable(this)) { %>",e,"<% } %>",this.LIST_UNIT_TITLE_SUFFIX])},createTitle:function(t){if(t.first||this.isEmptyUnit(t))return"";var e=this.sub(this.getTitleTemplateName(),t).slice(this.LIST_UNIT_TITLE_PREFIX.length,-this.LIST_UNIT_TITLE_SUFFIX.length);return'title="'+i.escape(e).replace(/&amp;#10;/g,"&#10;")+'"'}}},headerFunctions:function(t){return{isResizable:function(t){return!!t.first},createCellClassName:function(t){var i=["tau-elems-cell",e(t.unit.id)];return t.first&&i.push("tau-name-cell"),this.isResizable(t)&&i.push("ui-resizable"),i.join(" ")},createListSettings:function(e){var i=[];return t.listSettings&&t.listSettings.minWidth&&i.push('data-min-width="'+t.listSettings.minWidth+'"'),t.listSettings&&t.listSettings.maxWidth&&i.push('data-max-width="'+t.listSettings.maxWidth+'"'),i.push('data-unit-id="'+e.unit.id+'"'),i.join(" ")},getLevelTitle:function(t){return"priority"===t?"Business Values":this.term(t,"names")},getUnitHeader:function(e){if(void 0!==t.header)return this.replaceTermTags(t.header);if("{{name}}"===t.name)return r.getListHeader(e.unit.name);var i=this._tryGetHeaderFieldFromSettings(e);return i||t.name},getUnitTitle:function(){return void 0!==t.title?this.replaceTermTags(t.title):void 0!==t.header&&t.header.toLowerCase()!==t.name.toLowerCase()?this.replaceTermTags(t.name):""},getSortedField:function(e){if("simple"!==t.category&&"one to one"!==t.category)return null;var i=this._tryGetSortFieldFromConfig(e);if("undefined"!=typeof i)return i;var n=this._tryGetSortFieldFromSettings(e);return"undefined"!=typeof n?n:null},sortableTemplateHeader:function(t){var e=this.getSortedField(t);if(e&&t.renderSortingHeaders){var i=a.prototype,n=i.NON_SORTED_CLASS,r=t.ordering?t.ordering.name.replace(" "+i.ASC,"").replace(" "+i.DESC,"").toLowerCase():null;return r&&r===e.field.toLowerCase()&&(n=t.ordering.direction.toLowerCase()===i.ASC?i.ASC_SORTED_CLASS:i.DESC_SORTED_CLASS),'<span class="i-role-card-sorting tau-unit-sorting '+n+'" data-sort="'+e.field+'" data-inverse-sort-order="'+e.inverseOrder+'"><span class="i-role-card-sorting-title tau-unit-sorting-title">'
}return""},sortableTemplateFooter:function(t){var e=this.getSortedField(t);return e?"</span></span>":""},_tryGetSortFieldFromConfig:function(e){if(t.sortConfig&&t.sortConfig.allowed===s.NONE)return null;if(e.cardTypes.length>1){if(t.sortConfig&&t.sortConfig.allowed===s.SINGLE)return null;var n=i.flatMap(t.settings,function(t){return t.types}),r=i.map(e.cardTypes,function(t){return t.typeId});if(i.intersection(n,r).length!=r.length)return null}if(t.sortConfig&&t.sortConfig.field)return{field:t.sortConfig.field,inverseOrder:t.sortConfig.inverseOrder||!1};var a=i.any(t.settings,function(t){return t.sortConfig});return a?void 0:t.sampleData.name?{field:"name",inverseOrder:!1}:{field:i.keys(t.sampleData)[0],inverseOrder:!1}},_tryGetSortFieldFromSettings:function(t){var e=this._tryGetTypeSetting(t);return e&&e.sortConfig&&e.sortConfig.field?{field:e.sortConfig.field,inverseOrder:e.sortConfig.inverseOrder||!1}:null},_tryGetHeaderFieldFromSettings:function(t){var e=this._tryGetTypeSetting(t);return e&&e.header?e.header:null},_tryGetTypeSetting:function(e){return 1!==e.cardTypes.length?null:i.find(t.settings,function(t){var n=i.map(t.types,function(t){return t.toLowerCase()});return i.contains(n,e.cardTypes[0].typeId.toLowerCase())})}}}}});