define(["jQuery","Underscore","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/utils/utils.base64hashEncoder","tau/utils/utils.customFields.list","tau/models/board.customize.units/const.sorting.applying","tau/components/board.new.list/views/sortingItem"],function(t,e,i,n,r,s,a){function o(t){return"tau-list-"+t+"-cell"}return{itemFunctions:function(t){return{isApplicable:function(e){return t.isApplicableByType(e.type)},isEditable:function(e){return t.editorConfig?t.editorConfig.isEditable?t.editorConfig.isEditable(e):!0:!1},isEmptyUnit:function(t){return this.hideIf(t.data||{})},isNoValueUnit:function(t){return t.data&&t.data.empty},createCellClassName:function(t){var e=["tau-elems-cell"],i=this.isApplicable(t);return i||e.push("tau-elems-cell_unit-not-applicable"),t.first&&e.push("ui-resizable"),this.isNoValueUnit(t)?e.push("tau-elems-cell-no-value"):i&&this.isEditable(t)&&e.push("tau-elems-cell_unit-editable"),e.join(" ")},canDisplayNameControls:function(t){return t.first},canDisplayOpenDetailsButton:function(t){return!this.isNoValueUnit(t)&&i.isSupportedCardForView(t.type)},createUnitClassName:function(i){var n=[this.unitClass(i),o(i.unit?i.unit.id:t.id),"tau-board-unit_overflow",e.isFunction(t.classId)?t.classId(i.data):t.classId];return n.join(" ").replace(" tau-board-unit_format_max "," ")},LIST_UNIT_TITLE_PREFIX:'<div title="',LIST_UNIT_TITLE_SUFFIX:'"></div>',LIST_UNIT_TITLE_REGEX:/<[^<%>]+(<%[^%>]+%>[^<%>]*)*[^<%>]*>/g,getTitleTemplateName:function(){return"list.unit."+t.id+".title"},createTitleTemplateMarkup:function(){var i=e.complexKey(t,"listSettings.title")||(t.template.markup||t.template).join("").replace(this.LIST_UNIT_TITLE_REGEX,"");return e.flatten([this.LIST_UNIT_TITLE_PREFIX,"<% if (fn.isApplicable(this)) { %>",i,"<% } %>",this.LIST_UNIT_TITLE_SUFFIX])},createTitle:function(t){if(t.first)return"";var i=this.sub(this.getTitleTemplateName(),t).slice(this.LIST_UNIT_TITLE_PREFIX.length,-this.LIST_UNIT_TITLE_SUFFIX.length);return'title="'+e.escape(i).replace(/&amp;#10;/g,"&#10;")+'"'}}},headerFunctions:function(t){return{isResizable:function(t){return!!t.first},createCellClassName:function(t){var e=["tau-elems-cell",o(t.unit.id)];return t.first&&e.push("tau-name-cell"),this.isResizable(t)&&e.push("ui-resizable"),e.join(" ")},createListSettings:function(e){var i=[];return t.listSettings&&t.listSettings.minWidth&&i.push('data-min-width="'+t.listSettings.minWidth+'"'),t.listSettings&&t.listSettings.maxWidth&&i.push('data-max-width="'+t.listSettings.maxWidth+'"'),i.push('data-unit-id="'+e.unit.id+'"'),i.join(" ")},getUnitHeader:function(e){return void 0!==t.header?t.header:"{{name}}"===t.name?r.getListHeader(e.unit.name):t.name},getUnitTitle:function(){return void 0!==t.title?t.title:void 0!==t.header&&t.header.toLowerCase()!==t.name.toLowerCase()?t.name:""},getSortedField:function(e){if("simple"!==t.category&&"one to one"!==t.category)return null;var i=this._tryGetSortFieldFromConfig(e);if("undefined"!=typeof i)return i;var n=this._tryGetSortFieldFromSettings(e);return"undefined"!=typeof n?n:null},sortableTemplateHeader:function(t){var e=this.getSortedField(t);if(e&&t.renderSortingHeaders){var i=a.prototype,n=i.NON_SORTED_CLASS,r=t.ordering?t.ordering.name.replace(" "+i.ASC,"").replace(" "+i.DESC,"").toLowerCase():null;return r&&r===e.field.toLowerCase()&&(n=t.ordering.direction.toLowerCase()===i.ASC?i.ASC_SORTED_CLASS:i.DESC_SORTED_CLASS),'<span class="i-role-card-sorting tau-unit-sorting '+n+'" data-sort="'+e.field+'" data-inverse-sort-order="'+e.inverseOrder+'"><span class="i-role-card-sorting-title tau-unit-sorting-title">'}return""},sortableTemplateFooter:function(t){var e=this.getSortedField(t);return e?"</span></span>":""},_tryGetSortFieldFromConfig:function(i){if(t.sortConfig&&t.sortConfig.allowed===s.NONE)return null;if(i.cardTypes.length>1){if(t.sortConfig&&t.sortConfig.allowed===s.SINGLE)return null;var n=e.flatMap(t.settings,function(t){return t.types}),r=e.map(i.cardTypes,function(t){return t.typeId});if(e.intersection(n,r).length!=r.length)return null}if(t.sortConfig&&t.sortConfig.field)return{field:t.sortConfig.field,inverseOrder:t.sortConfig.inverseOrder||!1};var a=e.any(t.settings,function(t){return t.sortConfig});return a?void 0:t.sampleData.name?{field:"name",inverseOrder:!1}:{field:e.keys(t.sampleData)[0],inverseOrder:!1}},_tryGetSortFieldFromSettings:function(i){if(1!==i.cardTypes.length)return null;var n=e.find(t.settings,function(t){var n=e.map(t.types,function(t){return t.toLowerCase()});return e.contains(n,i.cardTypes[0].typeId.toLowerCase())});return n&&n.sortConfig&&n.sortConfig.field?{field:n.sortConfig.field,inverseOrder:n.sortConfig.inverseOrder||!1}:void 0}}}}});