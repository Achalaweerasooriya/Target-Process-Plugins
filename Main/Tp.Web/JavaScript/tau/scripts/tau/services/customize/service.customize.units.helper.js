define(["Underscore","tau/core/class","tau/models/board.customize.units/board.customize.units.fn","tau/const/entityType.names"],function(t,e,n,s){var i=function(){return""};return e.extend({init:function(t){this._templateRegistrators=t},_getKeyMap:function(e,n){return t.isObject(e)?(n=n?n+".":"",t.map(e,function(e,s){var i=this._getKeyMap(e,n+s);return t.isArray(i)?s+":{"+i.join(",")+"}":i},this)):n},getKeys:function(t){return this._getKeyMap(t).join(",")},processSettings:function(e,n){var s=e.model||this.getKeys(e.sampleData);e.settings?t.each(e.settings,function(t){t.model=t.model||s}):e.settings=[{types:e.types,sizes:e.sizes,model:s}],n&&t.each(e.settings,function(t){t.model=n(s)})},processIsApplicable:function(e){e.isApplicableByTypeAndSize=function(t,e){return null!=this.getModelByTypeAndSize(t,e)},e.isApplicableByType=function(e){var n=t.find(this.settings,function(n){return t.contains(n.types,e)||t.contains(n.types,s.ANY_TYPE)});return n?n.model:null},e.getModelByTypeAndSize=function(e,n){var i=t.find(this.settings,function(i){var o=t.contains(i.types,e)||t.contains(i.types,s.ANY_TYPE),r=!n||t.contains(i.sizes,n);return o&&r});return i?i.model:null}},processCustomFunctions:function(e,s){e.template.customFunctions=t.extend(e.template.customFunctions||{},n(e,s)),e.template.customFunctions.hideIf=e.hideIf||i},processTemplates:function(e){var n=t.reduce(this._templateRegistrators,function(n,s){var i=s.registerUnit(e);return t.extend(n,i)},{});e.getTemplateName=function(t){return n[t]}}})});