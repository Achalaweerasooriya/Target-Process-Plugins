define(["require","Underscore","tau/core/class","./service.boards.api","./service.views.groups.api","app.path","tau/utils/utils.api","./service.views.menu.utils","tau/services/boards/view.types","tau/components/board.menu/models/board.menu.section.collection"],function(e){var i=e("Underscore"),t=e("tau/core/class"),n=e("./service.boards.api"),r=e("./service.views.groups.api"),s=e("app.path"),a=e("tau/utils/utils.api"),o=e("./service.views.menu.utils"),u=e("tau/services/boards/view.types"),c=e("tau/components/board.menu/models/board.menu.section.collection");return t.extend({viewsApi:null,groupsApi:null,init:function(e,t){this.viewsMenuUrlService=t,this._clientId=i.uniqueId("viewmenu/"+ +new Date+"/"+i.UUID());var s={clientId:this._clientId};this.viewsApi=new n(e,s),this.groupsApi=new r(e,s,this.viewsApi.internalCreateItemUpdatedInvalidatingHandler()),Object.defineProperty(this,"boardsApi",{get:function(){return console.warn('Property "boardsApi" is deprecated. Use "viewsApi" instead'),this.viewsApi}}),this._noCacheStorage=new o.NoCacheStorageApiFacade(e)},getViewsMenuClientId:function(){return this._clientId},getBoardsForUser:function(e){var i={url:s.get()+"/api/boards/v1/visibleForUser/"+e,dataType:"json",type:"GET",$scope:{}};return this._noCacheStorage.makeServiceCall(i)},getApiForType:function(e){if("group"===e)return this.groupsApi;if(u.isKnownViewType(e))return this.viewsApi;throw new Error('Unknown menu item type "'+e+'"')},getViewsMenuForUser:function(){var e={url:s.get()+"/api/views/v1",dataType:"json",type:"GET",$scope:{}};return this.viewsMenuUrlService.urlResolverInitialized.then(function(){return this._noCacheStorage.makeServiceCall(e)}.bind(this)).then(function(e){return c.createFromMenuStructure(e.data.items,this.viewsMenuUrlService)}.bind(this))},removeAllViewMenuItems:function(){var e=a.createDeleteAjaxCommandConfig({url:s.get()+"/api/views/v1/unsafeDeleteAllItems",$scope:{}});return this._noCacheStorage.makeServiceCall(e).then(this.clearViewsMenuCache.bind(this))
},clearViewsMenuCache:function(){i.invoke([this.viewsApi,this.groupsApi],"clearViewMenuItemCollectionCache")}})});