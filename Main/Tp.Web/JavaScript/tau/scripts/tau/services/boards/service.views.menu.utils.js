define(["require","tau/storage/api.nocache","tau/storage/api","jQuery","Underscore"],function(e){var a=e("tau/storage/api.nocache"),r=e("tau/storage/api"),t=e("jQuery"),o=e("Underscore"),n={makeServiceCall:function(e){var a=e.$scope||{},r=t.Deferred();return r.$config=a,this._makeServiceCall(e,r,{ajaxConfig:e,config:a}).then(function(e){return e.value=e.data,e})}},i=a.extend(n),c=r.extend(n).extend({init:function(e,a,r){this._super(e),this._storageGroupName=a,this._storageKeyName=r},clearCache:function(){this._cache={}},_trySaveCacheByGroupAndKey:function(e,a){if(e&&e.key){var r=this._storageKeyName+e.key;return this._cache[this._createCacheNameFromGroupAndKey(this._storageGroupName,r)]=a,!0}return!1},saveCacheByGroupAndKey:function(e,a){this._trySaveCacheByGroupAndKey(e,t.Deferred().resolve(a))},mergeCacheByGroupAndKey:function(e){var a=this._storageKeyName+e.key,r=this._createCacheNameFromGroupAndKey(this._storageGroupName,a),t=this._cache[r];t&&"resolved"==t.state()&&t.done(function(a){o.extend(a.data,e)})},clearCacheForViewItem:function(e){var a=this._storageKeyName+e;delete this._cache[this._createCacheNameFromGroupAndKey(this._storageGroupName,a)]},createStoreRequestConfig:function(e){var a={$group:this._storageGroupName};return e&&(a.$key=this._storageKeyName+e),a}});return{NoCacheStorageApiFacade:i,StorageApiFacade:c}});