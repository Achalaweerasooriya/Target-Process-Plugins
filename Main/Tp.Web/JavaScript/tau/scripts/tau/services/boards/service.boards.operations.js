define(["require","tau/core/class","Underscore","jQuery","tau/utils/utils.serverErrorTranslator","template!tau/components/board.menu/templates/board.menu.undelete.template","tau/services/boards/view.types"],function(e){var t=e("tau/core/class"),r=e("Underscore"),i=e("jQuery"),o=e("tau/utils/utils.serverErrorTranslator"),n=e("template!tau/components/board.menu/templates/board.menu.undelete.template"),s=e("tau/services/boards/view.types");return t.extend({init:function(e,t,r,i,o,n,s){this._bus=e,this._errorBarService=t,this._configurator=r,this._viewsMenuService=i,this._urlBuilder=o,this._routing=n,this._history=s},createViewAndRedirect:function(){var e=this._configurator.getBoardDefinitionFactory();return e.createBoard().done(function(e){this._bus.fire("add.board",{board:{id:e.id}}),this._configurator.setConfig("tmpBoardIsJustAdded",!0),this.redirectToView(s.BOARD,e.id)}.bind(this))},createDashboardAndRedirect:function(){var e=this._configurator.getBoardDefinitionFactory();return e.createDashboard().done(function(e){this._bus.fire("add.dashboard",{board:{id:e.id}}),this._configurator.setConfig("tmpBoardIsJustAdded",!0),this.redirectToView(s.DASHBOARD,e.id)}.bind(this))},createReportAndRedirect:function(){var e=this._configurator.getBoardDefinitionFactory();return e.createReport().done(function(e){this._bus.fire("add.customReport",{board:{id:e.id}}),this._configurator.setConfig("tmpBoardIsJustAdded",!0),this.redirectToView(s.REPORT,e.id)}.bind(this))},createViewGroup:function(){var e=this._configurator.getBoardDefinitionFactory();return e.createViewGroup().done(function(e){this._bus.fire("add.board.group",{boardGroup:{id:e.key}})}.bind(this))},removeView:function(e,t){var r=t||this._getCurrentAcid();return this._viewsMenuService.viewsApi.getViewMenuItem(e).then(function(t){return i.when(t.data,this._viewsMenuService.viewsApi.removeViewMenuItem(e))}.bind(this)).fail(function(e){this._errorBarService.fire("error",o.translateXhrError(e))}.bind(this)).then(function(t){this._bus.fire("remove.board",{board:{id:e}}),this._history.exclude(e),this._showUndeleteMessage(t,r)
}.bind(this))},removeViewAndRedirect:function(e,t,r,i,o){var n=this.removeView(e,t);return r&&i?this.redirectToView(r,i,o):this.redirectToDefaultView(o),n},_showUndeleteMessage:function(e,t){var r=n.render({name:e.name,viewTypeName:s.getViewTypeName(e.itemType)});r.on("click",".i-role-undo",function(){var r=e.key||e.id;this._viewsMenuService.viewsApi.restoreViewMenuItem(r,e).done(function(){this.redirectToView(e.itemType,r,t)}.bind(this))}.bind(this)),this._errorBarService.fire("notification",{id:"board.removed",className:"tau-system-message-success",$node:r,delay:1e4,disableAutoClose:!1})},_getCurrentAcid:function(){return this._configurator.getAppStateStore().settings.acid},redirectToView:function(e,t,r,i){var o="";switch(e){case s.DASHBOARD:o="dashboard/";break;case s.REPORT:o="customreport/";break;default:o="board/"}var n=this._urlBuilder.getRelativeBoardPageUrl(o+t,r);this._routing.redirect(n+(i||""))},redirectToDefaultView:function(e){var t=this._urlBuilder.getDefaultViewUrl(e);this._routing.redirect(t)},getNextBoardAfterDeleted:function(e,t){var i,o=r.find(e,function(e){return e.key!==t?(i=i||e,e.menuIsVisible):void 0});return o||i}})});