define(["Underscore","jQuery","tau/core/class","tau/core/event","tau/storage/api","tau/storage/api.nocache","app.path","tau/utils/utils.api"],function(e,a,t,r,o,n,i,c){var s="__board_legacy",u="__board_legacy_id_",d={makeServiceCall:function(e){var t=e.$scope||{},r=a.Deferred();return r.$config=t,this._makeServiceCall(e,r,{ajaxConfig:e,config:t}).then(function(e){return e.value=e.data,e})}},h=n.extend(d),f=o.extend(d).extend({clearCache:function(){this._cache={}},_trySaveCacheByGroupAndKey:function(e,a){if(e&&e.key){var t=u+e.key;return this._cache[this._createCacheNameFromGroupAndKey(s,t)]=a,!0}return!1},saveCacheByGroupAndKey:function(e,a){this._trySaveCacheByGroupAndKey(e,a)}}),v=t.extend({init:function(e){this._storage=new f(e),this._noCacheStorage=new h(e)},createBoard:function(e){return this.setBoardData("",e).then(function(e){return this._notifyBoardCreated(e.data),e}.bind(this))},setBoardData:function(e,a){var t=this._createStoreRequestConfig(e);t.$value=a;var r=this._createAjaxConfig(e,t);return r.type="POST",r.contentType="application/json; charset=utf-8",r.data=JSON.stringify(a),this._storage.makeServiceCall(r)},getBoardData:function(e){var a=this._createStoreRequestConfig(e),t=this._createAjaxConfig(e,a);return this._storage.makeServiceCall(t)},setBoardsCache:function(a){e.each(a,function(e){this.setBoardCache(e)},this)},setBoardCache:function(e){var t=this._createStoreRequestConfig(e.key),r=this._createAjaxConfig(e.key,t),o={ajaxConfig:r,config:t,data:e,value:e};this._storage.saveCacheByGroupAndKey(e,a.Deferred().resolve(o))},removeBoard:function(e){var a=this._createStoreRequestConfig(e),t=c.createDeleteAjaxCommandConfig({url:i.get()+"/api/board/v1/"+e});return t.$scope=a,this._storage.makeServiceCall(t).then(this._notifyBoardRemoved.bind(this,e))},removeAllBoards:function(){var e=c.createDeleteAjaxCommandConfig({url:i.get()+"/api/boards/v1/",$scope:{}});return this._noCacheStorage.makeServiceCall(e)},getBoardsForUser:function(e){var a={url:i.get()+"/api/boards/v1/visibleForUser/"+e,dataType:"json",type:"GET",$scope:{}};return this._noCacheStorage.makeServiceCall(a)},clearBoardCache:function(){this._storage.clearCache()},_createStoreRequestConfig:function(e){var a={$group:s};return e&&(a.$key=u+e),a},_createAjaxConfig:function(e,a){return{url:i.get()+"/api/board/v1/"+e,dataType:"json",$scope:a,type:"GET"}},_notifyBoardCreated:function(e){this.fire("service.boards.api.board.created",e)},_notifyBoardRemoved:function(e){this.fire("service.boards.api.board.removed",e)}});return r.extend(v)});