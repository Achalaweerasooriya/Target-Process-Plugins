define(["require","Underscore","jQuery","tau/core/class"],function(e){var t=e("Underscore"),i=e("jQuery"),r=e("tau/core/class");return r.extend({init:function(){this.currentBoardChanged=t.Callbacks(),this._serviceInitializedDef=i.Deferred(),this.serviceInitialized=this._serviceInitializedDef.promise()},getCurrentSettings:function(){return this._assertInitialized(),this._service.settings},getCurrentBoardId:function(){return this.getCurrentSettings().id},getCurrentService:function(){return this._assertInitialized(),this._service},setNewBoardSettingsService:function(e){var t=this._service;t!==e&&(this._service=e,this.currentBoardChanged.fire(e.settings)),this._serviceInitializedDef.resolve()},toggleBoardEditMode:function(){this._assertInitialized();var e=this._service;return e.get({fields:["edit"]}).then(function(i){var r,s,n=i.edit&&i.cells&&0===i.cells.types.length;return n?(r={emptyCardsSet:+new Date},s=!0):(r={edit:!i.edit},s=r.edit),e.set({set:r}).then(t.constant(s))})},_assertInitialized:function(){if("resolved"!==this._serviceInitializedDef.state())throw new Error("Board settings service is not initialized yet")}})});