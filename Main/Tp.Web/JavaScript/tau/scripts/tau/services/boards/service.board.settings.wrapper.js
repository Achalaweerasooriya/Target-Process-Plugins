define(["require","Underscore","jQuery","tau/core/class"],function(e){var t=e("Underscore"),i=e("jQuery"),r=e("tau/core/class");return r.extend({init:function(){this.currentBoardChanged=t.Callbacks(),this._serviceInitializedDef=i.Deferred(),this.serviceInitialized=this._serviceInitializedDef.promise()},getCurrentSettings:function(){return this._assertInitialized(),this._service.settings},getCurrentViewId:function(){return this.getCurrentSettings().id},getCurrentService:function(){return this._assertInitialized(),this._service},setNewBoardSettingsService:function(e){var t=this._service;t!==e&&(this._service=e,this.currentBoardChanged.fire(e.settings)),this._serviceInitializedDef.resolve()},toggleBoardEditMode:function(){return this._assertInitialized(),this._service.get({fields:["edit","itemType","cells"]}).then(function(e){var i,r,s=e.edit&&this._isEmptyBoard(e);return s?(i={emptyCardsSet:+new Date},r=!0):(i={edit:!e.edit},r=i.edit),this._service.set({set:i}).then(t.constant(r))}.bind(this))},_isEmptyBoard:function(e){return"board"===e.itemType&&e.cells&&0===e.cells.types.length},_assertInitialized:function(){if("resolved"!==this._serviceInitializedDef.state())throw new Error("Board settings service is not initialized yet")}})});