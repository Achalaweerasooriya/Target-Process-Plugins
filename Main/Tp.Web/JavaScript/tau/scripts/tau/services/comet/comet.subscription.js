define(["Underscore","jQuery","tau/core/class"],function(t,e,r){return r.extend({init:function(r,i){t.isArray(i)||(i=[{parameters:i}]),this.$cmdStart=e.Deferred(),this.$cmdStarted=e.Deferred(),this.$cmdStop=e.Deferred(),this.$cmdStopped=e.Deferred(),this.$cmdNotify=e.Deferred(),this.$cmdBatchNotify=e.Deferred(),this.params=t.map(i,function(t){return t.callback=this.$cmdNotify.notify,t.batchCallback=this.$cmdBatchNotify.notify,t.clientId=t.parameters.clientId,t},this)},start:function(t){return this.$cmdStarted.done(t),this.$cmdStart.resolve(this.params),this},stop:function(t){this.$cmdStopped.done(t),this.$cmdStarted.done(this.$cmdStop.resolve)},on:function(r){var i={},s=function(t){var e=i["*"];e&&e.notify(t);var r=(t.data.modification||"").toLowerCase(),s=i[r];s&&s.notify(t)},o=e.Deferred(),c=function(t){o.notify(t)};this.$cmdNotify.progress(s),this.$cmdBatchNotify.progress(c);var n=(r.eventName||"*").toLowerCase(),d=r.callback||e.noop,a=r.batchCallback||e.noop;t.has(i,n)||(i[n]=e.Deferred()),o.progress(a);var h=i[n];return h.progress(d),this},setSubscriber:function(t){this.subscriber=t,this.$cmdStop.done(function(){this.subscriber.unsubscribe(this.$cmdStopped.resolve)}.bind(this)),this.$cmdStart.done(function(t){this.subscriber.subscribe(t,this.$cmdStarted.resolve)}.bind(this))}})});