define(["jQuery","./comet.subscriber"],function(e,n){e(document).ready(function(){e(this).keypress(function(e){return 27==e.keyCode?!1:void 0})});var r=e.Callbacks(),o=e.Deferred(),t=e.Deferred(),c=e.Deferred(),i=!0;e(window).on("beforeunload",function(){r.disable()});var d={disconnectedOnce:r.add,startAsync:function(d){d=d||e.noop,o.done(d),i&&(i=!1,require(["tp/serverNotifications"],function(d){d&&(t.done(function(){d.stop(function(){i=!0,o=e.Deferred(),c.resolve(),c=e.Deferred()})}),d.disconnected(function(){i=!0,o=e.Deferred(),c=e.Deferred(),r.fire().empty()}),d.start(function(){var e={createSubscriber:function(e){return new n(e,d)}};o.resolve(e)}))}))},stopAsync:function(n){c.done(n||e.noop),t.resolve()}};return d});