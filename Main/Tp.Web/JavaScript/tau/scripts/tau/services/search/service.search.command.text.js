define(["jQuery","Underscore","tau/core/class","tau/services/search/service.search.command","tau/services/search/service.search.command.text.contextBuilder"],function(e,t,a,i,s){var r=i.extend({init:function(e,t,a){this._super(e,t,a),this.searchContextBuilder=new s(this.configurator,t)},execute:function(){this._done(this.searchContextBuilder.getContextPromise().then(t.bind(this._searchTextPromise,this)).then(t.bind(this._fetchDetailsByIDs,this)))},_searchTextPromise:function(a){var i="{AppPath}/api/v1/Plugins.asmx/Search/Profiles/Now%20running/Commands/Search".replace(/{AppPath}/g,this.configurator.getApplicationPath()),s=this.configurator.getLoggedUser(),r=JSON.stringify({Command:"Search",Plugin:"Search",LoggedUserId:null!=s?s.id:null,TeamIds:t.without(a.selectedTeamIdsAvailable,"null"),IncludeNoTeam:a.includeNoTeam,ProjectIds:t.without(a.selectedProjectIdsAvailable,"null"),IncludeNoProject:a.includeNoProject,TeamProjectRelations:t(a.teamProjectRelations).map(function(e,t){return{TeamId:parseInt(t),ProjectIds:e}}),Query:this.params.searchString,EntityTypeId:this.params.entityTypeId,EntityStateIds:t.isArray(this.params.entityStateIds)?this.params.entityStateIds:t((this.params.entityStateIds||"").split(",")).chain().without("").map(function(e){return parseInt(e)}).value(),Page:{Number:this.params.pageNo,Size:this.params.pageSize}});return e.ajax({url:i,type:"POST",data:r,dataType:"json"})}});return r.isSuitableCommand=function(){return!0},r.allowsToBeFiltered=!0,r});