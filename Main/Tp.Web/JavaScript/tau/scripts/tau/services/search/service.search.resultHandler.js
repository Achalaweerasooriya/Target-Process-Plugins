define(["Underscore","tau/core/class","tau/utils/utils.date","tau/core/termProcessor"],function(e,t,n,r){var a=t.extend({init:function(){this.preProcessingStrategies={comment:function(e){e.entityType={name:"comment"};var t=new r;return e.general.entityType.term=t.getTerms(e.general.entityType.name).name,e}}},handle:function(t,n,r){t.fail(function(e){n.reject({data:{error:!0,response:e}})}).done(e.bind(function(t){var a=e.trim(r).replace(/(\d+)/g," $1 "),i=e.without(a?a.split(/\s|\?|\*|\+|-|:|'|"/g):[],"");i=e(i).chain().filter(function(e){return e&&(/^\d+$/.test(e)||e.length>1)}).uniq().value(),n.resolve({data:{keywords:i,info:t.info,items:e.map(t.items,e.bind(this._adaptItem,this))}})},this))},_adaptItem:function(t){var a=t.__type.toLowerCase(),i=this.preProcessingStrategies[a]||e.identity;t=i(t);var s=new r;return t.entityType.term=s.getTerms(t.entityType.name).name,t.nameExt=t.nameExt||t.name,t.descExt=t.descExt||t.description||"",t.tags=t.tags?t.tags.split(", "):[],t.createDate=n.parse(t.createDate),t}});return a});