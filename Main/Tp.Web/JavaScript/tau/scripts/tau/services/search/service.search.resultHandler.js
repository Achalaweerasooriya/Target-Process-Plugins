define(["Underscore","tau/core/class","tau/utils/utils.date","tau/ui/ui.templateFactory"],function(e,t,n,r){var i=t.extend({init:function(){this.preProcessingStrategies={comment:function(e){e.entityType={name:"comment"};var t=r.getTermProcessor();return e.general.entityType.term=t.getTerm(e.general.entityType.name),e}}},handle:function(t,n,r){t.fail(function(e){n.reject({data:{error:!0,response:e}})}).done(e.bind(function(t){var i=e.trim(r).replace(/(\d+)/g," $1 "),a=e.without(i?i.split(/\s|\?|\*|\+|-|:|'|"/g):[],"");a=e(a).chain().filter(function(e){return e&&(/^\d+$/.test(e)||e.length>1)}).uniq().value(),n.resolve({data:{keywords:a,info:t.info,items:e.map(t.items,e.bind(this._adaptItem,this))}})},this))},_adaptItem:function(t){var i=t.__type.toLowerCase(),a=this.preProcessingStrategies[i]||e.identity;t=a(t);var s=r.getTermProcessor();return t.entityType.term=s.getTerm(t.entityType.name),t.nameExt=t.nameExt||t.name,t.descExt=t.descExt||t.description||"",t.tags=t.tags?t.tags.split(", "):[],t.createDate=n.parse(t.createDate),t}});return i});