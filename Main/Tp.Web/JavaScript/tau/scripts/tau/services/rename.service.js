define(["require","jQuery","Underscore"],function(e){var t=e("jQuery"),n=e("Underscore");return{startRenamingActivity:function(e,n){var i=t(e);if(1!==i.length)throw new Error("There should be only one name element to edit");return this._startRename(i,n)},stopRenaming:function(e){t(e).editableText("performSave")},_clearSelection:function(){var e=window.getSelection?window.getSelection():document.selection;e&&(e.empty&&e.empty(),e.removeAllRanges&&e.removeAllRanges())},_selectElement:window.getSelection&&document.createRange?function(e){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}:t.noop,_startRename:function(e,i){var o=t.Deferred(),r=e.text();return e.editableText(n.extend({enabled:!1,restoreText:!0,classNameActive:"t3-edit",maxLength:40,onSave:function(e){o.resolve(e,r)},onEditStart:function(){this._selectElement(e[0])}.bind(this),onEditCancelled:function(){o.reject(),this._clearSelection()}.bind(this),onEditEnd:function(){o.resolve(e.text(),r),e.editableText("disable"),this._clearSelection()}.bind(this)},i)).editableText("enable").editableText("activate"),o.always(n.defer.bind(n,function(){e.editableText("destroy")})),o.promise()}}});