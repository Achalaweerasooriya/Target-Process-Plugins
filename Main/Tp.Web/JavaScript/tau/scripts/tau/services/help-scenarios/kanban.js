define(["jQuery","Underscore","tau/services/help-scenarios/base"],function(e,t,o){var r=o.liveSelect,n=o.markDropTarget,a=o.unMarkDropTarget,s=o.selectorOnVisibleBubble,i=[o.flowIntroVideo,{name:"Select/add project(s) and/or team(s)",steps:[o.stepContextPromptToSeeExistingProjectsAndTeams(),o.stepContextExplainProjects("Kanban"),o.stepContextApplyExistingProject("Tau Product - Kanban #1")]},{name:"Kanban Board",steps:[o.stepOpenBoard({boardName:"Kanban Board",message:["<p>Now open the Kanban board. Kanban is a simple process. You don't have to plan iterations here.</p>","<p>Just visualize your dev flow and limit Work In Progress (WIP). You'll do this later.</p>"].join("")}),o.stepClickForQuickAdd({message:"<p>Click the green + to add a new user story to the project.</p>",isScrollTo:!1,todoCellSelector:".tau-grid tr:first-child .tau-cellholder:first-child"}),{message:'<p>Enter a user story name, e.g. "As a user I want to log in"</p>',direction:"left",rollbackDepth:2,target:function(){return r(".tau-quick-add-dialog input.Name")},complete:function(e){return e.$node.on("keypress",e.resolve),e}},o.stepSelectYourProject(".tau-quick-add-dialog select.project",{direction:"left",rollbackDepth:3}),{message:"<p>Click here to add this user story to the Kanban board.</p>",direction:"left",rollbackDepth:4,target:function(){return r(".tau-quick-add-dialog .tau-add-item")},complete:function(e){return e.$node.one("click",function(){r(s(".i-role-quick-add-success-message"),e,!0)}),e}},{message:["<p>Here's your new story card.</p>",'<p class="tau-help-continue"><button class="i-role-next tau-btn tau-primary">Continue</button></p>'].join(""),pin:!1,target:function(e){var t=o.extractJustAddedEntityId(s(".i-role-quick-add-success-message"));return e.scenarioContext.set("step_EntityId",t),r(".i-role-card[data-entity-id="+t+"]")},complete:o.complete},{message:"<p>We will customize the Kanban board now. Click here.</p>",direction:"none",target:function(){return r(".tau-actions-btn")},complete:function(e){return e.$node.on("click",e.resolve),e}},{message:"<p>And here.</p>",direction:"none",target:function(){return r(".actions-menu-items .tau-board-settings-toggle")},complete:function(e){return e.$node.on("click",e.resolve),e}},{message:["<p>You can limit your Work in Progress in this tab.</p>",'<p class="tau-help-continue"><button class="i-role-next tau-btn tau-primary">Got it, thanks</button></p>'].join(""),direction:"right",target:function(){return r('.i-role-tabheader[data-label="limits"]')},complete:o.complete},{message:["<p>Let's get back to the Board Setup now.</p>"].join(""),direction:"none",target:function(){return r('.i-role-tabheader[data-label="setup"]')},complete:function(e){return e.$node.hasClass("tau-active")?o.resolveCtx(e):e.$node.one("click",e.resolve),e}},{message:"<p>Select Person to see work assigned to all the people.</p>",target:function(){return r(".tau-select[name=y_types]")},complete:function(e){return"assigneduser"===e.$node.val()?o.resolveCtx(e):e.$node.on("change",function(){"assigneduser"===e.$node.val()&&e.resolve()}),e}},{message:['<p>We\'ve set "State" for the vertical lanes, and "Person" for the horizontal lanes, so you see the Person/State swimlanes now.</p>',"<p>This means who's working on what, and what's the progress. You can mix the lanes later as you wish.</p>",'<p class="tau-help-continue"><button class="i-role-next tau-btn tau-primary">Got it, thanks</button></p>'].join(""),target:function(){return r(".tau-x-header .tau-cell:eq(0)")},complete:function(e){var t=e.$holder.tauBubble("getContent");return t.on("click",".i-role-next",e.resolve),e}},{message:"<p>Click here to get back to the Kanban board.</p>",direction:"none",target:function(){return r(".tau-settings-close")},complete:function(e){return e.$node.on("click",e.resolve),e}},{message:["<p>Let's see how to assign stories to people in the Person/State swimlanes. This can be done with drag-n-drop.</p>",'<p class="tau-help-card-dnd-vertical"></p>'].join(""),target:function(t){var o=t.scenarioContext.get("step_EntityId"),a=".i-role-card[data-entity-id="+o+"]",s=e('.i-role-cellaxis-viewtrigger[data-entity-type="user"][data-entity-id="'+window.loggedUser.id+'"]'),i=s.data("id"),l='.i-role-grid .i-role-cellholder[data-y="'+i+'"]:eq(0)',c=e(l);return n(c,"Drop the card here to assign it to yourself."),t.scenarioContext.set("step_CurrentUserCellHolderSelector",l),r(a)},complete:function(e){o.hideTooltipOnCardDnD(e);var t=e.step.scenarioContext.get("step_EntityId"),n=e.step.scenarioContext.get("step_CurrentUserCellHolderSelector");return r(n+" .i-role-card[data-entity-id="+t+"]",e),e},teardown:function(t){var o=t.step.scenarioContext.get("step_CurrentUserCellHolderSelector"),r=e(o);a(r)}},{message:["<p>Double-click the story card for more details.</p>",'<p class="tau-help-card-dblclick"></p>'].join(""),target:function(e){var t=e.scenarioContext.get("step_EntityId");return r(".i-role-card[data-entity-id="+t+"]")},complete:function(e){return e.$node.on("dblclick",e.resolve),e}},o.stepClickOrEscToClose({message:"<p>Click to get back to the board.</p>"})]},{name:"My Work",steps:[o.stepOpenBoard({message:"<p>You can manage your work items from a personal board as well. Click here to open it.</p>",boardName:"Personal Kanban"}),{message:["<p>Drag-n-drop the card to In Progress to start work.</p>",'<p class="tau-help-card-dnd-horizontal"></p>'].join(""),target:function(t){var o=t.scenarioContext.get("step_EntityId"),a=".i-role-grid .i-role-card[data-entity-id="+o+"]",s='.i-role-header .i-role-cellholder:contains("In Progress")',i=e(s),l=i.data("x"),c='.i-role-grid .i-role-cellholder[data-x="'+l+'"]';t.scenarioContext.set("inProgressCellHolderSelector",c);var d=e(c);return n(d,"Drop the card to this column"),r(a)},complete:function(e){o.hideTooltipOnCardDnD(e);var t=e.step.scenarioContext.get("step_EntityId"),n=e.step.scenarioContext.get("inProgressCellHolderSelector");return r(n+" .i-role-card[data-entity-id="+t+"]",e),e},teardown:function(t){var o=t.step.scenarioContext.get("inProgressCellHolderSelector"),r=e(o);a(r)}}]},o.flowUserGuide];return i});