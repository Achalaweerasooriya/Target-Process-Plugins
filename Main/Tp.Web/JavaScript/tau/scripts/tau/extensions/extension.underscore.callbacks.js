define(["libs/underscore"],function(n){var r=function(){this._subscriptions=[]};return r.prototype={_subscriptions:null,add:function(n,r){var e=this._findHandlerIndex(n,r);return 0>e&&this._subscriptions.push({handler:n,scope:r}),this},once:function(n,r){var e=this._findHandlerIndex(n,r);return 0>e&&this._subscriptions.push({handler:function(n,r,e){n.call(r,e),this._removeHandler(n,r)}.bind(this,n,r),originalHandler:n,scope:r}),this},fire:function(r){if(this._subscriptions.length){var e=this._subscriptions.slice();r=n.toArray(arguments);for(var t=0,i=e.length;i>t;t++){var o=e[t];o.handler.apply(o.scope,r)}}return this},remove:function(r,e){return n.isFunction(r)?this._removeHandler(r,e):(e=r,this._removeScope(e)),this},removeAll:function(){return this._subscriptions=[],this},_findHandlerIndex:function(r,e){return n.findIndex(this._subscriptions,function(n){return n.scope===e&&(n.handler===r||n.originalHandler===r)})},_removeHandler:function(n,r){var e=this._findHandlerIndex(n,r);e>=0&&this._subscriptions.splice(e,1)},_removeScope:function(r){for(var e in r)n.isFunction(r[e])&&this._removeHandler(r[e],r)}},r.prototype.empty=r.prototype.removeAll,r.prototype.on=r.prototype.add,r.prototype.one=r.prototype.once,r.prototype.off=r.prototype.remove,r.prototype.trigger=r.prototype.fire,n.mixin({Callbacks:function(){return new r}}),n});