define(["libs/underscore"],function(t){var r=function(){this._subscriptions=[],this._bufferEntries=0,this._bufferArguments=null};return r.prototype={_subscriptions:null,add:function(t,r){var e=this._findHandlerIndex(t,r);return 0>e&&this._subscriptions.push({handler:t,scope:r}),this},once:function(t,r){var e=this._findHandlerIndex(t,r);return 0>e&&this._subscriptions.push({handler:function(t,r,e){t.call(r,e),this._removeHandler(t,r)}.bind(this,t,r),originalHandler:t,scope:r}),this},fire:function(r){if(this._subscriptions.length){if(r=t.toArray(arguments),this._bufferEntries>0)return this._bufferArguments=r,this;for(var e=this._subscriptions.slice(),n=0,i=e.length;i>n;n++){var s=e[n];s.handler.apply(s.scope,r)}}return this},remove:function(r,e){return t.isFunction(r)?this._removeHandler(r,e):(e=r,this._removeScope(e)),this},removeAll:function(){return this._subscriptions=[],this},buffer:function(t,r){this._bufferEntries++;try{return t.call(r)}finally{this._bufferEntries--,0===this._bufferEntries&&(this.fire.apply(this,this._bufferArguments),this._bufferArguments=null)}},_findHandlerIndex:function(r,e){return t.findIndex(this._subscriptions,function(t){return t.scope===e&&(t.handler===r||t.originalHandler===r)})},_removeHandler:function(t,r){var e=this._findHandlerIndex(t,r);e>=0&&this._subscriptions.splice(e,1)},_removeScope:function(r){this._subscriptions=t.reject(this._subscriptions,function(t){return t.scope===r})}},r.prototype.empty=r.prototype.removeAll,r.prototype.on=r.prototype.add,r.prototype.one=r.prototype.once,r.prototype.off=r.prototype.remove,r.prototype.trigger=r.prototype.fire,t.mixin({Callbacks:function(){return new r}}),t});