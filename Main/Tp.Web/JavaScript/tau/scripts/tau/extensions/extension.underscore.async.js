define(["libs/underscore"],function(_){var exports={},a=Object.keys||function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},b=function(a,b){var c=Array.prototype[a];return function(d,e,f){var g=d?d[a]:0;return g&&g===c?g.call(d,e,f):b(d,e,f)}},c=b("forEach",function(b,c){var d=b instanceof Object,e=d?a(b):b||[];for(var f=0,g=e.length;f<g;f++){var h=d?e[f]:f;c(b[h],h,b)}}),d=function(b,d,e){var f=b.length||a(b).length;if(!f)return e();var g=0;c(b,function(){var a=function(a){a?(e(a),e=function(){}):++g===f&&e()},b=Array.prototype.slice.call(arguments);d.length?(b=b.slice(0,d.length-1),b[d.length-1]=a):b.push(a),d.apply(this,b)})},e=function(b,c,d){var e=a(b);if(!e.length)return d();var f=0,g=function(){var a=e[f],h=[b[a],a,b].slice(0,c.length-1);h[c.length-1]=function(a){a?(d(a),d=function(){}):++f===e.length?d():g()},c.apply(this,h)};g()},f=b("map",function(a,b){var d=[];return c(a,function(a,c,e){d[d.length]=b(a,c,e)}),d}),g=function(a){return function(b,c,d){var e=[];a(b,function(a,b,d,f){var g=function(a,b){e[e.length]=b,f(a)},h=[a,b,d];c.length?(h=h.slice(0,c.length-1),h[c.length-1]=g):h.push(g),c.apply(this,h)},function(a){d(a,e)})}},h=b("filter",function(a,b,d){var e=[];return c(a,function(a,c,d){b(a,c,d)&&(e[e.length]=a)}),e}),i=function(a,b,c){var e=[];d(a,function(a,c,d,f){var g=function(b,c){c&&(e[e.length]=a),f(b)},h=[a,c,d];b.length?(h=h.slice(0,b.length-1),h[b.length-1]=g):h.push(g),b.apply(this,h)},function(a){c(a,e)})},j=b("reduce",function(a,b,d){return c(a,function(a,c,e){d=b(d,a,c,e)}),d}),k=function(a,b,c,d){e(a,function(a,d,e,f){var g=function(a,b){c=b,f(a)},h=[c,a,d,e];b.length?(h=h.slice(0,b.length-1),h[b.length-1]=g):h.push(g),b.apply(this,h)},function(a){d(a,c)})};exports.each=function(a,b,e){return(e?d:c)(a,b,e)},exports.map=function(a,b,c){return(c?g(d):f)(a,b,c)},exports.filter=function(a,b,c){return(c?i:h)(a,b,c)},exports.reduce=function(a,b,c,d){return(d?k:j)(a,b,c,d)},exports.parallel=function(a,b){var c=new a.constructor;d(a,function(a,b,d){a(function(a){var e=Array.prototype.slice.call(arguments,1);c[b]=e.length<=1?e[0]:e,d(a)})},function(a){(b||function(){})(a,c)})},exports.series=function(a,b){var c=new a.constructor;e(a,function(a,b,d){a(function(a,e){var f=Array.prototype.slice.call(arguments,1);c[b]=f.length<=1?f[0]:f,d(a)})},function(a){(b||function(){})(a,c)})},_.mixin({parallel:exports.parallel,series:exports.series})})