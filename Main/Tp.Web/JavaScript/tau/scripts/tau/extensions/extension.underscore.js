define(["Underscore","libs/jsonselect"],function(a){a.mixin({keysExt:function(b){if(a.isArray(b))return a.keys(b);var c=[];for(var d in b)c.push(d);return c},findComplexField:function(b,c){var d=null,e=this;a.each(b,function(a){if(!e.isSimple(a)){if(!a.hasOwnProperty(c))return;d=a}});return d},getFieldName:function(b){if(this.isSimple(b))return b;var c=a.select(a.keys(b),function(a){return a!=="list"});if(c.length>1||c.length===0)throw"Only one reference or list should be defined";return c[0]},isSimple:function(b){return a.isString(b)},mergeFields:function(b,c,d){var e=this,f=d&&d.prependFields?"unshift":"push";a.each(c,function(c){if(b!==c){if(e.isSimple(c)){var d=a.select(b,function(a){return a===c});d.length===0&&b[f](c);return}var g=e.getFieldName(c),h=e.findComplexField(b,g);if(h===null){b[f](c);return}var i=c[g],j=h[g];e.mergeFields(j,i)}})},mergeArrayObjects:function(b,c,d){a.each(a(b).keys(),function(e){if(!!a.isArray(b[e])){if(!a.isArray(c[e]))return;if(d&&a.isArray(d)&&a(d).indexOf(e)<0)return;b[e]=b[e].concat(c[e])}})},functionsExt:function(b){return a.filter(a.keysExt(b),function(c){return a.isFunction(b[c])}).sort()},groupBy:function(b,c){var d=[],e={};a(b).each(function(a){var b=c(a);if(!e.hasOwnProperty(b)){var f={key:b,items:[]};d.push(f),e[b]=f}e[b].items.push(a)});return d},complexKey:function(b,c){var d=undefined,e=c.split(".");if(e.length===1)return b[c];a.forEach(e,function(c){d=b=b[c];if(a.isUndefined(d)===!0)return!1});return d},jsonSelect:function(a,b){return JSONSelect.match(b,a)}}),a.MIN_INT=-9007199254740992,a.MAX_INT=-a.MIN_INT;return a})