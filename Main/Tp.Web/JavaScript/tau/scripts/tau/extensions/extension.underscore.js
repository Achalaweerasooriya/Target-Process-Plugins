define(["libs/underscore","libs/jsonselect"],function(_){return _.mixin({keysExt:function(a){if(_.isArray(a))return _.keys(a);var b=[];for(var c in a)b.push(c);return b},findComplexField:function(a,b){var c=null,d=this;return _.each(a,function(a){if(d.isSimple(a))return;if(!a.hasOwnProperty(b))return;c=a}),c},concat:function(a){return _.flatten(_.compact(a))},getFieldName:function(a){if(this.isSimple(a))return a;var b=_.select(_.keys(a),function(a){return a!=="list"});if(b.length>1||b.length===0)throw"Only one reference or list should be defined";return b[0]},isSimple:function(a){return _.isString(a)},mergeFields:function(a,b,c){var d=this,e=c&&c.prependFields?"unshift":"push";return _.each(b,function(b){if(a===b)return;if(d.isSimple(b)){var c=_.select(a,function(a){return a===b});c.length===0&&a[e](b);return}var f=d.getFieldName(b),g=d.findComplexField(a,f);if(g===null){a[e](b);return}var h=b[f],i=g[f];d.mergeFields(i,h)}),a},mergeArrayObjects:function(a,b,c){_.each(_(a).keys(),function(d){if(!_.isArray(a[d]))return;if(!_.isArray(b[d]))return;if(c&&_.isArray(c)&&_(c).indexOf(d)<0)return;a[d]=a[d].concat(b[d])})},functionsExt:function(a){return _.filter(_.keysExt(a),function(b){return _.isFunction(a[b])}).sort()},groupBy:function(a,b){var c=[],d={};return _(a).each(function(a){var e=b(a);if(!d.hasOwnProperty(e)){var f={key:e,items:[]};c.push(f),d[e]=f}d[e].items.push(a)}),c},complexKey:function(a,b){var c=undefined,d=b.split(".");return d.length===1?a[b]:(_.forEach(d,function(b){c=a=a[b];if(_.isUndefined(c)===!0)return!1}),c)},jsonSelect:function(a,b){return JSONSelect.match(b,a)},inArray:function(a,b){return _.indexOf(b,a)>-1},toString:function(a){return(new String(a||"")).toString()}}),_.MIN_INT=-9007199254740992,_.MAX_INT=-_.MIN_INT,_})