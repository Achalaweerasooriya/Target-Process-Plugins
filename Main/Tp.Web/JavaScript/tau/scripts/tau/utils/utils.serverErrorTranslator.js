define(["Underscore","jQuery"],function(e,r){function t(e,t,n){var o=r("<span>"+t.join(" ")+"</span>");if(e.loggedUser.isAdministrator){var s=e.getTp2Service();o.on("click","a",function(){s.showPopupToChangeProcessWorkflow(e,r(this),n.EntityType,n.Process.Id)})}return o}var n=[{name:"StateIsNotAllowedByWorkflowException",isMatch:function(r){return/BadRequestException$/i.test(r.Type)&&(e.isObject(r.Error)&&/StateIsNotAllowedByWorkflowException/i.test(r.Error.Type)||e.isObject(r.InnerException)&&/StateIsNotAllowedByWorkflowException/i.test(r.InnerException.Type))},buildError:function(e){var r=this.config.context.configurator,n=e.InnerException||e.Error,o=n.Details,s=["Possible transitions are:",o.StateName,"&rarr;",o.NextStates.join(", ")+"."];r.loggedUser.isAdministrator&&s.push("You can edit the workflow for",'<a href="#">'+o.Process.Name+"</a> process.");var i=t(r,s,o);return{message:e.Message,details:i}}},{name:"NotWellFormedLangExpressionException",isMatch:function(r){return/BadRequestException$/i.test(r.Type)&&(e.isObject(r.Error)&&/NotWellFormedLangExpressionException$/i.test(r.Error.Type)||e.isObject(r.InnerException)&&/NotWellFormedLangExpressionException$/i.test(r.InnerException.Type))},buildError:function(e){var r=e.InnerException||e.Error,t=r.Details,n=e.Message,o=t.Message;return{message:n,details:o}}},{name:"General HttpException",isMatch:function(r){return/\.HttpException$/i.test(r.Type)&&(e.isObject(r.InnerException)&&r.InnerException.Message||e.isObject(r.Error)&&r.Error.Message)},buildError:function(e){var r=e.InnerException||e.Error;return{message:e.Message,details:r.Message}}},{name:"NoStatesDefinedInProcessException",isMatch:function(r){return/BadRequestException$/i.test(r.Type)&&(e.isObject(r.InnerException)&&/NoStatesDefinedInProcessException/i.test(r.InnerException.Type)||e.isObject(r.Error)&&/NoStatesDefinedInProcessException/i.test(r.Error.Type))},buildError:function(e){var r=this.config.context.configurator,n=e.InnerException||e.Error,o=n.Details,s=[];r.loggedUser.isAdministrator&&s.push("You can add",o.StateDescription,"manually to the",o.EntityName,"workflow.","Edit the workflow for",'<a href="#">'+o.Process.Name+"</a> process.");var i=t(r,s,o);return{message:e.Message,details:i}}},{name:"HttpError",isMatch:function(r){return r.data?e.has(r.data,"response"):!1},buildError:function(e){return o.buildError(e.data.response)}}],o={name:"default",buildError:function(r){if(!r)return{};var t=r.message||"Looks like application is not available. Please check your connection or server availability";t=e.isObject(r)&&e.isString(r.Message)?r.Message:t;var n=e.isObject(r.InnerException)&&e.isString(r.InnerException.Details)?r.InnerException.Details:e.isObject(r.Error)&&e.isString(r.Error.Details)?r.Error.Details:void 0;return{message:t,details:n}}};return{translateServerError:function(r){var t=e.find(n,function(e){return e.isMatch(r)})||o;return t.buildError.call(this,r)},translateXhrError:function(e){var t;try{t=r.parseJSON(e.responseText)}catch(n){t={message:e.statusText}}return this.translateServerError(t)}}});