define(["Underscore","jQuery"],function(e,r){function t(e,t,n){var s=r("<span>"+t.join(" ")+"</span>");return e.loggedUser.isAdministrator&&s.on("click","a",function(){e.getWorkflowService().editProcessWorkflow(e,r(this),[n.EntityType],n.Process.Id)}),s}var n=[{name:"StateIsNotAllowedByWorkflowException",isMatch:function(r){return/BadRequestException$/i.test(r.Type)&&(e.isObject(r.Error)&&/StateIsNotAllowedByWorkflowException/i.test(r.Error.Type)||e.isObject(r.InnerException)&&/StateIsNotAllowedByWorkflowException/i.test(r.InnerException.Type))},buildError:function(e){var r=this.config.context.configurator,n=e.InnerException||e.Error,s=n.Details,i=["Possible transitions are:",s.StateName,"&rarr;",s.NextStates.join(", ")+"."];r.loggedUser.isAdministrator&&i.push("You can edit the workflow for",'<a href="#">'+s.Process.Name+"</a> process.");var o=t(r,i,s);return{message:e.Message,details:o}}},{name:"NotWellFormedLangExpressionException",isMatch:function(r){return/BadRequestException$/i.test(r.Type)&&(e.isObject(r.Error)&&/NotWellFormedLangExpressionException$/i.test(r.Error.Type)||e.isObject(r.InnerException)&&/NotWellFormedLangExpressionException$/i.test(r.InnerException.Type))},buildError:function(e){var r=e.InnerException||e.Error,t=r.Details,n=e.Message,s=t.Message;return{message:n,details:s}}},{name:"General HttpException",isMatch:function(r){return/\.HttpException$/i.test(r.Type)&&(e.isObject(r.InnerException)&&r.InnerException.Message||e.isObject(r.Error)&&r.Error.Message)},buildError:function(e){var r=e.InnerException||e.Error;return{message:e.Message,details:r.Message}}},{name:"NoStatesDefinedInProcessException",isMatch:function(r){return/BadRequestException$/i.test(r.Type)&&(e.isObject(r.InnerException)&&/NoStatesDefinedInProcessException/i.test(r.InnerException.Type)||e.isObject(r.Error)&&/NoStatesDefinedInProcessException/i.test(r.Error.Type))},buildError:function(e){var r=this.config.context.configurator,n=e.InnerException||e.Error,s=n.Details,i=[];r.loggedUser.isAdministrator&&i.push("You can add",s.StateDescription,"manually in",'<a href="#">'+s.Process.Name+" process</a>.");
var o=t(r,i,s);return{message:e.Message,details:o}}},{name:"HttpError",isMatch:function(r){return r.data?e.has(r.data,"response"):!1},buildError:function(e){return s.buildError(e.data.response)}}],s={name:"default",buildError:function(r){if(!r)return{};var t=r.message||"Looks like application is not available. Please check your connection or server availability";t=e.isObject(r)&&e.isString(r.Message)?r.Message:t;var n=e.isObject(r.InnerException)&&e.isString(r.InnerException.Details)?r.InnerException.Details:e.isObject(r.Error)&&e.isString(r.Error.Details)?r.Error.Details:void 0;return{message:t,details:n}}};return{translateServerError:function(r){var t=e.find(n,function(e){return e.isMatch(r)})||s;return t.buildError.call(this,r)},parseXhrError:function(e){try{return r.parseJSON(e.responseText)}catch(t){return{message:e.statusText}}},translateXhrError:function(e){var r=this.parseXhrError(e);return this.translateServerError(r)}}});