define(["Underscore","tau/core/class"],function(_,Class){var converter=Class.extend({convert:function(text,escapeHtml){var html=text;if(escapeHtml===!0){var $node=$("<span></span>"),lines=html.split(/\r\n|\r|\n/);for(var i=0;i<lines.length;i++)lines[i]=$node.text(lines[i]).html();html=lines.join("\r\n")}return html=html.replace(/([^\r])\n/gi,"$1<br />\n"),html=html.replace(/\r\n/gi,"<br />\r\n"),html=html.replace(/  /gi,"&nbsp;&nbsp;"),html=html.replace(/&nbsp; /gi,"&nbsp;&nbsp;"),html}});return converter})