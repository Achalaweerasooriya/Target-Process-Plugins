define(["Underscore","tau/core/class","tau/core/event"],function(_,Class,Event){var History=Class.extend({init:function(){this.stack=[],this.current=null},size:function(){return this.stack.length},push:function(obj){var item=obj;return item.index=this.stack.length,this.stack.push(item),this},pop:function(){var item=this.stack.pop();return item},rewindTo:function(index){var length=this.stack.length;for(var i=length-1;i>=0;i--){var item=this.stack[i];item.index>index&&this.stack.pop()}return this.fire("changed"),this},setCurrent:function(obj){this.current=obj,this.fire("setCurrent")},getCurrent:function(){return this.current},process:function(){this.current&&this.stack.push(_.clone(this.current)),this.current=null},updateCurrent:function(data){this.current&&(this.current.url=data.url||this.current.url,this.current.title=data.title||this.current.title,this.current.id=data.id||this.current.id,this.fire("setCurrent"))},exclude:function(id,fire){this.stack=_.reject(this.stack,function(item,i){return item.id&&item.id==id}),this.current&&this.current.id==id&&(this.current=null),fire!==!1&&this.fire("changed")},reset:function(){this.current=null,this.stack=[]}});return Event.implementOn(History.prototype),History})