define(["Underscore","tau/core/class","tau/core/event"],function(t,r,n){var i=r.extend({init:function(){this.stack=[],this.current=null},size:function(){return this.stack.length},push:function(t){return this.stack.push(t),this},pop:function(){return this.stack.pop()},setCurrent:function(t){this.current=t,this.fire("setCurrent")},getCurrent:function(){return this.current},process:function(){this.current&&(this.stack=this.getFlatStack(),this.stack.push(t.clone(this.current))),this.current=null},updateCurrent:function(t){this.current&&(this.current.url=t.url||this.current.url,this.current.title=t.title||this.current.title,this.current.id=t.id||this.current.id,this.fire("setCurrent"))},exclude:function(r,n){this.stack=t.reject(this.stack,function(t){return t.id&&t.id==r}),this.current&&this.current.id==r&&(this.current=null),n!==!1&&this.fire("changed")},getFlatStack:function(){var r=this.stack,n=r;if(this.current){var i=t.find(n,t.bind(function(t){return t.id&&t.id===this.current.id},this));i&&(n=r.slice(0,t.indexOf(n,i)))}return n},reset:function(){this.current=null,this.stack=[]}});return n.implementOn(i.prototype),i});