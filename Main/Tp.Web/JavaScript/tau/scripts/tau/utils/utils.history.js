define(["Underscore","tau/core/class","tau/core/event","order!libs/crossroads.js/dist/js-signals","order!libs/crossroads.js/dist/crossroads"],function(_,a,b){var c=a.extend({init:function(){this.stack=[],this.current=null},size:function(){return this.stack.length},push:function(a){var b=a;return b.index=this.stack.length,this.stack.push(b),this},pop:function(){var a=this.stack.pop();return a},rewindTo:function(a){var b=this.stack.length;for(var c=b-1;c>=0;c--){var d=this.stack[c];d.index>a&&this.stack.pop()}return this.fire("changed"),this},setCurrent:function(a){this.current=a,this.fire("setCurrent")},getCurrent:function(){return this.current},process:function(){this.current&&this.stack.push(_.clone(this.current)),this.current=null},updateCurrent:function(a){this.current&&(this.current.url=a.url||this.current.url,this.current.title=a.title||this.current.title,this.current.id=a.id||this.current.id,this.fire("setCurrent"))},exclude:function(a,b){this.stack=_.reject(this.stack,function(b,c){return b.id&&b.id==a}),this.current.id==a&&(this.current=null),b!==!1&&this.fire("changed")}});return b.implementOn(c.prototype),c})