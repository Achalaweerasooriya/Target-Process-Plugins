define(["Underscore","tau/core/class"],function(_,Class){var Creator=Class.extend({init:function(loaderService){this.loaderService=loaderService||window.require},create:function(schema,options){_.defaults(options,{onCreateComponentsBefore:function(components,configs){},onCreateComponentBefore:function(component,config){},onCreateComponentAfter:function(componentBus,config){},onCreateComponentsAfter:function(componentBuses,configs){}}),schema=_.isArray(schema)?schema:[schema];var dependencies=this._getDependencies(schema),callback=this._createCallback(schema,options);dependencies.length?this.loaderService(dependencies,callback):callback()},_getDependencies:function(schemas){var dependencies=[];return _.forEach(schemas,function(schema){if(schema.path)dependencies.push(schema.path);else{if(!schema.type)throw"Configuration error: type or path is missing";var path="tau/components/component."+schema.type;dependencies.push(path)}}),dependencies},_createCallback:function(schemas,options){var cb=function(){var components=_.toArray(arguments);options.onCreateComponentsBefore(components,schemas);var buses=[];_.forEach(schemas,function(schema,index){var component=components[index],config=schema;options.onCreateComponentBefore(component,config);var componentBus=component.create(config);options.onCreateComponentAfter(componentBus),buses[index]=componentBus}),options.onCreateComponentsAfter(buses,schemas)};return cb}});return Creator})