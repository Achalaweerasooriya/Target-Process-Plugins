define(["tau/configurator","Underscore"],function(a,_){return{fromSourceToHtml:function(b){var c=a.getApplicationPath()+"/",d=b||"",e=/(?:<img(?=\s)(?:[^>"']|"[^"]*"|'[^']*')*?\s)src\s*=\s*("~\/([^"]*)"|'~\/([^']*)')(?:[^>]*>)/gi;d=d.replace(e,function(a,b,d,e){var f=d||e,g=b[0];return a.replace(b,function(){return g+c+f+g})});var f=/<[^<]+?>/g,g=[],h;while((h=f.exec(d))!=null)g.push({left:h.index,right:h.index+h[0].length});return d.replace(/\w[\xa0]+\w/g,function(a,b){return _.find(g,function(a){return a.left<=b&&a.right>=b})?a:a.replace(/[\xa0]/g," ")})},fromHtmlToSource:function(b){var c=a.getApplicationPath(),d=b||"",e='(?:<img(?=\\s)(?:[^>"\']|"[^"]*"|\'[^\']*\')*?\\s)src\\s*=\\s*("'+c+'/([^"]*)"|\''+c+"/([^']*)')(?:[^>]*>)",f=new RegExp(e,"gi");return d=d.replace(f,function(a,b,c,d){var e=c||d,f=b[0];return a.replace(b,function(){return f+"~/"+e+f})}),d}}})