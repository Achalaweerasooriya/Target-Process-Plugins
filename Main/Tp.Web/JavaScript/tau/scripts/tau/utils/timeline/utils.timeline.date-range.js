define(["Underscore","tau/utils/utils.date","libs/date.js/build/date","tau/utils/utils.date/utils.date.formats","tau/utils/timeline/utils.timeline.date"],function(t,e,a,n,i){var r="—",s=function(t){return t?t.getTime():0},d=function(t){return t?new a(t):null},u=function(t,e){this.startDate=t,this.endDate=e,this.isValid=!0,this.invalidString=null};u.prototype={errorMessage:function(){return"Invalid date range"},equals:function(t){return s(this.startDate)===s(t.startDate)&&s(this.endDate)===s(t.endDate)},toString:function(){if(!this.isValid)return this.invalidString;var t=this.startDate?e.format.date.short(this.startDate):"*";return t+=" "+r+" ",t+=this.endDate?e.format.date.short(this.endDate):"*"},toISOString:function(){if(!this.isValid)return this.invalidString;var t=this.startDate?e.format.date.iso(this.startDate):"*";return t+=" "+r+" ",t+=this.endDate?e.format.date.iso(this.endDate):"*"},toFullISOString:function(){if(!this.isValid)return this.invalidString;var t=this.startDate?e.format.datetime.iso(this.startDate):"*";return t+=" "+r+" ",t+=this.endDate?e.format.datetime.iso(this.endDate):"*"},toJSON:function(){return this.isValid?{startDate:e.format.datetime.iso(this.startDate),endDate:e.format.datetime.iso(this.endDate)}:null},setStartDate:function(t){return new u(t,this.endDate)},setEndDate:function(t){return new u(this.startDate,t)},getDurationInTicks:function(){return this.endDate-this.startDate},getDurationInDays:function(){return this.startDate||this.endDate?e.getDiffInDays(this.endDate,this.startDate):Number.POSITIVE_INFINITY},scale:function(t){var e=this.startDate.clone(),n=new a(this.startDate+this.getDurationInTicks()*t);return new u(e,n)},intersects:function(t){return t.startDate&&t.startDate.valueOf()>=this.endDate.valueOf()?!1:t.endDate&&t.endDate.valueOf()<=this.startDate.valueOf()?!1:!0}};var o=function(){this.startDate=null,this.endDate=null,this.isValid=!1};return o.prototype=u.prototype,u.tryParse=function(e,i){if(e=t.trim(e),0===e.length)return u.createEmptyRange();i=i||[n.datetime.iso,n.datetime.short];var r=e.split(/ [—-] /),s=function(e,n){var i=null;return t.find(n,function(t){return i=a.parseExact(e,t),null!==i}),i},d=r[0]?s(r[0],i):null,o=r[1]?s(r[1],i):null;return null===d||r[1]?null===d||null===o||d.getTime()>o.getTime()?u.createInvalidRange(e):new u(d,o):u.createEmptyRange()},u.tryParseWithRoundedDays=function(t,e){var a=this.tryParse(t,e||[n.date.short,n.date.iso]);return!a.isValid||a.isEmpty?a:u.createWithRoundedDays(a.startDate,a.endDate)},u.createInvalidRange=function(t){var e=new u(null,null);return e.isValid=!1,e.invalidString=t,e},u.createEmptyRange=function(){return new o},u.createWithRoundedDays=function(t,e){return new u(d(t),new a(e).clone().clearTime().addDays(1).addMilliseconds(-1))},u.createDefault=function(){return u.createWithRoundedDays(i.getToday().addMonths(-1),i.getToday().addDays(2))},u.createLastWeek=function(){return u.createWithRoundedDays(i.getToday().addDays(-7).moveToDayOfWeek(0,-1),i.getToday().addDays(-7).moveToDayOfWeek(6,1))},u.createLastThirtyDays=function(){return u.createWithRoundedDays(i.getToday().addDays(-30),i.getToday())},u.createLastThreeMonths=function(){return u.createWithRoundedDays(i.getToday().addMonths(-3),i.getToday())},u.createLastYear=function(){return u.createWithRoundedDays(i.getToday().addYears(-1),i.getToday())},u});