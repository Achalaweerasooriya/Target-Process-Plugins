define(["Underscore","tau/configurator","tau/utils/utils.date/utils.date.formats","tau/utils/utils.translation","libs/date.js/build/date","libs/date.js/build/time.special"],function(_,a,b,c){var d={};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getDate(),this.getMonth())};var e=function(a){return function(b){var c=d.parse(b);return c?d._format(c,a):""}};return d={serverTimezoneOffset:-1*(new Date).getTimezoneOffset(),format:{date:{"short":e(b.date.short)},time:{"short":e(b.time.short)},datetime:{"short":e(b.datetime.short)}},_format:function(a,b){return a.toString(b)||""},formatAs:function(a,b){return this._format(a,b)},parse:function(a){if(_.isString(a)&&/^\/Date\(/.test(a)){var b=a.match(/^\/Date\((-?\d+)(([+-])(\d{2})(\d{2}))\)\//),c=parseInt(b[1]),e=(parseInt(b[4])*60+parseInt(b[5]))*parseInt(b[3]+"1");a=new Date(c),a.sourceOffset=e,d.serverTimezoneOffset=e}return Date.parse(a)},convertToTimezone:function(a,b){a=d.parse(a);if(!a)return a;b||(b=a.sourceOffset||null);if(!b)return a;var c=(new Date).getTimezoneOffset(),e=b+c;return a=new Date(a.getTime()+e*60*1e3),a},getFormatData:function(){return b},getAge:function(b,d){d=d||a.getCurrentDate(),b=Date.parse(b);var e={isZero:!0,value:0,unit:"sec",direction:"ago",toString:function(){var a;return this.isZero?a="now":a=this.value+" "+this.unit+" "+this.direction,a}};e.direction=d>b?"ago":"after";var f=new TimePeriod(b,d,function(a){return a===1?1:a<1?0:Math.ceil(a)}),g=[{func:"years",units:"year|years"},{func:"months",units:"month|months"},{func:"days",units:"day|days"},{func:"hours",units:"hour|hours"},{func:"minutes",units:"min"},{func:"seconds",units:"sec"}],h=_.detect(g,function(a,b){var d=f[a.func];if(d!==0)return a.value=Math.abs(d),a.unit=c.pluralize(a.units,d),!0});return h&&(e.isZero=!1,e.value=h.value,e.unit=h.unit),e}},d})