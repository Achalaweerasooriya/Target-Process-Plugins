define(["Underscore","tau/configurator","tau/utils/utils.date/utils.date.formats","tau/utils/utils.translation","libs/date.js/build/date","libs/date.js/build/time.special"],function(_,configurator,formatData,Translation){var util={};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getDate(),this.getMonth())};var f=function(a){return function(b){var c=util.parse(b);return c?util._format(c,a):""}};return util={format:{date:{"short":f(formatData.date.short)},time:{"short":f(formatData.time.short)},datetime:{"short":f(formatData.datetime.short)}},_format:function(a,b){return a.toString(b)||""},formatAs:function(a,b){return this._format(a,b)},parse:function(dateString){return _.isString(dateString)&&/^\/Date\(/.test(dateString)&&(dateString=eval(["new ",dateString.replace(/\//gi,"")].join(""))),Date.parse(dateString)},getFormatData:function(){return formatData},getAge:function(a,b){b=b||configurator.getCurrentDate(),a=Date.parse(a);var c={isZero:!0,value:0,unit:"sec",direction:"ago",toString:function(){var a;return this.isZero?a="now":a=this.value+" "+this.unit+" "+this.direction,a}};c.direction=b>a?"ago":"after";var d=new TimePeriod(a,b,function(a){return a===1?1:a<1?0:Math.ceil(a)}),e=[{func:"years",units:"year|years"},{func:"months",units:"month|months"},{func:"days",units:"day|days"},{func:"hours",units:"hour|hours"},{func:"minutes",units:"min"},{func:"seconds",units:"sec"}],f=_.detect(e,function(a,b){var c=d[a.func];if(c!==0)return a.value=Math.abs(c),a.unit=Translation.pluralize(a.units,c),!0});return f&&(c.isZero=!1,c.value=f.value,c.unit=f.unit),c}},util})