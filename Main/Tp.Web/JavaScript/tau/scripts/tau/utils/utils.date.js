define(["Underscore","tau/configurator","tau/utils/utils.date/utils.date.formats","tau/utils/utils.translation","libs/date.js/build/date"],function(_,configurator,formatData,Translation){var util={},f=function(a){return function(b){var c=util.parse(b);return c?util._format(c,a):""}};return util={format:{date:{"short":f(formatData.date.short)},time:{"short":f(formatData.time.short)},datetime:{"short":f(formatData.datetime.short)}},_format:function(a,b){return a.toString(b)||""},formatAs:function(a,b){return this._format(a,b)},parse:function(dateString){return _.isString(dateString)&&/^\/Date\(/.test(dateString)&&(dateString=eval(["new ",dateString.replace(/\//gi,"")].join(""))),Date.parse(dateString)},getFormatData:function(){return formatData},getAge:function(a,b){b=b||configurator.getCurrentDate(),a=Date.parse(a);var c={isZero:!0,value:0,unit:"sec",direction:"ago",toString:function(){var a;return this.isZero?a="now":a=this.value+" "+this.unit+" "+this.direction,a}};c.direction=b>a?"ago":"after";var d=new Date(0),e=new Date(b>a?b-a:a-b),f=[{func:"getYear",units:"year|years"},{func:"getMonth",units:"month|months"},{func:"getDate",units:"day|days"},{func:"getHours",units:"hour|hours"},{func:"getMinutes",units:"min"},{func:"getSeconds",units:"sec"}],g=_.detect(f,function(a){var b=e[a.func]()-d[a.func]();if(b>0)return a.value=b,a.unit=Translation.pluralize(a.units,b),!0});return g&&(c.isZero=!1,c.value=g.value,c.unit=g.unit),c}},util})