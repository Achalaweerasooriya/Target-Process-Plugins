define(["Underscore","tau/utils/utils.date/utils.date.wrapper","tau/utils/utils.date/utils.date.formats","tau/utils/utils.translation","libs/date.js/build/time.special"],function(t,e,n,i,r){var u={},s="/Date",o=/^\/Date\((-?\d+)(([+-])(\d{2})(\d{2}))?\)\//i,a=function(t){return function(e){var n=u.parse(e);return n?u._format(n,t):""}};return u={Date:e,minimalDate:new e(-621355968e5),format:{date:{"short":a(n.date.short),iso:a(n.date.iso)},time:{"short":a(n.time.short),iso:a(n.time.iso)},datetime:{"short":a(n.datetime.short),full:a(n.datetime.full),iso:a(n.datetime.iso)}},_format:function(t,e){return t.toString(e)||""},formatAs:function(t,n){return t instanceof e||(t=new e(t)),this._format(t,n)},isMinimalDate:function(e){return t.isString(e)&&(e=this.parse(e)),null!==e&&e.getTime()==this.minimalDate.getTime()},_getServerTimezonOffset:function(){var t=window.tauServerInfo||{timeZoneOffsetInMilliseconds:0};return t.timeZoneOffsetInMilliseconds},_convertToServerTime:function(t){return new e(t.getTime()-this._getServerTimezonOffset())},getServerNow:function(){return this.__now||this._convertToServerTime(new e)},lockNow:function(t){this.__now=new e(t)},unlockNow:function(){this.__now=null},parse:function(t){if(u.isTimestamp(t)){var n=t.match(o),i=parseInt(n[1]),r=(60*parseInt(n[4])+parseInt(n[5]))*parseInt(n[3]+"1");t=new e(i),t.sourceOffset=r}return e.parse(t)},convertToTimezone:function(t,n){if(t=u.parse(t),!t)return t;if(!n){var i=t.sourceOffset;n=null!==i&&void 0!==i?i:null}if(null===n||void 0===n)return t;var r=t.getTimezoneOffset(),s=60*(n+r)*1e3;return t=new e(t.getTime()+s)},getFormatData:function(){return n},getAge:function(n,u){n=e.parse(n),u=e.parse(u);var s={isZero:!0,value:0,unit:"sec",direction:u>n?"ago":"after",toString:function(){return this.isZero?"now":this.value+" "+this.unit+" "+this.direction}},o=new r.TimePeriod(n,u,function(t){return 1===t?1:1>t?0:Math.round(t)}),a=[{func:"years",units:"year|years"},{func:"months",units:"month|months"},{func:"days",units:"day|days"},{func:"hours",units:"hour|hours"},{func:"minutes",units:"min"},{func:"seconds",units:"sec"}],f=t.detect(a,function(t){var e=o[t.func];
return 0!==e?(t.value=Math.abs(e),t.unit=i.pluralize(t.units,e),!0):void 0});return f&&(s.isZero=!1,s.value=f.value,s.unit=f.unit),s},addDays:function(t,n){return new e(t.getTime()+864e5*n)},getDiff:function(t,e){return t-e-60*t.getTimezoneOffset()*1e3+60*e.getTimezoneOffset()*1e3},getDiffInDays:function(t,e){return Math.ceil(this.getDiff(t,e)/864e5)},getDiffInMinutes:function(t,e){return Math.ceil(this.getDiff(t,e)/6e4)},addMinutes:function(t,n){return new e(t.getTime()+6e4*n)},sameDay:function(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()},isTimestamp:function(e){return t.isString(e)&&0===e.indexOf(s)},parseTimestamp:function(t){var e=6,n=t.length-2,i=t.substring(e,n);return parseInt(i)},parseTimestampToDate:function(t){return new e(this.parseTimestamp(t))},toTimestamp:function(t){return"/Date("+t.valueOf()+"+0000)/"},between:function(t,n,i){var r=new e(t.getYear(),t.getMonth(),t.getDate()),u=new e(n.getYear(),n.getMonth(),n.getDate()),s=new e(i.getYear(),i.getMonth(),i.getDate()+1);return r>=u&&s>r},getNow:function(){return new e},trimTime:function(t){return new e(t).setHours(0,0,0,0)}}});