define(["Underscore","jQuery","tau/core/class","tau/core/event","libs/parseUri"],function(a,b,c,d,e){var f=c.extend({init:function(a){this.config=a,this.window=this.config.window||window,this.params=[];var c=this;this.hashChangeHandler=function(a){a.stopPropagation(),a.preventDefault();var b=a.hash||a.target.location.hash;c.fire("urlChanged",{url:c.parseUrl(b)})},b(this.window).bind("hashchange",this.hashChangeHandler),this.destroyHandler=function(a){c.fire("destroyed",{})},b(this.window).bind("unload",this.destroyHandler)},_extract:function(a){var b=a;if(this.config.safe==1){a="?"+a;var c=e(a);this.params=c.queryKey,b=this.params[this.config.safeParameterName]||""}return b},_generate:function(c,d){d=!!d;var e=c.url;a.isEmpty(c.states)==0&&d&&(e+="||"+JSON.stringify(c.states));var f=e;return this.config.safe==1&&(this.params[this.config.safeParameterName]=e,f=b.param(this.params)),f},parseUrl:function(a){a&&a[0]=="#"&&(a=a.slice(1));var b=this._extract(a);b=decodeURIComponent(b);var c={url:null,states:{},source:"#"+a},d=b.split("||");c.url=d[0];if(d[1])try{c.states=JSON.parse(d[1])}catch(e){}return c},generateUrl:function(a,b){return this._generate(a,b)},setUrl:function(b){var c="#";a.isObject(b)&&b.hasOwnProperty("url")&&b.hasOwnProperty("states")?c=this._generate(b,!0):a.isString(b)&&(c=b),this.window.location.hash=c},getUrl:function(){return this.parseUrl(this.window.location.hash)}});return d.implementOn(f.prototype),f})