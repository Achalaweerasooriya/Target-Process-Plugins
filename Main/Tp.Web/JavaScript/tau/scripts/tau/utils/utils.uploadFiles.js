define(["require","./utils.date","jQuery"],function(e){var t=e("./utils.date"),r=e("jQuery"),n=/<title\b[^>]*>(.*?)<\/title>/,i=function(e){var t="";return"string"==typeof e?t=e:e.jquery&&(t=e.text()),t},a=function(e){var r,n=i(e);try{r=JSON.parse(n),r=r.items||r,r=r.pop()}catch(a){}var u=t.parse(t.convertToTimezone(r[1]));return{id:r[0],uri:r[4],thumbnailUri:r[5],mimeType:r[3],name:"undefined"===r[2]?"":r[2],ownerName:r[6][1]+" "+r[6][2],date:t.format.datetime.short(u)}};return{upload:function(e){return e.submit().then(function(e){try{return a(e)}catch(t){return r.Deferred().reject("")}},function(e){var t,r=e.responseText.match(n);return t=r&&r.length>0?r[1]:"Looks like application is not available. Please check your connection or server availability"})}}});