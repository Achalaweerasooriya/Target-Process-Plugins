define(["Underscore","tau/core/class"],function(_,Class){var Textsearch=Class.extend({data:[],load:function(data){var self=this;_.forEach(data,function(item){item.normalizeData=self._normalize(item.data)}),this.data=data},_createRegex:function(query){var pattern=_.trim(query);pattern=pattern.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&"),pattern=pattern.replace(/[ ]+/g,"([-[\\]{}()*+?.,\\\\^$|#:;! ]+|\\s+|\\s+[ \\S]*?\\s+)");var regex=new RegExp(pattern,"i");return regex},_normalize:function(string){return _.trim(string)},search:function(query){var result=[],regex=this._createRegex(query);return _.forEach(this.data,function(item){var target=item.normalizeData,match=target.match(regex);if(match){var resultItem={_id:item._id,data:item.data,entry:{from:match.index,len:match[0].length}};result.push(resultItem)}}),result},match:function(text,query){var result=null,match=this._normalize(text).match(this._createRegex(query));return match&&(result={from:match.index,len:match[0].length}),result}});return Textsearch})