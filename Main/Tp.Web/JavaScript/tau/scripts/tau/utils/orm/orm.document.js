define(["./orm.reference"],function(a){var b=function(a,b){this.state="empty",this.schema=a,this._data={},this._refs={}},c=b.prototype;return c.fill=function(b,c){_.forEach(b,function(){}),this.set(name,new a(type))},c.get=function(a){return this._data[a]},c.set=function(a,b){this._data[a]=b},c.isClean=function(){return this.state==="clean"},c.isNew=function(){return this.id===null},c.save=function(){if(this.isClean()||this.isNew()==0)return!1;var a={};_.forEach(this._data,function(b,c){a[name]=b}),_.forEach(this._refs,function(b){b.save(function(c,d){b.isProcessed()==0&&(a[refName]=b.populateIds(),res.markProcessed()),next()})})},b})