define(["Underscore","tau/core/extension.base","tau/core/termProcessor"],function(e,t,i){var n=45,r=t.extend({"bus beforeInit":function(t,i){var n=i.config,r=i.config.context.configurator,a=i.config.context.entity;this.fire("configurator.ready",r),this.fire("entity.ready",a);var o=n.items,s=n.eventNamesCommon||{};e.defaults(s,{dataBind:"dataBind"});var c=s.dataBind,f=[],u=0;e.forEach(o,function(e){if("-----"===e){if(0===u)return;u=0}else++u;f.push(e)}),this.fire(c,{items:f})},"bus configurator.ready:last + beforeInit:last + entity.ready:last + menu.show.first":function(t,r,a,o,s){var c=new i(a.config.context.getTerms()),f=function(e){var t=c.getTerms(e.name);return{id:e.id,label:t.name,name:e.name,icon:t.iconSmall}},u=function(t){return e.chain(t).filter(function(e){return e.id!=n}).map(f).value()},d=a.config.items;e.findWhere(d,{roleAction:"convert"})&&r.getActionsService().getEntityTypesToConvert(o.id).done(e.bind(function(t){var i=u(t),r=e.find(t,function(e){return e.id==n});if(r){var a=f(r);a.label+="&hellip;",a.alias="convertToTask",i.push(a)}this.fire("convert.submenuData.ready",{items:i})},this));var l=o.entityType.name.toLowerCase();"request"===l&&r.getActionsService().getEntityTypesToCreateFromRequest(o.id).done(e.bind(function(t){var i=u(t),r=e.find(t,function(e){return e.id==n});if(r){var a=f(r);a.label+="&hellip;",a.alias="createTask",i.push(a)}this.fire("create.submenuData.ready",{items:i})},this)),("iteration"===l||"teamiteration"===l)&&r.getStore().get(l,{id:o.id,fields:["canBeFinished"]}).done({success:e.bind(function(e){var t=e[0].data.canBeFinished;t&&s.find(".tau-action-finish_iteration").show()},this)})}});return r});