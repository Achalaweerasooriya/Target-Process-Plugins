define(["Underscore","tau/core/extension.base","tau/core/termProcessor"],function(e,t,i){var n=45,a=t.extend({"bus beforeInit":function(t,i){var n=i.config,a=i.config.context.configurator,r=i.config.context.entity;this.fire("configurator.ready",a),this.fire("entity.ready",r);var o=n.items,s=n.eventNamesCommon||{};e.defaults(s,{dataBind:"dataBind"});var c=s.dataBind,f=[],u=0;e.forEach(o,function(e){if("-----"===e){if(0===u)return;u=0}else++u;f.push(e)}),this.fire(c,{items:f})},"bus configurator.ready:last + beforeInit:last + entity.ready:last + menu.show.first":function(t,a,r,o,s){var c=new i(r.config.context.getTerms()),f=function(e){var t=c.getTerms(e.name);return{id:e.id,label:t.name,name:e.name,className:"tau-"+e.name.toLowerCase(),icon:t.iconSmall}},u=function(t){return e.chain(t).filter(function(e){return e.id!=n}).map(f).value()},d=r.config.items;e.findWhere(d,{roleAction:"convert"})&&a.getActionsService().getEntityTypesToConvert(o.id).done(e.bind(function(t){var i=u(t),a=e.find(t,function(e){return e.id==n});if(a){var r=f(a);r.label+="&hellip;",r.alias="convertToTask",i.push(r)}this.fire("convert.submenuData.ready",{items:i})},this));var m=o.entityType.name.toLowerCase();"request"===m&&a.getActionsService().getEntityTypesToCreateFromRequest(o.id).done(e.bind(function(t){var i=u(t),a=e.find(t,function(e){return e.id==n});if(a){var r=f(a);r.label+="&hellip;",r.alias="createTask",i.push(r)}this.fire("create.submenuData.ready",{items:i})},this)),("iteration"===m||"teamiteration"===m)&&a.getStore().get(m,{id:o.id,fields:["canBeFinished"]}).done({success:e.bind(function(e){var t=e[0].data.canBeFinished;t&&s.find(".tau-action-finish_iteration").show()},this)})}});return a});