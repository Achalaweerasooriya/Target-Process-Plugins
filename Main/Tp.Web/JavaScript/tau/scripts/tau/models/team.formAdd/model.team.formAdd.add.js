define(["Underscore","tau/core/extension.base","tau/libs/inviter/inviter"],function(e,t,n){return t.extend({"bus configurator.ready:last + form.submitted":function(t,i,a){var r=this,s=i.getStore(),o={name:e.trim(a.name),icon:e.trim(e.asString(a.icon))||null,teamProjects:[]};e.forEach(a.connected,function(e){o.teamProjects.push({project:{id:e}})}),s.save("team",{failureGlobal:!1,fields:["id","name","icon","teamProjects"],$set:o},{success:function(e){r.fire("entity.saved",e.data)},failure:function(e){r.fire("entity.add.failure",e.data.response.Message)}}).done();var c=new n(i);c.invite(a.members).done(function(e){r.fire("members.saved",e)})},"bus configurator.ready:last + entity.saved + members.saved":function(t,n,i,a){var r=this,s=n.getStore(),o=e.compact(e.pluck(a,"success")),c=e.compact(e.pluck(a,"failure"));if(c.length){var d="Can't assign users.";this.fire("entity.add.nonFatalFailure",d)}o=e.filter(o,function(e){return e!=n.getLoggedUser().id});var u={teamMembers:e.map(o,function(e){return{user:{id:e}}})};s.save("team",{id:i.id,$set:u,fields:["id","name","icon",{teamMembers:[{user:["id","firstName","lastName","avatarUri"]},{role:["id","name"]}]}]}).done(function(e){r.fire("members.connected",e[0].data)})},"bus entity.saved + members.saved + members.connected":function(e,t,n,i){this.fire("entity.add.success",i)}})});