define(["require","Underscore","jQuery","tau/models/model.teamProject.formAdd.data.abstract","tau/configurations/team.icons"],function(t){"use strict";var e=t("Underscore"),r=t("jQuery"),i=t("tau/models/model.teamProject.formAdd.data.abstract"),n=t("tau/configurations/team.icons");return i.extend({"bus beforeInit":function(t,e){var r=e.config.context.configurator;this.fire("configurator.ready",r)},"bus configurator.ready:last + beforeInit":function(t,r){var i=r.getStore(),n=e.bind(this.fire,this);this._getRequiredData(i).then(function(t){n("dataBind",t)}),i.unbind(this),i.on({type:"project",eventName:"afterSave",listener:this},function(t){e.isEmpty(t.data.changes)||n("refresh")})},"bus configurator.ready:last + afterInit:last + destroy":function(t,e){e.getStore().unbind(this)},_getRequiredData:function(t){var i=r.Deferred(),o={icons:n},s=[this._getProjects.bind(this,t),this.getProcesses.bind(this,t),this.getTerms.bind(this,t),this.getWorkflows.bind(this,t)];return e.parallel(s,function(t,e){o.projects=e[0],o.processes=e[1],o.terms=e[2],o.workflows=e[3],i.resolve(o)}),i},_getProjects:function(t,r){t.get("projects",{fields:["id","name","color","isActive"]}).done(function(t){var i=e.sortBy(t[0].data,this.byName);i=e.filter(i,function(t){return t.isActive}),e.each(i,function(t){t.tooltip=""}),r(!1,i)}.bind(this))}})});