define(["Underscore","tau/core/class","tau/core/model-base"],function(e,t,n){var i=n.extend({onInit:function(){var t=this,n=this.config.context,i=n.entity.entityType.name,a=n.entity.id,s=[{entityState:["id","name","isFinal","isCommentRequired",{nextStates:["id"]}]}];if(!t.config.disableSubscriptions){var r=function(n){var i=n.data.changes,a=n.data.cmd.config.fields;n.data.cmd.config.fields=e.union(a,s),t.fire("beforeChanges",i),t.fire("beforeChangeProperty")},o=function(e){t.fire("applyChanges",e.data.changes),t.fire("propertyChanged")};t.store.unbind(t),t.store.on({eventName:"beforeSave",type:i,hasChanges:["entityState"],listener:this},r),t.store.on({eventName:"afterSave",type:i,hasChanges:["entityState"],listener:this},o)}t.store.get(i,{id:a,fields:s}).done({success:this._onEntityStatesRetrieved,scope:this})},_onEntityStatesRetrieved:function(e){var t=e[0].data.entityState;this.fire("dataBind",t)}});return i});