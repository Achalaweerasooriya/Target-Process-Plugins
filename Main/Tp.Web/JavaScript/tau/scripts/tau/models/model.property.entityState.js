define(["tau/core/model-base","Underscore"],function(e,t){var n=function(e){this.model=e};n.prototype={done:function(e){var t=e[0].data.entityState;this.model.fire("dataBind",t)}};var i=e.extend({onInit:function(){var e=this,i=new n(this),a=this.config.context,s=a.entity.entityType.name,o=a.entity.id,r=[{entityState:["id","name","isFinal","isCommentRequired",{nextStates:["id"]}]}];if(!e.config.disableSubscriptions){var d=function(n){var i=n.data.changes,a=n.data.cmd.config.fields;n.data.cmd.config.fields=t.union(a,r),e.fire("beforeChanges",i),e.fire("beforeChangeProperty")},c=function(t){e.fire("applyChanges",t.data.changes),e.fire("propertyChanged")};e.store.unbind(e),e.store.on({eventName:"beforeSave",type:s,hasChanges:["entityState"],listener:this},d),e.store.on({eventName:"afterSave",type:s,hasChanges:["entityState"],listener:this},c)}e.store.get(s,{id:o,fields:r},{success:i.setEntity,scope:i}).done({success:i.done,scope:i})}});return i});