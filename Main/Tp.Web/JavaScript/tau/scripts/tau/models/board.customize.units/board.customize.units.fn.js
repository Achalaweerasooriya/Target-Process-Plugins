define(["Underscore","tau/utils/utils.date"],function(t,e){function n(e,n){return["<a ",e?"":'href="'+t.escape(n.href)+'" ',!e&&n.title?'title="'+t.escape(n.title)+'" ':"",!e&&n.target?'target="'+n.target+'" ':"",'class="tau-board-unit-link tau-board-unit-not-selectable ',n.additionalClasses||"",'" ',n.additionalAttributes||"",">",t.escape(n.text),"</a>"].join("")}return function(i){return{_:t,dateUtils:e,trim:function(t,e){return t&&t.length>e?t.substr(0,e)+"&hellip;":t},formatDate:function(n,i){return t.isString(n)&&(n=e.convertToTimezone(n)),n?e.formatAs(n,i):""},formatDayShort:function(n){return t.isString(n)&&(n=e.convertToTimezone(n)),n?n.getDate():""},precise_round:function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},unitClass:function(e){var n=["tau-board-unit"];return t.each(e.settings&&e.settings.classes||[],function(t){n.push("tau-board-unit_"+t)}),i.sections&&n.push("tau-board-unit_format_max"),e.settings&&e.settings.metaData&&e.settings.metaData.alignment&&n.push("tau-board-unit_alignment_"+e.settings.metaData.alignment),n.join(" ")},unitData:function(e){var n=[],a=e.settings&&e.settings.metaData;return a&&(a.title&&n.push('title="'+t.escape(a.title)+'"'),a.id&&n.push('data-unit-id="'+t.escape(a&&a.id)+'"'),a.alignment&&n.push('data-alignment="'+t.escape(a&&a.alignment)+'"'),i.sections&&(n.push('data-sections="'+i.sections+'"'),1==i.sections&&n.push('data-is-stretchable="'+!(i.isStretchable===!1)+'"'))),n.join(" ")},generateEntityLink:function(t,e,i,a){var s=t.settings&&t.settings.isDesignMode,r=s?"":t.configurator.getUrlBuilder().getNewViewUrl(e.id,i,!0);return n(s,{href:r,title:e.name,additionalClasses:"tau-id "+(a||""),additionalAttributes:'data-entity-id="'+e.id+'" data-entity-type="'+i+'" ',text:e.id})},buildLink:function(t,e,i){if(e.cf&&e.cf.value){var a=n(t.settings&&t.settings.isDesignMode,{text:e.cf.value.label,title:i?e.cf.value.label:"",href:e.cf.value.uri,target:"_blank"});return i?a:this.trim(e.cf.name,10)+": "+a}return""},getUserText:function(e){return t.escape(t.trim(e.fullName)||e.email)},getPeopleOrdered:function(e){var n=e.users||[e.user],i="responsible",a="others",s=t.groupBy(n,function(t){return this.isResponsible(e,t)?i:a},this);return t.concat([s[i],s[a]])},isResponsible:function(t,e){return!t.currentStateResponsiblePersons||t.currentStateResponsiblePersons.indexOf(e.id)>=0}}}});