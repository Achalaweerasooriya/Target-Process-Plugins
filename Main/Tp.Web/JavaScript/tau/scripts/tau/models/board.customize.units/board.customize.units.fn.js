define(["Underscore","tau/utils/utils.date"],function(t,e){function n(e,n){return!t.isUndefined(n)&&e&&e.length>n?e.substr(0,n)+"&hellip;":e}function i(e,i){return["<a ",e?"":'href="'+t.escape(i.href)+'" ',!e&&i.title?'title="'+t.escape(i.title)+'" ':"",!e&&i.target?'target="'+i.target+'" ':"",'class="tau-board-unit-link tau-board-unit-not-selectable ',i.className||"",'" ',i.attributes||"",">",n(t.escape(i.text),i.maxTextLength),"</a>"].join("")}return function(a){return{_:t,dateUtils:e,trim:n,formatDate:function(n,i){return t.isString(n)&&(n=e.convertToTimezone(n)),n?e.formatAs(n,i):""},formatDayShort:function(n){return t.isString(n)&&(n=e.convertToTimezone(n)),n?n.getDate():""},precise_round:function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},unitClass:function(e){var n=["tau-board-unit"];return t.each(e.settings&&e.settings.classes||[],function(t){n.push("tau-board-unit_"+t)}),a.sections&&n.push("tau-board-unit_format_max"),e.settings&&e.settings.metaData&&e.settings.metaData.alignment&&n.push("tau-board-unit_alignment_"+e.settings.metaData.alignment),n.join(" ")},unitData:function(e){var n=[],i=e.settings&&e.settings.metaData;return i&&(i.title&&n.push('title="'+t.escape(this.replaceTermTags(i.title))+'"'),i.id&&n.push('data-unit-id="'+t.escape(i&&i.id)+'"'),i.alignment&&n.push('data-alignment="'+t.escape(i&&i.alignment)+'"'),a.sections&&(n.push('data-sections="'+a.sections+'"'),1==a.sections&&n.push('data-is-stretchable="'+(a.isStretchable!==!1)+'"'))),n.join(" ")},generateEntityLink:function(e,n,a,s){s=s||{};var r=e.settings&&e.settings.isDesignMode,u=r?"":e.configurator.getUrlBuilder().getNewViewUrl(n.id,a,!0);return t.defaults(s,{text:n.id,title:n.name,href:u,className:"tau-board-unit__value tau-related-id",attributes:'data-entity-id="'+n.id+'" data-entity-type="'+a+'" '}),s.className="tau-id "+(s.className||""),i(r,s)},buildLink:function(t,e,n){if(e.cf&&e.cf.value){var a=i(t.settings&&t.settings.isDesignMode,{text:e.cf.value.label,title:n?e.cf.value.label:"",href:e.cf.value.uri,target:"_blank"});
return n?a:this.trim(e.cf.name,10)+": "+a}return""},getUserText:function(e){return t.escape(t.trim(e.fullName)||e.email)},getPeopleOrdered:function(e){var n=e.users||[e.user],i="responsible",a="others",s=t.groupBy(n,function(t){return this.isResponsible(e,t)?i:a},this);return t.concat([s[i],s[a]])},programProgress:function(t){return 0===t.totalStoriesCount?0:(t.totalStoriesCount-t.openStoriesCount)/t.totalStoriesCount},isResponsible:function(t,e){return!t.currentStateResponsiblePersons||t.currentStateResponsiblePersons.indexOf(e.id)>=0}}}});