define(["Underscore","tau/models/board.customize.units/const.entity.types.names","tau/models/board.customize.units/const.card.sizes","tau/models/board.customize.units/const.customField.types","tau/services/customize/service.customize.units.customField.sampleData","tau/models/board.customize.units/board.customize.units.base"],function(t,e,a,i,s,u){var n=[a.XS,a.S,a.M,a.L,a.XL],o=n.concat(a.LIST),d={formatText:function(e,a,s){if(!e)return"";var u=e.value;if(a&&a.isDesignMode)s&&(u="Value for "+u);else if(e.type.toLowerCase()==i.DATE)return['<div class="tau-board-unit__value_type_day">',this.formatDayShort(u),"</div>",'<div class="tau-board-unit__value_type_month">',this.formatDate(u,"MMM"),"</div>",'<div class="tau-board-unit__value_type_year">',this.formatDate(u,"yyyy"),"</div>"].join("");return t.escape(u)},formatTextForTitle:function(e){if(!e)return"";var a=e.value;return e.type.toLowerCase()==i.DATE?[this.formatDayShort(a),this.formatDate(a,"MMM"),this.formatDate(a,"yyyy")].join(" "):t.escape(a)},type:function(t){var e=t.cf;return e&&e.value&&e.value.entityKind?e.value.entityKind.toLowerCase():"none"},getRelationsCount:function(t){return(t.cf.value||"").split(",").length}},c=function(t){var e=t.cf,a=e&&e.value&&e.value.entityKind&&e.value.entityKind.toLowerCase();return"tau-board-unit_type_"+a},l=function(t){return t&&t.cf&&t.cf.value?"tau-board-unit_type_custom-checkbox-checked":"tau-board-unit_type_custom-checkbox"},_=[{id:"custom_field__long__{{name}}",classId:"tau-board-unit_type_custom_field_long",customFieldTypes:[i.TEXT,i.DATE,i.NUMBER,i.MULTIPLE_LIST,i.DROP_DOWN],sizes:n,sections:1,template:{markup:['<div class="tau-board-unit__value">',"<%!fn.trim(this.data.cf.name,10)%>: ","<%=fn.formatText(this.data.cf, this.settings, true)%>","</div>"]}},{id:"custom_field__short__{{name}}",classId:"tau-board-unit_type_custom_field_short",sizes:n,customFieldTypes:[i.TEXT,i.DATE,i.NUMBER,i.DROP_DOWN],template:{markup:['<div class="tau-board-unit__value">',"<%=fn.formatText(this.data.cf, this.settings)%>","</div>"]}},{id:"custom_field__100__{{name}}",sections:1,classId:"tau-board-unit_type_custom_field_100",customFieldTypes:[i.TEXT,i.DATE,i.NUMBER,i.MULTIPLE_LIST,i.DROP_DOWN],listSettings:{title:"<%=fn.formatTextForTitle(this.data.cf)%>"},template:{markup:['<div class="tau-board-unit__value">',"<%=fn.formatText(this.data.cf, this.settings)%>","</div>"]}},{id:"custom_field__entity_id__{{name}}",classId:function(t){return"tau-board-unit_type_custom-related-entity tau-board-unit_type_id "+c(t)+"-id"
},customFieldTypes:[i.ENTITY],template:{markup:["<% if (this.data.cf && this.data.cf.value && this.data.cf.value.entityKind){ %>","<%= fn.generateEntityLink(this, this.data.cf.value, this.data.cf.value.entityKind) %>","<% } %>"]},listSettings:{title:'<%= this.data.cf && this.data.cf.value ? this.data.cf.value.name : ""%>'}},{id:"custom_field__url_short__{{name}}",classId:"tau-board-unit_type_custom-url",customFieldTypes:[i.URL],template:{markup:['<div class="tau-board-unit__value">',"<%=fn.buildLink(this, this.data, true)%>","</div>"]},listSettings:{title:'<%= this.data.cf && this.data.cf.value ? this.data.cf.value.label : ""%>'}},{id:"custom_field__url_line__{{name}}",classId:"tau-board-unit_type_custom-url",customFieldTypes:[i.URL],sections:1,sizes:n,template:{markup:['<div class="tau-board-unit__value">',"<%=fn.buildLink(this, this.data, false)%>","</div>"]}},{id:"custom_field__checkbox_short__{{name}}",classId:function(t){return"tau-board-unit_type_custom-checkbox-short "+l(t)},customFieldTypes:[i.CHECK_BOX],template:{markup:[""]},hideIf:function(t){return!t||!t.cf||!t.cf.name}},{id:"custom_field__checkbox__{{name}}",classId:l,sizes:n,customFieldTypes:[i.CHECK_BOX],template:{markup:['<div class="tau-board-unit__value"><%!fn.trim(this.data.cf.name,15)%></div>']},hideIf:function(t){return!t||!t.cf||!t.cf.name}},{id:"custom_field__checkbox_long__{{name}}",classId:l,customFieldTypes:[i.CHECK_BOX],sections:1,sizes:n,template:{markup:['<div class="tau-board-unit__value"><%! this.data.cf.name %></div>']},hideIf:function(t){return!t||!t.cf||!t.cf.name}}];u.pushClones(_,{classId:function(t){return"tau-board-unit_type_custom-related-entity "+c(t)},customFieldTypes:[i.ENTITY],template:{markup:['<div class="tau-board-unit__value">',"<% if (this.data.cf && this.data.cf.value) { %>","<%!this.data.cf.value.name%>","<% } %>","</div>"]}},[{id:"custom_field__entity_long__{{name}}",sections:1,sizes:n},{id:"custom_field__entity_name__{{name}}",sizes:o}]);var r=function(t){return null===t.cf.value||void 0===t.cf.value||""===t.cf.value
};return t.each(_,function(a){a=t.defaults(a,{category:"custom fields",priority:1,model:'cf:CustomValues.Get("{{name}}")',name:"{{name}}",types:[e.EPIC,e.FEATURE,e.STORY,e.TASK,e.BUG,e.REQUEST,e.TEST_CASE,e.IMPEDIMENT,e.ITERATION,e.TEAM_ITERATION,e.RELEASE,e.TEST_PLAN,e.TEST_PLAN_RUN,e.BUILD,e.PROJECT],sizes:o,hideIf:r}),a.template.customFunctions=d,a.sampleData||(a.sampleData={cf:{name:"{{name}}",type:a.customFieldTypes[0],value:s[a.customFieldTypes[0]]}}),a.hideIf=t.wrap(a.hideIf,function(t,e){return!e.cf||a.customFieldTypes.indexOf(e.cf.type.toLowerCase())<0||t(e)})}),_});