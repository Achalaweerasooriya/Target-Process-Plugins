define(["Underscore","tau/core/model-base","tau/configurator"],function(_,a,b){var c=a.extend({"bus beforeInit":function(a){var c=a.data.config,d=c.eventNamesSpecial||{};_.defaults(d,{dataBind:"dataBind"});var e=d.dataBind,f=c.context.entity.id,g=b.getApplicationPath(),h={run:{show:!1,url:g+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+f,label:"Run"},completeRun:{show:!1,url:g+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+f+"&CompleteRun=1",label:"Complete Last Run"},newRun:{show:!1,url:g+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+f+"&ReRun=1",label:"New Run"},changeLastRun:{show:!1,url:g+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+f+"&Edit=1",label:"Change Last Run"}},i=this,j=c.context.entity;this.store.get("testplanrun",{id:j.id,fields:["testCaseRuns-count","passedCount","failedCount","notRunCount",{entityState:["isFinal"]}]}).done({success:function(a){var b=a[0].data;!b.entityState.isFinal&&b["testCaseRuns-count"]>0&&(b.passedCount>0||b.failedCount>0?(h.newRun.show=!0,b.notRunCount>0?h.completeRun.show=!0:h.changeLastRun.show=!0):h.run.show=!0),i.bus.fire(e,{additionalActions:h})}}),this.store.on({eventName:"afterSave",type:"testplanrun",listener:this,filter:{id:j.id},hasChanges:["entityState"]},function(a){i.fire("refresh")})}});return c})