define(["Underscore","tau/core/model-base","tau/configurator"],function(a,b,c){var d=b.extend({"bus beforeInit":function(b){var d=b.data.config,e=d.eventNamesSpecial||{};a.defaults(e,{dataBind:"dataBind"});var f=e.dataBind,g=d.context.entity.id,h=c.getApplicationPath(),i={run:{show:!1,url:h+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+g,label:"Run"},completeRun:{show:!1,url:h+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+g+"&CompleteRun=1",label:"Complete Last Run"},newRun:{show:!1,url:h+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+g+"&ReRun=1",label:"New Run"},changeLastRun:{show:!1,url:h+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+g+"&Edit=1",label:"Change Last Run"}},j=this,k=d.context.entity;this.store.get("testplanrun",{id:k.id,fields:["testCaseRuns-count","passedCount","failedCount","notRunCount",{entityState:["isFinal"]}]}).done({success:function(a){var b=a[0].data;!b.entityState.isFinal&&b["testCaseRuns-count"]>0&&(b.passedCount>0||b.failedCount>0?(i.newRun.show=!0,b.notRunCount>0?i.completeRun.show=!0:i.changeLastRun.show=!0):i.run.show=!0),j.bus.fire(f,{additionalActions:i})}}),this.store.on({eventName:"afterSave",type:"testplanrun",listener:this,filter:{id:k.id},hasChanges:["entityState"]},function(a){j.fire("refresh")})}});return d})