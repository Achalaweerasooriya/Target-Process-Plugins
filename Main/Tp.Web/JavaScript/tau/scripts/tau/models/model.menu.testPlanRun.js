define(["Underscore","tau/core/model-base"],function(_,BaseModel){var model=BaseModel.extend({"bus beforeInit":function(evt){var config=evt.data.config,eventNames=config.eventNamesSpecial||{};_.defaults(eventNames,{dataBind:"dataBind"});var eventName=eventNames.dataBind,id=config.context.entity.id,path=this.config.context.configurator.getApplicationPath(),additionalActions={run:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id,label:"Run"},completeRun:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id+"&CompleteRun=1",label:"Complete Last Run"},newRun:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id+"&ReRun=1",label:"New Run"},changeLastRun:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id+"&Edit=1",label:"Change Last Run"}},self=this,entity=config.context.entity;this.store.get("testplanrun",{id:entity.id,fields:["testCaseRuns-count","passedCount","failedCount","notRunCount",{entityState:["isFinal"]}]}).done({success:function(result){var item=result[0].data;!item.entityState.isFinal&&item["testCaseRuns-count"]>0&&(item.passedCount>0||item.failedCount>0?(additionalActions.newRun.show=!0,item.notRunCount>0?additionalActions.completeRun.show=!0:additionalActions.changeLastRun.show=!0):additionalActions.run.show=!0),self.bus.fire(eventName,{additionalActions:additionalActions})}}),this.store.on({eventName:"afterSave",type:"testplanrun",listener:this,filter:{id:entity.id},hasChanges:["entityState"]},function(res){self.fire("refresh")})}});return model})