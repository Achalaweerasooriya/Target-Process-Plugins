define(["Underscore","tau/core/model-base","tau/utils/utils.date"],function(e,t,i){var n=i.Date,a=6e4,r=60*a,o=24*r,c=t.extend({name:"Lead Cycle Time Model",onInit:function(){var e=this,t=e.config.context,i=t.entity.entityType.name,n=t.entity.id,a={id:n,fields:["leadTime","cycleTime","createDate","startDate","endDate"]};e.store.unbind(e),e.store.on({eventName:"afterSave",type:i,fields:["entityState"],listener:e},function(){e.fire("refresh")}),e.store.get(i,a,{scope:e,success:e.onEntityRetrieved}).done()},getTime:function(e){var t="d",i="min",n="h";return this.getTimeWithAbbreviation(e,t,n,i)},getTimeWithAbbreviation:function(e,t,i,n){if(e*=o,r>e)return(e/a).toFixed(0)+n;if(o>e)return(e/r).toFixed(0)+i;var c=parseInt(e/o);e%=o;var s=(e/r).toFixed(0);return c+t+" "+(s>0?s+i:"")},convertDayToMinutes:function(e){return 24*e*60},getLongTime:function(e){return this.getTimeWithAbbreviation(e," days"," hours"," minutes")},onEntityRetrieved:function(t){var a=t.data,r=i.parse(a.startDate),o=i.parse(a.createDate),c=i.parse(a.endDate),s="dd MMM yy",d=c?"End Date":"Today";c=c||new n;var u=a.leadTime,m={leadTime:this.getTime(u),leadTimeTooltip:this.getLongTime(u),createDate:o.toString(s),endDateLabel:d,endDate:(c||new n).toString(s),id:e.uniqueId()};if(e.isNumber(a.cycleTime)){var l=a.cycleTime;m.cyclePercentage=l/u,m.cycleTime=this.getTime(l),m.cycleTimeTooltip=this.getLongTime(l),m.startDate=(r||"").toString(s),m.startDate==m.createDate&&(m.startDate="")}else m.cycleTime="",m.cyclePercentage=null;this.fire("dataBind",m)}});return c});