define(["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,Class){return Class.extend({fetch:function(fnCallback){this._fetch("testPlanRuns","testPlanRun","severity",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain","passedCount","failedCount","notRunCount","testCaseRuns-count",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}];var projectField={project:["id"]};return this.config.multiprojects&&projectField.project.push("abbreviation"),detailCommand[collectionType].push(projectField),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&detailCommand[collectionType].push({iteration:["id","name"]}),detailCommand},_convertData:function(data){return data=this._super(data),_.sortBy(data,function(item){var priority=item.numericPriority||0;return priority})},_convertItem:function(data){var self=this,isAvailableIteration=!0;this.config.context.isPracticeAvailable("Iterations")||(isAvailableIteration=!1),data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},assignments:this._processAssignments(data),projectId:data.project.id,entitiesCount:0,release:data.release,iteration:data.iteration,build:data.build,passedCount:_.toNumber(data.passedCount)||0,failedCount:_.toNumber(data.failedCount)||0,notRunCount:_.toNumber(data.notRunCount)||0,isAvailableIteration:isAvailableIteration,additionalActions:{}};return this.config.multiprojects&&(item.project={id:data.project.id,abbreviation:data.project.abbreviation}),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&(item.iteration={id:data.iteration?data.iteration.id:null,name:data.iteration?data.iteration.name:null}),item}})})