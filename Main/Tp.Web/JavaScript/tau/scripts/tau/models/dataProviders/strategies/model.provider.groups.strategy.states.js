define(["Underscore","tau/models/dataProviders/strategies/model.provider.groups.strategy.base"],function(_,BaseStrategy){return BaseStrategy.extend({fetch:function(key,items,fnCallback){},moveToGroup:function(store,item,group,prevGroup,callback){var realPrevGroup=_.find(prevGroup.realGroups,function(group){return group.id==item.entityState.id}),realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realPrevGroup.process.id});if(!realGroup||realGroup.id==realPrevGroup.id){callback.call(null);return}var actions=[];actions.push(function(next){store.save(item.__type,{id:item.id,$set:{entityState:{id:realGroup.id}},fields:["id",{entityState:["id","name","isFinal"]}]}).done({success:function(){next(null,arguments)}})}),actions.push(function(next){store.get(item.__type,{id:item.id,fields:["id",{entityState:["id","name","isFinal"]}]}).done({success:function(result){next(null,result[0].data)}})}),_.series(actions,function(err,result){_.isFunction(callback)&&callback.call(null,{changed:result[1]})})},isAvailableForItem:function(item,group,currentGroup){var realCurrentGroup=_.find(currentGroup.realGroups,function(group){return group.id==item.entityState.id}),realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realCurrentGroup.process.id}),availableIds=_.pluck(realCurrentGroup.nextStates,"id");return availableIds.push(realCurrentGroup.id),realGroup&&_.include(availableIds,realGroup.id)},getCommentRequirements:function(item,groups,currentGroup){var realCurrentGroup=_.find(currentGroup.realGroups,function(group){return group.id==item.entityState.id}),config=[];return _.forEach(groups,function(group){var realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realCurrentGroup.process.id});config.push({isCommentRequired:realGroup?realGroup.isCommentRequired:!1})}),config}})})