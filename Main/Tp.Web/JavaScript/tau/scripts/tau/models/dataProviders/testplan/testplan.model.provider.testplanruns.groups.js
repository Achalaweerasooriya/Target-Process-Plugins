define(["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/models/dataProviders/strategies/model.provider.groups.strategy.states"],function(e,t,s){return t.extend({init:function(e){this._super(e),this.strategy=new s},fetch:function(t,s,r){var n=e(s).pluck("projectId"),i=this.config.store,o={fields:[{process:["id"]}],list:!0};i.get("projects",o,{scope:this,success:this.onProjects(n,t,r)}).done()},onProjects:function(t,s,r){return function(n){var i=e(n.data).chain().select(function(s){return e(t).include(s.id)}).map(function(e){return e.process.id}).uniq().value(),o=$.Deferred(),u=function(t){var s=(t.entityType.name||"").toLowerCase();return"testplanrun"===s&&e(i).include(t.process.id)};if(i.length)o.resolveWith(this,[u]);else{var c=this.config.store;c.get("processes",{fields:["id","IsDefault"],$query:{IsDefault:"true"}},{scope:this,fail:o.reject,success:function(t){i.push(e.chain(t.data).select(function(e){return e.IsDefault}).pluck("id").first().value()),o.resolveWith(this,[u])}}).done()}this._fetchStateAsync(s,o,r)}},_fetchStateAsync:function(e,t,s){t.always(function(t){return this._fetchState(e,t,s)})},moveToGroup:function(e,t,s,r){var n=this.config.store;return this.strategy.moveToGroup(n,e,t,s,r)},isAvailableForItem:function(e,t,s){return this.strategy.isAvailableForItem(e,t,s)},getCommentRequirements:function(e,t,s){return this.strategy.getCommentRequirements(e,t,s)}})});