define(["Underscore","tau/models/dataProviders/model.provider.items.base"],function(t,e){return e.extend({fetch:function(t){this.config.store.get("entityState",{fields:["id",{entityType:["id","name"]},{role:["id","name"]},{process:["id"]}]}).get("project",{fields:["id",{process:["id"]}]}).done({scope:this,success:this.onReadyToFetch(t)})},onReadyToFetch:function(t){return function(e){this.entityStates=e[0].data,this.projects=e[1].data,this._fetch("features","feature","priority",t)}},_createDetailCommand:function(t){var e={};return e[t]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain","userStories-count",{entityState:this.fields.entityState},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{priority:["id","name","importance"]},{project:["id"]}],e},_convertData:function(i){return i=e.prototype._convertData.call(this,i),t.forEach(i,function(t){t.visibleEntityState=t.entityState.name}),i=this._calculateEffortToMaximum(i),this._sortByPriority(i)},_convertItem:function(e){var i=this;e.project=e.project||{};var r=t(this.projects).detect(function(t){return t.id===e.project.id}),n=r.process.id,o=t(this.entityStates).chain().select(function(t){return"feature"===t.entityType.name.toLowerCase()&&t.process.id===n&&null!==t.role}).pluck("role").value(),s=t(o).reduce(function(e,i,r){return 0!=r&&t.detect(e,function(t){return t.id===i.id})||(e[e.length]=i),e},[]);e.roleEfforts=t(s).map(function(t){return{role:t}});var a={id:e.id,name:e.name,__type:e.__type,numericPriority:e.numericPriority,entityState:{id:e.entityState.id,name:e.entityState.name,isInitial:e.entityState.isInitial,isFinal:e.entityState.isFinal,numericPriority:e.entityState.numericPriority},tags:this._processTags(e),effort:this._getEffortData(e),assignments:this._processAssignments(e),priority:{id:e.priority.id,name:e.priority.name,kind:i.importanceProcessor.getKind(e.priority.importance)},entitiesCount:e["userStories-count"]};return a}})});