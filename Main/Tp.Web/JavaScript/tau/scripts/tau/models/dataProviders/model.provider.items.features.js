define(["Underscore","tau/models/dataProviders/model.provider.items.base"],function(a,b){return b.extend({fetch:function(a){this.config.store.get("entityState",{fields:["id",{entityType:["id","name"]},{role:["id","name"]},{process:["id"]}]}).get("project",{fields:["id",{process:["id"]}]}).done({scope:this,success:this.onReadyToFetch(a)})},onReadyToFetch:function(a){return function(b){this.entityStates=b[0].data,this.projects=b[1].data,this._fetch("features","feature","priority",a)}},_createDetailCommand:function(a){var b={};b[a]=["id","name","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:["id","name","isinitial","isfinal"]},{assignments:["id",{role:["id"]},{generalUser:["id","firstName","lastName"]}]},{priority:["id","name","importance"]},{project:["id"]}];return b},_convertData:function(c){c=b.prototype._convertData.call(this,c),a.forEach(c,function(a){a.visibleEntityState=a.entityState.name});return this._calculateEffortToMaximum(c)},_convertItem:function(b){var c=this,d=a(this.projects).detect(function(a){return a.id===b.project.id}),e=d.process.id,f=a(this.entityStates).chain().select(function(a){return a.entityType.name.toLowerCase()==="feature"&&a.process.id===e&&a.role!==null}).pluck("role").value(),g=a(f).reduce(function(b,c,d){if(0==d||!a.detect(b,function(a){return a.id===c.id}))b[b.length]=c;return b},[]);b.roleEfforts=a(g).map(function(a){return{role:a}});var h={id:b.id,name:b.name,__type:b.__type,entityState:{id:b.entityState.id,name:b.entityState.name,isInitial:b.entityState.isinitial,isFinal:b.entityState.isfinal},tags:this._processTags(b),effort:this._getEffortData(b),assignments:this._processAssignments(b),priority:{id:b.priority.id,name:b.priority.name,kind:c.importanceProcessor.getKind(b.priority.importance)}};return h}})})