define(["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/utils/utils.date"],function(_,a,b){return a.extend({fetch:function(a,b,c){return this._fetchReleases(a,b,c)},_fetchReleases:function(a,c,d){var e=this.config.context,f=e.entity.entityType.name,g=e.entity.id,h=this.config.store,i=this,j={id:g,nested:!0,fields:[{releases:["id","name","startDate","endDate"]}]};h.get("project",j).done({success:function(a){var c=_(a).pluck("data")[0].releases;c=_.sortBy(c,function(a){return b.parse(a.startDate)});var e=[];_.forEach(c,function(a){e.push(i._processRelease(a))}),_.forEach(e,function(a){a.items=[]}),d(e)}})},_processRelease:function(a){var c=b.parse(a.startDate).clearTime(),d=b.parse(a.endDate).clearTime(),e=!0,f=!1;Date.today().between(c,d)&&(e=!1,f=!0);var g="d MMM",h=b.formatAs(c,g)+" / "+b.formatAs(d,g);h=h+" ("+Math.floor((d.getTime()-c.getTime())/1e3/60/60/24+1)+" days)",f&&(h+=" (current)");var i={key:a.id,title:a.name,subtitle:h,collapsed:e};return i}})})