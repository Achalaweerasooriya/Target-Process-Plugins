define(["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/utils/utils.date"],function(e,t,r){return t.extend({fetch:function(e,t,r){return this._fetchReleases(e,t,r)},_fetchReleases:function(t,a,s){var n=this.config.context,i=(n.entity.entityType.name,n.entity.id),o=this.config.store,c=this,d={id:i,nested:!0,fields:[{releases:["id","name","startDate","endDate"]}]};o.get("project",d).done({success:function(t){var a=e(t).pluck("data")[0].releases;a=e.sortBy(a,function(e){return r.parse(e.startDate)});var n=[];e.forEach(a,function(e){n.push(c._processRelease(e))}),e.forEach(n,function(e){e.items=[]}),s(n)}})},_processRelease:function(e){var t=r.parse(e.startDate).clearTime(),a=r.parse(e.endDate).clearTime(),s=!0,n=!1;r.Date.today().between(t,a)&&(s=!1,n=!0);var i="d MMM",o=r.formatAs(r.convertToTimezone(t),i)+" / "+r.formatAs(r.convertToTimezone(a),i);o=o+" ("+Math.floor((a.getTime()-t.getTime())/1e3/60/60/24+1)+" days)",n&&(o+=" (current)"),e.url=this.config.context.configurator.getUrlBuilder().getNewViewUrl(e.id,e.__type,!0);var c={key:e.id,title:e.name,subtitle:o,collapsed:s};return c}})});