define(["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/utils/utils.date"],function(e,t,r){return t.extend({fetch:function(e,t,r){return this._fetchReleases(e,t,r)},_fetchReleases:function(t,a,s){var n=this.config.context,o=(n.entity.entityType.name,n.entity.id),i=this.config.store,c=this,u={id:o,nested:!0,fields:[{releases:["id","name","startDate","endDate"]}]};i.get("project",u).done({success:function(t){var a=e(t).pluck("data")[0].releases;a=e.sortBy(a,function(e){return-1*r.parse(e.startDate)});var n=[];e.forEach(a,function(e){n.push(c._processRelease(e))}),e.forEach(n,function(e){e.items=[]}),s(n)}})},_processRelease:function(e){var t=r.parse(e.startDate);t=r.convertToTimezone(t);var a=r.parse(e.endDate);a=r.convertToTimezone(a);var s=!0,n=!1;r.Date.today().between(t,a)&&(s=!1,n=!0);var o="d MMM",i=r.formatAs(t,o)+" / "+r.formatAs(a,o);i=i+" ("+Math.floor((a.getTime()-t.getTime())/1e3/60/60/24+1)+" days)",n&&(i+=" (current)"),e.url=this.config.context.configurator.getUrlBuilder().getNewViewUrl(e.id,e.__type,!0);var c={key:e.id,title:e.name,subtitle:i,collapsed:s,realGroup:e};return c}})});