define(["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/utils/utils.date"],function(e,t,r){return t.extend({fetch:function(e,t,r){return this._fetchReleases(e,t,r)},_fetchReleases:function(t,a,n){var s=this.config.context,o=(s.entity.entityType.name,s.entity.id),i=this.config.store,c=this,d="crossprojectreleases",u={id:o,nested:!0,fields:[{}]};u.fields[0][d]=["id","name","startDate","endDate",{entityType:["name"]}],i.get("project",u).done({success:function(t){var a=t[0].data[d];a=e.sortBy(a,function(e){return-1*r.parse(e.startDate)});var s=[];e.forEach(a,function(e){s.push(c._processRelease(e))}),e.forEach(s,function(e){e.items=[]}),n(s)}})},_processRelease:function(e){var t=r.parse(e.startDate);t=r.convertToTimezone(t);var a=r.parse(e.endDate);a=r.convertToTimezone(a);var n=!0,s=!1;r.Date.today().between(t,a)&&(n=!1,s=!0);var o="d MMM",i=r.formatAs(t,o)+" / "+r.formatAs(a,o);i=i+" ("+Math.floor((a.getTime()-t.getTime())/1e3/60/60/24+1)+" days)",s&&(i+=" (current)"),e.url=this.config.context.configurator.getUrlBuilder().getNewViewUrl(e.id,e.entityType.name.toLowerCase(),!0);var c={key:e.id,title:e.name,subtitle:i,collapsed:n,realGroup:e};return c}})});