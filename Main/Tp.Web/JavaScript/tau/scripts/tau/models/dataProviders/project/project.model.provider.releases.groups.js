define(["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/utils/utils.date"],function(e,t,r){return t.extend({fetch:function(e,t,r){return this._fetchReleases(e,t,r)},_fetchReleases:function(t,s,a){var n=this.config.context,o=(n.entity.entityType.name,n.entity.id),i=this.config.store,c=this,d=this.config.context.configurator.getFeaturesService().isEnabled("release.crossproject"),u=d?"crossprojectreleases":"releases",f={id:o,nested:!0,fields:[{}]};f.fields[0][u]=["id","name","startDate","endDate",{entityType:["name"]}],i.get("project",f).done({success:function(t){var s=t[0].data[u];s=e.sortBy(s,function(e){return-1*r.parse(e.startDate)});var n=[];e.forEach(s,function(e){n.push(c._processRelease(e))}),e.forEach(n,function(e){e.items=[]}),a(n)}})},_processRelease:function(e){var t=r.parse(e.startDate);t=r.convertToTimezone(t);var s=r.parse(e.endDate);s=r.convertToTimezone(s);var a=!0,n=!1;r.Date.today().between(t,s)&&(a=!1,n=!0);var o="d MMM",i=r.formatAs(t,o)+" / "+r.formatAs(s,o);i=i+" ("+Math.floor((s.getTime()-t.getTime())/1e3/60/60/24+1)+" days)",n&&(i+=" (current)"),e.url=this.config.context.configurator.getUrlBuilder().getNewViewUrl(e.id,e.entityType.name.toLowerCase(),!0);var c={key:e.id,title:e.name,subtitle:i,collapsed:a,realGroup:e};return c}})});