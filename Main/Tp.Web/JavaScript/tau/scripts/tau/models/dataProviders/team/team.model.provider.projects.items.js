define(["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({sparklineLength:16,fetch:function(fnCallback){this._fetch("teamProjects","teamProject",!1,fnCallback)},_fetch:function(collectionName,typeName,importanceTypeName,fnCallback){var self=this,entity=this.config.context.entity,configurator=this.config.context.configurator;$.ajax({url:configurator.getApplicationPath()+"/api/v2/TeamProject?select={"+["id",'"TeamProject" as __type',"new("+["Project.id","Project.name","Project.color","Project.Bugs.Count(entityState.IsFinal != true AND Team.id = "+entity.id+") as openBugsCount","Project.Bugs.Count(entityState.IsFinal == true AND Team.id = "+entity.id+") as closedBugsCount","Project.UserStories.Count(entityState.IsFinal != true AND Team.id = "+entity.id+") as openUsCount","Project.UserStories.Count(entityState.IsFinal == true AND Team.id = "+entity.id+") as closedUsCount","Project.UserStories.Where(Team.id = "+entity.id+").Sparkline("+this.sparklineLength+") as userStoriesSparkline","Project.Bugs.Where(Team.id = "+entity.id+").Sparkline("+this.sparklineLength+") as bugsSparkline"].join(",")+") as project"].join(",")+"}&where=(Team.id=="+entity.id+")"}).done(function(data){fnCallback(self._convertData(data.items))}).fail(function(){fnCallback(self._convertData([]))})},_convertData:function(data){return data=this._super(data),this._sortByPriority(data)},_sortByPriority:function(items){return _.sortBy(items,function(item){return item.id*-1})},_convertItem:function(data){var usp=data.project.userStoriesSparkline,bsp=data.project.bugsSparkline,item={id:data.id,__type:"teamProject",project:data.project,uri:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.project.id,"project",!0),appPath:this.config.context.configurator.getApplicationPath(),userStoriesSparkline:usp,bugsSparkline:bsp};return item}})})