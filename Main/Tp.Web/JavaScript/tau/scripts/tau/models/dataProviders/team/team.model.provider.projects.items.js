define(["Underscore","tau/models/dataProviders/model.provider.items.base"],function(e,t){return t.extend({sparklineLength:16,fetch:function(e){this._fetch("teamProjects","teamProject",!1,e)},_fetch:function(e,t,r,i){var o=this,n=this.config.context.entity,s=this.config.context.configurator;$.ajax({url:s.getApplicationPath()+"/api/v2/TeamProject?select={"+["id","isProjectAccessed","Team.TeamMembers.Select(User.id) as teamMembers","Team.TeamMembers.Count() as teamMembersCount",'"TeamProject" as __type',"new("+["Project.id","Project.name","Project.color","Project.ProjectMembers.Select(User.id) as projectMembers","Project.Bugs.Count(entityState.IsFinal != true AND Team.id = "+n.id+") as openBugsCount","Project.Bugs.Count(entityState.IsFinal == true AND Team.id = "+n.id+") as closedBugsCount","Project.UserStories.Count(entityState.IsFinal != true AND Team.id = "+n.id+") as openUsCount","Project.UserStories.Count(entityState.IsFinal == true AND Team.id = "+n.id+") as closedUsCount","Project.UserStories.Where(Team.id = "+n.id+").Sparkline("+this.sparklineLength+") as userStoriesSparkline","Project.Bugs.Where(Team.id = "+n.id+").Sparkline("+this.sparklineLength+") as bugsSparkline"].join(",")+") as project"].join(",")+"}&where=(Team.id=="+n.id+")"}).done(function(e){i(o._convertData(e.items))}).fail(function(){i(o._convertData([]))})},_convertData:function(e){return e=this._super(e),this._sortByPriority(e)},_sortByPriority:function(t){return e.sortBy(t,function(e){return-1*e.id})},_convertItem:function(t){var r=t.project.userStoriesSparkline,i=t.project.bugsSparkline,o={id:t.id,__type:"teamProject",teamMembers:t.teamMembers,isProjectAccessed:t.isProjectAccessed,teamMembersCount:t.teamMembers.length,teamMembersInProjectCount:e.intersection(t.teamMembers,t.project.projectMembers).length,project:t.project,uri:this.config.context.configurator.getUrlBuilder().getNewViewUrl(t.project.id,"project",!0),appPath:this.config.context.configurator.getApplicationPath(),userStoriesSparkline:r,bugsSparkline:i};return o}})});