define(["Underscore","jQuery","tau/models/dataProviders/model.provider.items.base"],function(_,$,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("features","feature","severity",fnCallback)},_chainResponse:function(callback){var self=this,storeChain=self.config.store,$d=$.Deferred();return $d.pipe(function(r){var processIds=_(r[1].data.features).chain().map(function(item){var proj=item.project||{process:{id:null}};return proj.process.id}).uniq().without(null).value();if(processIds.length>0){var params={fields:["id",{entityStates:["id",{role:["id","name","hasEffort","isPair"]},{entityType:["id","name"]}]}],$query:{id:{$in:processIds}},list:!0};storeChain.get("process",params).done(function(p){callback(r)})}else callback(r)}),$d.resolve},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{priority:["id","name","importance"]},{project:["id",{process:["id"]}]}],detailCommand},_convertData:function(data){return data=this._super(data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data),priority:{id:data.priority.id,name:data.priority.name,kind:self.importanceProcessor.getKind(data.priority.importance)},projectId:data.project.id,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item.visibleEntityState=item.entityState,item}})})