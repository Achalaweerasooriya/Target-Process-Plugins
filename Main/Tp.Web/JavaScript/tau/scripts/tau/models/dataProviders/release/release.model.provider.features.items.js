define(["Underscore","jQuery","tau/models/dataProviders/model.provider.items.base"],function(t,e,i){return i.extend({fetch:function(t){this._fetch("features","feature","severity",t)},_chainResponse:function(i){var r=this,n=r.config.store,o=e.Deferred();return o.pipe(function(e){var r=t(e[1].data.features).chain().map(function(t){var e=t.project||{process:{id:null}};return e.process.id}).uniq().without(null).value();if(r.length>0){var o={fields:["id",{entityStates:["id",{role:["id","name","hasEffort","isPair"]},{entityType:["id","name"]}]}],$query:{id:{$in:r}},list:!0};n.get("process",o).done(function(){i(e)})}else i(e)}),o.resolve},_createDetailCommand:function(t){var e={};return e[t]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{priority:["id","name","importance"]},{project:["id",{process:["id"]}]}],e},_convertData:function(t){return t=this._super(t),t=this._calculateEffortToMaximum(t),this._sortByPriority(t)},_convertItem:function(t){var e=this;t.project=t.project||{};var i={id:t.id,name:t.name,numericPriority:t.numericPriority,__type:t.__type,entityState:{id:t.entityState.id,name:t.entityState.name,isInitial:t.entityState.isInitial,isFinal:t.entityState.isFinal,numericPriority:t.entityState.numericPriority},tags:this._processTags(t),effort:this._getEffortData(t),assignments:this._processAssignments(t),priority:{id:t.priority.id,name:t.priority.name,kind:e.importanceProcessor.getKind(t.priority.importance)},projectId:t.project.id,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(t.id,t.__type,!0)};return i.visibleEntityState=i.entityState,i}})});