define(["Underscore","tau/models/dataProviders/model.provider.groups.base"],function(a,b){return b.extend({fetch:function(b,c,d){var e={tasks:[],bugs:[]},f=[],g=[],h=a(c).select(function(a){return a.__type==="task"}),i=a(c).select(function(a){return a.__type==="bug"});e.tasks=a(h).chain().pluck("projectId").uniq().value(),this.config.context.isPracticeAvailable("Bug Tracking")&&(e.bugs=a(i).chain().pluck("projectId").uniq().value());var j=this.config.store,k=this;j.get("projects",{fields:[{process:["id"]}],list:!0}).done({success:function(c){var f=c[0].data,g={tasks:[],bugs:[]};a.forEach(e,function(b,c){g[c]=a(f).chain().select(function(c){return a(b).include(c.id)}).map(function(a){return a.process.id}).uniq().value()});var h=function(b){var c=(b.entityType.name||"").toLowerCase(),d=b.process.id;return c==="task"&&a(g.tasks).include(d)||c==="bug"&&a(g.bugs).include(d)};return k._fetchState(b,h,d)}})},moveToGroup:function(a,b,c,d){return this._moveToGroupByState(a,b,c,d)},isAvailableForItem:function(b,c,d){var e=a.find(d.realGroups,function(a){return a.id==b.entityState.id}),f=a.find(c.realGroups,function(a){return a.entityType.name.toLowerCase()==b.__type.toLowerCase()&&a.process.id==e.process.id}),g=a.pluck(e.nextStates,"id");return g.push(e.id),f&&a.include(g,f.id)},getCommentRequirements:function(b,c,d){var e=a.find(d.realGroups,function(a){return a.id==b.entityState.id}),f=[];return a.forEach(c,function(c){var d=a.find(c.realGroups,function(a){return a.entityType.name.toLowerCase()==b.__type.toLowerCase()&&a.process.id==e.process.id});f.push({isCommentRequired:d?d.isCommentRequired:!1})}),f}})})