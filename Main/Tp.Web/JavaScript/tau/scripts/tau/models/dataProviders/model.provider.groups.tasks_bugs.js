define(["Underscore","tau/models/dataProviders/model.provider.groups.base"],function(_,a){return a.extend({fetch:function(a,b,c){var d={tasks:[],bugs:[]},e=[],f=[],g=_(b).select(function(a){return a.__type==="task"}),h=_(b).select(function(a){return a.__type==="bug"});d.tasks=_(g).chain().pluck("projectId").uniq().value(),this.config.context.isPracticeAvailable("Bug Tracking")&&(d.bugs=_(h).chain().pluck("projectId").uniq().value());var i=this.config.store,j=this;i.get("projects",{fields:[{process:["id"]}],list:!0}).done({success:function(b){var e=b[0].data,f={tasks:[],bugs:[]};_.forEach(d,function(a,b){f[b]=_(e).chain().select(function(b){return _(a).include(b.id)}).map(function(a){return a.process.id}).uniq().value()});var g=function(a){var b=(a.entityType.name||"").toLowerCase(),c=a.process.id;return b==="task"&&_(f.tasks).include(c)||b==="bug"&&_(f.bugs).include(c)};return j._fetchState(a,g,c)}})},moveToGroup:function(a,b,c,d){return this._moveToGroupByState(a,b,c,d)},isAvailableForItem:function(a,b,c){var d=_.find(c.realGroups,function(b){return b.id==a.entityState.id}),e=_.find(b.realGroups,function(b){return b.entityType.name.toLowerCase()==a.__type.toLowerCase()&&b.process.id==d.process.id}),f=_.pluck(d.nextStates,"id");return f.push(d.id),e&&_.include(f,e.id)},getCommentRequirements:function(a,b,c){var d=_.find(c.realGroups,function(b){return b.id==a.entityState.id}),e=[];return _.forEach(b,function(b){var c=_.find(b.realGroups,function(b){return b.entityType.name.toLowerCase()==a.__type.toLowerCase()&&b.process.id==d.process.id});e.push({isCommentRequired:c?c.isCommentRequired:!1})}),e}})})