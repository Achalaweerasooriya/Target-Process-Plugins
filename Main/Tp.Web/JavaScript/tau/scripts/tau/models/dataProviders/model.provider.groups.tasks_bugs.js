define(["Underscore","tau/models/dataProviders/model.provider.groups.base"],function(a,b){return b.extend({fetch:function(b,c,d){var e=a.pluck(this.config.context.applicationContext.processes[0].practices,"name"),f=[],g=[],h=a(c).select(function(a){return a.__type==="task"});h.length&&(f=a(h).chain().pluck("projectId").uniq().value());var i=a(c).select(function(a){return a.__type==="bug"});i.length&&a.indexOf(e,"Bug Tracking")!==-1&&(g=a(i).chain().pluck("projectId").uniq().value());var j=this.config.store,k={fields:[{process:["id"]}],list:!0};j.get("projects",k,{scope:this,success:this.onReadyToFetch(f,g,b,d)}).done()},filterProcessesInProjects:function(b,c){return a(b).chain().select(function(b){return a(c).include(b.id)}).map(function(a){return a.process.id}).uniq().value()},onReadyToFetch:function(b,c,d,e){var f=this;return function(g){var h=g.data,i=f.filterProcessesInProjects(h,b),j=f.filterProcessesInProjects(h,c),k=function(b){var c=(b.entityType.name||"").toLowerCase(),d=b.process.id;return c==="task"&&a(i).include(d)||c==="bug"&&a(j).include(d)};return this._fetchState(d,k,e)}}})})