define(["Underscore","tau/core/model-base","tau/utils/utils.date","tau/utils/utils.htmlConverter"],function(t,e,s,i){function a(t){this.model=t}a.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetrieved}},onAssignableRetrieved:function(e){var s={labelAdd:this.model.config.labelAdd||"Add",items:[]};this.model.assignable=e.data;for(var i=t.sortBy(e.data.testCases,function(t){return t.numericPriority}),a=i.length,n=0;a>n;n++)s.items.push(this.convertServerDataModelData(i[n]));this.model.bus&&this.model.bus.fire("dataBind",s)},convertServerDataModelData:function(t){var e=null;t.lastRunDate&&(e=s.format.datetime.short(t.lastRunDate));var a=void 0;void 0!=t.lastStatus&&(a={isPassed:t.lastStatus});var n=(this.config.context.configurator.getUrlBuilder(),{__type:"testCase",id:t.id,name:t.name,lastRunDate:e,applicationUrl:"#testcase/"+t.id,steps:i.fromSourceToHtml(t.steps),success:i.fromSourceToHtml(t.success)});return a&&(n.lastRunStatus=a),n}};var n=e.extend({onInit:function(){var t=this,e=new a(t),s=t.config.context.entity;this.store.get(s.entityType.name,{id:s.id,fields:["id",{testCases:["id","name","lastRunDate","lastStatus","steps","success","numericPriority"]}]},e.getAssignableRetrievedCallback()).done()},"bus evictTestCases":function(){var t=this.config.context.entity;this.store.evictProperties(t.id,t.entityType.name,["testCases","testCases-count"])}});return n});