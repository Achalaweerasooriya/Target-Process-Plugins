define(["Underscore","tau/core/model-base","tau/utils/utils.urlBuilder","tau/utils/utils.date","tau/utils/utils.htmlConverter"],function(_,a,b,c,d){function e(a){this.model=a}e.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetrieved}},onAssignableRetrieved:function(a){var b={labelAdd:this.model.config.labelAdd||"Add",items:[]};this.model.assignable=a.data;var c=_.sortBy(a.data.testCases,function(a){return a.numericPriority}),d=c.length;for(var e=0;e<d;e++)b.items.push(this.convertServerDataModelData(c[e]));this.model.bus&&this.model.bus.fire("dataBind",b)},convertServerDataModelData:function(a){var e=null;a.lastRunDate&&(e=c.format.datetime.short(a.lastRunDate));var f=undefined;a.lastStatus!=undefined&&(f={isPassed:a.lastStatus});var g={__type:"testCase",id:a.id,name:a.name,lastRunDate:e,applicationUrl:"#testcase/"+a.id,externalUrl:b.getViewUrl(a.id),steps:d.fromSourceToHtml(a.steps),success:d.fromSourceToHtml(a.success)};return f&&(g.lastRunStatus=f),g}};var f=a.extend({onInit:function(){var a=this,b=new e(a),c=a.config.context.entity;this.store.get(c.entityType.name,{id:c.id,fields:["id",{testCases:["id","name","lastRunDate","lastStatus","steps","success","numericPriority"]}]},b.getAssignableRetrievedCallback()).done()},"bus evictTestCases":function(){var a=this.config.context.entity;this.store.evictProperties(a.id,a.entityType.name,["testCases","testCases-count"])}});return f})