define(["Underscore","tau/core/model-base","tau/utils/utils.urlBuilder","tau/utils/utils.date","tau/utils/utils.htmlConverter"],function(a,b,c,d,e){function f(a){this.model=a}f.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetrieved}},onAssignableRetrieved:function(b){var c={labelAdd:this.model.config.labelAdd||"Add",items:[]};this.model.assignable=b.data;var d=a.sortBy(b.data.testCases,function(a){return a.numericPriority}),e=d.length;for(var f=0;f<e;f++)c.items.push(this.convertServerDataModelData(d[f]));this.model.bus&&this.model.bus.fire("dataBind",c)},convertServerDataModelData:function(a){var b=null;a.lastRunDate&&(b=d.format.datetime.short(a.lastRunDate));var f=undefined;a.lastStatus!=undefined&&(f={isPassed:a.lastStatus});var g={__type:"testCase",id:a.id,name:a.name,lastRunDate:b,applicationUrl:"#testcase/"+a.id,externalUrl:c.getViewUrl(a.id),steps:e.fromSourceToHtml(a.steps),success:e.fromSourceToHtml(a.success)};return f&&(g.lastRunStatus=f),g}};var g=b.extend({onInit:function(){var a=this,b=new f(a),c=a.config.context.entity;this.store.get(c.entityType.name,{id:c.id,fields:["id",{testCases:["id","name","lastRunDate","lastStatus","steps","success","numericPriority"]}]},b.getAssignableRetrievedCallback()).done()},"bus evictTestCases":function(){var a=this.config.context.entity;this.store.evictProperties(a.id,a.entityType.name,["testCases","testCases-count"])}});return g})