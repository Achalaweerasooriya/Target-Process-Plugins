define(["Underscore","tau/core/extension.base"],function(e,i){return i.extend({"bus afterInit":function(e,i){this.fire("configurator.ready",i.config.context.configurator)},"bus boardSettings.ready:last + configurator.ready":function(i,t){t.boardSettings.get({fields:["ownerIds"],callback:e.bind(function(e){this.fire("ownerIds.ready",{ownerIds:e.ownerIds})},this)})},"bus configurator.ready:last + ownerIds.ready":function(i,t,n){t.getStore().find("user",{$query:{id:{$in:n.ownerIds},deleteDate:{$isNull:!0}},fields:["id","firstName","lastName","avatarUri","email"]}).done({success:e.bind(function(e){var i=e[0].data;this._dataBind(i,n,t)},this),failure:e.bind(function(){this._dataBind([],n,t)},this)})},_dataBind:function(e,i,t){var n=this._createViewModel(e,i.ownerIds,t.getLoggedUser());this.fire("dataBind",n)},_createViewModel:function(i,t,n){var r=e.bind(function(e,i){return i==e},this,n.id),a=1===i.length,d=n.isAdministrator||e.some(t,r),s=e.map(i,function(i){return{displayName:(e.trim([i.firstName,i.lastName].join(" "))||i.email).replace(/\s/g,"&nbsp;"),avatarUri:i.avatarUri,canBeDeleted:d&&!r(i.id)&&!a,userId:i.id}});return{canBeAdded:d,owners:e.sortBy(s,function(i){return e.indexOf(t,i.userId)})}}})});