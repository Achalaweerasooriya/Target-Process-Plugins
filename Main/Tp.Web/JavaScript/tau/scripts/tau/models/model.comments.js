define(["Underscore","tau/core/model-base","tau/models/dataprocessor/model.processor.comment"],function(e,t,n){return t.extend({name:"Comments",FIELDS:["id",{comments:["id","description","createDate","parentId",{owner:["id","firstName","lastName","kind","avatarUri","email"]}],list:!0}],onInit:function(){this.converter=new n(this.config.context.configurator),this._requestAssignable()},"bus createDTO":function(e){var t=this.converter.convertDTO(e.data);t.comments=[],this.fire("DTOCreated",t)},_requestAssignable:function(){var e=this.config.context.entity,t={id:e.id,fields:this.FIELDS},n={success:this.safeCallback(this._onAssignableRetrieved)};this.store.get(e.entityType.name,t,n).done()},_onAssignableRetrieved:function(t){this.assignable=t.data;var n=t.data.comments,r=e.sortBy(n,function(e){return e.id});this._convertDTO(r);var s=this._convertToTree(null);this.bus.fire("dataBind",{items:s})},_convertDTO:function(t){return this.convertedComments=e.map(t,function(e){return this.converter.convertDTO(e)},this),this},_convertToTree:function(e){for(var t=[],n=this.convertedComments,r=0,s=n.length;s>r;r++){var i=n[r];i.parentId==e&&(t.push(i),i.comments=this._convertToTree(i.id))}return t},destroy:function(){this.converter.destroy(),this.converter=null,this._super()}})});