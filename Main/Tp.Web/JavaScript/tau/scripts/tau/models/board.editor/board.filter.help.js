define(["Underscore","jQuery","tau/core/class","tau/models/board.editor/board.filter.help.data","tau/store/types"],function(_,$,Class,data,tauTypes){var _cache={},map={assigneduser:"assignment"},additions={userStory:["releasable"],bug:["releasable"],feature:["releasable"],task:["releasable"],iteration:["releasable","time_container"],teamIteration:["time_container"],release:["time_container"]};return Class.extend({getTypes:function(type){return _cache.hasOwnProperty(type)||(_cache[type]=this._getTypes(type)),_cache[type]},_getTypes:function(type){var register=[];map.hasOwnProperty(type)&&(type=map[type]);var typeDescription=tauTypes.findByKeyword(type);typeDescription&&typeDescription.name&&additions.hasOwnProperty(typeDescription.name)&&(register=register.concat(additions[typeDescription.name]));if(!typeDescription)register.push(type);else{var parent=typeDescription.parent;register.push(typeDescription.name);while(parent){register.push(parent);var p=tauTypes.findByKeyword(parent);if(!p)break;parent=p.parent}}return register},get:function(config){config=config||{};var result={},self=this,$deferred=$.Deferred();return _.each(_.keys(config),function(key){var types=(config[key]||{}).types||[];if(types.length===0)return;result[key]=[];var keys=[];_.each(types,function(type){keys.push(self.getTypes(type))}),keys=_.intersection.apply(null,keys),_.each(keys,function(keyValue){var val=data[keyValue];if(!val)return;result[key]=result[key].concat(val)})}),$deferred.resolve(result),$deferred}})})