define(["Underscore","jQuery","tau/core/class"],function(_,$,Class){var suggestionsCache={};return Class.extend({init:function(configurator){this.url=configurator.getApplicationPath()+"/api/v2/lang/query",this.acidStore=configurator.getAppStateStore(),this.ajaxService=$.ajax},get:function(params){params=_.defaults(params||{},{query:{resourceTypes:[],script:""},take:50,skip:0,options:{insertDotForObjectAttribute:!0,insertLeftBracketForObjectCollectionMethod:!0}});var url=this.url+"/suggestions",$deferred=$.Deferred();return this.acidStore.get({fields:["acid"],callback:_.bind(function(res){var acid=res.acid;params.acid=acid;var strParams=JSON.stringify(params),cacheKey=(url+"/"+strParams).toLowerCase(),$subDeferred=suggestionsCache.hasOwnProperty(cacheKey)?suggestionsCache[cacheKey]:this.ajaxService({url:url,type:"POST",data:strParams,dataType:"json",contentType:"application/json; charset=utf-8"});suggestionsCache[cacheKey]=$subDeferred,$subDeferred.done($deferred.resolve).fail($deferred.fail)},this)}),$deferred}})})