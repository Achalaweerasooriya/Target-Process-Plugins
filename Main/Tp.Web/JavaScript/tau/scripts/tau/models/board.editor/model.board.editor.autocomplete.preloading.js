define(["Underscore","tau/core/extension.base"],function(e,t){return t.extend({"bus configurator.ready:last + suggestionManager.ready:last + preloading.execute":function(t,r,n){var i=r.service("boardSettings");i.get({fields:["x","y","cells","user"],callback:e.bind(function(t){this._preloadAll(n,t).done(e.bind(function(){this.fire("preload.complete")},this))},this)})},_preloadAll:function(e,t){var r=[];return t.x&&(r=r.concat(this._preload(t.x.types,t.x.filter,e))),t.y&&(r=r.concat(this._preload(t.y.types,t.y.filter,e))),t.cells&&(r=r.concat(this._preload(t.cells.types,t.cells.filter,e)),t.user&&(r=r.concat(this._preload(t.cells.types,t.user.cardFilter,e)))),$.whenList(r)},_preload:function(t,r,n){var i=[];if(e.isArray(t)||(t=[t]),!(t.indexOf("effort")>=0||t.indexOf("source")>=0)){e.each(t,function(t){i.push(e.isString(t)?t:t.type)}),r=r||"";var s=["?"];return r.length>1&&"?"===r[0]&&s.push(r.trim()+" "),0===i.length?[]:e.map(s,function(e){return n.get({query:{resourceTypes:i,script:e}})})}}})});