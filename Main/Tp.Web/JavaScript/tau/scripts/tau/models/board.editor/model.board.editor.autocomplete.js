define(["require","jQuery","Underscore","tau/core/extension.base","tau/models/board.editor/board.filter.suggestionManager"],function(e){var r=e("jQuery"),t=e("Underscore"),n=e("tau/core/extension.base"),o=e("tau/models/board.editor/board.filter.suggestionManager");return n.extend({"bus configurator.ready":function(e,r){var t=new o(r);this.fire("suggestionManager.ready",t)},_getTypes:function(e,t){if(!e)return r.Deferred().reject();var n=r.Deferred();return t.get({fields:[e],callback:function(r){var t=[];r.hasOwnProperty(e)&&(t=r[e].types||[]),n.resolve(t)}}),n},"bus suggestionManager.ready:last + boardSettings.ready:last + filter.autocomplete.preload":function(e,r,n,o){this._getTypes(o.typesProperty,n.boardSettings).done(function(e){if(e.length){var n=o.value;if(n&&0!==n.length&&"?"==n[0]){var s=[n.trim()+" ",n.trim()+"."];t.each(s,function(t){var n={query:{resourceTypes:e,script:t}};r.get(n)})}}})},"bus suggestionManager.ready:last + boardSettings.ready:last + filter.autocomplete.resolve":function(e,r,n,o){this._getTypes(o.typesProperty,n.boardSettings).done(function(e){if(!e.length)return void o.next([]);var n=o.term,s=function(e){var r=e.Suggestions?e.Suggestions.Items:[];r=t.map(r,function(r){return r.Source=e.Source,r.Position=e.Position,r}),o.next(r)},a=function(){o.next([])};r.get({query:{resourceTypes:e,script:n}}).done(s).fail(a)})}})});