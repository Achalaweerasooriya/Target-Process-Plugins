define(["Underscore","tau/core/extension.base","tau/models/board.editor/board.filter.suggestionManager"],function(e,t,r){var n=t.extend({"bus configurator.ready":function(e,t){var n=new r(t);this.fire("suggestionManager.ready",n)},getTypes:function(e,t){var r=e.prop("name"),n=$.Deferred();if(!r)return n.reject(),n;var a=r.replace("_filter","");return t.get({fields:[a],callback:function(e){var t=[];e.hasOwnProperty(a)&&(t=e[a].types||[]),n.resolve(t)}}),n},"bus suggestionManager.ready:last + boardSettings.ready:last + filter.autocomplete.preload":function(t,r,n,a){var i=a.$input;this.getTypes(i,n.boardSettings).done(function(t){if(0!=t.length){var n=a.value;if(n&&0!==n.length&&"?"==n[0]){var i=[n.trim()+" ",n.trim()+"."];e.each(i,function(e){var n={query:{resourceTypes:t,script:e}};r.get(n)})}}})},"bus suggestionManager.ready:last  + boardSettings.ready:last + filter.autocomplete.resolve":function(t,r,n,a){var i=a.$input;this.getTypes(i,n.boardSettings).done(function(t){if(0==t.length)return void a.next([]);var n=a.request.term.slice(0,i[0].selectionStart),o=function(t){var r=t.Suggestions?t.Suggestions.Items:[];r=e.map(r,function(e){return e.Source=t.Source,e.Position=t.Position,e}),a.next(r)},s=function(){a.next([])},u={query:{resourceTypes:t,script:n}};r.get(u).done(o).fail(s)})}});return n});