define(["Underscore","tau/core/extension.base","tau/libs/inviter/inviter"],function(_,BaseModel,Inviter){return BaseModel.extend({"bus configurator.ready:last + form.submitted":function(evt,configurator,formData){var self=this,inviter=new Inviter(configurator);inviter.invite(formData.members).done(function(members){self.fire("members.saved",members)})},"bus configurator.ready:last + entity.ready:last + members.saved":function(evt,configurator,team,members){var self=this,store=configurator.getStore(),successed=_.compact(_.pluck(members,"success")),failed=_.compact(_.pluck(members,"failure"));if(failed.length){var message="Can't assign users.";this.fire("team.add.nonFatalFailure",message)}var set={teamMembers:_.map(successed,function(id){return{user:{id:id}}})};store.save("team",{id:team.id,$set:set,fields:["id","name","icon",{teamMembers:[{user:["id","firstName","lastName","avatarUri"]},{role:["id","name"]}]}]}).done(function(res){self.fire("members.connected",res[0].data)})},"bus entity.ready:last + members.saved + members.connected":function(evt,teamSimple,members,teamFull){this.fire("invitation.success",teamFull)}})})