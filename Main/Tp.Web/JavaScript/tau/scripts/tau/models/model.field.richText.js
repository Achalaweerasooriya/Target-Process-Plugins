define(["tau/core/model-base","tau/utils/utils.htmlConverter"],function(a,b){var c=a.extend({name:"field ",init:function(a){this._super.apply(this,arguments),this.fieldName=a.fieldName;if(!a.fieldName)throw"model.field.richText fieldName is undefined"},onInit:function(){var a=this.config.context,b=a.entity.entityType.name,c=a.entity.id,d=this,e=function(a){if(a.data.id!=c)return;var b=a.data.changes;if(!b.hasOwnProperty(d.fieldName))return;d.fire("applyChanges",b)},f=function(a){if(a.data.id!=c)return;var b=a.data.changes;if(!b.hasOwnProperty(d.fieldName))return;d.fire("prepareChanges",b)};this.store.on({eventName:"beforeSave",type:b,listener:this},f).on({eventName:"afterSave",type:b,listener:this},e);var g={id:c,fields:["id",d.fieldName]};this.store.get(b,g,{scope:this,success:this.entityRetrieved}).done({success:this.requestDone,scope:this})},entityRetrieved:function(a){var b=a.data;this.id=b.id,this.fieldValue=b[this.fieldName]},requestDone:function(){this.bus.fire("dataBind",{html:b.fromSourceToHtml(this.fieldValue)})}});return c})