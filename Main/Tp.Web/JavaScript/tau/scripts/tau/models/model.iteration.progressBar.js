define(["Underscore","tau/core/model-base"],function(a,b){var c=b.extend({name:"Iteration Progress Bar",afterSaveRoleEffort:function(a){var b=this;b.fire("roleEffortChanged")},onDataUpdate:function(a){var b=this;b.fire("refresh")},floatToString:function(a){return a.toFixed(2).replace(".00","")},_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},onInit:function(){var b=this,c=this.config.context,d=c.entity.entityType.name,e=c.entity.id,f=["bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum"];b.store.unbind(b),b.store.on({eventName:"afterSave",type:"roleEffort",listener:b,filter:{assignable:{id:e}}},a.bind(b.afterSaveRoleEffort,b)),b.store.on({eventName:"afterSave",type:d,listener:b,filter:{id:e},hasChanges:[f.join("|")]},a.bind(b.onDataUpdate,b)),b.store.get(d,{id:e,fields:f},{success:b.onEntityRetrieved,scope:b}).done({success:b.done,scope:b})},onEntityRetrieved:function(a){var b=a.data,c=b["bugs-effortToDo-sum"]+b["userStories-effortToDo-sum"],d=b["bugs-effortCompleted-sum"]+b["userStories-effortCompleted-sum"],e=Math.round(100*parseFloat(c)+100*parseFloat(d))/100,f=Math.round(1e4*(d/e))/100;f=isNaN(f)?0:f,f=f>100?100:f,this.effortToDo=c,this.effortCompleted=d,this.percentCompleted=f},done:function(){this.fire("dataBind",{effortToDo:this.floatToString(this.effortToDo),effortCompleted:this.floatToString(this.effortCompleted),percentCompleted:this.percentCompleted,totalEffort:this.floatToString(this.effortToDo+this.effortCompleted),point:this._getEffortPoints()})}});return c})