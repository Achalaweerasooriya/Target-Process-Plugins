define(["tau/models/model.property"],function(ModelBase){return ModelBase.extend({onInit:function(){this.listenOfPropertyChanged();var entity=this.config.context.entity,typeName=entity.entityType.name,userFields={};userFields[this.config.propertyName]=["id","firstName","lastName","email","avatarUri"],this.store.get(typeName,{id:entity.id,fields:["id",userFields]}).done({scope:this,success:this.initialDataProcessor}),this.bindStoreListeners()},initialDataProcessor:function(result){var config=this.config;if(!config)return;var entity=result[0].data,user=entity[config.propertyName];if(!user)return;var username=user.email;if(user.firstName||user.lastName)username=_.trim([user.firstName,user.lastName].join(" "));var visibleName=username;config.hidename&&(username="");var data={id:user.id,avatar:user.avatarUri+"24",name:username,visibleName:visibleName};this.fire("dataBind",data)},bindStoreListeners:function(){var self=this;self.store.on({eventName:"afterSave",type:"user",hasChanges:["avatarUri"],listener:self},function(){self.afterUserSaved.apply(self,arguments)})},afterUserSaved:function(command){this.fire("userAvatarChanged",command.data)},"bus dataBind:last + userAvatarChanged":function(evt,dataBind,userData){dataBind.id===userData.id&&this.fire("avatarChanged",userData)}})})