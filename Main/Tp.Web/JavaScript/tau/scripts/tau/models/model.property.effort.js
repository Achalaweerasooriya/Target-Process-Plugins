define(["tau/core/model-base"],function(ModelBase){var EffortModel=ModelBase.extend({onInit:function(){var self=this,ctx=self.config.context,typeName=ctx.entity.entityType.name,entityId=ctx.entity.id;self.store.unbind(self),self.store.on(self.getSubscriptionConfig("afterSave"),_.bind(self.onEntityAfterSave,self)),self.store.on(self.getSubscriptionConfig("beforeSave"),_.bind(self.onEntityBeforeSave,self)),self.store.get(typeName,{id:entityId,fields:["id","effort",{roleEfforts:["id",{role:["id","hasEffort"]}]}]}).done({scope:self,success:self.done})},done:function(r){var self=this,entity=r[0].data,ctx=self.config.context,typeName=ctx.entity.entityType.name,data={id:entity.id,effort:Math.round(100*entity.effort)/100,unit:ctx.getEffortPoint(typeName),roleEfforts:entity.roleEfforts};self.fire("dataBind",data)},getSubscriptionConfig:function(eventName){var self=this,entity=self.config.context.entity;return{eventName:eventName,type:"roleEffort",listener:self,filter:{assignable:{id:entity.id}},hasChanges:["effort"]}},onEntityAfterSave:function(evtArgs){this.fire("propertyChanged")},onEntityBeforeSave:function(evtArgs){this.fire("beforeChangeProperty")}});return EffortModel})