define(["Underscore","tau/core/model.editable.base"],function(_,ModelBase){var editableModel=ModelBase.extend({category:"edit",name:"Editable custom field","bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0,deletable:!0})},"bus beforeSave":function(evt){var val=evt.data.cmd.$set.customFields[0].value;evt.data.cmd.$set.customFields[0].value=val?val:null,evt.data.cmd.$set.customFields[0].type=="URL"&&val.label==null&&val.url==null&&(evt.data.cmd.$set.customFields[0].value=null)},"bus beforeInit+configurationProvided":function(evt){var entity=evt.beforeInit.data.config.context.entity,field=evt.configurationProvided.data;this.configuration=field,this.beforeSaveHandler||(this.beforeSaveHandler=_.bind(this._beforeSave,this),this.store.on({eventName:"beforeSave",type:entity.entityType.name,listener:this,hasChanges:["customFields"],filter:{id:entity.id}},this.beforeSaveHandler)),this.afterSaveHandler||(this.afterSaveHandler=_.bind(this._afterSave,this),this.store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,hasChanges:["customFields"],filter:{id:entity.id}},this.afterSaveHandler))},_beforeSave:function(evt){var changedField=evt.data.changes.customFields[0];_.mergeFields(evt.data.cmd.config.fields,["customFields"]);var currentField=this.configuration;changedField.name==currentField.name&&changedField.type==currentField.type&&this.bus.fire("preRefreshRow",{data:changedField})},_afterSave:function(evt){this.bus.fire("refreshRow",{})},destroy:function(){this.beforeSaveHandler=null,this.afterSaveHandler=null,this._super()}});return editableModel})