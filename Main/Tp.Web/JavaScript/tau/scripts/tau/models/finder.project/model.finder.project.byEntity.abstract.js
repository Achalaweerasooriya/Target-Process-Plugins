define(["Underscore","tau/core/extension.base","tau/configurations/project.colors","tau/core/templates-factory"],function(t,e,r,n){return e.extend({resetLifecycle:!0,"bus beforeInit":function(t,e){var r=e.config.context.configurator;this.fire("configurator.ready",r),this.fire("entity.ready",e.config.context.entity)},"bus configurator.ready + entity.ready":function(t,e){var r=e.getStore(),n=this.fire.bind(this,"refresh");r.unbind(this),r.on(this._getStoreOnRefreshConfig(),n)},"bus configurator.ready:last + entity.ready":function(t,e,r){this._getAssignedEntities(e.getStore(),r)},"bus configurator.ready:last + destroy":function(t,e){var r=e.getStore();r.unbind(this)},_getAvailableEntities:function(e,n){var i=this.fire.bind(this,"dataBind");t.parallel(e,function(t,e){var o=e.projects,s=e.processes,a=e.programs;i({projects:o,processes:s,programs:a,activeTab:n,canAddProjects:!0,teams:[],canAddTeams:!1,submitLabel:"Assign",showEmpty:!0,showSearch:o.length>20,colors:r})})},_getList:function(e,r,n,i,o){e.get(r,{fields:n}).done({success:function(e){var r=e[0].data;r=t.filter(r,function(e){return-1==t.indexOf(i,e.id)}),r=t.sortBy(r,this._sortByName),o(!1,r)}})},_getPrograms:function(e,r){e.get("program",{fields:["id","name"]}).done(function(e){var n=t.sortBy(e[0].data,this._sortByName);n.length&&n.unshift(this._getDefaultProgram()),r(!1,n)}.bind(this))},_getDefaultProgram:function(){var t=n.termProcessor.getTerm("Program","name");return{id:-1,name:"No "+t}},_sortByName:function(t){return t.name.toUpperCase()}})});