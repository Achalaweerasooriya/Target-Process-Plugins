define(["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(_,ModelBase,configFactory){return ModelBase.extend({resetLifecycle:!0,"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator),this.fire("entity.ready",initConfig.config.context.entity)},"bus configurator.ready + entity.ready":function(e,configurator,user){var store=configurator.getStore(),fireRefresh=_.bind(this.fire,this,"refresh");store.unbind(this),store.on({eventName:"afterSave",type:"team",listener:this,hasChanges:["teamProjects"]},fireRefresh)},"bus configurator.ready:last + teamProjects.ready:last + activeTab.ready:last + beforeInit":function(e,configurator,teamProjects,activeTab){var self=this,store=configurator.getStore(),f=[];f.push(_.bind(this._getList,this,store,"project",["id","name","color"],_.pluck(_.compact(_.pluck(teamProjects,"project")),"id"))),f.push(_.bind(this._getList,this,store,"process",["id","name","isDefault"],[])),_.parallel(f,function(err,res){var projects=res[0],processes=res[1];self.fire("dataBind",{projects:projects,activeTab:activeTab,canAddProjects:!0,teams:[],canAddTeams:!1,showTeams:!1,submitLabel:"Assign",showEmpty:!0,showSearch:projects.length>20,colors:configFactory.getConfigByType("project").prototype.colors,processes:processes})})},_getList:function(store,name,fields,excludeIds,next){store.get(name,{fields:fields}).done({success:function(result){var items=result[0].data;items=_.filter(items,function(v){return _.indexOf(excludeIds,v.id)==-1}),items=_.sortBy(items,function(v){return v.name.toUpperCase()}),next(!1,items)}})},"bus configurator.ready:last + entity.ready":function(evt,configurator,entity){var self=this;configurator.getStore().get("team",{id:entity.id,fields:[{teamProjects:[{project:["id","name"]}]}]}).done({success:function(res){self.fire("teamProjects.ready",res[0].data.teamProjects)}})},"bus configurator.ready:last + destroy":function(e,configurator){var store=configurator.getStore();store.unbind(this)}})})