define(["Underscore","tau/core/templates-factory","tau/models/finder.project/model.finder.project.byEntity.abstract"],function(e,t,r){var a=function(e){return e.name.toUpperCase()};return r.extend({resetLifecycle:!0,"bus configurator.ready:last + teamProjects.ready:last + activeTab.ready:last + beforeInit":function(t,r,a,i){var n=r.getStore(),s=e.chain(a).pluck("project").compact().pluck("id").value(),o=[this._getList.bind(this,n,"project",["id","name","color"],s),this._getList.bind(this,n,"process",["id","name","isDefault"],[]),this._getPrograms.bind(this,n)];this._getAvailableEntities(o,i)},_getStoreOnRefreshConfig:function(){return{eventName:"afterSave",type:"team",listener:this,hasChanges:["teamProjects"]}},_getAssignedEntities:function(e,t){var r=this;e.get("team",{id:t.id,fields:[{teamProjects:[{project:["id","name"]}]}]}).done({success:function(e){r.fire("teamProjects.ready",e[0].data.teamProjects)}})},_getDefaultProgram:function(){var e=t.termProcessor.getTerm("Program","name");return{id:-1,name:"No "+e}},_getPrograms:function(t,r){t.get("program",{fields:["id","name"]}).done(function(t){var i=e.sortBy(t[0].data,a);i.length&&i.unshift(this._getDefaultProgram()),r(!1,i)}.bind(this))}})});