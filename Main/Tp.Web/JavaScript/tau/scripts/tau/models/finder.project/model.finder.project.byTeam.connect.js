define(["Underscore","tau/core/extension.base"],function(e,t){return t.extend({"bus configurator.ready:last + entity.ready:last + form.submitted":function(e,t,n,c){var o=this,r=c.projectIds;this._connect(t,n,r).done(function(){o.fire("projects.connected",r)})},"bus configurator.ready:last + entity.ready:last + project.add.success":function(e,t,n,c){var o=this,r=[c.id];this._connect(t,n,r).done(function(){o.fire("projects.connected",r)})},_connect:function(t,n,c){var o=t.getStore(),r=[],i=[];e.forEach(c,function(e){i.push({project:{id:e}})}),r.push({id:n.id,type:"team",fields:["id","teamProjects"],data:{teamProjects:i}});var s=[function(e){o.evictProperties(n.id,n.entityType.name,["teamProjects"]),e()}];e.forEach(r,function(e){s.push(function(t){o.save(e.type,{id:e.id,fields:e.fields,$set:e.data}).done({success:function(e){t(!1,e[0].data)}})})});var a=$.Deferred();return e.parallel(s,function(){a.resolve(c)}),a}})});