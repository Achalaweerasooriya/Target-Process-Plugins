define(["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus configurator.ready:last + entity.ready:last + form.submitted":function(evt,configurator,entity,data){var self=this,ids=data.projectIds;this._connect(configurator,entity,ids).done(function(){self.fire("projects.connected",ids)})},"bus configurator.ready:last + entity.ready:last + project.add.success":function(evt,configurator,entity,project){var self=this,ids=[project.id];this._connect(configurator,entity,ids).done(function(){self.fire("projects.connected",ids)})},_connect:function(configurator,team,ids){var store=configurator.getStore(),saves=[],tps=[];_.forEach(ids,function(projectId){tps.push({project:{id:projectId}})}),saves.push({id:team.id,type:"team",fields:["id","teamProjects"],data:{teamProjects:tps}});var f=[function(next){store.evictProperties(team.id,team.entityType.name,["teamProjects"]),next()}];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})});var def=$.Deferred();return _.parallel(f,function(err,res){def.resolve(ids)}),def}})})