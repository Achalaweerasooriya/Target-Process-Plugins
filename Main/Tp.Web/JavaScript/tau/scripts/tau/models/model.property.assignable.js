define(["tau/models/model.property"],function(ModelBase){return ModelBase.extend({onInit:function(){var self=this;self._super.apply(self,arguments),self.store.unbind(self),self.store.on({type:self.getEntityTypeName(),eventName:"beforeSave",listener:self,filter:{id:self.getEntityId()},hasChanges:[self.propertyName]},function(args){self.store.evictProperties(self.getEntityId(),self.getEntityTypeName(),[self.config.refField]),self.fire("beforeChanged",args.data)}),self.store.on({type:self.getEntityTypeName(),eventName:"afterSave",listener:self,filter:{id:self.getEntityId()},hasChanges:[self.propertyName]},function(args){self.fire("propertyChanged",args.data)})},getPropertyData:function(){var self=this;self.store.get(self.getEntityTypeName(),{id:self.getEntityId(),fields:["id",self.config.refField]},{success:function(args){if(!args.data[self.config.refField]||args.data[self.config.refField].length===0){self.processProperty({});return}self.store.get("assignable",{id:args.data[self.config.refField][0],fields:[self.displayField,self.valueField]},{success:function(args){self.processProperty(args.data)}}).done()},scope:self}).done()}})})