define(["Underscore","tau/models/model.property"],function(e,t){return t.extend({onInit:function(e){this._super(e),this.store.unbind(this),this.store.on({type:this.getEntityTypeName(),eventName:"beforeSave",listener:this,filter:{id:this.getEntityId()},hasChanges:[this.propertyName]},function(e){this.store.evictProperties(this.getEntityId(),this.getEntityTypeName(),[this.config.refField]),this.fire("beforeChanged",e.data)}.bind(this)),this.store.on({type:this.getEntityTypeName(),eventName:"afterSave",listener:this,filter:{id:this.getEntityId()},hasChanges:[this.propertyName]},function(e){this.fire("propertyChanged",e.data)}.bind(this))},getPropertyData:function(){this.store.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",this.config.refField]},{success:this.safeCallback(this._processRefField)}).done()},_processRefField:function(t){var i=t.data[this.config.refField];return i&&0!==i.length?void this.store.get("assignable",{id:i[0],fields:[this.displayField,this.valueField]},{success:this.safeCallback(e.compose(this.processProperty,e.property("data")))}).done():void this.processProperty({})}})});