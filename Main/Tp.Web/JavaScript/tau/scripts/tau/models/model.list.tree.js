define(["Underscore","tau/core/model-base","tau/models/dataProviders/model.provider.groups.default"],function(_,a,b){var c=a.extend({onInit:function(){var a=this;this.config.groupsDataProvider&&(b=this.config.groupsDataProvider);var c=_.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,d=new b(this.config);d.fetch(c,[],function(b){a.fire("afterGroupsProvided",{data:b})})},"bus afterGroupsProvided":function(a){var b=a.data.data,c=this,d=new this.config.itemsDataProvider(this.config),e=[];_.forEach(b,function(a){var b=function(b){d.fetchForGroup(a,function(c){a.items=c,b()})};e.push(b)}),_.parallel(e,function(){c.fire("afterDataProvided",{data:{items:[],groups:b}})})},"bus afterDataProvided":function(a){var b=this.preProcess(a.data.data);this.fire("preDataBind",b),this.fire("dataBind",b)},preProcess:function(a){var b=this.config.views[0];return _.forEach(a.groups,function(a){a.title||(_.isObject(a.key)?a.title=_.complexKey(a.key,b.group.dataIndex):a.title=a.key)}),a.config={views:this.config.views,currentView:b},a},innerGroupBy:function(a,b){var c=_.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,d=this;return _.forEach(b,function(b){_.forEach(a,function(a){var d=_.complexKey(a,c);_.isArray(b.key)&&_.indexOf(b.key,d)>-1?b.items.push(a):_.isEqual(b.key,d)&&b.items.push(a)})}),b}});return c})