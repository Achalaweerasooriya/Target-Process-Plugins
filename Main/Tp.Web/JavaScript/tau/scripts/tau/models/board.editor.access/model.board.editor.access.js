define(["Underscore","tau/core/model-base"],function(e,t){return t.extend({"bus beforeInit":function(e){var t=e.data.config.context.configurator;this.fire("configurator.ready",t)},getTeams:function(e){var t=$.Deferred();return e.get("team",{fields:["id","name","icon"]}).done(function(e){t.resolve(e[0].data)}),t},getProjects:function(t){var i=$.Deferred();return t.get("project",{fields:["id","name","color","isActive"]}).done(function(t){var a=e.filter(t[0].data,function(e){return e.isActive});i.resolve(a)}),i},getBoardAccess:function(e,t){var i=$.Deferred(),a=t.getLoggedUser(),n=t.getBoardAccessService();return e.get({fields:["id","ownerIds","name","isShared","customSharedData","acid"],callback:function(e){var t={isShared:e.isShared,isOwner:n.isOwner(e,a),isAdmin:a.isAdministrator,isEditable:n.isEditable(e,a),customSharedData:e.customSharedData,id:e.id,name:e.name,acid:e.acid};t.customSharedData||(t.customSharedData={isActive:!1,teamIds:[],projectIds:[]}),i.resolve(t)}.bind(this)}),i},getEmailNotificationSettings:function(e){var t=$.Deferred();return e.getGlobalSettingsService().getGlobalSettings({success:function(e){t.resolve(e.IsEmailNotificationsEnabled)},failure:function(){t.resolve(!1)}}),t},_process:function(t,i){var a=function(e){return(-1==e.id?"0":"1")+(e.selected?"0_":"1_")+e.name.toUpperCase()},n=t;return n=e.chain(n).map(function(t){return{id:t.id,name:t.name,icon:t.icon,color:t.color,selected:e.indexOf(i,t.id)>=0}}).sortBy(a).value()},"bus configurator.ready + boardSettings.ready:last":function(t,i,a){var n=i.getStore(),r=a.boardSettings;$.when(this.getTeams(n),this.getProjects(n),this.getBoardAccess(r,i),this.getEmailNotificationSettings(i)).done(function(e,t,i,a){e=this._process(e,i.customSharedData.teamIds),t=this._process(t,i.customSharedData.projectIds),this.fire("dataBind",{access:i,teams:e,projects:t,canAddTeams:!1,canAddProjects:!1,checkedAllProject:t.length==i.customSharedData.projectIds.length,checkedAllTeam:e.length==i.customSharedData.teamIds.length,showSearch:!0,submitLabel:"Share",boardId:i.id,boardName:i.name,isEmailNotificationsEnabled:a,boardAcid:i.acid})}.bind(this));var s=e.debounce(function(){this.fire("componentRefresh")}.bind(this),300);r.unbind({listener:this}),r.bind({fields:["name","acid"],listener:this,callback:s}),n.unbind(this),n.on({eventName:"afterSave",type:"team",listener:this},s),n.on({eventName:"afterRemove",type:"team",listener:this},s),n.on({eventName:"afterSave",type:"project",listener:this},s),n.on({eventName:"afterRemove",type:"project",listener:this},s)},"bus elementInsertedToContainer:last + componentRefresh":function(){this.fire("refresh")},"bus boardSettings.ready:last + form.submitted":function(e,t,i){t.boardSettings.set({set:i})},"bus destroy + boardSettings.ready:last":function(e,t,i){i.boardSettings.unbind({listener:this})}})});