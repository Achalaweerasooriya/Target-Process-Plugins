define(["Underscore","tau/models/model.label","tau/libs/store2/store2"],function(t,e,a){var n=e.extend({_updateBadge:function(t){this.fire("updateBadge",{badgeConfig:t})},"bus updateBadge":function(t,e){var a=e.badgeConfig||{};this._badgeDataRetrieve(a)},_badgeDataRetrieve:function(e){this._getStore2().findAll("general?select={masterRelations.Count()%20%2B%20slaveRelations.Count()%20as%20totalRelationCount,%20masterRelations.ActiveMasterRelationsCount().openBlockers%20as%20blockerRelationCount,%20masterRelations.Select({id,master.id%20as%20masterId})%20as%20masterRelations}&where=(id=="+this.config.context.entity.id+")").done(t.bind(function(t){0!==t.length&&this.fire("badgeDataRetrieved",{badgeConfig:e,badgeData:t[0]})},this))},_getStore2:function(){return this.store2||(this.store2=new a(this.config.context.configurator)),this.store2},"bus badgeDataRetrieved":function(t){var e=t.data.badgeConfig,a=t.data.badgeData;this._setBadgeData(e,a)},_setBadgeData:function(t,e){var a={totalRelationCount:e.totalRelationCount,blockerRelationCount:e.blockerRelationCount};this.fire("setBadgeData",a)}});return n});