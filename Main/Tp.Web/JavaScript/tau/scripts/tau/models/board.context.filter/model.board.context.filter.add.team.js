define(["Underscore","tau/core/extension.base","tau/libs/inviter/inviter"],function(e,a,t){return a.extend({"bus configurator.ready:last + team.add.ready":function(a,r,n){var i=this,s=r.getStore();s.save("team",{failureGlobal:!1,$set:{name:e.trim(n.name),icon:e.trim(e.asString(n.icon))||null}},{success:function(e){i.fire("team.saved",e.data)},failure:function(e){i.fire("team.add.failure",e.data.response.Message)}}).done();var d=new t(r);d.invite(n.members).done(function(e){i.fire("teamMembers.saved",e)})},"bus configurator.ready:last + team.add.ready + team.saved + teamMembers.saved":function(a,t,r,n,i){var s=this,d=t.getStore(),m=e.compact(e.pluck(i,"success")),o=e.compact(e.pluck(i,"failure"));if(o.length){var u="Can't assign users.";this.fire("team.add.nonFatalFailure",u)}m=e.filter(m,function(e){return e!=t.getLoggedUser().id});var c={teamMembers:e.map(m,function(e){return{user:{id:e}}})};d.save("team",{id:n.id,$set:c,fields:["id","name","icon",{teamMembers:[{user:["id","firstName","lastName","avatarUri"]},{role:["id","name"]}]}]}).done(function(e){s.fire("teamMembers.connected",e[0].data)})},"bus team.saved + teamMembers.saved + teamMembers.connected":function(e,a,t,r){this.fire("team.add.success",r)}})});