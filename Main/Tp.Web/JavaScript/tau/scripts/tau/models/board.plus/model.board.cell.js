define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,n){return n.extend({"bus slice.ready:last+model.get.cell.content":function(e,t,n){var i=t.base;this.onGetCellContent(i,n)},onGetCellContent:function(e,t){var n=this,i=t.from,r=t.to-t.from+1,a={$take:n.generateExcessTake(r),$skip:i};"null"!==t.x&&(a.x=t.x),"null"!==t.y&&(a.y=t.y),e.cell(a).done(function(e){var i=e.data.items.length>0?e.data.items[0]:{},r=n.preProcessCellResponse(i,t);n.fireCellBasicInfoRetrieved(r)})},"bus model.get.cell.basicInfo":function(e){var t=this,n=e.data;n.x=n.x||null,n.y=n.y||null,n.x&&n.y?(n.x=n.x.toString(),n.y=n.y.toString(),t.fire("model.get.cell.content",n)):t.fire("model.get.axisCell.basicInfo",n)},"bus model.sliceInfo.retrieved:last+model.get.axisCell.basicInfo":function(t){var n=t["model.get.axisCell.basicInfo"].data,i=t["model.sliceInfo.retrieved"].data,r=(n.hasOwnProperty("x"),n.hasOwnProperty("y"),n.x?"X":"Y"),a=i["marks"+r],o=e(a).find(function(e){var t=r.toLowerCase();return e[t]==n[t]});this.fireCellBasicInfoRetrieved({dataItem:o,coords:n})},fireCellBasicInfoRetrieved:function(t){var n=t.dataItem;n.paging=e(t.coords).pick("from","to"),this.fire("model.cell.basicInfo.retrieved",n)},"bus configurator.ready:last + acid.ready:last + before_model.cell.basicInfo.retrieved":function(t,n,i,r){var a=n.getUrlBuilder();e.forEach(r.dynamic.items,function(t){var n=t.data;n.entityRef=a.getNewViewUrl(e.asString(n.id),e.asString(n.type),i)})},fireCardsDataReady:function(e){this.fire("model.cards.data.ready",{cards:e})},preProcessCellResponse:function(t,n){var i=e.defaults(t||{},{dynamic:{items:[]},fixed:{items:[]},x:n.x,y:n.y}),r=e(i.fixed.items).find(function(e){return"cellpaging"===e.type});if(r){var a=n.to-n.from+1,o=i.dynamic.items;i.dynamic.items=o.slice(0,a),r.data=r.data||{},r.data.nextOrderingValue=this.getNextOrderingValue(a,o)}else n.to=n.from+(i.dynamic.items.length-1);return{dataItem:i,coords:n}},getNextOrderingValue:function(e,t){if(e>=t.length)throw"DEBUG: index is out of range. To implement cell paging logic we must query more card items then show to user";
return t[e].orderingValue},generateExcessTake:function(e){return e+Math.round(e/4)}})});