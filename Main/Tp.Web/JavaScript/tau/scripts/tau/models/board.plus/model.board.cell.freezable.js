define(["Underscore","jQuery","./model.board.cell"],function(e,t,l){return l.extend({"bus start.lifecycle":function(){this.onGetCellContent=t.noop,this.fire("model.get.cell.basicInfo.dump",{dump:{}})},preProcessAggregatedCellItem:function(t){var l=t.coords,n=t.dataItem,a=l.to-l.from+1,s=n.dynamic.items.length;if(a>=s)return t;var o=e(n.fixed.items).find(function(e){return"cellpaging"===e.type});return o?t=this.preProcessCellResponse(n,l):t},processResponse:function(t,l,n){for(var a=t.data.items,s=0,o=a.length;o>s;s++){var i=a[s],d=this.getKey(i);if(l.hasOwnProperty(d)){var c=l[d].dataItem;i.dynamic.items=c.dynamic.items.concat(i.dynamic.items),i.fixed.items=c.fixed.items.concat(i.fixed.items),e.extend(l[d].dataItem,i)}}for(var r=[],u=0;u<n.length;u++){var m=this.preProcessAggregatedCellItem(n[u]),f=this.fireCellBasicInfoRetrieved(m);r=r.concat(f)}this.fireCardsDataReady(r)},getKey:function(e){var t=e.x||"null",l=e.y||"null";return t+"_"+l},"bus model.cells.content.loaded+model.cards.data.ready":function(){var e=this;delete e.onGetCellContent},"bus model.cells.content.loaded+model.get.cell.basicInfo.dump:last+model.get.cell.basicInfo.end":function(t){var l=t["model.get.cell.basicInfo.dump"].data.dump,n=e.values(l),a=t["model.cells.content.loaded"].data;this.processResponse(a,l,n)},"bus slice.ready:last+model.get.cell.basicInfo.dump:last+model.get.cell.basicInfo.end":function(t){var l=t["model.get.cell.basicInfo.dump"].data.dump,n=e.values(l),a=this,s={},o={},i=0;e.each(n,function(e){var t=e.coords.to-e.coords.from+1;t>i&&(i=t);var l=e.dataItem;l.x&&"null"!=l.x&&(s[l.x]=1),l.y&&"null"!=l.y&&(o[l.y]=1)}),s=e.keys(s),o=e.keys(o);var d={};s.length&&(d.x={$in:s}),o.length&&(d.y={$in:o}),d.$skip=0,d.$take=a.generateExcessTake(i),a.fire("model.execute.cell.query",{query:d})},skipQueryCells:function(){this.fire("model.cells.content.loaded",{data:{items:[]}})},queryCells:function(e,t){e.cell(t).done(function(e){this.fire("model.cells.content.loaded",e)}.bind(this)).fail(this.skipQueryCells.bind(this))
},"bus slice.ready:last+model.execute.cell.query":function(e,t,l){var n=t.base,a=l.query;this.queryCells(n,a)},generateDefaultContent:function(e){var t={x:e.x.toString(),y:e.y.toString(),dynamic:{items:[]},fixed:{items:[]}};return t},"bus model.get.cell.basicInfo.dump:last+model.get.cell.basicInfo":function(e){var t=e["model.get.cell.basicInfo.dump"].data.dump,l=e["model.get.cell.basicInfo"].data;if(l.x&&l.y){var n=this.generateDefaultContent(l);t[this.getKey(n)]={dataItem:n,coords:l}}}})});