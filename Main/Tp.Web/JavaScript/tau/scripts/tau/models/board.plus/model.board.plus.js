define(["Underscore","tau/models/board.plus/model.board.base"],function(_,BaseModel){return BaseModel.extend({"bus configurator.ready:last + start.lifecycle":function(evt,configurator){configurator.getAppStateStore().get({fields:["acid"],callback:_.bind(function(result){this.fire("acid.ready",result.acid)},this)})},"bus boardSettings.ready:last + start.lifecycle":function(evt,bs){var self=this,boardSettings=bs.boardSettings;boardSettings.get({fields:["x","y","cells","zoomLevel","viewMode","page","focus","selectedMarks","user","acid"],callback:function(r){self.fire("board.configuration.ready",r)}})},"bus board.configuration.ready":function(evt,r){var self=this,definition={};r.hasOwnProperty("x")&&r.x!==null&&(definition.x=r.x),r.hasOwnProperty("y")&&r.y!==null&&(definition.y=r.y),r.hasOwnProperty("cells")&&r.cells!==null&&(definition.cells=r.cells),definition.zoomLevel=self.normalizeZoomLevel(r.zoomLevel||3),definition.page=_.defaults(r.page||{},{x:0,y:0,size:{x:8,y:20}}),definition.focus=_.defaults(r.focus||{},{x:[],y:[]}),definition.selectedMarks=_.defaults(r.selectedMarks||{},{x:[],y:[]}),definition.viewMode=r.viewMode||"board",definition.boardId=r.id,definition.user=_.defaults(r.user||{},{cardsFilter:""}),self.fire("definition.ready",definition),self.fire("board.definition.ready",definition)},"bus configurator.ready + definition.ready + acid.ready":function(evt,configurator,definition,acid){var sliceConfig={definition:definition};sliceConfig.definition.global={acid:acid};var slice=configurator.getSliceFactory().create(sliceConfig);this.fire("slice.ready",{slice:slice})},"bus slice.ready:last + before_destroy":function(evt){this.fire("clearError");var slice=evt["slice.ready"].data.slice;slice.abort()},"bus slice.ready:last + before_refresh":function(evt){this.fire("clearError");var slice=evt["slice.ready"].data.slice;slice.abort()},"bus slice.ready + model.get.sliceInfo":function(evt){var self=this,slice=evt["slice.ready"].data.slice;self.onGetSliceInfo(slice)},onGetSliceInfo:function(slice){},"bus boardSettings.ready:last + destroy":function(evt){var boardSettings=evt["boardSettings.ready"].data.boardSettings;boardSettings.unbind({listener:this})},"bus boardSettings.ready":function(evt){var self=this,boardSettings=evt.data.boardSettings;boardSettings.unbind({listener:self}),boardSettings.bind({fields:["zoomLevel"],listener:self,callback:_.bind(self.onZoomLevelUpdated,self)}),boardSettings.bind({fields:["page"],listener:self,callback:function(r){self.fire("page.changed",_.deepClone(r.page))}}),boardSettings.get({fields:["zoomLevel"],callback:_.bind(self.onZoomLevelReady,self)})},normalizeZoomLevel:function(zoomLevel){return Math.max(1,Math.min(6,zoomLevel))},"bus before_model.zoomLevelChanged":function(evt){var data=evt.data;data.zoomLevel=this.normalizeZoomLevel(data.zoomLevel)},"bus definition.ready":function(evt){var page=evt.data.page;this.fire("page.ready",_.deepClone(page))},onZoomLevelUpdated:function(zoomLevel){zoomLevel.name||this.fire("model.zoomLevelChanged",zoomLevel)},onZoomLevelReady:function(zoomLevel){this.fire("model.zoomLevelChanged",zoomLevel)}})})