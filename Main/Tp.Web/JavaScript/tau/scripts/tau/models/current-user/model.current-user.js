define(["tau/core/extension.base","tau/utils/utils.convertUserName"],function(e,t){return e.extend({"bus beforeInit":function(e,t){this.fire("configurator.ready",t.config.context.configurator)},"bus afterInit":function(e,r){var a=r.config.context.configurator,i=a.getLoggedUser(),n=a.getStore(),u=this;a.getFeaturesService().isEnabled("context.v2")?u.fire("dataBind",{userAvatarURI:i.avatarUri+"24",userId:i.id,logoutUrl:a.getUrlBuilder().getLogoutUrl(),userName:i.name}):n.get("user",{id:i.id,fields:["avatarUri","firstName","lastName"]}).done({success:function(e){var r=e[0].data;u.fire("dataBind",{userAvatarURI:r.avatarUri+"24",userId:r.id,logoutUrl:a.getUrlBuilder().getLogoutUrl(),userName:t.getFullName(r)})}}),n.unbind(this),n.on({eventName:"afterSave",type:"user",listener:u},function(e){e.data.id==i.id&&u.fire("refresh")})}})});