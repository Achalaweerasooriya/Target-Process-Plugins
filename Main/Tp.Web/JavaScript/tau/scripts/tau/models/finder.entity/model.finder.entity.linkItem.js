define(["require","jQuery","Underscore","./model.finder.entity.data"],function(t){var e=t("jQuery"),i=t("Underscore"),n=t("./model.finder.entity.data");return n.extend({entityDslFilters:{},"bus afterInit":function(t,e){this.config=e.config},"bus item.selected":function(t,e){this.config.parentBus.fire("link.entity",{entityId:e,path:this.config.treeCardPath,lookupBus:this.bus})},processOptions:function(t,e){var n=i.defaults(t,{filter:{entityType:"user"},columnsDisabled:{release:!0,iteration:!0}});return this._super(n,e)},processInitDsl:function(t){var i=e.Deferred();return this._initDslFilters(t),t.filter.init_dsl=this._dslFilter,i.resolve(t),i.promise()},doSearch:function(t,e){var i=t.getFilterParamValue("entityType.name"),n=this.entityDslFilters[i];return t.setFilterParamValue("init_dsl",n?n:this.entityDslFilters["default"]),this._super(t,e)},_initDslFilters:function(t){var e=t.immediateParentCard;this.entityDslFilters["default"]="not(It."+e.type+".Id is "+e.data.cardData.id+") or It."+e.type+" is None"},_getParentEntityIds:function(t){var e=[];return t.entity&&e.push(t.entity.id),i.each(t.allParentCards,function(t){e.push(t.getId())}),e}})});