define(["Underscore","tau/models/finder.entity/model.finder.entity.data"],function(e,t){return t.extend({buildInitialParameters:function(t,i){var r=$.Deferred(),n=t.context.entity,d=e.bind(this._super,this);return i.getStore().get("testPlanRun",{id:n.id,fields:["id",{project:["id",{process:["id",{practices:["id","name"]}]}]},{release:["id"]},{iteration:["id"]}]}).done({success:e.bind(function(n){var s=n[0].data||{};e.defaults(s.project,{process:{practices:[]}});var a=s.project.process.practices,o=e.any(a,function(e){return"iterations"==e.name.toLowerCase()}),c=[];s.project&&c.push("project.id == "+s.project.id),s.release&&c.push("release.id == "+s.release.id),s.iteration&&1==o&&c.push("iteration.id == "+s.iteration.id),c="("+c.join(" and ")+")",t.filter.init_dsl=t.filter.init_dsl?t.filter.init_dsl+" and "+c:c,d(t,i).then(function(e){r.resolve(e)})},this)}),r}})});