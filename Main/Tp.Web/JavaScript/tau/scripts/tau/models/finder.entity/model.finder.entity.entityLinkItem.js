define(["require","jQuery","Underscore","./model.finder.entity.linkItem"],function(t){var e=t("jQuery"),s=t("Underscore"),i=t("./model.finder.entity.linkItem");return i.extend({_defaultFilterEntityMap:[{entityTypes:["testcase"],asDefault:"testcase"},{entityTypes:["testplan","testcase"],asDefault:"testplan"},{entityTypes:["bug"],asDefault:"bug"}],processInitDsl:function(t){var i=e.Deferred();this._initDslFilters(t);var n=s.find(this._defaultFilterEntityMap,function(e){return s.isEqual(e.entityTypes,t.entityType)});return this.entityDslFilters["default"]=this.entityDslFilters[n&&n.asDefault],t.filter.init_dsl=this.entityDslFilters["default"],i.resolve(t),i.promise()},doSearch:function(t,e){var s=t.getFilterParamValue("entityType.name"),i=this.entityDslFilters[s];return t.setFilterParamValue("init_dsl",i?i:this.entityDslFilters["default"]),this._super(t,e)},_initDslFilters:function(t){var e=t.entityType,i=this._getParentEntityIds(t),n=s.intersection(e,["testcase","testplan","bug"]);s.each(n,function(e){var n=[];switch(e){case"testcase":case"testplan":n.push("not(It."),n.push("testcase"==e?"TestPlans":"ParentTestPlans"),n.push(".Where(It.Id is "),n.push(t.immediateParentId),n.push("))"),s.each(i,function(t){n.push(" and It.Id is not "),n.push(t)});break;case"bug":n.push("not(It.TestCaseRuns.Where(It.Id is "),n.push(t.immediateParentId),n.push("))");break;default:return}this.entityDslFilters[e]=n.join("")}.bind(this))}})});