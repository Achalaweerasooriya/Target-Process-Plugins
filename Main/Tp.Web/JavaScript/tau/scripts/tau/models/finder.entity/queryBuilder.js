define(["Underscore","tau/core/class"],function(e,t){var r=t.extend({_collection:null,_orderBy:null,_orderDir:"asc",_page:1,_onPage:10,init:function(){this._parameters=[],this._values={},this._fields=[]},setFields:function(e){this._fields=e},setCollection:function(e){this._collection=e},registerParameters:function(t){this._parameters=e.toArray(t)},setParameter:function(t,r){if(!e.include(this._parameters,t))throw new Error('No "'+t+'" parameter for query');this._values[t]=r},unsetParameter:function(e){delete this._values[e]},setOnPage:function(e){this._onPage=e},setPage:function(e){this._page=e||1},setOrderBy:function(e){this._orderBy=e},setOrderDir:function(e){this._orderDir=e},create:function(){var e={fields:this._fields,$query:this.createWhere()},t=this.createPaging();e.$skip=t.skip,e.$limit=t.limit;var r="asc"===this._orderDir?"$orderBy":"$orderByDesc";return e[r]=this.createOrderBy(),{collection:this.createCollection(),request:e}},createCollection:function(){return this._collection},createWhere:function(){var t={};return e.each(this._values,function(e,r){t[r]=e}),t},createOrderBy:function(){return this._orderBy||"id"},createPaging:function(){return{limit:this._onPage,skip:(this._page-1)*this._onPage}}});return r});