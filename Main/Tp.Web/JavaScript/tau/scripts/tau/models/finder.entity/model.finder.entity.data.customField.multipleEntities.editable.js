define(["Underscore","tau/core/extension.base"],function(e,t){return t.extend({"bus afterInit:last + entitySelected":function(t,n){var i=n.config.customField,o=n.config.context.entity,a=n.config.context.configurator.getStore();a.get(o.entityType.name,{id:o.id,fields:["customFields"]}).done(e.bind(function(t){var n=e.find(t[0].data.customFields,function(e){return e.name===i.name}),o=null!=n.value?n.value.split(","):[];this.fire("prevValues.ready",o)},this))},"bus afterInit:last + entitySelected + prevValues.ready":function(t,n,i,o){var a=i.entity,c=n.config.customField,s=n.config.context.entity,d=n.config.context.configurator.getStore(),u=a.id+" "+a.entityType.name.toLowerCase(),r=e.uniq(o.concat(u)).join(",");d.save(s.entityType.name,{id:s.id,$set:{customFields:[{name:c.name,value:r}]},fields:["id","customFields"]}).done()}})});