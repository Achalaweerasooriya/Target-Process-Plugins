define(["jQuery","tau/core/model.editable.base","app.path","tau/core/tau"],function($,ModelBase,AppPath,tau){return ModelBase.extend({onInit:function(){var self=this,entity=this.config.context.entity;this.config.store.get("user",{id:entity.id,fields:["avatarUri"]}).done(function(){self.onUserDataRetrieved.apply(self,arguments)});var avatarService=this.config.context.configurator.getAvatarService();avatarService.getCropRect(entity.id).done(function(cropRect){self.fire("model.crop.ready",cropRect)}),this.config.store.unbind(this),this.config.store.on({eventName:"afterSave",type:"user",hasChanges:["avatarUri"],listener:self},function(){self.fire("avatarChanged")})},onUserDataRetrieved:function(result){var entity=result[0].data,sizeAvatar=this.config.context.avatarSize||64;this.fire("dataBind",{url:entity.avatarUri+sizeAvatar+tau.getTokenParameterFromQueryString("&"),id:entity.id})}})})