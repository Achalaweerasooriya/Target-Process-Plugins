define(["jQuery","tau/core/model.editable.base","app.path","tau/core/tau"],function(e,t,a,i){return t.extend({onInit:function(){var e=this.config,t=e.context.entity,a=e.userKind||"user";e.store.get(a,{id:t.id,fields:["avatarUri"]}).done(this.safeCallback(this.onUserDataRetrieved));var i=e.context.configurator.getAvatarService();i.getCropRect(t.id).done(function(e){this.fire("model.crop.ready",e)}.bind(this)),e.store.unbind(this),e.store.on({eventName:"afterSave",type:a,hasChanges:["avatarUri"],listener:this},function(){this.fire("avatarChanged")}.bind(this))},onUserDataRetrieved:function(e){var t=e[0].data,a=this.config.context.avatarSize||64;this.fire("dataBind",{url:t.avatarUri+a+i.getTokenParameterFromQueryString("&"),id:t.id})}})});