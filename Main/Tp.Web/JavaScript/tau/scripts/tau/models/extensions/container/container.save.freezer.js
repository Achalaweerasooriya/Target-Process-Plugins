define(["Underscore","tau/core/event.emitter"],function(_,EventEmitter){return EventEmitter.extend({init:function(config){this._super.apply(this,arguments),this.setQueueBusForComponents(config.children),this.suspendedEvents=[]},setQueueBusForComponents:function(children){for(var i=0;i<children.length;i++){var child=children[i];child["queue.bus"]=!0,this.setQueueBusForComponents(child.children||[])}},handleChildComponentCreated:function(evt){evt.data.on("before_save",this.onBeforeSave,this),evt.data.on("childComponentCreated",this.handleChildComponentCreated,this)},"bus childComponentCreated":function(evt){this.handleChildComponentCreated(evt)},onBeforeSave:function(evt){evt.suspendMain(),this.fire("event.suspended",evt),this.suspendedEvents=_.reject(this.suspendedEvents,function(suspendedEvent){return suspendedEvent.sender===evt.sender}),this.suspendedEvents.push(evt)},"bus resumeSave":function(){_.each(this.suspendedEvents,function(evt){evt.resumeMain()})}})})