define(["Underscore","tau/core/model-base"],function(e,t){return t.extend({"bus registerStoreRequest":function(){var t=this.config.context.entity,r=this.config.store,a=this;r.get(t.entityType.name,{id:t.id,fields:[{project:["id",{projectMembers:[{user:["id","firstName","lastName","email","isActive","deleteDate"]},{role:["id","name"]}]}]},{team:["id",{teamMembers:[{user:["id","firstName","lastName","email","isActive","deleteDate"]},{role:["id","name"]}]}]}]}).done({success:function(t){t[0].data.project=t[0].data.project||{},e.defaults(t[0].data.project,{projectMembers:[]}),t[0].data.team=t[0].data.team||{},e.defaults(t[0].data.team,{teamMembers:[]});var r=t[0].data.project.projectMembers.concat(t[0].data.team.teamMembers||[]);r=e.uniq(r,!1,function(e){return e.user.id}),a.fire("members.provided",r)}}),r.get(t.entityType.name,{id:t.id,fields:[{requesters:["id","avatarUri","firstName","lastName","email","isActive","deleteDate","kind"]}]}).done({success:function(e){var t=e[0].data.requesters;a.fire("requesters.provided",t)}})},"bus members.provided+requesters.provided":function(t){var r=t["members.provided"].data,a=t["requesters.provided"].data,i=e.pluck(a,"id");r=e.reject(r,function(t){return e.indexOf(i,t.user.id)>-1}),e.forEach(a,function(e){r.unshift({role:{id:0,name:"Requesters"},user:e})}),r=e.filter(r,function(e){return null===e.user.deleteDate});var s=[];e.forEach(r,function(t){var r=t.role;r&&s.push(r),t.username=e.trim([t.firstName,t.lastName].join(" "))||t.email}),s=e.uniq(s,!1,function(e){return e.id}),this.fire("projectMembersReady",r),this.fire("projectRolesReady",s)}})});