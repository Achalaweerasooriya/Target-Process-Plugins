define(["Underscore","tau/core/model-base"],function(_,a){return a.extend({"bus registerStoreRequest":function(){var a=this.config.context.entity,b=this.config.store,c=this;b.get(a.entityType.name,{id:a.id,fields:[{project:["id",{projectMembers:[{user:["id","firstName","lastName","email","isActive","deleteDate"]},{role:["id","name"]}]}]}]}).done({success:function(a){var b=a[0].data.project.projectMembers;c.fire("members.provided",b)}}),b.get(a.entityType.name,{id:a.id,fields:[{requesters:["id","firstName","lastName","email","isActive","deleteDate","kind"]}]}).done({success:function(a){var b=a[0].data.requesters;c.fire("requesters.provided",b)}})},"bus members.provided+requesters.provided":function(a){var b=a["members.provided"].data,c=a["requesters.provided"].data,d=_.pluck(c,"id");b=_.reject(b,function(a){return _.indexOf(d,a.user.id)>-1}),_.forEach(c,function(a){b.unshift({role:{id:0,name:"Requesters"},user:a})}),b=_.filter(b,function(a){return a.user.deleteDate===null});var e=[];_.forEach(b,function(a){var b=a.role;b&&e.push(b),a.username=a.email;if(a.firstName||a.lastName)a.username=_.trim([a.firstName,a.lastName].join(" "))}),e=_.uniq(e,!1,function(a){return a.id}),this.fire("projectMembersReady",b),this.fire("projectRolesReady",e)}})})