define(["Underscore","tau/core/model-base","tau/core/termProcessor"],function(a,b,c){return b.extend({init:function(b){this._super(b);var d=function(a,b,c){a.hasOwnProperty(b)||(a[b]={}),a[b].$contains=c},e=function(b,c,d){if(d==="All uncompleted"){b[c]={isFinal:0};return}if(!b.hasOwnProperty(c)||a.isNull(b[c]))b[c]={name:{$in:[]}};if(d==="Backlog"){b[c]=null;return}b[c].name&&b[c].name.$in&&b[c].name.$in.push(d)},f=function(b,c,d){b.hasOwnProperty(c)||(b[c]={$in:[0]});var e=parseInt(d);a.isNumber(e)&&!a.isNaN(e)&&b[c].$in.push(e)};b.context&&b.context.applicationContext?this.terms=new c(b.context.getTerms()):this.terms=new c;var g=this.terms;this.properties={id:{autoCompletable:!1,statement:f},text:{name:"name",autoCompletable:!1,statement:d},name:{autoCompletable:!1,statement:d},description:{autoCompletable:!1,statement:d},tag:{name:"tags",autoCompletable:!1,statement:d},project:{label:g.resolve("project"),autoCompletable:!0,statement:e},state:{name:"entityState",autoCompletable:!0,fields:[{entityType:["id"]}],items:[{label:"All uncompleted",value:"All uncompleted",id:0}],statement:e},iteration:{label:g.resolve("iteration"),autoCompletable:!0,category:"project",items:[{label:"Backlog",value:"Backlog",id:0}],fields:[{project:["id","abbreviation"]}],statement:e},release:{label:g.resolve("release"),autoCompletable:!0,category:"project",items:[{label:"Backlog",value:"Backlog",id:0}],fields:[{project:["id","abbreviation"]}],statement:e},priority:{autoCompletable:!0,fields:[{entityType:["id","name"]}],statement:e}}},getType:function(){return"assignable"},"bus autoCompleteRequest":function(b){var c=b.data,d=this,e=d.properties[c.property];if(!e)return;if(e.autoCompletable!==!0)return;if(e.autoCompleteValues){var f={config:c,data:e.autoCompleteValues};d["bus autoComplete"]({data:f});return}var g=e.hasOwnProperty("name")?e.name:c.property,h=["id","name"];e.hasOwnProperty("fields")&&a.mergeFields(h,e.fields);var i=function(a){var b={data:a.data,config:c};d.fire("autoComplete",b)};d.bus.fire("dataRequest",{type:g,config:{fields:h},callback:i})},_isEqualByCategory:function(a,b,c){return b.hasOwnProperty("category")?a[b.category]?a[b.category].name===c.category:!0:!0},"bus autoComplete":function(b){var c=b.data,d=c.config,e=[],f=this,g=this.properties[d.property];g.hasOwnProperty("items")&&(e=e.concat(g.items)),a.each(c.data,function(b){if(b.name===""||b.name==="-")return;if(a(e).any(function(a){return a.value.toLowerCase()===b.name.toLocaleLowerCase()&&f._isEqualByCategory(b,g,a)}))return;var c={label:b.name,value:b.name,id:b.id,dataItem:b},h=function(){return!0};g.hasOwnProperty("filter")&&(h=g.filter);if(!h.call(this,c,g,d))return;if(g.hasOwnProperty("category")){var i=b[g.category].abbreviation||b[g.category].name;a.extend(c,{category:i,label:b.name+" ["+i+"]"})}e.push(c)});var h=a(e).select(function(a){return!d.term||d.term==""?!0:a.value.toLowerCase().indexOf(d.term.toLowerCase())>=0});d.callback(h)},"bus search":function(b){var c=b.data,d=this,e=c.collection,f={};a.each(e,function(a){var b=d.properties[a.property];if(!b)return;var c=b.name?b.name:a.property;b.statement(f,c,a.value)}),d.bus.fire("newSearchQuery",{type:d.getType(),config:{$orderBy:"name",$query:f,$skip:0,$limit:20}})},getInitialQueryConfig:function(){var a={$skip:0,$limit:20,$query:{}};return a},getInitialQueryString:function(){return""},"bus requireSearchConfig":function(b){var c=this,d=b.data.project,e=c.getInitialQueryConfig();a.defaults(e,{$orderBy:"name"});var f=c.getInitialQueryString();c.fire("searchConfigFormed",{type:c.getType(),config:e,properties:c.properties,searchQuery:f})}})})