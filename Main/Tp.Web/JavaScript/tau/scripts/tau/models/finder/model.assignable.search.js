define(["Underscore","tau/core/model-base","tau/core/termProcessor"],function(_,a,b){return a.extend({init:function(a){this._super(a);var c=function(a,b,c){a.hasOwnProperty(b)||(a[b]={}),a[b].$contains=c},d=function(a,b,c){if(c==="All uncompleted"){a[b]={isFinal:0};return}if(!a.hasOwnProperty(b)||_.isNull(a[b]))a[b]={name:{$in:[]}};if(c==="Backlog"){a[b]=null;return}a[b].name&&a[b].name.$in&&a[b].name.$in.push(c)},e=function(a,b,c){a.hasOwnProperty(b)||(a[b]={$in:[0]});var d=parseInt(c);_.isNumber(d)&&!_.isNaN(d)&&a[b].$in.push(d)};a.context&&a.context.applicationContext?this.terms=new b(a.context.getTerms()):this.terms=new b;var f=this.terms;this.properties={id:{autoCompletable:!1,statement:e},text:{name:"name",autoCompletable:!1,statement:c},name:{autoCompletable:!1,statement:c},description:{autoCompletable:!1,statement:c},tag:{name:"tags",autoCompletable:!1,statement:c},project:{label:f.resolve("project"),autoCompletable:!0,statement:d},state:{name:"entityState",autoCompletable:!0,fields:[{entityType:["id"]}],items:[{label:"All uncompleted",value:"All uncompleted",id:0}],statement:d},iteration:{label:f.resolve("iteration"),autoCompletable:!0,category:"project",items:[{label:"Backlog",value:"Backlog",id:0}],fields:[{project:["id","abbreviation"]}],statement:d},release:{label:f.resolve("release"),autoCompletable:!0,category:"project",items:[{label:"Backlog",value:"Backlog",id:0}],fields:[{project:["id","abbreviation"]}],statement:d},priority:{autoCompletable:!0,fields:[{entityType:["id","name"]}],statement:d}}},getType:function(){return"assignable"},"bus autoCompleteRequest":function(a){var b=a.data,c=this,d=c.properties[b.property];if(!d)return;if(d.autoCompletable!==!0)return;if(d.autoCompleteValues){var e={config:b,data:d.autoCompleteValues};c["bus autoComplete"]({data:e});return}var f=d.hasOwnProperty("name")?d.name:b.property,g=["id","name"];d.hasOwnProperty("fields")&&_.mergeFields(g,d.fields);var h=function(a){var d={data:a.data,config:b};c.fire("autoComplete",d)};c.bus.fire("dataRequest",{type:f,config:{fields:g},callback:h})},_isEqualByCategory:function(a,b,c){return b.hasOwnProperty("category")?a[b.category]?a[b.category].name===c.category:!0:!0},"bus autoComplete":function(a){var b=a.data,c=b.config,d=[],e=this,f=this.properties[c.property];f.hasOwnProperty("items")&&(d=d.concat(f.items)),_.each(b.data,function(a){if(a.name===""||a.name==="-")return;if(_(d).any(function(b){return b.value.toLowerCase()===a.name.toLocaleLowerCase()&&e._isEqualByCategory(a,f,b)}))return;var b={label:a.name,value:a.name,id:a.id,dataItem:a},g=function(){return!0};f.hasOwnProperty("filter")&&(g=f.filter);if(!g.call(this,b,f,c))return;if(f.hasOwnProperty("category")){var h=a[f.category].abbreviation||a[f.category].name;_.extend(b,{category:h,label:a.name+" ["+h+"]"})}d.push(b)});var g=_(d).select(function(a){return!c.term||c.term==""?!0:a.value.toLowerCase().indexOf(c.term.toLowerCase())>=0});c.callback(g)},"bus search":function(a){var b=a.data,c=this,d=b.collection,e={};_.each(d,function(a){var b=c.properties[a.property];if(!b)return;var d=b.name?b.name:a.property;b.statement(e,d,a.value)}),c.bus.fire("newSearchQuery",{type:c.getType(),config:{$orderBy:"name",$query:e,$skip:0,$limit:20}})},getInitialQueryConfig:function(){var a={$skip:0,$limit:20,$query:{}};return a},getInitialQueryString:function(){return""},"bus requireSearchConfig":function(a){var b=this,c=a.data.project,d=b.getInitialQueryConfig();_.defaults(d,{$orderBy:"name"});var e=b.getInitialQueryString();b.fire("searchConfigFormed",{type:b.getType(),config:d,properties:b.properties,searchQuery:e})}})})