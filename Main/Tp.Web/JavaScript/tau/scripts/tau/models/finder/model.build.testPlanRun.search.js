define(["Underscore","tau/models/finder/model.build.search"],function(_,ModelBase){return ModelBase.extend({"bus requireSearchConfig":function(evt){var self=this,project=evt.data.project,entity=this.config.context.entity;this.config.store.get("testPlanRun",{id:entity.id,fields:["id",{project:["id",{process:["id",{practices:["id","name"]}]}]},{release:["id"]},{iteration:["id"]}]}).done({success:function(result){var entity=result[0].data||{};_.defaults(entity.project,{process:{practices:[]}});var practices=entity.project.process.practices,isAvailableIterations=_.any(practices,function(practice){return practice.name.toLowerCase()=="iterations"}),q={"Project.Id":null,"Release.Id":null};entity.project&&(q["Project.Id"]=entity.project.id),entity.release&&(q["Release.Id"]=entity.release.id),entity.iteration&&isAvailableIterations==1&&(q["Iteration.Id"]=entity.iteration.id),self.setInitialLimits(q);var config={$skip:0,$limit:20,$query:q},searchQuery=self.getInitialQueryString();self.fire("searchConfigFormed",{type:self.getType(),config:config,properties:self.properties,searchQuery:searchQuery})}})}})})