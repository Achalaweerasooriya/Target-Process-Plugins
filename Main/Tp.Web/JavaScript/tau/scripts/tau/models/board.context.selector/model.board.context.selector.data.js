define(["Underscore","tau/models/board.context.output/model.board.context.output.data"],function(t,e){return e.extend({CONVERT_MAP:{None:"null",Any:"*"},"bus beforeInit":function(t){var e=t.data.config.context.configurator;this.contextStore=e.getApplicationContextService(),this.acidStore=e.getAppStateStore(),this._super(t)},"bus model.setFilter":function(e,a){var n=this.fire.bind(this),i=a.selectedProjectsIds,c=a.selectedTeamsIds;if(this._selectedCache&&t.isEqual(this._selectedCache.teams,c)&&t.isEqual(this._selectedCache.projects,i))return void n("currentContextSelected");var o=function(t){var e=this.CONVERT_MAP[t];return e?e:t}.bind(this),s={projectIds:t.map(i,o),teamIds:t.map(c,o)};this.contextStore.getApplicationContext(s,{success:function(t){n("context.changed",t),n("application.context.data.changed",{teams:c,projects:i})}})},"bus context.changed":function(t,e){this.contextStore.markAsDirty(),this.acidStore.set({set:{acid:e.acid,appContext:e.appContext}})},_setupStore:function(t,e){this._super(t,e),e.unbind(this);var a=this.fire.bind(this);e.on({type:"project",eventName:"afterSave",listener:this},function(t){t.data.cmd&&"context"!=t.data.cmd.type&&e.get("project",{id:t.data.id,fields:["id","name","color"]}).done(function(t){a("project.add.success",t[0].data)})}),e.on({type:"team",eventName:"afterSave",listener:this},function(t){t.data.cmd&&"context"!=t.data.cmd.type&&e.get("team",{id:t.data.id,fields:["id","name","icon"]}).done(function(t){a("team.add.success",t[0].data)})})},_getModelData:function(t,e,a){return{acid:t.acid,teams:e.list,projects:a.list}},_trackData:function(){}})});