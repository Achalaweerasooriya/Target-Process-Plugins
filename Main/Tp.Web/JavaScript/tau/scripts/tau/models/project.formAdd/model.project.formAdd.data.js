define(["require","Underscore","jQuery","tau/models/model.teamProject.formAdd.data.abstract","tau/configurations/project.colors","tau/core/templates-factory"],function(t){"use strict";var e=t("Underscore"),r=t("jQuery"),o=t("tau/models/model.teamProject.formAdd.data.abstract"),a=t("tau/configurations/project.colors"),i=t("tau/core/templates-factory");return o.extend({"bus beforeInit":function(t,e){var r=e.config.context.configurator;this.fire("configurator.ready",r)},"bus configurator.ready:last + beforeInit":function(t,r){var o=r.getStore(),a=e.bind(this.fire,this);this._getRequiredData(o).then(function(t){a("dataBind",t)}),o.unbind(this),o.on({type:"team",eventName:"afterSave",listener:this},function(t){e.isEmpty(t.data.changes)||a("refresh")})},_getRequiredData:function(t){var o=r.Deferred(),i={colors:a},s=[this._getTeams.bind(this,t),this.getProcesses.bind(this,t),this._getPrograms.bind(this,t),this.getTerms.bind(this,t),this.getWorkflows.bind(this,t)];return e.parallel(s,function(t,e){i.teams=e[0],i.processes=e[1],i.programs=e[2],i.terms=e[3],i.workflows=e[4],o.resolve(i)}),o},_getTeams:function(t,r){t.get("teams",{fields:["id","name","icon"]}).done(function(t){var o=e.sortBy(t[0].data,this.byName);e.each(o,function(t){t.tooltip=""}),r(!1,o)}.bind(this))},_getPrograms:function(t,r){var o=i.termProcessor.getTerm("Program","name"),a={id:-1,name:"No "+o};t.get("program",{fields:["id","name"]}).done(function(t){var o=e.sortBy(t[0].data,this.byName);o.unshift(a),r(!1,o)}.bind(this))}})});