define(["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(_,ModelBase,configFactory){return ModelBase.extend({resetLifecycle:!0,"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator),initConfig.config.context.entity.type=initConfig.config.context.entity.entityType.name.toLowerCase(),this.fire("entity.ready",initConfig.config.context.entity)},"bus configurator.ready + entity.ready":function(e,configurator,entity){var store=configurator.getStore(),fireRefresh=_.bind(this.fire,this,"refresh");store.unbind(this),store.on({eventName:"afterSave",type:entity.type,listener:this,hasChanges:["teamProjects"]},fireRefresh)},"bus configurator.ready:last + teamProjects.ready:last + activeTab.ready:last + beforeInit":function(e,configurator,teamProjects,activeTab){var self=this,store=configurator.getStore(),f=[];f.push(_.bind(this._getList,this,store,"team",["id","name","icon"],_.pluck(_.compact(_.pluck(teamProjects,"team")),"id"))),_.parallel(f,function(err,res){var teams=res[0];self.fire("dataBind",{activeTab:activeTab,projects:[],showProjects:!1,canAddProjects:!1,teams:teams,canAddTeams:!0,submitLabel:"Assign",showEmpty:!0,showSearch:teams.length>20,icons:configFactory.getConfigByType("team").prototype.icons})})},_getList:function(store,name,fields,excludeIds,next){store.get(name,{fields:fields}).done({success:function(result){var items=result[0].data;items=_.filter(items,function(v){return _.indexOf(excludeIds,v.id)==-1}),items=_.sortBy(items,function(v){return v.name.toUpperCase()}),next(!1,items)}})},"bus configurator.ready:last + entity.ready":function(evt,configurator,entity){var self=this;configurator.getStore().get(entity.type,{id:entity.id,fields:[{teamProjects:[{team:["id","name"]}]}]}).done({success:function(res){self.fire("teamProjects.ready",res[0].data.teamProjects)}})},"bus configurator.ready:last + destroy":function(e,configurator){var store=configurator.getStore();store.unbind(this)}})})