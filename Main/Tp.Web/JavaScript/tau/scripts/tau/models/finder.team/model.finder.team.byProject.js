define(["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(t,e,n){return e.extend({resetLifecycle:!0,"bus beforeInit":function(t,e){var n=e.config.context.configurator;this.fire("configurator.ready",n),e.config.context.entity.type=e.config.context.entity.entityType.name.toLowerCase(),this.fire("entity.ready",e.config.context.entity)},"bus configurator.ready + entity.ready":function(e,n,i){var a=n.getStore(),r=t.bind(this.fire,this,"refresh");a.unbind(this),a.on({eventName:"afterSave",type:i.type,listener:this,hasChanges:["teamProjects"]},r)},"bus configurator.ready:last + teamProjects.ready:last + activeTab.ready:last + beforeInit":function(e,i,a,r){var o=this,s=i.getStore(),c=[];c.push(t.bind(this._getList,this,s,"team",["id","name","icon"],t.pluck(t.compact(t.pluck(a,"team")),"id"))),t.parallel(c,function(t,e){var i=e[0];o.fire("dataBind",{activeTab:r,projects:[],showProjects:!1,canAddProjects:!1,teams:i,canAddTeams:!0,submitLabel:"Assign",showEmpty:!0,showSearch:i.length>20,icons:n.getConfigByType("team").prototype.icons})})},_getList:function(e,n,i,a,r){e.get(n,{fields:i}).done({success:function(e){var n=e[0].data;n=t.filter(n,function(e){return-1==t.indexOf(a,e.id)}),n=t.sortBy(n,function(t){return t.name.toUpperCase()}),r(!1,n)}})},"bus configurator.ready:last + entity.ready":function(t,e,n){var i=this;e.getStore().get(n.type,{id:n.id,fields:[{teamProjects:[{team:["id","name"]}]}]}).done({success:function(t){i.fire("teamProjects.ready",t[0].data.teamProjects)}})},"bus configurator.ready:last + destroy":function(t,e){var n=e.getStore();n.unbind(this)}})});