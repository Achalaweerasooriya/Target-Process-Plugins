define(["Underscore","tau/core/extension.base","tau/configurations/team.icons"],function(e,t,n){return t.extend({resetLifecycle:!0,"bus beforeInit":function(e,t){var n=t.config.context.configurator;this.fire("configurator.ready",n),t.config.context.entity.type=t.config.context.entity.entityType.name.toLowerCase(),this.fire("entity.ready",t.config.context.entity)},"bus configurator.ready + entity.ready":function(t,n){var a=n.getStore(),i=e.bind(function(e){"removeFromList"==e.data.cmd.name&&this.fire("refresh")},this);a.unbind(this),a.on({eventName:"afterSave",type:"team",listener:this},i)},"bus configurator.ready:last + teamMembers.ready:last + activeTab.ready:last + beforeInit":function(t,a,i,r){var s=this,o=a.getStore(),c=[];c.push(e.bind(this._getList,this,o,"team",["id","name","icon"],e.pluck(e.compact(e.pluck(i,"team")),"id"))),e.parallel(c,function(e,t){var a=t[0];s.fire("dataBind",{activeTab:r,projects:[],showProjects:!1,canAddProjects:!1,teams:a,canAddTeams:!0,submitLabel:"Assign",showEmpty:!0,showSearch:a.length>20,icons:n})})},_getList:function(t,n,a,i,r){t.get(n,{fields:a}).done({success:function(t){var n=t[0].data;n=e.filter(n,function(t){return-1==e.indexOf(i,t.id)}),n=e.sortBy(n,function(e){return e.name.toUpperCase()}),r(!1,n)}})},"bus configurator.ready:last + entity.ready":function(e,t,n){var a=this;t.getStore().get(n.type,{id:n.id,fields:[{teamMembers:[{team:["id","name"]}]}]}).done({success:function(e){a.fire("teamMembers.ready",e[0].data.teamMembers)}})},"bus configurator.ready:last + entity.ready:last + form.submitted":function(t,n,a,i){var r=this,s=n.getStore(),o={id:a.id,fields:["id",{teamMembers:[{user:["id"]}]}],$set:{teamMembers:[]}};e.forEach(i.teamIds,function(e){o.$set.teamMembers.push({team:{id:e}})}),s.save(a.entityType.name,o).done({success:function(e){e.length&&e[0].data.teamMembers.length&&n.getGlobalBus().fire("teamsAndUsers.connected",e[0].data.teamMembers),r.fire("refresh")}})},"bus configurator.ready:last + destroy":function(e,t){var n=t.getStore();
n.unbind(this)}})});