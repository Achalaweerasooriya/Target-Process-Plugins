define(["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(e,t,n){return t.extend({resetLifecycle:!0,"bus beforeInit":function(e,t){var n=t.config.context.configurator;this.fire("configurator.ready",n),t.config.context.entity.type=t.config.context.entity.entityType.name.toLowerCase(),this.fire("entity.ready",t.config.context.entity)},"bus configurator.ready + entity.ready":function(t,n){var i=n.getStore(),a=e.bind(function(e){"removeFromList"==e.data.cmd.name&&this.fire("refresh")},this);i.unbind(this),i.on({eventName:"afterSave",type:"team",listener:this},a)},"bus configurator.ready:last + teamMembers.ready:last + activeTab.ready:last + beforeInit":function(t,i,a,r){var s=this,o=i.getStore(),c=[];c.push(e.bind(this._getList,this,o,"team",["id","name","icon"],e.pluck(e.compact(e.pluck(a,"team")),"id"))),e.parallel(c,function(e,t){var i=t[0];s.fire("dataBind",{activeTab:r,projects:[],showProjects:!1,canAddProjects:!1,teams:i,canAddTeams:!0,submitLabel:"Assign",showEmpty:!0,showSearch:i.length>20,icons:n.getConfigByType("team").prototype.icons})})},_getList:function(t,n,i,a,r){t.get(n,{fields:i}).done({success:function(t){var n=t[0].data;n=e.filter(n,function(t){return-1==e.indexOf(a,t.id)}),n=e.sortBy(n,function(e){return e.name.toUpperCase()}),r(!1,n)}})},"bus configurator.ready:last + entity.ready":function(e,t,n){var i=this;t.getStore().get(n.type,{id:n.id,fields:[{teamMembers:[{team:["id","name"]}]}]}).done({success:function(e){i.fire("teamMembers.ready",e[0].data.teamMembers)}})},"bus configurator.ready:last + entity.ready:last + form.submitted":function(t,n,i,a){var r=this,s=n.getStore(),o={id:i.id,fields:["id",{teamMembers:[{user:["id"]}]}],$set:{teamMembers:[]}};e.forEach(a.teamIds,function(e){o.$set.teamMembers.push({team:{id:e}})}),s.save(i.entityType.name,o).done({success:function(e){e.length&&e[0].data.teamMembers.length&&n.getGlobalBus().fire("teamsAndUsers.connected",e[0].data.teamMembers),r.fire("refresh")}})},"bus configurator.ready:last + destroy":function(e,t){var n=t.getStore();n.unbind(this)}})});