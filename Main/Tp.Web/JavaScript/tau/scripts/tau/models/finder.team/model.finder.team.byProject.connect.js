define(["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus configurator.ready:last + entity.ready:last + form.submitted":function(evt,configurator,entity,data){var self=this,store=configurator.getStore(),saves=[],tps=[];_.forEach(data.teamIds,function(teamId){tps.push({team:{id:teamId}})}),saves.push({id:entity.id,type:entity.type,fields:["id","teamProjects"],data:{teamProjects:tps}});var f=[function(next){store.evictProperties(entity.id,entity.type,["teamProjects"]),next()}];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})}),_.parallel(f,function(err,res){self.fire("refresh")})},"bus configurator.ready:last + entity.ready:last + team.add.success":function(evt,configurator,entity,team){var self=this,store=configurator.getStore(),saves=[];saves.push({id:entity.id,type:entity.type,fields:["id","teamProjects"],data:{teamProjects:[{team:{id:team.id}}]}});var f=[function(next){store.evictProperties(entity.id,entity.type,["teamProjects"]),next()}];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})}),_.parallel(f,function(err,res){self.fire("refresh")})}})})