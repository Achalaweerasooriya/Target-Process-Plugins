define(["Underscore","tau/core/model-base"],function(t,i){var e=i.extend({childType:"userStory",childCountFieldName:"userStories-count",fieldsToListen:["userStories|effort"],onInit:function(){var t=this.config.context.entity;this.entityType=t.entityType.name,this.entityId=t.id,this.listenToEntityUpdates(),this.getEntity()},listenToEntityUpdates:function(){this.store.unbind(this),this.store.on({eventName:"afterSave",type:this.entityType,filter:{id:this.entityId},hasChanges:this.fieldsToListen,listener:this},this.onEntityUpdate.bind(this))},onEntityUpdate:function(){this.fire("refresh")},getEntity:function(){this.store.get(this.entityType,{id:this.entityId,fields:["id","effort",this.childCountFieldName]},this.safeCallback(this.onGetEntity)).done(this.safeCallback(this.onRequestCompleted))},floatToString:function(t){return t.toFixed(2).replace(".00","")},_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},onGetEntity:function(t){var i=t.data,e=i[this.childCountFieldName];e>0?(this.hidden=!1,this.childCount=e,this.effort=this.floatToString(i.effort),this.pointName=this._getEffortPoints()):this.hidden=!0},onRequestCompleted:function(){this.fire("dataBind",this)}});return e});