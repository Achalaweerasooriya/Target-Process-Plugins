define(["Underscore","tau/core/model.editable.base"],function(a,b){var c=b.extend({name:"Editable Comments",_signUpEventsIfRequired:function(){var a=this;if(!a._signedUp){a._signedUp=!0;var b=function(b){b.data.cmd.guid=+(new Date),a.fire("prepareUpdate",b.data)},c=function(b){a.fire("applyUpdate",b.data)},d=function(b){b.data.cmd.guid=+(new Date),a.fire("prepareRemove",b.data)},e=function(b){var c=b.data.obj.parentId,d=a.getComment(c);d&&d.deleted&&d.comments.length===1?a.store.remove("comment",{id:c}).done():a.fire("applyRemove",b.data)};a.store.on({eventName:"beforeSave",type:"comment",listener:a},b).on({eventName:"afterSave",type:"comment",listener:a},c).on({eventName:"beforeRemove",type:"comment",listener:a},d).on({eventName:"afterRemove",type:"comment",listener:a},e)}},"bus dataBind":function(b){var c=b.data.items;this.commentsList=this.getPlainList(c);var d=a(this.commentsList).pluck("id"),e={editable:!0,editableItems:d,deletable:!0,deletableItems:d},f=this;f._signUpEventsIfRequired(),f.fire("permissionsReady",e)},getComment:function(b){var c=b?a(this.commentsList).detect(function(a){return a.id===b}):null;return c},getPlainList:function(a){var b=[];for(var c=0,d=a.length;c<d;c++){var e=a[c];b.push(e);var f=arguments.callee.call(this,a[c].comments);b=b.concat(f)}return b}});return c})