define(["tau/core/model-base","tau/utils/utils.urlBuilder","tau/extensions/extension.underscore"],function(a,b){function c(a){this.model=a}c.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetreived}},onAssignableRetreived:function(a){this.assignable=this.model.assignable=a.data;var b=this.assignable.requests,c=b.length,d=this.model.store;for(var e=0;e<c;e++)d=d.get("request",{id:b[e].id,fields:["id","name",{entityState:["name"]}]});d.done({scope:this,success:this.onRequestsRetreived})},onRequestsRetreived:function(a){var b={items:[]};for(var c=0;c<a.length;c++)b.items.push(this.convertServerDataModelData(a[c].data));this.model.bus.fire("dataBind",b)},convertServerDataModelData:function(a){return{__type:a.__type,id:a.id,name:a.name,state:{name:a.entityState.name},url:"#request/"+a.id}}};var d=a.extend({onInit:function(){var a=new c(this),b=this.config.context.entity;this.store.get(b.entityType.name,{id:b.id,fields:[{requests:["id"]}]},a.getAssignableRetrievedCallback()).done()},"bus evictRequests":function(){var a=this.config.context.entity;this.store.evictProperties(a.id,a.entityType.name,["requests"])}});return d})