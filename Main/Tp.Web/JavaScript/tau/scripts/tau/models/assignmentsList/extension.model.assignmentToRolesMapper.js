define(["Underscore","tau/models/extension.model.base"],function(e,t){return t.extend({category:"model assignment to role mapper","bus registerStoreRequest":function(){var e=this.config.context.entity||{entityType:{}},t={generalUser:["id","firstName","lastName"]};this.fire("get",{type:e.entityType.name,query:{id:e.id,fields:[{assignments:["id",{role:["id","name"]},t],list:!0}]},callback:{scope:this,success:this.onAssignmentsRetrieved}})},"bus assignmentsReady+rolesReady+extendDataToBind":function(e){for(var t=(e.assignmentsReady||{}).data,a=(e.rolesReady||{}).data,s=(e.extendDataToBind||{}).data,n=[],r=0;r<a.length;r++){var i=a[r],o={role:i,users:this.getUsersInRole(t,i),allowAdd:!0};this.fire("userGroupWasCreated",o),n.push(o)}s.assignments={groups:n}},_convertUserDataToViewData:function(t){var a=t.avatarUri+"32";return{id:t.id,name:e.trim([t.firstName,t.lastName].join(" "))||t.email,avatar:a}},getUsersInRole:function(t,a){t=e.sortBy(t,function(e){return e.id});for(var s=[],n=0,r=t.length;r>n;n++){var i=t[n];if(i.role.id==a.id){var o=this._convertUserDataToViewData(i.generalUser);o.assignmentId=i.id,o.roleId=a.id,s.push(o)}}return s}})});