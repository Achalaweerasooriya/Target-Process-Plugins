define(["Underscore","tau/models/extension.model.base","tau/utils/utils.convertUserName"],function(e,t,s){return t.extend({category:"model assignment to role mapper","bus registerStoreRequest":function(){var e=this.config.context.entity||{entityType:{}},t={generalUser:["id","firstName","lastName"]};this.fire("get",{type:e.entityType.name,query:{id:e.id,fields:[{assignments:["id",{role:["id","name"]},t],list:!0}]},callback:{scope:this,success:this.onAssignmentsRetrieved}})},"bus assignmentsReady+rolesReady+extendDataToBind":function(e){for(var t=(e.assignmentsReady||{}).data,s=(e.rolesReady||{}).data,a=(e.extendDataToBind||{}).data,n=[],r=0;r<s.length;r++){var i=s[r],o={role:i,users:this.getUsersInRole(t,i),allowAdd:!0};this.fire("userGroupWasCreated",o),n.push(o)}a.assignments={groups:n}},_convertUserDataToViewData:function(e){var t=e.avatarUri+"32";return{id:e.id,name:s.getFullName(e),avatar:t}},getUsersInRole:function(t,s){t=e.sortBy(t,function(e){return e.id});for(var a=[],n=0,r=t.length;r>n;n++){var i=t[n];if(i.role.id==s.id){var o=this._convertUserDataToViewData(i.generalUser);o.assignmentId=i.id,o.roleId=s.id,a.push(o)}}return a}})});