define(["Underscore","tau/models/extension.model.base"],function(_,a){return a.extend({category:"model feature roles retriever extension","bus registerStoreRequest":function(){var a=this.config.context.getProcessId();this.fire("get",{type:"process",query:{id:a,nested:!0,fields:[{entityStates:["id",{role:["id","name","hasEffort","isPair"]},{entityType:["id","name"]}],list:!0}]},callback:{scope:this,success:this.onEntityStatesRetrieved}})},onEntityStatesRetrieved:function(a){var b=a.data.entityStates,c=this.roles=[],d={},e=this.config.context.entity.entityType.name.toLocaleLowerCase();_.each(b,function(a){var b=a.role;b&&a.entityType.name.toLowerCase()===e&&(d.hasOwnProperty(b.id)||(d[b.id]=!0,c.push(b)))}),this.fire("rolesReady",c)}})})