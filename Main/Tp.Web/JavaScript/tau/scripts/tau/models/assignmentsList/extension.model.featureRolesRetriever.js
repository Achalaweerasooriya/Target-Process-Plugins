define(["Underscore","tau/models/extension.model.base"],function(a,b){return b.extend({category:"model feature roles retriever extension","bus registerStoreRequest":function(){var a=this.config.context.getProcessId();this.fire("get",{type:"process",query:{id:a,nested:!0,fields:[{entityStates:["id",{role:["id","name","hasEffort","isPair"]},{entityType:["id","name"]}],list:!0}]},callback:{scope:this,success:this.onEntityStatesRetrieved}})},onEntityStatesRetrieved:function(b){var c=b.data.entityStates,d=this.roles=[],e={},f=this.config.context.entity.entityType.name.toLocaleLowerCase();a.each(c,function(a){var b=a.role;b&&a.entityType.name.toLowerCase()===f&&(e.hasOwnProperty(b.id)||(e[b.id]=!0,d.push(b)))}),this.fire("rolesReady",d)}})})