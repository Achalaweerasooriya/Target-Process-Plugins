define(["Underscore","tau/models/extension.model.base"],function(e,t){return t.extend({category:"model feature roles retriever extension","bus registerStoreRequest":function(){var e=this.config.context.getProcessId();this.fire("get",{type:"process",query:{id:e,nested:!0,fields:[{entityStates:["id",{role:["id","name","hasEffort"]},{entityType:["id","name"]}],list:!0}]},callback:{scope:this,success:this.onEntityStatesRetrieved}})},onEntityStatesRetrieved:function(t){if(this.config){var i=t.data.entityStates,s=this.roles=[],n={},o=this.config.context.entity.entityType.name.toLocaleLowerCase();e.each(i,function(e){var t=e.role;t&&e.entityType.name.toLowerCase()===o&&(n.hasOwnProperty(t.id)||(n[t.id]=!0,s.push(t)))}),this.fire("rolesReady",s)}}})});