define(["Underscore","tau/core/model.editable.base"],function(_,EditableModelBase){return EditableModelBase.extend({category:"edit",name:"Editable attachment","bus dataBind":function(evt){this.bus.fire("permissionsReady",{editable:!0,deletable:!0}),this._attachments||(this._attachments=evt.data.items)},"bus attachmentUploaded":function(evt){this._addAttachment(evt.data.data)},onInit:function(){var self=this;this.store.on({eventName:"afterRemove",listener:self,type:"attachment"},function(evt){var id=parseInt(evt.data.cmd.config.id);self._isValidAttachmentId(id)&&(self._removeAttachment(id),self.bus.fire("afterAttachmentRemove",{id:id}))})},_addAttachment:function(attachment){this._attachments.push(attachment)},_removeAttachment:function(attachmentId){this._attachments=_.reject(this._attachments,function(attachment){return attachmentId===attachment.id})},_isValidAttachmentId:function(id){return _.any(this._attachments,function(attachment){return attachment.id===id})}})})