define(["Underscore","tau/core/model.editable.base"],function(t,e){function n(t,e){return t===e.id}return e.extend({category:"edit",name:"Editable attachment",onInit:function(){this.store.on({eventName:"afterRemove",listener:this,type:"attachment"},t.bind(this._afterAttachmentRemove,this))},"bus dataBind":function(t){this.bus.fire("permissionsReady",{editable:!0,deletable:!0}),this._attachments||(this._attachments=t.data.items,this._fireAttachmentsEvent())},"bus attachmentUploaded":function(t){this._addAttachment(t.data.data),this._fireAttachmentsEvent()},_afterAttachmentRemove:function(t){var e=parseInt(t.data.cmd.config.id,10);this._isValidAttachmentId(e)&&(this._removeAttachment(e),this.bus.fire("afterAttachmentRemove",{id:e}),this._fireAttachmentsEvent())},_addAttachment:function(t){this._attachments.push(t)},_removeAttachment:function(e){this._attachments=t.reject(this._attachments,t.bind(n,null,e))},_isValidAttachmentId:function(e){return t.any(this._attachments,t.bind(n,null,e))},_fireAttachmentsEvent:function(){this.bus.fire("attachments",this._attachments)}})});