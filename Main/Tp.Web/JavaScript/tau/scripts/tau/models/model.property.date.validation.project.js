define(["Underscore","tau/core/model-base","tau/utils/utils.jsonSchema","tau/utils/utils.date"],function(a,b,c,d){var e=b.extend({category:"edit",name:"Model date validation","bus afterInit":function(){this.schema=c.Schema.create({type:"string",optional:!1,empty:!1,post:function(a){if(this.wasError()==0){var b=d.parse(a),c=d.parse(this.schema.additionalProperties.max),e=d.parse(this.schema.additionalProperties.min);b==null?new this.Error("Date","Incorrect date format"):b<new Date("01/01/1900")?new this.Error("Date","Date must be greater then 1-Jan-1900"):c&&b>c?new this.Error("Date","Date must be less then "+d.format.date.short(c)):e&&b<e?new this.Error("Date","Date must be greater then "+d.format.date.short(e)):a=d.format.date.short(b)}return a},additionalProperties:{dateFormat:d.getFormatData().date.short,max:null,min:null}});var b=this.config.store,e=this.config.context.entity,f=this.config.bus,g=this,h=function(a){var b=a[0].data;this.config.propertyName=="startDate"&&(this.schema.additionalProperties.max=d.parse(b.endDate)),this.config.propertyName=="endDate"&&(this.schema.additionalProperties.min=d.parse(b.startDate))};b.get("project",{id:e.id,fields:["startDate","endDate"]}).done({success:a.bind(h,this)}),this.config.propertyName=="startDate"?b.on({eventName:"afterSave",type:"project",listener:this,filter:{id:e.id},hasChanges:["endDate"]},function(a){var b=d.parse(a.data.changes.endDate);g.schema.additionalProperties.max=b}):this.config.propertyName=="endDate"&&b.on({eventName:"afterSave",type:"project",listener:this,filter:{id:e.id},hasChanges:["startDate"]},function(a){var b=d.parse(a.data.changes.startDate);g.schema.additionalProperties.min=b})},"bus validate":function(a){var b=a.data,c=b.cmd.$set[this.config.propertyName];b.validation=b.validation&&b.validation.isError()==1?b.validation:this.schema.validate(c)}});return e})