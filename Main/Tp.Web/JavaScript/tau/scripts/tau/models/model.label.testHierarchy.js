define(["require","tau/core/helpers/entityResolver","tau/models/model.label","tau/libs/store2/store2"],function(e){var t=e("tau/core/helpers/entityResolver"),i=e("tau/models/model.label"),n=e("tau/libs/store2/store2");return i.extend({_hierarchyCountField:"testHierarchyCount",onInit:function(e){this._entityPromise=t.resolve(e),this.dataBind(),this._updateBadge()},getCountFields:function(){return[this._hierarchyCountField]},entityChanged:function(){this._updateBadge()},_updateBadge:function(){this._entityPromise.then(this._receiveCount.bind(this)).then(this._setBadgeData.bind(this))},_receiveCount:function(e){return this._getStore2().findAll(e.entityType.name+"?select={"+this.getCountFields().join(",")+"}&where=(id=="+e.id+")")},_setBadgeData:function(e){0!==e.length&&this.badgeDataRetrieved({data:e[0]})},_getStore2:function(){return this.store2||(this.store2=new n(this.config.context.configurator)),this.store2}})});