define(["Underscore","tau/core/extension.base.stateful","tau/utils/utils.date"],function(e,t,s){return t.extend({"bus beforeInit":function(e,t){this.entity=t.config.context.entity,this.store.get(this.entity.entityType.name,{id:this.entity.id,fields:["passed","runDate",{testplanrun:[{entitystate:["isFinal"]}]}]}).done({success:function(e){var t=e[0].data,s={};t.passed===!0?s.passed=!0:t.passed===!1?s.failed=!0:null==t.passed&&null!=t.runDate&&(s.skipped=!0),s.isTestPlanRunStateFinal=t.testplanrun.entitystate.isFinal,this.fire("dataBind",s)},scope:this})},"bus test.case.run.change.state.save":function(e,t){var a={id:this.entity.id,runDate:s.format.datetime.full(s.getServerNow()),executed:!0};switch(t.state){case"passed":a.passed=!0;break;case"failed":a.passed=!1;break;case"skipped":a.passed=null;break;default:a.executed=!1,a.runDate=null,a.passed=null}this.store.save("testcaserun",{$set:a}).done()}})});