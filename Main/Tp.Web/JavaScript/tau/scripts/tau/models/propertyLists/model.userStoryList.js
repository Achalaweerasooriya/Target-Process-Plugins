define(["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelProperyListBase){return ModelProperyListBase.extend({name:"userStory-list",propertyType:"userStory",onInit:function(){var self=this,success=function(){self.store.get("userStory",{fields:["id","name",{project:["id","name"]}]}).done({success:_.bind(self.onDataRetrieved,self)})};success()},processData:function(stories){var currentUserStoryId=this.getCurrentEntityId(),projectList={};_.each(stories,function(story){story.project=story.project||{};if(story.id==currentUserStoryId)return;projectList.hasOwnProperty(story.project.id)||(projectList[story.project.id]=story.project,projectList[story.project.id].items=[]),projectList[story.project.id].items.push(story)});var data={states:this.sortProjects(_.values(projectList)),completed:!0,nullableValue:currentUserStoryId!==null&&this.config.context.entity.entityType.name.toLowerCase()!="task"&&this.propertyIsNotEmpty()};this.fire("dataBind",data)}})})