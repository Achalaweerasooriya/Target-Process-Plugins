define(["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({name:"priority-list-model",propertyType:"priority",onInit:function(){var self=this,success=function(r){var assignable=r[0].data;self.assignable=assignable,self.store.get(self.propertyType,self.createGetPrioritiesCommand()).done({success:_.bind(self.onDataRetrieved,self)})};this.getAssignable(success)},getRequiredFields:function(){return[{entityType:["id"]}]},createGetPrioritiesCommand:function(){return{fields:["id","name","importance",{entityType:["id"]}]}},processData:function(priorities){var currentId=this.getCurrentEntityId(),currentEntityTypeId=this.assignable.entityType.id,filteredPriorities=[];_.each(priorities,function(priority){priority.id!==currentId&&priority.entityType.id===currentEntityTypeId&&filteredPriorities.push({id:priority.id,name:priority.name,importance:priority.importance||0})}),filteredPriorities.sort(function(a,b){return a.importance-b.importance}),this.fire("dataBind",{states:filteredPriorities,completed:!0,nullableValue:!1})}})})