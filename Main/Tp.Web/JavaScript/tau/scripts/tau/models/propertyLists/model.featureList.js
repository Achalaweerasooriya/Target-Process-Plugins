define(["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelProperyListBase){return ModelProperyListBase.extend({name:"release-list",propertyType:"feature",onInit:function(){var self=this;self.store.get("project",{fields:["id","name",{process:["id"]},{features:["id","name"]}]},{success:_.bind(self.onProjectRetrieved,self)}).get("feature",{fields:["id","name",{project:["id"]}]},{success:_.bind(self.onFeatureRetrieved,self)}).get("process",{fields:["id",{practices:["name"]}]},{success:_.bind(self.onProcessesRetrieved,self)}).done({success:_.bind(self.onDataRetrieved,self)})},onFeatureRetrieved:function(result){this.featureList=result.data},onProjectRetrieved:function(result){this.projectList=result.data},onProcessesRetrieved:function(result){this.processList=result.data},getFeaturesForProject:function(project){var currentFeatureId=this.getCurrentEntityId(),fnFilter=function(feature){feature.id!==currentFeatureId&&this.push(feature)},featureList=[];return this.projectHasRequirementsPractice(project)&&_.each(project.features,fnFilter,featureList),featureList},onDataRetrieved:function(){this.processData(this.projectList,this.processList)},projectHasRequirementsPractice:function(project){var projectProcessId=project.process.id,process=_.detect(this.processList,function(process){return process.id==projectProcessId}),requirementsProcess=_.detect(process.practices,function(practice){return practice.name=="Requirements"});return!_.isEmpty(requirementsProcess)},processData:function(availableProjectList,processList){var projectsToBind=[];this.processList=processList,_.each(this.sortProjects(availableProjectList),function(project){var featureForProjectList=this.getFeaturesForProject(project);_.isEmpty(featureForProjectList)||projectsToBind.push({id:project.id,name:project.name,items:featureForProjectList})},this);var data={states:projectsToBind,completed:!0,nullableValue:this.getCurrentEntityId()!==null&&this.propertyIsNotEmpty()};this.fire("dataBind",data)}})})