define(["Underscore","tau/models/propertyLists/model.propertyList.base","tau/configurator","tau/utils/utils.date"],function(a,b,c,d){return b.extend({name:"iteration-list",propertyType:"iteration",onInit:function(){var a=this,b=function(){a.store.get("project",{id:a.config.context.getProjectId(),nested:!0,fields:["id",{iterations:["id","name","startDate","endDate",{release:["id","name"]}]}]}).done({success:a.onDataRetrieved.tauCreateDelegate(a)})};b()},getRequiredFields:function(){return[{entityState:["id"]}]},"bus beforeSave":function(a){var b=a.data.cmd.fields=a.data.cmd.fields||[];b.push({release:["id","name"]})},processData:function(b){var e=this.config,f=this.getCurrentEntityId(),g=[],h=e.mode||"short",i=null,j=null,k=c.getCurrentDate(),l=function(a){a.id!==f&&g.push(a)};h==="full"?i=l:i=function(a){var b=d.parse(a.startDate),c=d.parse(a.endDate);a.id!==f&&(b>=k||c>=k)&&g.push(a)},a.each(b.iterations,i),g.length==0&&(e.mode=="full",i=l,a.each(b.iterations,i));var m=[],n={};a(g).each(function(a){var b=n[a.release.id]||{id:a.release.id,name:a.release.name};b.items=b.items||[];var c=d.parse(a.startDate),e=d.parse(a.endDate),f=k>=c&&k<=e,g=a.name+(f?" (current)":"");f&&(j=a),b.items.push({id:a.id,name:g,description:"From "+d.format.date.short(c)+" to "+d.format.date.short(e)}),n[b.id]||(m.push(b),n[b.id]=b)});var o=b.iterations.length,p=f?o-1:o,q={nullableValue:f!==null&&this.propertyIsNotEmpty(),states:m,completed:0===g.length-p};j&&(q.defaultValue=j.id),this.fire("dataBind",q)}})})