define(["Underscore","tau/core/model-base","tau/core/event","tau/configurator"],function(_,a,b,c){var d=a.extend({"bus afterInit":function(a){c.getRouting().on("stateChanged",function(a){c.getHistory().updateCurrent({url:c.getRouting().getUrl().source})},this)},"bus currentFound":function(a){this._dataHandler(a.data)},"bus currentUpdated":function(a){c.getHistory().updateCurrent(a.data)},_dataHandler:function(a){var b=this;if(a){c.getHistory().setCurrent(a);var d=c.getHistory().stack,e=_.detect(d,function(b){return b.id===a.id});if(e){var f=_.indexOf(d,e);c.getHistory().stack=d.slice(0,f)}}this.bus.fire("stackFound",{})},"bus beforeInit+stackFound":function(){var a=_.clone(c.getHistory().stack);a=a.slice(-3),this.fire("dataBind",{items:a});var b=this},"bus destroy":function(){c.getRouting().removeAllListeners(this)}});return d})