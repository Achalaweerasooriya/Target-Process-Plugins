define(["Underscore","tau/core/model-base"],function(_,ModelBase){var Model=ModelBase.extend({"bus afterInit":function(e){var configurator=this.config.context.configurator;configurator.getRouting().on("stateChanged",function(e){configurator.getHistory().updateCurrent({url:configurator.getRouting().getUrl().source})},this)},"bus currentFound":function(e){this._dataHandler(e.data)},"bus currentUpdated":function(e){var configurator=this.config.context.configurator;configurator.getHistory().updateCurrent(e.data)},_dataHandler:function(data){var self=this,configurator=self.config.context.configurator;if(data){configurator.getHistory().setCurrent(data);var stack=configurator.getHistory().stack,item=_.detect(stack,function(item){return item.id===data.id});if(item){var index=_.indexOf(stack,item);configurator.getHistory().stack=stack.slice(0,index)}}self.fire("stackFound",configurator.getHistory().stack)},"bus beforeInit+stackFound":function(e){var data=_.clone(e.stackFound.data);data=data.slice(-3),this.fire("dataBind",{items:data})},"bus destroy":function(){var configurator=this.config.context.configurator;configurator.getRouting().removeAllListeners(this)}});return Model})