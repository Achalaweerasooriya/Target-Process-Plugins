define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,a){return a.extend({"bus beforeInit:last + dataBind:last + model.add.item":function(t,a,i,n){var d=a.config.context.configurator,o=a.config.context.entity,r=a.config.options,s=i.types[n.type];"release"==o.entityType.name&&"iteration"==s.entityType.name.toLowerCase()&&n.fields.push({id:"release",value:o.id});var y=e.extend({entityType:n.type,values:n.fields},s.coordinates);s.slice[s.saveAction]({$set:y}).done(e.bind(function(t){var a=t.data,i=e.find(r.items,function(e){return e.entityType.toLowerCase()==a.type.toLowerCase()}),y=d.getStore().typeMetaInfo(i.relationName).resource;if(y){var p={id:o.id,__type:o.entityType.name};p[y]=[e.extend(e.omit(a,"entityType","type"),{__type:a.type})],d.getStore().registerWithEvents(p);var f=a.type,c=f.charAt(0).toLowerCase()+f.substring(1);d.getGlobalBus().fire(c+".items.added",{entity:{id:a.id},"evict-data":{entityId:o.id,entityType:o.entityType.name,evictProperties:[y]}})}var m={message:{dataItem:{data:a}},nameType:s.entityType};m.message.dataItem.data.cardData=m.message.dataItem.data,m.openAfter=n.openAfter,this.fire("model.data.item.did.add",m)},this)).fail(e.bind(function(e){return this.fire("model.data.item.did.fail.add",e.data.responseText),!1},this))}})});