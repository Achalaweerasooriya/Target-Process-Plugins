define(["Underscore","tau/models/extension.model.base"],function(a,b){var c=b.extend({"bus extendGetEntityQuery":function(b){var c=b.data.fields,d=["id"];c=b.data.fields=a.uniq(a.union(c,[{owner:d},{responsible:d},"isPrivate"])),a.each(c,function(b){b.hasOwnProperty("entityState")&&(b.entityState=a.uniq(a.union(b.entityState,["isFinal"])))})},"bus filterEntities":function(b){var c=b.data;c.entities=a.select(c.entities,function(a){if(a.entityState.isFinal)return!1;if(!a.isPrivate)return!0;var b=this.config.context.applicationContext.loggedUser.id;return(a.owner||{}).id==b||(a.responsible||{}).id==b},this)}});return c})