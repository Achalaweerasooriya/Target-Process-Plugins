define(["Underscore","tau/models/extension.model.base"],function(a,b){var c=b.extend({"bus entityIdsRetrieved":function(a){var b=a.data,c=b.length;for(var d=0;d<c;d++){var e={id:b[d].id,fields:["id","name",{entityState:["name"]}]};this.fire("extendGetEntityQuery",e),this.fire("get",{type:this.config.typeName,query:e})}this.fire("commitTransaction",{scope:this,success:this.onEntitiesRetrieved})},convertServerDataModelData:function(a){return a=a,{__type:a.__type,id:a.id,name:a.name,state:{name:a.entityState.name}}},onEntitiesRetrieved:function(b){var c={entities:a.pluck(b,"data")};this.fire("filterEntities",c),b=c.entities;var d=a.map(b,this.convertServerDataModelData,this);d=a.compact(d),this.fire("entitiesRetrieved",d)}});return c})