define(["Underscore","tau/models/extension.model.base"],function(e,t){var i=t.extend({"bus entityIdsRetrieved":function(e){for(var t=e.data,i=t.length,n=0;i>n;n++){var r={id:t[n].id,fields:["id","name",{entityState:["name"]}]};this.fire("extendGetEntityQuery",r),this.fire("get",{type:this.config.typeName,query:r})}this.fire("commitTransaction",{scope:this,success:this.onEntitiesRetrieved})},convertServerDataModelData:function(e){e=e;var t=this.config.context.configurator.getUrlBuilder();return{__type:e.__type,id:e.id,name:e.name,state:{name:e.entityState.name},url:t.getNewViewUrl(e.id,e.__type,!0)}},onEntitiesRetrieved:function(t){var i={entities:e.pluck(t,"data")};this.fire("filterEntities",i),t=i.entities;var n=e.map(t,this.convertServerDataModelData,this);n=e.compact(n),this.fire("entitiesRetrieved",n)}});return i});