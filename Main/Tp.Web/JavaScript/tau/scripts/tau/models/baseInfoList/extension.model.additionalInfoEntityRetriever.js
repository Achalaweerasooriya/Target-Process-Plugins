define(["Underscore","tau/models/extension.model.base"],function(_,a){var b=a.extend({"bus entityIdsRetrieved":function(a){var b=a.data,c=b.length;for(var d=0;d<c;d++){var e={id:b[d].id,fields:["id","name",{entityState:["name"]}]};this.fire("extendGetEntityQuery",e),this.fire("get",{type:this.config.typeName,query:e})}this.fire("commitTransaction",{scope:this,success:this.onEntitiesRetrieved})},convertServerDataModelData:function(a){return a=a,{__type:a.__type,id:a.id,name:a.name,state:{name:a.entityState.name}}},onEntitiesRetrieved:function(a){var b={entities:_.pluck(a,"data")};this.fire("filterEntities",b),a=b.entities;var c=_.map(a,this.convertServerDataModelData,this);c=_.compact(c),this.fire("entitiesRetrieved",c)}});return b})