define(["Underscore","tau/models/extension.model.base"],function(_,ModelBase){var ModelListBase=ModelBase.extend({"bus entityIdsRetrieved":function(evtArgs){var entities=evtArgs.data,requestCount=entities.length;for(var i=0;i<requestCount;i++){var query={id:entities[i].id,fields:["id","name",{entityState:["name"]}]};this.fire("extendGetEntityQuery",query),this.fire("get",{type:this.config.typeName,query:query})}this.fire("commitTransaction",{scope:this,success:this.onEntitiesRetrieved})},convertServerDataModelData:function(serverData){serverData=serverData;var urlBuilder=this.config.context.configurator.getUrlBuilder();return{__type:serverData.__type,id:serverData.id,name:serverData.name,state:{name:serverData.entityState.name},url:urlBuilder.getNewViewUrl(serverData.id,serverData.__type,!0)}},onEntitiesRetrieved:function(result){var data={entities:_.pluck(result,"data")};this.fire("filterEntities",data),result=data.entities;var entities=_.map(result,this.convertServerDataModelData,this);entities=_.compact(entities),this.fire("entitiesRetrieved",entities)}});return ModelListBase})