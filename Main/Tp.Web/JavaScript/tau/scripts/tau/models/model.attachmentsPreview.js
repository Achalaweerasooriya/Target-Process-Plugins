define(["tau/core/extension.base"],function(ModelBase){var Model=ModelBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator,store=configurator.getStore(),entity=initConfig.config.context.entity,selected=initConfig.config.selected;store.get(entity.entityType.name,{id:entity.id,fields:[{attachments:["id","date","name","mimeType","uri","thumbnailUri"]}]}).done({success:_.bind(function(res){var attachments=_(res[0].data.attachments).chain().filter(function(v){return v.mimeType===null||(v.mimeType||"").match(/^image\//)}).map(function(v){return v.selected=v.id==selected.id,v}).value(),selectedAttachment=_.find(attachments,function(v){return v.id==selected.id});this.fire("dataBind",{selected:selectedAttachment,items:attachments})},this)})}});return Model})