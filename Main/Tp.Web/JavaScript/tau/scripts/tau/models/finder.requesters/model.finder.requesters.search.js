define(["Underscore","tau/core/class","tau/core/model-base"],function(e,t,i){var r=t.extend({init:function(){this._collection=null,this._parameters=[],this._values={},this._fields=[],this._page=1,this._onPage=10,this._orderBy=null,this._orderDir="asc"},setFields:function(e){this._fields=e},setCollection:function(e){this._collection=e},registerParameters:function(t){this._parameters=e.toArray(t)},setParameter:function(t,i){if(-1==e.indexOf(this._parameters,t))throw new Error('No "'+t+'" parameter for query');this._values[t]=i},setOnPage:function(e){this._onPage=e},setPage:function(e){this._page=e||1},setOrderBy:function(e){this._orderBy=e},setOrderDir:function(e){this._orderDir=e},create:function(){var e={};e.collection=this.createCollection();var t={};t.fields=this._fields,t.$query=this.createWhere();var i=this.createPaging();t.$skip=i.skip,t.$limit=i.limit;var r="asc"==this._orderDir?"$orderBy":"$orderByDesc";return t[r]=this.createOrderBy(),e.request=t,e},createCollection:function(){return this._collection},createWhere:function(){var t={};return e.forEach(this._values,function(e,i){t[i]=e}),t},createOrderBy:function(){return this._orderBy||"id"},createPaging:function(){var e={limit:this._onPage,skip:0};return e.skip=(this._page-1)*this._onPage,e}}),s=r.extend({init:function(){this._super(),this.registerParameters(["name","email","type","projectId","companyId","action"])},createCollection:function(){var e=this._super();if(this._values.type){var t=this._values.type;"User"==t?e="User":"Requester"==t&&(e="Requester")}return this._values.companyId&&(e="Requester"),e},createWhere:function(){var e={};return this._values.type||(e.kind={$in:["User","Requester"]}),e.isActive=1,e.deleteDate={$isNull:!0},"reset"==this._values.action?e:(void 0!==this._values.name&&(e.lastName={$contains:this._values.name}),void 0!==this._values.email&&(e.email={$contains:this._values.email}),this._values.companyId&&"Requester"==this.createCollection()&&(e["company.id"]=this._values.companyId),e)}}),a=t.extend({init:function(e){this.items=e.data;var t=e.command,i=e.data.length;this.paging={start:t.config.$skip,end:t.config.$skip+i,count:i,hasNext:e.data.isNextPageAvailable()}}}),n=i.extend({"bus beforeInit":function(e){this.config=e.data.config;var t=this.config.store,i=this,r=this.config.actions||[];this.config.emptyDataMessage=this.config.emptyDataMessage||"No data found",t.get("company",{fields:["id","name"]}).done({success:function(e){i.fire("dataBind",{actions:r,result:null,filter:{companies:e[0].data}})}});var a=new s;a.setCollection("generalUser"),a.setOnPage(15),a.setFields(["id","firstName","lastName","email","login"]),a.setOrderBy("id"),a.setOrderDir("desc"),this.builder=a,i.fire("search.parametersBound",{parameters:{}})},"bus search.readyToExecute":function(){var e=this.builder.create(),t=this;this.config.store.find(e.collection,e.request).done({success:function(e){var i=new a(e[0]);t.fire("search.completed",{result:i})}})},"bus search.completed":function(e){this.fire("result.ready",{data:{result:e.data.result}})},"bus search.parametersBound":function(t){var i=t.data.parameters,r=this.builder;e.forEach(i,function(e,t){e?r.setParameter(t,e):r.setParameter(t,void 0)}),r.setPage(0),this.fire("search.readyToExecute")},"bus search.pagingBound":function(){var e=this.builder;e.setPage(e._page+1),this.fire("search.readyToExecute")},"bus search.orderBound":function(e){var t=this.builder;t.setOrderBy(e.data.value),t.setOrderDir(e.data.dir),t.setPage(1),this.fire("search.readyToExecute")}});return n});