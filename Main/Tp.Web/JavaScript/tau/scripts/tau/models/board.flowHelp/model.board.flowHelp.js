define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,r){return r.extend({init:function(t){var r=this;if(r._super.apply(r,arguments),r.flowHelpService=t.context.configurator.getHelpScenarioService(),r.flowHelpService.on("next.section",e.bind(r.fire,r,"next.section")),r.flowHelpService.on("done.scenario",e.bind(r.fire,r,"done.section")),r.flowHelpService.getState()===r.flowHelpService.stateTypes.ToBeStarted){var n=r.flowHelpService.getCurrentFlow();r.flowHelpService.run(n)}},isInProgress:function(t){var r=t.getState(),n=t.stateTypes;return!e.contains([n.Aborted,n.Done,n.Stopped],r)},"bus beforeInit":function(){var e=this.getFlowData();this.fire("dataBind",e)},"bus next.section":function(){var e=this.getFlowData();this.fireStatsData(e),this.fire("update",e)},fireStatsData:function(t){var r=e.clone(t),n=": "+t.currentState;t.progress.done===t.progress.total&&(n="is COMPLETED"),r.name=t.name+" ("+(t.progress.done+1)+" of "+t.progress.total+") "+n,r.tags=[t.name],this.fire("help.flow.action",r)},getFlowData:function(){var t=this.flowHelpService,r=t.getCurrentFlow(),n=t.getScenarioById(r),o=t.getSubFlows(r),a="ready to start/replay",i=0;e.each(o||[],function(e){"active"==e.state&&(a=e.name),"done"==e.state&&i++});var s=(o||[]).length;i===s&&(a="COMPLETED");var c={name:n.name,currentState:a,subFlows:o,progress:{total:s,done:i}};return c}})});