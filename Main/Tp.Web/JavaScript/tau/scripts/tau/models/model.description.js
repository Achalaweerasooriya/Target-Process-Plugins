define(["Underscore","tau/core/model-base","tau/utils/utils.htmlConverter"],function(_,ModelBase,htmlConverter){var initialDataProcessor=function(model){this.model=model};initialDataProcessor.prototype={onGetDescription:function(result){var data=result.data;this.id=data.id,this.description=data.description},done:function(results){var eventData={description:htmlConverter.fromSourceToHtml(this.description)};this.model.bus.fire("dataBind",eventData)}};var descriptionModel=ModelBase.extend({name:"Description",bindCurrentEntityChanges:function(propertyList,options){propertyList=_.isArray(propertyList)?propertyList:[propertyList],options=options||{before:"beforePropertyChanged",after:"afterPropertyChanged"};var entityId=this.config.context.entity.id;this.listenedEntities=this.listenedEntities||{};if(this.listenedEntities[entityId])return;this.listenedEntities[entityId]=!0;var self=this,afterSaveHandler=function(evtArgs){var data=evtArgs.data;self.isPropertyChanged(propertyList,data)&&self.fire(options.after,data)},beforeSaveHandler=function(evtArgs){var data=evtArgs.data;self.isPropertyChanged(propertyList,data)&&self.fire(options.before,data)},typeName="general";self.store.unbind(this),self.store.on({eventName:"beforeSave",type:typeName,listener:this,filter:{id:entityId}},beforeSaveHandler),self.store.on({eventName:"afterSave",type:typeName,listener:this,filter:{id:entityId}},afterSaveHandler)},onInit:function(){var proc=new initialDataProcessor(this),ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id;this.bindCurrentEntityChanges("description",{before:"prepareChanges",after:"applyChanges"});var cmdSettings={id:entityId,fields:["id","description"]};this.store.get(entityTypeName,cmdSettings,{scope:proc,success:proc.onGetDescription}).done({success:proc.done,scope:proc})},destroy:function(){this.listenedEntities={},this._super()}});return descriptionModel})