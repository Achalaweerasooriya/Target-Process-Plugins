define(["Underscore","tau/core/model-base","tau/models/dataProviders/model.provider.groups.default","tau/extensions/extension.underscore"],function(a,b,c){var d=b.extend({name:"model.list",onInit:function(){var a=this,b=new this.config.itemsDataProvider(this.config);b.fetch(function(b){a.fire("afterItemsProvided",{data:b})})},"bus afterItemsProvided":function(b){var d=this,e=null;this.config.groupsDataProvider?e=this.config.groupsDataProvider:e=c;var f=b.data.data,g=a.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,h=new e(this.config);h.fetch(g,f,function(a){d.fireAfterGroupsProvided(a)})},fireAfterGroupsProvided:function(a){this.fire("afterGroupsProvided",{data:a})},createSubscription:function(a,b){var c=this;c.store.on({eventName:"beforeRemove",type:a,listener:c},function(a){var d=a.data.id;b(d)&&c.fire("beforeDeleteRow",{id:d})}),c.store.on({eventName:"afterRemove",type:a,listener:c},function(a){var d=a.data.id;b(d)&&c.fire("afterDeleteRow",{id:d})})},"bus afterItemsProvided+afterGroupsProvided":function(b){var c=this,d=b.afterItemsProvided.data.data,e=b.afterGroupsProvided.data.data;if(d&&d.length){var f=function(b){return a(d).detect(function(a){return a.id==b})};a(d).chain().map(function(a){return a.__type}).unique().each(function(a){c.createSubscription(a,f)})}var g={items:[],groups:[],isEmpty:d.length?!1:!0};e!==!1?g.groups=this.innerGroupBy(d,e):g.items=d,this.data=g,c.fire("afterDataProvided",{data:g})},"bus afterDataProvided":function(a){var b=this.preProcess(a.data.data);this.fire("preDataBind",b),this.fire("dataBind",b)},preProcess:function(b){var c=this.config.views[0];return a.forEach(b.groups,function(b){b.title||(a.isObject(b.key)?b.title=a.complexKey(b.key,c.group.dataIndex):b.title=b.key)}),b.config={views:this.config.views,currentView:c},b},innerGroupBy:function(b,c){var d=a.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,e=this;return a.forEach(c,function(c){a.forEach(b,function(b){var e=a.complexKey(b,d);a.isArray(c.key)&&a.indexOf(c.key,e)>-1?c.items.push(b):a.isEqual(c.key,e)&&c.items.push(b)})}),c},"bus prioritize.start":function(b){var d=b.data.item,e=b.data.group,f=null;this.config.groupsDataProvider?f=this.config.groupsDataProvider:f=c;var g=new f(this.config),h=a.filter(this.data.groups,function(a){return g.isAvailableForItem(d,a,e)});this.fire("prioritize.updateGroupsAvailability",{groups:h});var i=g.getCommentRequirements(d,this.data.groups,e);this.fire("prioritize.updateGroupsCommentRequirements",{groups:i})}});return d})