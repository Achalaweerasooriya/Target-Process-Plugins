define(["Underscore","tau/core/model-base","tau/models/dataProviders/model.provider.groups.default"],function(e,t,i){var r=t.extend({name:"model.list",onInit:function(){var e=this;e.store.unbind(this);var t=new this.config.itemsDataProvider(this.config);t.fetch(function(t){e.fire("afterItemsProvided",{data:t})})},"bus afterItemsProvided":function(t){var r=this,o=null;o=this.config.groupsDataProvider?this.config.groupsDataProvider:i;var a=t.data.data,n=e.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,s=new o(this.config);s.fetch(n,a,function(e){r.fireAfterGroupsProvided(e)})},fireAfterGroupsProvided:function(e){this.fire("afterGroupsProvided",{data:e})},createSubscription:function(e,t){var i=this;i.store.on({eventName:"beforeRemove",type:e,listener:i},function(e){var r=e.data.id;t(r)&&i.fire("beforeDeleteRow",{id:r})}),i.store.on({eventName:"afterRemove",type:e,listener:i},function(e){var r=e.data.id;t(r)&&i.fire("afterDeleteRow",{id:r})})},"bus afterItemsProvided+afterGroupsProvided":function(t){var i=this,r=t.afterItemsProvided.data.data,o=t.afterGroupsProvided.data.data;if(r&&r.length){var a=function(t){return e(r).detect(function(e){return e.id==t})};e(r).chain().map(function(e){return e.__type}).unique().each(function(e){i.createSubscription(e,a)})}var n={items:[],groups:[],isEmpty:r.length?!1:!0};o!==!1?n.groups=this.innerGroupBy(r,o):n.items=r,this.data=n,i.fire("afterDataProvided",{data:n}),n.isEmpty&&i.fire("noData")},"bus afterDataProvided":function(e){var t=this.preProcess(e.data.data);this.fire("preDataBind",t),this.fire("dataBind",t)},preProcess:function(t){var i=this.config.views[0];return e.forEach(t.groups,function(t){t.title||(t.title=e.isObject(t.key)?e.complexKey(t.key,i.group.dataIndex):t.key)}),t.config={views:this.config.views,currentView:i},t},innerGroupBy:function(t,i){var r=this.config.groupBy;return r=e.isArray(r)?r[0]:r,e.forEach(i,function(i){e.forEach(t,function(t){var o=e.complexKey(t,r);e.isArray(i.key)&&e.indexOf(i.key,o)>-1?i.items.push(t):e.isEqual(i.key,o)&&i.items.push(t)
})}),i},"bus prioritize.start":function(t){var r=t.data.item,o=t.data.group,a=null;a=this.config.groupsDataProvider?this.config.groupsDataProvider:i;var n=new a(this.config),s=e.filter(this.data.groups,function(e){return n.isAvailableForItem(r,e,o)});this.fire("prioritize.updateGroupsAvailability",{groups:s});var u=n.getCommentRequirements(r,this.data.groups,o);this.fire("prioritize.updateGroupsCommentRequirements",{groups:u})}});return r});