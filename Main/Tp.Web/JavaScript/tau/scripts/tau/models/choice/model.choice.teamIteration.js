define(["Underscore","./model.choice.base","tau/utils/utils.date"],function(t,e,a){return e.extend({name:"team-iteration-list",propertyType:"teamIteration",onInit:function(){var e=this.config.context.entity,a=this;this.store.get(e.entityType.name,{id:e.id,fields:["id",{team:["id",{teamIterations:["id","name","startDate","endDate","isCurrent"]}]}]}).done({success:function(e){e[0].data.team=e[0].data.team||{};var n=t.defaults(e[0].data.team,{teamIterations:[]});a.processData.call(a,n)}})},convertTeamIterationToDto:function(t){var e=a.convertToTimezone(t.startDate),n=a.convertToTimezone(t.endDate);return{id:t.id,name:t.name,description:"From "+a.format.date.short(e)+" to "+a.format.date.short(n),isCurrent:t.isCurrent}},processData:function(e){var n=this.config,i=this.getCurrentEntityId(),o=[],r=n.mode||"short",s=null,u=null,c=this.config.context.configurator.getCurrentDate(),d=function(t){t.id!==i&&o.push(t)};s="full"===r?d:function(t){var e=a.convertToTimezone(t.startDate),n=a.convertToTimezone(t.endDate);t.id!==i&&(e>=c||n>=c)&&o.push(t)},t.each(e.teamIterations,s),0===o.length&&(s=d,t.each(e.teamIterations,s));var l=[];t(o).each(function(t){!u&&t.isCurrent&&(u=t),l.push(this.convertTeamIterationToDto(t))},this);var m=e.teamIterations.length,h=i?m-1:m,f={nullableValue:this.isNullableValue(),states:l,completed:0===l.length-h};u&&(f.defaultValue=u.id),this.fire("dataBind",f)}})});