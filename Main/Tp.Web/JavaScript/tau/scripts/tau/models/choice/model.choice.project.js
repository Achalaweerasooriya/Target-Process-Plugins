define(["Underscore","./model.choice.base","tau/const/entityType.practices"],function(e,t,i){return t.extend({propertyType:"project",init:function(e,t){this._super(e),this.showCurrentProject=!!t},"bus beforeInit":function(t,i){var n=i.config.context.entity,r=i.config.context.configurator,o=r.getStore(),c=e.bind(this.fire,this),a={fields:["id","name","color","isActive",{process:["id",{practices:["id","name"]}]}]},s={id:n.id,fields:["id",{project:["id"]}]};o.get("project",a).done(function(e){c("items.ready",e[0].data)}),o.get(n.entityType.name,s).done(function(e){c("currentItem.ready",e[0].data.project||{})})},"bus beforeInit:last + items.ready + currentItem.ready":function(t,n,r,o){var c=n.config,a=n.config.context.entity.entityType.name.toLowerCase(),s=e.compact([i[a]]),d=o&&o.id;r=e.filter(r,function(t){var i=!0;if(s.length&&t.isActive){var n=e.pluck(t.process.practices,"name");i=e.any(n,function(t){return e.indexOf(s,t)>=0})}return t.isActive&&i}),r=e.sortBy(r,function(e){return e.name.toLowerCase()}),!this.showCurrentProject&&d&&(r=e.reject(r,function(e){return e.id===o.id}));var u=n.config.context.configurator.getFeaturesService(),f=u.isEnabled("hide.noProject"),p={states:r,completed:!0,nullableValue:!f&&this.isNullableValue(),templateOption:c.templateOption};this.fire("dataBind",p)}})});