define(["Underscore","./model.choice.base"],function(e,t){var i={bug:["Bug Tracking"],feature:["Requirements"],release:["Requirements"],testcase:["Test Cases"],testplan:["Test Cases"],iteration:["Iterations"],request:["Help Desk"],epic:["Requirements"]};return t.extend({propertyType:"project",init:function(e,t){this._super(e),this.showCurrentProject=!!t},"bus beforeInit":function(t,i){var n=i.config.context.entity,r=i.config.context.configurator,o=r.getStore(),s=e.bind(this.fire,this),c={fields:["id","name","color","isActive",{process:["id",{practices:["id","name"]}]}]},a={id:n.id,fields:["id",{project:["id"]}]};o.get("project",c).done(function(e){s("items.ready",e[0].data)}),o.get(n.entityType.name,a).done(function(e){s("currentItem.ready",e[0].data.project||{})})},"bus beforeInit:last + items.ready + currentItem.ready":function(t,n,r,o){var s=n.config,c=n.config.context.entity.entityType.name.toLowerCase(),a=i[c]||[],u=o&&o.id;r=e.filter(r,function(t){var i=!0;if(a.length&&t.isActive){var n=e.pluck(t.process.practices,"name");i=e.any(n,function(t){return e.indexOf(a,t)>=0})}return t.isActive&&i}),r=e.sortBy(r,function(e){return e.name.toLowerCase()}),!this.showCurrentProject&&u&&(r=e.reject(r,function(e){return e.id===o.id}));var d=n.config.context.configurator.getFeaturesService(),f=d.isEnabled("hide.noProject"),l={states:r,completed:!0,nullableValue:!f&&this.isNullableValue(),templateOption:s.templateOption};this.fire("dataBind",l)}})});