define(["require","Underscore","./model.choice.base"],function(t){var e=t("Underscore"),i=t("./model.choice.base");return i.extend({propertyType:"teamStates","bus beforeInit":function(t,i){var a=i.config.context.entity,n=i.config.context.configurator;this.store=n.getStore();var s=e.bind(this.fire,this),r={fields:["id","name","icon"]},d={id:a.id,fields:["id",{teamStates:["id",{team:["id"]}]}]};this.store.get("team",r).done(function(t){s("items.ready",t[0].data)});var o=this;this.store.get(a.entityType.name,d).done(function(t){var i=t[0].data.teamStates;o.activeTeamState=e.first(i),s("currentItem.ready",e.pluck(i,"team")||[])})},"bus beforeInit:last + items.ready + currentItem.ready":function(t,i,a,n){var s=i.config;a=e.sortBy(a,function(t){return t.name.toLowerCase()});var r={states:e.reject(a,function(t){return e.contains(this,t.id)},e.pluck(n,"id")),completed:!0,nullableValue:this.isNullableValue(),templateOption:s.templateOption};this.fire("dataBind",r)},"bus beforeSave":function(t){var e=t.data.cmd.fields||[];e.push("id","team",{teamStates:["team"]}),t.data.cmd.fields=e},buildDataSet:function(t){return t.id?this.activeTeamState?[{id:this.activeTeamState.id,team:this._super(t)}]:[{team:this._super(t)}]:[]},handleSave:function(t,e){var i=this._super.bind(this,t,e);!this.activeTeamState||t.additionalData&&t.additionalData.id?i():this.store.removeDef("teamStates",{id:this.activeTeamState.id}).then(function(){this.isDestroyed||i()}.bind(this))},destroy:function(){this._super.apply(this,arguments),this.isDestroyed=!0}})});