define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,n){var i=n.extend({"bus beforeInit + boardSettings.ready:last":function(t,n,i){var s=i.boardSettings,r=n.config.context.configurator;s.unbind({listener:this});var a=["cells","y","x"];s.bind({fields:a,listener:this,callback:e.bind(function(){this.fire("refresh")},this)});var c=function(e){return e&&e.types||[]};s.get({fields:a,callback:e.bind(function(t){this.getEmptySpace(r).done(e.bind(function(e){this.fire("dataBind",this.getViewModel({cells:c(t.cells),x:c(t.x),y:c(t.y)},e,r.getUnitsRegistry().units))},this))},this)})},"bus + boardSettings.ready:last + destroy":function(e,t){t.boardSettings.unbind({listener:this})},getEmptySpace:function(n){return this.emptySpace?t.when(this.emptySpace):n.getSliceFactory().create({}).space().then(e.bind(function(e){return this.emptySpace={cells:e.data.cells.items,axes:e.data.axes.items},this.emptySpace},this))},getViewModel:function(t,n,i){function s(t,n){return e.chain(t).filter(function(e){return n.filter(function(t){return t==e.id}).length}).map(function(e,t){return{id:e.id,name:e.name,"default":!t}}).value()}var r=function(t,n){return e.reduce(t,function(t,i){return t&&e.find(n,function(t){return e.contains(t.types,i.id)})},!0)},a=s(n.cells,t.cells),c=s(n.axes,t.y),u=s(n.axes,t.x),l={cells:!0};return u.isDisabled=!r(u,i),c.isDisabled=!r(c,i),{cells:a,y:c,x:u,defaultChecked:l}}});return i});