define(["Underscore","tau/core/model-base","tau/configurator","tau/core/termProcessor"],function(_,a,b,c){var d=function(a,b){this.model=a,this.appContext=b;var d=b.processes[0].terms;this.termProcessor=new c(d)};d.prototype={convertToItem:function(a){var c=_.bind(function(a){var b=a,c=this.termProcessor.getTerms(b.__type).name,d=c+" #"+b.id+" "+b.name;return d},this),d=b.getRouting().getUrl().source;return{id:a.id,url:d.length&&d.match(/\//)?d:"#"+a.__type.toLowerCase()+"/"+a.id,title:c(a)}},onGetEntity:function(a){this.entity=a.data},done:function(){this.model.fire("currentFound",this.convertToItem(this.entity))}};var e=a.extend({onInit:function(){var a=this,b=a.config.context,c=b.entity.entityType.name,e=b.entity.id,f=b.applicationContext.processes[0],g=new d(a,b.applicationContext),h=function(b){b.data.changes.hasOwnProperty("name")&&a.store.get(c,{id:e,fields:["id","name"]},{success:function(b){a.bus.fire("currentUpdated",g.convertToItem(b.data))}}).done()};a.store.on({eventName:"afterSave",type:c,listener:this},h),a.store.get(c,{id:e,fields:["id","name"]},{scope:g,success:g.onGetEntity}).done({scope:g,success:g.done})}});return e})