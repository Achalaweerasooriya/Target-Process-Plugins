define(["Underscore","tau/core/extension.base"],function(e,t){return t.extend({fields:["name"],"bus entity.ready + configurator.ready":function(t,i,n){"user"==i.entityType.name&&(this.fields=["firstName","lastName"]);var r=n.getStore();r.unbind(this),r.on({eventName:"afterSave",type:i.entityType.name,id:i.id,fields:this.fields,listener:this},e.bind(this.update,this,i,n)),n.getHistory().setCurrent({url:n.getUrlBuilder().getNewViewUrl(i.id,i.entityType.name,!0),id:i.id})},"bus entity.ready + configurator.ready + storeFreeze.ready":function(e,t,i){this.update(t,i)},update:function(t,i){var n=i.getStore();n.get(t.entityType.name,{id:t.id,fields:["id"].concat(this.fields)}).done(e.bind(function(e){var t=e[0].data;i.getHistory().updateCurrent({title:this.createTitle(t,i.getTemplateFactory().getTermProcessor())})},this))},createTitle:function(t,i){return e.sprintf("%s #%d %s",i.getTerm(t.__type,"name"),t.id,e.values(e.pick(t,this.fields)).join(" "))},"bus configurator.ready + destroy":function(e,t){t.getStore().unbind(this)}})});