define(["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus entity.ready + configurator.ready":function(evt,entity,configurator){var entityType=entity.entityType.name,store=configurator.getStore(),fire=_.bind(this.fire,this);store.unbind(this),_.forEach(["team","project","userStory"],_.bind(function(changeField){store.on({eventName:"afterSave",type:entityType,listener:this,filter:{id:entity.id},hasChanges:[changeField]},function(cmd){var d=cmd.data;fire("entity.toEvict",entity);var update=_.extend({},d.obj,d.changes,{__type:d.obj.type});store.register(update),fire("refresh")})},this)),entityType=="project"&&store.on({eventName:"afterSave",type:entityType,listener:this,filter:{id:entity.id},hasChanges:["process"]},function(){fire("entity.toEvict",entity),fire("refresh")})},"bus configurator.ready > destroy":function(evt,configurator){configurator.getStore().unbind(this)}})})