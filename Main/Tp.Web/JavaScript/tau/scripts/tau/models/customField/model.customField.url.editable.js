define(["tau/models/model.customField.editable","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema){var model=ModelBase.extend({category:"edit",name:"Editable custom field",schema:jsonSchema.Schema.create({type:"object",properties:{value:{type:"object",optional:!1,pre:function(instance){var notEmpty=!!_.trim(instance.label)||!!_.trim(instance.url);return this.schema.properties.label.optional=this.schema.properties.label.optional&&!notEmpty,this.schema.properties.label.empty=this.schema.properties.label.empty&&!notEmpty,this.schema.properties.url.optional=this.schema.properties.url.optional&&!notEmpty,this.schema.properties.url.empty=this.schema.properties.url.empty&&!notEmpty,instance},properties:{label:{type:"string",optional:!0,maxLength:30,pre:["trim"]},url:{type:"string",optional:!0,pattern:jsonSchema.PATTERN_URL,pre:["trim",function(instance){return instance.length==0&&this.schema.optional&&(this._wasError=1),instance}]}},post:function(instance){return!instance.label&&!instance.url&&(instance={label:null,url:null}),instance}}}}),"bus validate":function(evt){var args=evt.data,data=args.cmd.$set.customFields[0],customField=this.config.customField||this.config.data;this.schema.properties.value.properties.label.optional=!customField.required,this.schema.properties.value.properties.label.empty=!customField.required,this.schema.properties.value.properties.url.optional=!customField.required,this.schema.properties.value.properties.url.empty=!customField.required,args.validation=this.schema.validate(data),delete args.validation.instance.value.__id}});return model})