define(["tau/models/customField/model.customField.editable","tau/utils/utils.jsonSchema","tau/utils/utils.htmlConverter"],function(e,t,i){var a=e.extend({category:"edit",name:"Editable custom field",schema:t.Schema.create({type:"object",properties:{value:{optional:!0,empty:!0,maxLength:4e3,type:"string",pre:["trim"]}}}),"bus save":function(e){var t=this,a=t.config.context?t.config.context.entity:{},o=e.data||{},r=o.$set||o,d=o.$include,n=o.hasOwnProperty("id")?o.id:a.id,s=o.typeName||a.entityType.name,l={$set:r,fields:d};n&&(l.id=n);var c={type:s,cmd:l,validation:{isValid:!0,isError:function(){return!1}}},m=c.cmd.$set.customFields[0];if(c.validation=this.schema.validate(m),t.fire("afterValidate",c),c.validation.isValid===!1||c.validation.isError&&1==c.validation.isError())return void this.fire("validationFailed",c);t.fire("beforeSave",c);var u=c.cmd.$set,f=u.customFields[0];f.value=i.fromHtmlToSource(f.value),t.store.save(s,l,{success:function(e){t.fire("afterSave",{type:e.command.type,cmd:l})},failure:function(e){t.fire("saveFailed",{data:e,type:e.command.type,cmd:l})}}).done()}});return a});