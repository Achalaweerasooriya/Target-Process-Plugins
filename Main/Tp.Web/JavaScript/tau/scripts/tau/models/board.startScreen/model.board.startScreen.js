define(["Underscore","jQuery","tau/core/extension.base"],function(e,t,r){return r.extend({"bus beforeInit":function(r,o){var a=o.config.context.configurator;this.fire("configurator.ready",a);var i=e.defaults(o.config.options||{},{boardTemplatesGroupName:"boardTemplates",boardTemplateGroupsGroupName:"boardTemplateGroups",boardsGroupName:"boards"});this.fire("options.ready",i);var n=t.Deferred();a.getLoggedUser().isAdministrator?a.getRestStorage().select(i.boardsGroupName,{$where:'(publicData.isShared == "true")',$fields:["key"]}).done(function(e){var t=e.data||[];0===t.length?n.resolve():n.reject()}):n.reject(),n.done(e.bind(function(){this.fire("dataBind",{})},this)).fail(function(){a.getRouting().redirect(a.getUrlBuilder().getRelativeBoardUrl("current"))})},"bus configurator.ready:last + options.ready:last + boardsSet.selected":function(r,o,a,i){var n=t.Deferred(),s=o.getHelpScenarioService(),d=s.getScenarioById(i),c=d.requiredProject;c?o.getApplicationContextService().getApplicationContext({projectIds:[c],teamIds:[]},{success:n.resolve}):n.resolve({acid:void 0});var l=t.Deferred(),u=this;t.post(o.getApplicationPath()+"/board/generate/"+i).fail(function(e){console.log("ERROR: "+e.responseText)}).done(function(){u.fire("boardsSet.applied"),l.resolve()}),t.when(n,l).done(e.bind(function(e){var t=s.checkScenarioPrerequisites(e,d)?i:"scratch";s.setCurrentFlow(t),s.setState(s.stateTypes.ToBeStarted),o.getRouting().redirect(o.getUrlBuilder().getRelativeBoardUrl("current",e.acid)),this.fire("helpFlow.activated")},this))}})});