define(["Underscore","jQuery","tau/core/class","tau/core/event"],function(e,t,n,s){var i=n.extend({init:function(){this.buses={}},register:function(e){this.buses[e.id]=e,this.fire("create",{bus:e})},count:function(t){var n=e.keys(this.buses);return t&&(n=e.without(n,"global")),n.length},size:function(){return this.count()},stats:function(){var t={};e.forEach(this.buses,function(e){t.hasOwnProperty(e.name)||(t[e.name]=0),t[e.name]++}),e.forEach(t,function(e,t){console.log(t+" : "+e)})},unregister:function(e){"global"!==e.id&&(delete this.buses[e.id],this.fire("destroy",{bus:e}))},getByName:function(n,s){var i=t.Deferred(),r=function(e){return e.name===n},o=e.find(this.buses,r);if(o)i.resolve(o);else{var u=e.bind(function(e,t){var n=t.data.bus;r(n)&&(this.removeListener("create",u,this),e.resolve(n))},this,i);this.on("create",u,this)}return s&&i.done(s),i},onCreate:function(e){this.register(e)},onDestroy:function(e){this.unregister(e)},logCount:function(){console.log("#count: "+this.count())},clear:function(){this.buses={}}});return s.implementOn(i.prototype),i});