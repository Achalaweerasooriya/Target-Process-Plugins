define(["Underscore","tau/extensions/extension.underscore"],function(a){var b=function(){};b.implementOn=function(a){var c=b.prototype;for(var d in c)a[d]==undefined&&(a[d]=c[d]);return a},b.signUpOnEvents=function(b,c,d,e,f){var g={},h=b,i=function(b){g[b.name]=b,a(g).keys().length===h.length&&(c[d].call(c,g),g={})};a(h).each(function(a){e.on(a,i,null,null,f)})},b.subscribeOn=function(c){var d=a(c);a.each(d.keys(),function(d){var e=c[d];if(!!e&&a.isFunction(e.on)){var f=a(c).functionsExt();for(var g=0,h=f.length;g<h;g++){var i=f[g],j=i.split(" "),k=j[1],l=j[0],m;if(j.length<2)continue;j.length>2&&!isNaN(j[2])&&(m=j[2]);var n=k.split("+");l==d&&(n.length>1?b.signUpOnEvents(n,c,i,e,m):e.on(k,c[i],c,null,m))}}})},b.unSubscribe=function(b){var c=a(b);a.each(c.keys(),function(c){var d=b[c];d&&a.isFunction(d.removeAllListeners)&&d.removeAllListeners()})},b.prototype=function(){var b=function(a){var b=a.getPrivate&&a.getPrivate()||a._||(a._={});return b.events||(b.events={})},c=function(a){this.name=a,this.listeners=[]};c.prototype={getListenerIndex:function(a,b){for(var c=0,d=this.listeners;c<d.length;c++)if(d[c].fn==a&&(d[c].scopeObj===b||!d[c].scopeObj&&(arguments.length==1||!b)))return c;return-1}};return{on:function(d,e,f,g,h){{if(!a.isArray(d)){var k=b(this),l=k[d]||(k[d]=new c(d));if(l.getListenerIndex(e,f)<0){var m=l.listeners;f||(f=this),isNaN(h)&&(h=10);var n=this,o=function(a,b,c,h){var i={name:d,sender:this,caller:a,data:b,listenerData:g,stop:c,cancel:h,removeListener:function(){n.removeListener(d,e,f)}};e.call(f,i);return i.data};o.fn=e,o.scopeObj=f,o.priority=h;for(var p=m.length-1;p>=0;p--)if(m[p].priority<=h){m.splice(p+1,0,o);return}m.unshift(o)}return this}var i=arguments.callee,j=this;a.each(d,function(a){i.call(j,a,e,f,g,h)})}},fire:function(){var a=!1,c=function(){a=!0},d=!1,e=function(){d=!0};return function(f,g,h){var i=b(this)[f],j=a,k=d;a=d=!1;if(i){var l=i.listeners;if(l.length){l=l.slice(0);for(var m=0;m<l.length;m++){var n=l[m].call(this,h,g,c,e);typeof n!="undefined"&&(g=n);if(a||d)break}}}var o=d||(typeof g=="undefined"?!1:g);a=j,d=k;return o}}(),fireOnce:function(a,c,d){var e=this.fire(a,c,d);delete b(this)[a];return e},removeListener:function(a,c,d){var e=b(this)[a];if(e){var f=e.getListenerIndex(c,d);f>=0&&e.listeners.splice(f,1)}},removeAllListeners:function(){var a=b(this);for(var c in a)a[c].listeners&&delete a[c].listeners,delete a[c]},hasListeners:function(a){var c=b(this)[a];return c&&c.listeners.length>0}}}();return b})