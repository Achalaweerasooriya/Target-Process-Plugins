define(["Underscore","tau/extensions/extension.underscore"],function(a){var b=function(){};return b.implementOn=function(a){var c=b.prototype;for(var d in c)a[d]==undefined&&(a[d]=c[d]);return a},b.signUpOnEvents=function(b,c,d,e,f){var g={},h=b,i=function(b){g[b.name]=b,a(g).keys().length===h.length&&(c[d].call(c,g),g={})};a(h).each(function(a){e.on(a,i,c,null,f)})},b.subscribeOn=function(c){var d=a(c);a.each(d.keys(),function(d){var e=c[d];if(!e)return;if(a.isFunction(e.on)){var f=a(c).functionsExt();for(var g=0,h=f.length;g<h;g++){var i=f[g],j=i.split(" "),k=j[1],l=j[0],m;if(j.length<2)continue;j.length>2&&!isNaN(j[2])&&(m=j[2]);var n=k.split("+");l==d&&(n.length>1?b.signUpOnEvents(n,c,i,e,m):e.on(k,c[i],c,null,m))}}})},b.unSubscribe=function(b){var c=a(b);a.each(c.keys(),function(c){var d=b[c];d&&a.isFunction(d.removeAllListeners)&&d.removeAllListeners(b)})},b.prototype=function(){var b=function(a){var b=a.getPrivate&&a.getPrivate()||a._||(a._={});return b.events||(b.events={})},c=function(a){this.name=a,this.listeners=[]};return c.prototype={getListenerIndex:function(a,b){for(var c=0,d=this.listeners;c<d.length;c++)if(d[c].fn==a&&(d[c].scopeObj===b||!d[c].scopeObj&&(arguments.length==1||!b)))return c;return-1}},{on:function(d,e,f,g,h){if(a.isArray(d)){var i=arguments.callee,j=this;a.each(d,function(a){i.call(j,a,e,f,g,h)});return}var k=b(this),l=k[d]||(k[d]=new c(d));if(l.getListenerIndex(e,f)<0){var m=l.listeners;f||(f=this),isNaN(h)&&(h=10);var n=this,o=function(a,b,c,h){var i={name:d,sender:this,caller:a,data:b,listenerData:g,stop:c,cancel:h,removeListener:function(){n.removeListener(d,e,f)}};return e.call(f,i),i.data};o.fn=e,o.scopeObj=f,o.priority=h;for(var p=m.length-1;p>=0;p--)if(m[p].priority<=h){m.splice(p+1,0,o);return}m.unshift(o)}return this},fire:function(){var a=!1,c=function(){a=!0},d=!1,e=function(){d=!0};return function(f,g,h){var i=b(this)[f],j=a,k=d;a=d=!1;if(i){var l=i.listeners;if(l.length){l=l.slice(0);for(var m=0;m<l.length;m++){var n=l[m].call(this,h,g,c,e);typeof n!="undefined"&&(g=n);if(a||d)break}}}var o=d||(typeof g=="undefined"?!1:g);return a=j,d=k,o}}(),fireOnce:function(a,c,d){var e=this.fire(a,c,d);return delete b(this)[a],e},removeListener:function(a,c,d){var e=b(this)[a];if(e){var f=e.getListenerIndex(c,d);f>=0&&e.listeners.splice(f,1)}},removeAllListeners:function(a){var c=b(this);for(var d in c)if(c[d].listeners)if(!a)delete c[d].listeners,delete c[d];else{var e=c[d].listeners,f=[];for(var g=0;g<e.length;g++)e[g].scopeObj!=a&&f.push(e[g]);c[d].listeners=f}},hasListeners:function(a){var c=b(this)[a];return c&&c.listeners.length>0},getListeners:function(){var a=b(this),c=[];for(var d in a){var e=a[d].listeners;if(e&&e.length>0){var f=[];for(var g=0;g<e.length;g++){var h=e[g],i={name:"unknown",item:h};h.scopeObj&&h.scopeObj.bus&&h.scopeObj.bus.name?i.name=h.scopeObj.bus.name:h.scopeObj&&h.scopeObj.name&&(i.name=h.scopeObj.name),f.push(i)}c.push({name:d,items:e,count:e.length,listeners:f})}}return c},getListenersCount:function(){var a=b(this),c=0;for(var d in a)a[d].listeners&&(c+=a[d].listeners.length);return c}}}(),b})