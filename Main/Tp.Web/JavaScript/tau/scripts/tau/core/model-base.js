define(["Underscore","tau/core/event.emitter"],function(a,b){var c=b.extend({init:function(a){this._super(a),this.store=a.store,this.config=a},onInit:function(){},isCommandForEntityInContext:function(a){return a.data.cmd.config.id===this.config.context.entity.id},isPropertyChanged:function(b,c){var d=c.changes;return a.any(b,function(a){return d.hasOwnProperty(a)})},attachToChangePropertiesOfCurrentEntity:function(b){var c=a.isArray(b)?b:[b],d=this.config.context.entity.id,e=this,f=function(a){var b=a.data;e.isPropertyChanged(c,b)&&e.fire("propertyChanged",b)},g=function(a){var b=a.data;e.isPropertyChanged(c,b)&&e.fire("beforeChangeProperty",b)},h=this.config.context.entity.entityType.name||"general";e.store.on({type:h,eventName:"afterSave",filter:{id:d},listener:e},f),e.store.on({type:h,eventName:"beforeSave",filter:{id:d},listener:e},g),b[this.propertyName]=[this.displayField,this.valueField]},"bus beforeInit":function(a){this.config=a.data?a.data.config:{},this.onInit()},"bus evictData":function(){var a=this.config.context.entity,b=a.id;this.store.config.proxy.evictPersistedObject(b,"context"),this.store.config.proxy.evictPersistedObject(b,a.entityType.name)},destroy:function(){this.store.unbind(this),delete this.config,delete this.store,this._super()}});return c})