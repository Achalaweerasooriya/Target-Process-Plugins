define(["Underscore","tau/core/class","tau/core/event"],function(a,b,c){var d=b.extend({init:function(a,b){if(arguments.length>1)this.store=a,this.config=b;else if(arguments.length==1){var b=arguments[0];this.bus=b.bus,this.store=b.store,this.config=b,c.subscribeOn(this)}},fire:function(a,b){this.bus.fire.call(this.bus,a,b,this)},onInit:function(){},isCommandForEntityInContext:function(a){return a.data.cmd.config.id===this.config.context.entity.id},isPropertyChanged:function(b,c){var d=c.changes;return a.any(b,function(a){return d.hasOwnProperty(a)})},attachToChangePropertiesOfCurrentEntity:function(b){var c=a.isArray(b)?b:[b],d=this.config.context.entity.id,e=this,f=function(a){var b=a.data;e.isPropertyChanged(c,b)&&e.fire("propertyChanged",b)},g=function(a){var b=a.data;e.isPropertyChanged(c,b)&&e.fire("beforeChangeProperty",b)},h="general";e.store.on({type:h,eventName:"afterSave",filter:{id:d},listener:e},f),e.store.on({type:h,eventName:"beforeSave",filter:{id:d},listener:e},g),b[this.propertyName]=[this.displayField,this.valueField]},"bus beforeInit":function(a){this.config=a.data.config,this.onInit()},"bus destroy":function(){this.destroy()},"bus evictData":function(){var a=this.config.context.id;this.store.config.proxy.evictPersistedObject(a,"context"),this.store.config.proxy.evictPersistedObject(a,this.config.context.entityType.name)},destroy:function(){c.unSubscribe(this),this.store.unbind(this),this.config=null,this.store=null,this.bus=null}});return d})