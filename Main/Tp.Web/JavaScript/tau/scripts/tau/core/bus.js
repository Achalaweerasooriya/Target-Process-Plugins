define(["Underscore","tau/core/class","tau/core/bus.reg","tau/core/event"],function(_,a,b,c){function e(a,b,c){var d=b[1],e=b[0];a.name.match(/(diagnostics)/)&&console.log(a.name,"["+a.id+"]",":",e,d||"")}var d=a.extend({globalBus:null,init:function(a){a=a||{},this.globalBus=a&&a.globalBus?a.globalBus:null,this.name=a&&a.name?a.name:_.uniqueId()+"",_.defaults(a,{id:_.uniqueId("bus_")}),this.id=a.id,b.onCreate(this)},initialize:function(a){this.fire("initialize",a)},destroy:function(){this.fire("destroy"),delete this.globalBus},getGlobalBus:function(){return this.globalBus}});return c.implementOn(d.prototype),d.prototype.fire=function(a,d,e){this.globalBus&&this.globalBus.fire(a,d,this);var f=c.prototype.fire.apply(this,arguments);return a==="destroy"&&(b.onDestroy(this),delete this.globalBus),f},d})