define(["Underscore","tau/core/class","tau/core/bus.reg","tau/core/event","tau/core/event.queued"],function(e,t,i,u,n){var s=function(e){return function(t,u){this.globalBus&&this.globalBus.fire(t,u,this);var n=e.prototype.fire.apply(this,arguments);return"destroy"===t&&(i.onDestroy(this),delete this.globalBus),n}},o=s(n),l=t.extend({globalBus:null,init:function(t){t=t||{},(t["queue.bus"]||t.queuedBus)&&(this.fire=o),this.globalBus=t&&t.globalBus?t.globalBus:null,this.name=t&&t.name?t.name:e.uniqueId()+"",e.defaults(t,{id:e.uniqueId("bus_")}),this.id=t.id,i.onCreate(this)},initialize:function(e){this.fire("initialize",e)},destroy:function(){this.fire("destroy"),delete this.globalBus},getGlobalBus:function(){return this.globalBus}});return u.implementOn(l.prototype),l.prototype.fire=s(u),l});