define(["Underscore","tau/core/class","tau/store/types.targetprocess"],function(e,t,r){var n=/\$\{(.+?)(?:,(.*?))?(?:,(.*?))?\}/gi,i={lower:function(e){return e.toLowerCase()},camel:e.titleize,capital:e.capitalize,upper:function(e){return e.toUpperCase()},id:function(e){return e}},a={icon:function(e,t){return'<em class="tau-entity-icon tau-entity-icon--icon tau-entity-icon--'+t.toLowerCase().replace(" ","")+'">'+e+"</em>"},abbr:function(t,r,n){return t==("names"==n?e.pluralize(r):r)?t:'<abbr title="'+r+'">'+t+"</abbr>"},id:function(e){return e}},o={},u=function(t){t=t||"",t=t.replace(/\s+/g," ");var r=o[" "+t];if(r)return r;r="";var n=e.trim(t).split(" ");return n[0]&&(r=n[0][0].toUpperCase(),n[1]&&(r+=n[1][0].toUpperCase())),o[" "+t]=r,r},c=function(e){return e},s=function(t,r,n){var i=r[t],a=e.find(n,function(e){return e.wordKey===i.key});return a?a.value:i.val},f=function(e,t){if(!e)return void 0;var r=s("name",e,t);return{name:r,names:s("names",e,t),iconSmall:u(r),iconBig:c(r)}},m=t.extend({init:function(t){this.registry={},e.forEach(r._dictionary,function(e,r){this.registry[r]=f(e.terms,t)},this)},getTerm:function(e,t){var r=this.getTerms(e);return r?r[t]||r.name:""},getShortAbbreviation:u,getLongAbbreviation:c,getTerms:function(e){return this.registry[e]},resolve:function(e,t){return this.getTerm(e,"name")||t||e},replaceTermTags:function(t,r){return t?t.replace(n,function(t,n,o,u){var c=n.replace(/\s+/g,"").toLowerCase();u=u||"name";var s=this.getTerm(c,u)||n,f=i[o||""]||i.id,m=f(s),l=(e.isFunction(r)?r:a[r])||a.id;return l(m,n,u)}.bind(this)):t}});return m.getTerms=function(e,t){var n=r._dictionary[e];return f(n.terms,t)},m.getTerm=function(e,t,r){var n=m.getTerms(e,r);return n?n[t]||n.name:""},m});