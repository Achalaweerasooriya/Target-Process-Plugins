define(["Underscore","tau/core/class","tau/store/types.targetprocess"],function(e,t,r){var n=/\$\{(.+?)(?:,(.*?))?(?:,(.*?))?\}/gi,i={lower:function(e){return e.toLowerCase()},camel:e.titleize,capital:e.capitalize,upper:function(e){return e.toUpperCase()},id:function(e){return e}},a={icon:function(e,t){return'<em class="tau-entity-icon tau-entity-icon--icon tau-entity-icon--'+t.toLowerCase().replace(" ","")+'">'+e+"</em>"},abbr:function(t,r,n){return t==("names"==n?e.pluralize(r):r)?t:'<abbr title="'+r+'">'+t+"</abbr>"},id:function(e){return e}};return t.extend({keys:["name","names","iconSmall","iconBig"],init:function(t){this.registry={},e.forEach(r._dictionary,function(r,n){r.terms&&(this.registry[n]=e.inject(this.keys,function(n,i){var a=r.terms[i],o=e.findWhere(t,{wordKey:a.key});return"iconSmall"===i?(n[i]=this.getShortAbbreviation(n.name),n):"iconBig"===i?(n[i]=this.getLongAbbreviation(n.name),n):(n[i]=o?o.value:a.val,n)},{},this))},this)},getTerm:function(e,t){var r=this.getTerms(e);return r?r[t]||r.name:""},getShortAbbreviation:function(t){var r="";t=t||"",t=t.replace(/\s\s+/i," ");var n=e.trim(t).split(" ");return n[0]&&(r=n[0][0].toUpperCase(),n[1]&&(r+=n[1][0].toUpperCase())),r},getLongAbbreviation:function(e){return e},getTerms:function(e){return this.registry[e]},resolve:function(e,t){return this.getTerm(e,"name")||t||e},replaceTermTags:function(t,r){return t?t.replace(n,function(t,n,o,s){var c=n.replace(" ","").toLowerCase();s=s||"name";var u=this.getTerm(c,s)||n,l=i[o||""]||i.id,m=l(u),f=(e.isFunction(r)?r:a[r])||a.id;return f(m,n,s)}.bind(this)):t}})});