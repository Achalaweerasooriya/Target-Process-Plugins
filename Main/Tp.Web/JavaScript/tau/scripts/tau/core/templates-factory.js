define(["Underscore","jQuery"],function(_,$){var a={sub:function(a,c){var d=_.isArray(c)?c:[c],e=[];for(var f=0,g=d.length;f<g;f++)e.push(b.get(a).render(null,d[f]));return e.join("")}},b={templates:{},initialized:{},get:function(a){var b=this,c=b.templates[a];if(!c)throw["Template '",a,"' was not registered."].join("");return b[c.engine+".get"](a)},"jquery.get":function(a){var b=this;if(!$.template.hasOwnProperty(a))throw["jQuery template '",a,"' was not found."].join("");return{bind:function(c,d){var e={},f=b.templates[a],g=f.tags||[];for(var h=0;h<g.length;h++){var i=g[h];i.register(c,e)}var j=$.template[a];return $.tmpl(j,d,e)}}},"jqote2.get":function(b){var c=this,d=c.templates[b];if(!d.jqotecmpl)throw["Template '",b,"' was not compiled."].join("");return{render:function(b,c){return d.jqotecmpl.call(c,0,0,[c],a)},bind:function(a,b){var c=this.render(a,b);return $(c)}}},registerRecursively:function(a,b){var c=this;b=b||{tags:[]};var d=null;if(!$.template.hasOwnProperty(a)){d=this.templates[a];if(!d)throw["Template '",a,"' was not found."].join("");d.tags&&(b.tags=b.tags.concat(d.tags)),$.each(d.dependencies,function(a,d){c.registerRecursively(d,b)}),d.tags=b.tags;var e=d.markup;$.template(a,e)}else d=d||this.templates[a],d.tags&&(b.tags=b.tags.concat(d.tags))},"jquery.register":function(a){var b=this;b.registerRecursively(a.name)},"jqote2.register":function(a){a.jqotecmpl=$.jqotec(a.markup)},register:function(a){var b=this;return a.dependencies=a.dependencies||[],a.markup=_.isArray(a.markup)?a.markup.join(""):a.markup,a.engine=a.engine||"jquery",b.templates[a.name]=a,b[a.engine+".register"](a),{name:a.name,options:a.options||{},get:function(){return b.get(a.name)}}}};return b})