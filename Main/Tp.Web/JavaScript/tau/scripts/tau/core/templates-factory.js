define(["Underscore","jQuery","tau/nls/translator","tau/core/termProcessor"],function(e,t,r,n){var i={templates:{},termProcessor:new n,jqote2customFunctions:{sub:function(t,r){var n=i.get(t);e.isArray(r)||(r=[r]);for(var s=[],o=0,a=r.length;a>o;o++)s.push(n.render(null,r[o]));return s.join("")},term:function(t,r){return e.asString(i.termProcessor.getTerm(t,r))},cond:function(e,t,r){return(e?t:r)||""},uid:function(t){return e.uniqueId(t||"uid")},_:e,$:t,translate:r,T:r},setTermProcessor:function(e){this.termProcessor=e},getTermProcessor:function(){return this.termProcessor},get:function(e){var t=this.templates[e];if(!t)throw new Error('Template "'+e+'" was not registered.');return this[t.engine+".get"](e)},"jquery.get":function(e){var r=this;if(!t.template.hasOwnProperty(e))throw new Error('jQuery template "'+e+'" was not found.');return{render:function(r,n){var i=t.template[e],s=i(t,{data:n});return s.join("")},bind:function(n,i){for(var s={},o=r.templates[e],a=o.tags||[],u=0;u<a.length;u++){var c=a[u];c.register(n,s)}var m=t.template[e];return t.tmpl(m,i,s)}}},"jqote2.get":function(r){var n=this.templates[r];if(!n.jqotecmpl)throw new Error('Template "'+r+'" was not compiled.');return{config:n,render:e.bind(function(t,r){var i=n.customFunctions||{};e.extend(i,this.jqote2customFunctions),e.isFunction(n.pre)&&(r=n.pre(r));var s=n.jqotecmpl.call(r,0,0,[r],i);return e.isFunction(n.post)&&(s=n.post(s,r)),s},this),bind:function(e,r){var n=this.render(e,r);return t(n)},bindPure:function(e,t){return this.render(e,t)}}},registerRecursively:function(r,n){n=n||{tags:[]};var i=this.templates[r];if(!i)throw new Error('Template "'+r+'" was not found.');i.tags&&(n.tags=n.tags.concat(i.tags)),t.template.hasOwnProperty(r)||(e.each(i.dependencies,function(e){this.registerRecursively(e,n)},this),i.tags=n.tags,t.template(r,i.markup))},"jquery.register":function(e){this.registerRecursively(e.name)},"jqote2.register":function(e){try{e.jqotecmpl=t.jqotec(e.markup)}catch(r){throw new Error('Error in template "'+e.name+'": '+r.message)}},register:function(t){t.dependencies=t.dependencies||[],t.markup=e.isArray(t.markup)?t.markup.join(""):t.markup,t.engine=t.engine||"jquery";var r=t.name;return this.templates[r]=t,this[t.engine+".register"](t),{name:r,options:t.options||{},get:this.get.bind(this,r),render:function(e){return this.get(r).bind({},e)}.bind(this)}}};return i});