define(["Underscore"],function(_){return{isEqualIncluded:function(a,b){if(a===b)return!0;var c=typeof a,d=typeof b;if(c!=d)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(_.isDate(a)&&_.isDate(b))return a.getTime()===b.getTime();if(_.isNaN(a)&&_.isNaN(b))return!1;if(_.isRegExp(a)&&_.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object")return!1;if(_.isArray(a)&&_.isArray(b)&&a.length!==b.length)return!1;var e=_.keys(b);for(var f=0;f<e.length;f++){var g=e[f];if(a.hasOwnProperty(g)&&!this.isEqualIncluded(a[g],b[g]))return!1}return!0},compare:function(a,b){var c=this,d={changes:{}};return a?(_.each(_(b).keys(),function(e){var f={value:b[e]};if(!a.hasOwnProperty(e)){d.changes[e]=f;return}c.isEqualIncluded(a[e],b[e])||(d.changes[e]=f)}),d):d}}})