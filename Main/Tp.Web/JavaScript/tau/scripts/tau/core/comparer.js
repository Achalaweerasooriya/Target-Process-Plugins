define(["Underscore"],function(_){return{isEqualIncluded:function(a,b){if(a===b)return!0;var atype=typeof a,btype=typeof b;if(atype!=btype)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(_.isDate(a)&&_.isDate(b))return a.getTime()===b.getTime();if(_.isNaN(a)&&_.isNaN(b))return!1;if(_.isRegExp(a)&&_.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(atype!=="object")return!1;if(_.isArray(a)&&_.isArray(b)&&a.length!==b.length)return!1;var bKeys=_.keys(b);for(var i=0;i<bKeys.length;i++){var key=bKeys[i];if(a.hasOwnProperty(key)&&!this.isEqualIncluded(a[key],b[key]))return!1}return!0},compare:function(oldObj,newObj){var self=this,results={changes:{}};return oldObj?(_.each(_(newObj).keys(),function(key){var result={value:newObj[key]};if(!oldObj.hasOwnProperty(key)){results.changes[key]=result;return}self.isEqualIncluded(oldObj[key],newObj[key])||(results.changes[key]=result)}),results):results}}})