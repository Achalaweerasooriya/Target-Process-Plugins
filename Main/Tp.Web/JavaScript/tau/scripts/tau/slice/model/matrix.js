define(["tau/core/model-base","tau/slice/data/service","Underscore"],function(baseModel,service,_){var model=baseModel.extend({onInit:function(){var self=this,start=new Date;service.getData(function(r){var doneServerTime=new Date-start,data={renderTime:new Date,x:[null].concat(_.unique(_.pluck(r.x.items,"x"))),y:[null].concat(_.unique(_.pluck(r.y.items,"y")))};data.getDroppableAttribute=function(x,y){return x!=null&&y!=null?"droppable":""};var length=r.cells.items.length,cardsCount=0;for(var i=0;i<length;i++){var cell=r.cells.items[i];cardsCount+=cell.dynamic.items.length,data[cell.x+"_"+cell.y]={data:cell.dynamic.items,info:[]}}length=r.x.items.length;for(i=0;i<length;i++)cell=r.x.items[i],data[cell.x+"_null"]={info:cell.dynamic.items,data:[]};length=r.y.items.length;for(i=0;i<length;i++)cell=r.y.items[i],data["null_"+cell.y]={info:cell.dynamic.items,data:[]};var name=data.x.length+" x "+data.y.length+" ["+cardsCount+"]";name+="<br/>server: "+doneServerTime+"ms",data.null_null={info:[{data:{name:name}}],data:[]},self.bus.fire("dataBind",data)})},"bus move":function(args){var data=args.data,self=this;service.move(data,function(r){var evtData={saga:data,data:r};self.bus.fire("moveCompleted",evtData)},function(r){var evtData={saga:data,data:r};self.bus.fire("moveFailed",evtData)})}});return model})