define(["require","Underscore","tau/core/class","jQuery"],function(e){var t=e("Underscore"),i=e("tau/core/class"),n=e("jQuery"),r=i.extend({init:function(e,t){this.boardSettings=e,this.appStateStore=t},getBoardDefinition:function(){var e=this.boardSettings.get(["x","y","cells","zoomLevel","viewMode","page","focus","selectedMarks","cardSettings","user","acid","cellPaging","colorSettings"]),i=this.appStateStore.get({fields:["acid"]});return n.when(e,i).then(t.bind(function(e,t){var i=this.createDefinition(e);return i.global={acid:t.acid},{definition:i,configuration:e}},this))}}),a={entitystate:{pageSize:50},teamentitystate:{pageSize:50,itemType:"entitystate"},effort:{pageSize:12}},s=function(e,i){var n=e[i];if(n&&(n.itemType=n&&n.types&&n.types[0],n.itemType)){var r=a[n.itemType.toLowerCase()];r&&(t.isUndefined(r.pageSize)||(e.page.size[i]=r.pageSize),t.isUndefined(r.itemType)||(n.itemType=r.itemType))}},o=function(e){return Math.max(1,Math.min(6,e))},c=function(e,t){return e.hasOwnProperty(t)&&null!==e[t]};return r.prototype.createDefinition=function(e){var i={};return c(e,"x")&&(i.x=e.x),c(e,"y")&&(i.y=e.y),c(e,"cells")&&(i.cells=e.cells),i.cells&&(i.cells.ordering=t.defaults(i.cells.ordering||{},{name:"Rank",direction:"Desc"})),i.zoomLevel=o(e.zoomLevel||3),i.page=t.defaults(e.page||{},{x:0,y:0,size:{x:8,y:20}}),s(i,"x"),s(i,"y"),i.focus=t.defaults(e.focus||{},{x:[],y:[]}),i.selectedMarks=t.defaults(e.selectedMarks||{},{x:[],y:[]}),i.viewMode=e.viewMode||"board",i.boardId=e.id,i.cardSettings=e.cardSettings,i.colorSettings=e.colorSettings,i.user=t.defaults(e.user||{},{cardsFilter:""}),i},r});