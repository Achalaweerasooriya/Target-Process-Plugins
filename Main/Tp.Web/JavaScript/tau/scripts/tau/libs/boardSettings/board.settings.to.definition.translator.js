define(["Underscore","tau/core/class"],function(e,t){var n=t.extend({init:function(e,t){this.boardSettings=e,this.appStateStore=t},getBoardDefinition:function(){var t=this.boardSettings.get(["x","y","cells","zoomLevel","viewMode","page","focus","selectedMarks","cardSettings","user","acid","cellPaging"]),n=this.appStateStore.get({fields:["acid"]});return $.when(t,n).then(e.bind(function(e,t){var n=this.createDefinition(e);return n.global={acid:t.acid},{definition:n,configuration:e}},this))}}),i={entityState:25,effort:12},r=function(t,n){e.each(i,function(i,r){t[n]&&t[n].types&&e.any(t[n].types,function(e){return e.toLowerCase()==r.toLowerCase()})&&(t.page.size[n]=i)})},a=function(e){return Math.max(1,Math.min(6,e))};return n.prototype.createDefinition=function(t){var n={};return t.hasOwnProperty("x")&&null!==t.x&&(n.x=t.x),t.hasOwnProperty("y")&&null!==t.y&&(n.y=t.y),t.hasOwnProperty("cells")&&null!==t.cells&&(n.cells=t.cells),n.cells&&(n.cells.ordering=e.defaults(n.cells.ordering||{},{name:"Rank",direction:"Desc"})),n.zoomLevel=a(t.zoomLevel||3),n.page=e.defaults(t.page||{},{x:0,y:0,size:{x:8,y:20}}),r(n,"x"),r(n,"y"),n.focus=e.defaults(t.focus||{},{x:[],y:[]}),n.selectedMarks=e.defaults(t.selectedMarks||{},{x:[],y:[]}),n.viewMode=t.viewMode||"board",n.boardId=t.id,n.cardSettings=t.cardSettings,n.user=e.defaults(t.user||{},{cardsFilter:""}),n},n});