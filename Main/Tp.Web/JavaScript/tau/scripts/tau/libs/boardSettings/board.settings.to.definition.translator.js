define(["Underscore","tau/core/class"],function(e,t){var i=t.extend({init:function(e,t){this.boardSettings=e,this.appStateStore=t},getBoardDefinition:function(){var t=this.boardSettings.get(["x","y","cells","zoomLevel","viewMode","page","focus","selectedMarks","cardSettings","isCustomizeDisabled","user","acid","cellPaging"]),i=this.appStateStore.get({fields:["acid"]});return $.when(t,i).then(e.bind(function(e,t){var i=this.createDefinition(e);return i.global={acid:t.acid},{definition:i,configuration:e}},this))}}),n={entityState:25,effort:12},s=function(t,i){e.each(n,function(n,s){t[i]&&t[i].types&&e.any(t[i].types,function(e){return e.toLowerCase()==s.toLowerCase()})&&(t.page.size[i]=n)})},a=function(e){return Math.max(1,Math.min(6,e))};return i.prototype.createDefinition=function(t){var i={};return t.hasOwnProperty("x")&&null!==t.x&&(i.x=t.x),t.hasOwnProperty("y")&&null!==t.y&&(i.y=t.y),t.hasOwnProperty("cells")&&null!==t.cells&&(i.cells=t.cells),i.cells&&(i.cells.ordering=e.defaults(i.cells.ordering||{},{name:"Rank",direction:"Desc"})),i.zoomLevel=a(t.zoomLevel||3),i.page=e.defaults(t.page||{},{x:0,y:0,size:{x:8,y:20}}),s(i,"x"),s(i,"y"),i.focus=e.defaults(t.focus||{},{x:[],y:[]}),i.selectedMarks=e.defaults(t.selectedMarks||{},{x:[],y:[]}),i.viewMode=t.viewMode||"board",i.boardId=t.id,i.cardSettings=t.cardSettings,i.isCustomizeDisabled=t.isCustomizeDisabled,i.user=e.defaults(t.user||{},{cardsFilter:""}),i},i});