define(["Underscore","tau/core/class"],function(e,t){var i=t.extend({init:function(e,t){this.boardSettings=e,this.appStateStore=t},getBoardDefinition:function(){var t=this.boardSettings.get(["x","y","cells","zoomLevel","viewMode","page","focus","selectedMarks","cardSettings","user","acid","cellPaging"]),i=this.appStateStore.get({fields:["acid"]});return $.when(t,i).then(e.bind(function(e,t){var i=this.createDefinition(e);return i.global={acid:t.acid},{definition:i,configuration:e}},this))}}),n={entitystate:{pageSize:25},teamentitystate:{pageSize:25,itemType:"entitystate"},effort:{pageSize:12}},a=function(t,i){var a=t[i];if(a&&(a.itemType=a&&a.types&&a.types[0],a.itemType)){var s=n[a.itemType.toLowerCase()];s&&(e.isUndefined(s.pageSize)||(t.page.size[i]=s.pageSize),e.isUndefined(s.itemType)||(a.itemType=s.itemType))}},s=function(e){return Math.max(1,Math.min(6,e))};return i.prototype.createDefinition=function(t){var i={};return t.hasOwnProperty("x")&&null!==t.x&&(i.x=t.x),t.hasOwnProperty("y")&&null!==t.y&&(i.y=t.y),t.hasOwnProperty("cells")&&null!==t.cells&&(i.cells=t.cells),i.cells&&(i.cells.ordering=e.defaults(i.cells.ordering||{},{name:"Rank",direction:"Desc"})),i.zoomLevel=s(t.zoomLevel||3),i.page=e.defaults(t.page||{},{x:0,y:0,size:{x:8,y:20}}),a(i,"x"),a(i,"y"),i.focus=e.defaults(t.focus||{},{x:[],y:[]}),i.selectedMarks=e.defaults(t.selectedMarks||{},{x:[],y:[]}),i.viewMode=t.viewMode||"board",i.boardId=t.id,i.cardSettings=t.cardSettings,i.user=e.defaults(t.user||{},{cardsFilter:""}),i},i});