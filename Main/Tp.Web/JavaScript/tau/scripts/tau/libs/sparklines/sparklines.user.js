define(["tau/libs/sparklines/sparklines"],function(Class){return Class.extend({drawBottom:function(msvg,config){var dt=config.items,legendSpace=config.legendSpace,max=config.max,height=config.height,width=config.width,padding=config.padding,percent=config.percent;if(dt.length==0)return;var svg=msvg.append("g").attr("transform","translate(0,"+height/2+")"),maxData=_.reduce(dt,function(memo,v,index){return v>memo.value?{index:index,value:v}:memo},{index:0,value:dt[0]}),currentValue=_.last(dt);maxData.index==dt.length-1&&(maxData=null);var hasEmptyStart=_.all(dt.slice(0,this.config.emptyStart),function(v){return v==0}),diffData=_.reduce(dt,function(memo,v,index){return memo?memo.concat({diff:v-_.last(memo).to,to:v,from:_.last(memo).to}):[{diff:v,to:v,from:0}]},null),scaleX=d3.scale.ordinal().domain(_.keys(dt)).rangeRoundBands([0,width-legendSpace]),scaleWidth=scaleX.rangeBand(),scaleY=d3.scale.linear().domain([0,max]).range([0,height/2-padding]),scaleHeight=d3.scale.linear().domain([0,max]).range([0,height/2-padding]);svg.selectAll(".tau-sparkline__closedbar").data(dt).enter().append("rect").attr("class","tau-sparkline__closedbar").attr("x",function(data,i){return scaleX(i)+scaleWidth/2-.5}).attr("y",scaleY(0)).attr("height",scaleHeight).attr("width",1),maxData&&svg.selectAll("text").data([maxData]).enter().append("text").text(function(d){return d.value||""}).attr("x",function(data,i){return scaleX(data.index)+(data.index?scaleWidth/2:0)}).attr("y",function(data,i){return scaleY(data.value)+padding}).attr("text-anchor",function(data,i){return data.index?data.index==dt.length-1?"right":"middle":"left"}),svg.selectAll("text.legend").data([currentValue]).enter().append("text").attr("class","legend").text(function(d){return d}).attr("x",function(data,i){return width-legendSpace}).attr("y",function(data){return scaleY(data)-padding/2<scaleY(0)?padding/2:scaleY(data)}).attr("text-anchor","right").attr("dx",percent).attr("dy",(padding-percent)/2),hasEmptyStart&&config.emptyStartLabel&&svg.selectAll("text.tau-sparkline__emptylegend").data([config.emptyStartLabel]).enter().append("text").attr("class","tau-sparkline__emptylegend").text(function(d){return d||""}).attr("x",function(data,i){return scaleX(0)}).attr("y",function(data){return scaleY(0)+padding/2+2}).attr("text-anchor","left").attr("dx",percent).attr("dy",(padding-percent)/2)}})})