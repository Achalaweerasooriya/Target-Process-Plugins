define(["tau/libs/sparklines/sparklines"],function(t){return t.extend({drawBottom:function(t,e){var n=e.items,a=e.legendSpace,r=e.max,l=e.height,i=e.width,d=e.padding,u=e.percent;if(0!=n.length){var c=t.append("g").attr("transform","translate(0,"+l/2+")"),s=_.reduce(n,function(t,e,n){return e>t.value?{index:n,value:e}:t},{index:0,value:n[0]}),o=_.last(n);s.index==n.length-1&&(s=null);var x=_.all(n.slice(0,this.config.emptyStart),function(t){return 0==t}),p=d3.scale.ordinal().domain(_.keys(n)).rangeRoundBands([0,i-a]),f=p.rangeBand(),g=d3.scale.linear().domain([0,r]).range([0,l/2-d]),h=d3.scale.linear().domain([0,r]).range([0,l/2-d]);c.selectAll(".tau-sparkline__closedbar").data(n).enter().append("rect").attr("class","tau-sparkline__closedbar").attr("x",function(t,e){return p(e)+f/2-.5}).attr("y",g(0)).attr("height",h).attr("width",1),s&&c.selectAll("text").data([s]).enter().append("text").text(function(t){return t.value||""}).attr("x",function(t){return p(t.index)+(t.index?f/2:0)}).attr("y",function(t){return g(t.value)+d}).attr("text-anchor",function(t){return t.index?t.index==n.length-1?"right":"middle":"left"}),c.selectAll("text.legend").data([o]).enter().append("text").attr("class","legend").text(function(t){return t}).attr("x",function(){return i-a}).attr("y",function(t){return g(t)-d/2<g(0)?d/2:g(t)}).attr("text-anchor","right").attr("dx",u).attr("dy",(d-u)/2),x&&e.emptyStartLabel&&c.selectAll("text.tau-sparkline__emptylegend").data([e.emptyStartLabel]).enter().append("text").attr("class","tau-sparkline__emptylegend").text(function(t){return t||""}).attr("x",function(){return p(0)}).attr("y",function(){return g(0)+d/2+2}).attr("text-anchor","left").attr("dx",u).attr("dy",(d-u)/2)}}})});