define(["Underscore","tau/core/class"],function(e,i){return i.extend({init:function(e){this.store=e.getStore()},invite:function(i){var n=this.store,t=[];t=e.map(i,function(e){return function(i){e.id?i(!1,{success:e.id}):n.find("user",{$query:{email:e.email,deleteDate:{$isNull:!0}},fields:["id","firstName","lastName"]}).done(function(t){var s=t[0].data.length?t[0].data[0]:null;s?i(!1,{success:s.id}):n.save("user",{failureGlobal:!1,$set:{login:e.login,email:e.email,password:Math.round(1e11*Math.random())}},{success:function(e){i(!1,{success:e.data.id})},failure:function(){i(!1,{failure:e})}}).done()})}});var s=$.Deferred();return e.series(t,function(e,i){e?s.failure(e):s.resolve(i)}),s}})});