require(["jQuery","Underscore","tau/configurator"],function($,_,configurator){var text="Vestibulum ut tortor nisi. Donec convallis feugiat enim, gravida pellentesque eros posuere vitae. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur condimentum, urna eu placerat semper, metus magna imperdiet sem, in commodo purus dolor sed nisi. Nam eget dignissim eros. Etiam ac enim est, et dignissim urna. Nulla ac diam nisi. Maecenas laoreet congue est, id euismod leo porta nec. Donec dapibus ipsum nec erat accumsan ut cursus dui lacinia. Nullam convallis augue mi, et elementum ligula. Nam mi arcu, lacinia at venenatis et, ultricies ultricies mi. Cras vel dui ut sem placerat convallis. Nunc neque nisi, cursus ac eleifend eu, molestie non orci. Fusce quis nunc tortor. Ut leo velit, mollis non sagittis vitae, ultricies ut metus. Aenean pretium ultricies suscipit. Sed euismod vulputate condimentum. Curabitur pharetra nisl non nunc porttitor aliquet. Morbi id mi magna, in varius dolor. Vestibulum ullamcorper adipiscing aliquam. Mauris orci sem, adipiscing at convallis in, lacinia vel tellus. Aliquam erat volutpat. Proin tempor justo quis metus gravida sed sagittis dui dignissim.Duis sapien risus, sollicitudin vitae consequat ut, malesuada sed elit. Nulla tellus tellus, vehicula et scelerisque non, fermentum eu nulla. Nulla quis erat massa. Suspendisse scelerisque diam vel ipsum convallis et consectetur sapien viverra. Mauris eget risus sem. Etiam mollis, felis non hendrerit eleifend, massa metus luctus magna, vel aliquam nisl quam adipiscing tellus. Donec sit amet eros sem. Etiam auctor cursus enim, nec dignissim leo aliquet id. Ut lorem enim, tempor ut suscipit at, dapibus vel.",names=text.split("."),tagNames=text.replace(/\./gi,"").split(" "),tagcount=5,bugsCount=5,requestCount=1,testCaseCount=10,taskCount=5,impedimentCount=5,generateTags=function(){var count=Math.max(Math.floor(Math.random()*tagcount),1),tags=[];for(var i=0;i<count;i++)tags.push(tagNames[Math.floor(Math.random()*tagNames.length)]);return tags.join(",")},generateText=function(lineCount){var parts=[],str="";while(str.length==0){for(var i=0;i<lineCount;i++)parts.push(names[Math.floor(Math.random()*names.length)]);str=parts.join(".")}return str};configurator.getStore().get("project",{},{success:function(res){var projects=res.data,parts=['<select id="projectId">'];_.each(projects,function(project){parts.push('<option value="'+project.id+'">'+project.name+"</option>")}),parts.push("</select>"),$("#projectId").replaceWith($(parts.join("")))}}).done(),$("#btnGenerate").click(function(){function generateBugs(count,userStory,projectId){generateEntities(count,"bug",userStory,projectId)}function generateEntity(fields){var us={name:generateText(1),description:generateText(3),tags:generateTags()};return _.extend(us,fields),us}function generateRequest(projectId,userStoryCount,projectMembers,roles){var request=generateEntity({project:{id:projectId}});store.save("request",{$set:request}).done({success:function(result){for(var i=0;i<userStoryCount;i++){var us=generateEntity({project:{id:projectId},relatedRequests:[{id:result[0].data.id}]}),bug=generateEntity({project:{id:projectId},requests:[{id:result[0].data.id}]});store.save("userStory",{$set:us}).done(),store.save("bug",{$set:bug}).done(),generateEntities(3,"impediment",result[0].data,projectId,"assignable")}}})}function generateTestCase(projectId,runsCount){var status=Math.round(Math.random())===1,testCase=generateEntity({project:{id:projectId},success:generateText(5),steps:generateText(5),lastStatus:status,lastFailureComment:status?null:generateText(1)});store.save("testCase",{$set:testCase}).done({success:function(result){}})}function generateUS(projectId,fields,callback){var us=generateEntity(fields);store.save("userStory",{$set:us}).done({success:function(res){var userStory=res[0].data,count=Math.floor(Math.random()*bugsCount);generateBugs(count,userStory,projectId),generateEntities(count,"impediment",userStory,projectId,"assignable"),generateEntities(count,"task",userStory,projectId),callback&&callback()}})}var project=$("#projectId"),$usCount=$("#usCount"),projectId=parseInt(project.val()),usCount=parseInt($usCount.val());if(_.isNaN(usCount)||_.isNaN(projectId))return;var store=configurator.getStore(),generateEntities=function(count,type,userStory,projectId,relationName){for(var i=0;i<count;i++){var data={name:generateText(1),description:generateText(3),tags:generateTags(),project:{id:projectId}};data[relationName||"userStory"]={id:userStory.id},store.save(type,{$set:data}).done()}};store.get("project",{id:projectId,fields:[{features:["id"]},{releases:["id"]}]}).done({success:function(result){var project=result[0].data;for(var i=0;i<requestCount;i++)generateRequest(projectId,3);for(var i=0;i<testCaseCount;i++)generateTestCase(projectId,3);_.each(project.features,function(feature){_.each(project.releases,function(release){var id=projectId;for(var i=0;i<usCount;i++)generateUS(id,{feature:{id:feature.id},release:{id:release.id}})})})}})})})