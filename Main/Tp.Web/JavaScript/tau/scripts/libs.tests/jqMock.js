define(["libs/jquery/jquery"],function(jQuery){var a=function($){function b(a,d,e,f){e=e||!1,f=f||[];if(a===d)return!0;if(d instanceof q)return d.assert(a);if(a===null||d===null)return!1;if(a instanceof Array&&d instanceof Array){if(a.length!=d.length)return!1;for(var g=0;g<a.length;g++){var h=c(a[g],d[g],e,f,d[g]);if(!h)return!1}return!0}if(typeof a=="object"&&typeof d=="object"){for(var g in d){var h=c(a[g],d[g],e,f,d[g]);if(!h)return!1}if(!e)for(var g in a)if(!b(a[g],d[g]))return!1;return!0}return!1}function c(a,c,d,e,f){if(f&&typeof f=="object"){for(var g=0;g<e.length;g++)if(f===e[g])throw new Error("Circular Reference detected in the object!");var h=e.length;e.push(f);var i=b(a,c,d,e);return e.splice(h),i}return b(a,c,d,e)}function d(a,c,d){var e=a===c||b(a,c);QUnit.push(e,a,c,d)}function f(a,b){b=b||[];if(b.length>e)return".....";if(typeof a=="object")for(var c=0;c<b.length;c++)if(a==b[c])return"...";b.push(a);var d=b.length,g=[];if(a===null)return"null";if(a===undefined)return"undefined";if(a instanceof Array){g.push("[");for(var h=0;h<a.length;h++)g.push(f(a[h],b)),g.push(",");a.length>0?g[g.length-1]="]":g.push("]")}else{if(a instanceof q)return a.tostring();if(a instanceof Error){var i={};return"name"in a&&(i.name=a.name),"message"in a&&(i.message=a.message),f(i,b)}if($.isFunction(a))return"function()";if(typeof a=="object"){g.push("{");for(var j in a){if(/^__/.test(j))continue;g.push(j),g.push(":"),g.push(f(a[j],b)),g.push(",")}g[g.length==1?g.length:g.length-1]="}"}else g.push(typeof a=="string"?"'":""),g.push(a),g.push(typeof a=="string"?"'":"")}return b.splice(d),g.join("")}function g(a){try{return $.trim(a.toString()).match(/^function\s(.*)\(/)[1]}catch(b){return a instanceof Error&&a.name?a.name:a.toString()}}function h(a,b){try{a(),QUnit.ok(!1,"The expected exception was never thrown. Expression was: "+f(b))}catch(c){d(c,b,"expected exception matching "+f(b)+" to be thrown")}}function i(a,b){this._fnName=a,this._origFn=b,this._args=[],this._multiplicity=o.exactly(1),this._returnValue=undefined,this._returnValueSpecified=!1,this._exception=null,this._matchCount=0}function n(a,b,c,d){this.type=a,this.lower=b,this.upper=c,this.satisfied=d,this.isDisabled=!1}function q(a,b){this.type=a,this.param=b}function s(a,b){var c=[],d=[],e=a,g=b,h=!1,j=0,m=!1;if(a==undefined||a[b]==undefined)throw new Error("Could not create Mock: the object or function you specified is not defined, obj."+b);if(!$.isFunction(a[b]))throw new Error("Could not create Mock: "+b+" is not a function");var n=function(){var a,e;if(h)m||(e=d[j].matches(arguments),e==l?a=d[j]:(j++,d.length>j&&(e=d[j].matches(arguments),e==l&&(a=d[j])))),a===undefined&&(m=!0);else for(var g=0;g<d.length;g++){e=d[g].matches(arguments);if(e==l){a=d[g];break}}if(a)return a.doAction(this,arguments);var i=Array.prototype.slice.call(arguments),k=b+"("+f(i).replace(/^\[(.*)\]$/,"$1")+")";c.push({matchResult:e,msg:k})};if(!!a[b].isMock)throw new Error("Could not create Mock: you tried to overwrite a function which is already a mock!");var o=a[b];a[b]=n,a[b].isMock=!0,this.reset=function(){j=0,m=!1;for(var a=0;a<d.length;a++)delete d[a];d=[];for(var a=0;a<c.length;a++)delete c[a];c=[]},this.restore=function(){this.reset(),e[g]=o},this.modify=function(){return d.push(new i(g,o)),d[d.length-1]},this.setOrdered=function(a){h=a};var p=function(a){if(!(d.length>0))throw new Error("Expectation setup error. You must set up some expectations");var b=!0;for(var e=0;e<d.length;e++)if(!d[e].satisfied()){b=!1;break}var f="";if(!b){f+=(h?"Ordered":"Unordered")+" expectations have not yet been satisfied:<br/>";for(var e=0;e<d.length;e++)f+=d[e].tostring()+"<br/>"}if(c.length>0)if(a){b=!1,f+="No expectation matched for the following calls:<br/>";for(var e=0;e<c.length;e++)f+=c[e].msg+"<br/>"}else{var g="";for(var e=0;e<c.length;e++)c[e].matchResult==k&&(g+=c[e].msg+"<br/>");g.length>0&&(f+="No expectation matched for the following calls which were setup as expectations:<br/>"+g,b=!1)}f==""&&(f=d.length+" expectations were satisfied"),QUnit.ok(b,f)};this.verify=function(){p(!1)},this.verifyAll=function(){p(!0)}}function t(){if(window.expect||window.is)throw new Error("Cannot add shortcuts, expect() or is() already exists in global scope!");expect=a.expect,is=a.is}var e=100;i.prototype.args=function(){var a=Array.prototype.slice.call(arguments);return this._args=a,this},i.prototype.multiplicity=function(a){if(a instanceof n)this._multiplicity=a;else if(typeof a=="number")this._multiplicity=o.exactly(a);else throw new Error("Invalid argument for multiplicity()");return this},i.prototype.returnValue=function(a){this._returnValueSpecified=!0,typeof a!="undefined"&&(this._returnValue=a)},i.prototype.throwException=function(a){this._exception=a};var j=-1,k=0,l=1;i.prototype.matches=function(a){var c=!0,d=this._args;if(d.length==0)c=a.length==0;else if(d.length==a.length){for(var e=0;e<d.length;e++)if(!b(a[e],d[e])){c=!1;break}}else c=!1;return c?this._multiplicity.isDisabled?k:(this._multiplicity.verify(++this._matchCount),l):j},i.prototype.doAction=function(a,b){if(this._returnValueSpecified)return this._returnValue;if(this._exception)throw this._exception;return this._origFn.apply(a,b)},i.prototype.satisfied=function(){return this._multiplicity.satisfied},i.prototype.tostring=function(){return[this._multiplicity.satisfied?"&nbsp;&nbsp;&nbsp;":"&rarr;",this._matchCount," ",this._multiplicity.tostring()," ",this._fnName,"(",f(this._args).replace(/^\[(.*)\]$/,"$1"),")"].join("")};var m={EXACTLY:0,ATLEAST:1,ATMOST:2,RANGE:3};n.prototype.verify=function(a){this.satisfied=a>=this.lower&a<=this.upper,this.isDisabled=a>=this.upper},n.prototype.tostring=function(){return this.type==m.EXACTLY?"("+this.lower+")":["(",this.lower,"..",this.upper==Infinity?"*":this.upper,")"].join("")};var o={exactly:function(a){return a==0?new n(m.ATMOST,0,0,!0):new n(m.EXACTLY,a,a,!1)},times:function(a,b){return arguments.length==1?new n(m.EXACTLY,a,a,!1):a==0?new n(m.ATMOST,0,b,!0):new n(m.RANGE,a,b,!1)},atLeast:function(a){return new n(m.ATLEAST,a,Infinity,!1)},atMost:function(a){return new n(m.ATMOST,0,a,!0)}},p={ANYTHING:0,NOT:1,INSTANCEOF:2,SUPERSET:3,REGEX:4,ANYOF:5,ALLOF:6,CUSTOM:7,ERROR:8};q.prototype.assert=function(a){switch(this.type){case p.ANYTHING:return!0;case p.NOT:return!b(a,this.param);case p.INSTANCEOF:return a instanceof this.param;case p.SUPERSET:return b(a,this.param,!0);case p.REGEX:return this.param.test(a);case p.ANYOF:for(var c=0;c<this.param.length;c++)if(b(a,this.param[c]))return!0;return!1;case p.ALLOF:for(var c=0;c<this.param.length;c++)if(!b(a,this.param[c]))return!1;return!0;case p.CUSTOM:return this.param(a);case p.ERROR:var d=!0;return"name"in this.param&&(d=d&&this.param.name===a.name),"message"in this.param&&(d=d&&this.param.message===a.message),"type"in this.param&&(d=d&&b(a,this.param.type)),d}},q.prototype.tostring=function(){switch(this.type){case p.ANYTHING:return"is.anything";case p.NOT:return"is.not("+f(this.param)+")";case p.INSTANCEOF:return"is.instanceOf("+g(this.param)+")";case p.SUPERSET:return"is.objectThatIncludes("+f(this.param)+")";case p.REGEX:return"is.regex("+this.param.toString()+")";case p.ANYOF:return"is.anyOf("+f(this.param)+")";case p.ALLOF:return"is.allOf("+f(this.param)+")";case p.CUSTOM:return"is.custom(function)";case p.ERROR:return b(this.param,{})?"is.exception()":"is.exception("+f(this.param)+")"}};var r={anything:new q(p.ANYTHING),not:function(a){return new q(p.NOT,a)},instanceOf:function(a){if(typeof a!="function")throw new Error("Invalid argument to is.instanceOf() , argument must be a Class");return new q(p.INSTANCEOF,a)},objectThatIncludes:function(a){return new q(p.SUPERSET,a)},regex:function(a){if(a instanceof RegExp)return new q(p.REGEX,a);throw new Error("Invalid argument to is.regex() , argument must be regex")},anyOf:function(a){if(a instanceof Array)return new q(p.ANYOF,a);throw new Error("Invalid argument to is.anyOf() , argument must be an Array")},allOf:function(a){if(a instanceof Array)return new q(p.ALLOF,a);throw new Error("Invalid argument to is.allOf() , argument must be an Array")},custom:function(a){if(!$.isFunction(a))throw new Error("Invalid argument to is.custom() , argument must be a Function that returns a boolean value");return new q(p.CUSTOM,a)},exception:function(a){if(typeof a=="string")return new q(p.ERROR,{message:a});typeof a=="undefined"&&(a={});if(typeof a!="object")throw new Error("Invalid argument to is.exception() , argument must be an object or string");if("type"in a&&typeof a["type"]!="function")throw new Error("Invalid argument to is.exception() , the type attribute of the parameter must be a Class");return"type"in a&&(a.type=new q(p.INSTANCEOF,a.type)),new q(p.ERROR,a)}};return{assertThat:d,tostring:f,expectThatExceptionThrown:h,Mock:s,expect:o,is:r,addShortcut:t}}(jQuery);window.jqMock=a})