/*!
 * Nodeunit
 * Copyright (c) 2010 Caolan McMahon
 * MIT Licensed
 *
 * THIS FILE SHOULD BE BROWSER-COMPATIBLE JS!
 * You can use @REMOVE_LINE_FOR_BROWSER to remove code from the browser build.
 * Only code on that line will be removed, it's mostly to avoid requiring code
 * that is node specific
 */
define(["libs/async/async","./types","./nodeunit"],function(a,b,c){var exports={},d=function(a){if(_.isObject(a)==0)return[];if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},e=function(a){var b={},c=d(a);for(var e=0;e<c.length;e+=1)b[c[e]]=a[c[e]];return b};exports.runTest=function(a,c,d,e){var f=b.options(d);f.testStart(a,d.moduleId);var g=(new Date).getTime(),h=b.test(a,g,f,e);try{c(h)}catch(i){h.done(i)}},exports.runSuite=function(b,c,e,f){c=h(c);var g=d(c),i=b,j="concatSeries";e.execution=="parallel"&&(j="concat"),e.shuffle&&(g=_.shuffle(g)),a[j](g,function(a,b){var d=c[a],f;f=i?[].concat(i,a):[a],f.toString=function(){return this.join(" ")};if(typeof d=="function"){var g=!0,h=e.filter,j=f.toString();h&&(g=j.search(h)==0);if(g)e.moduleStart&&e.moduleStart(),exports.runTest(f,c[a],e,b);else return b()}else exports.runSuite(f,c[a],e,b)},f)},exports.runModule=function(a,module,c,d){function j(){g||(g=!0,i(module))}var f=e(b.options(c)),g=!1,i=f.moduleStart;module=h(module),f.moduleStart=j,f.moduleId=module.id;var k=(new Date).getTime();exports.runSuite(a,module,f,function(a,c){var e=(new Date).getTime(),g=b.assertionList(c,e-k);f.moduleDone(module,g),d(null,c)})},exports.runModules=function(c,e){var f=[],g=b.options(e),h=(new Date).getTime(),i="concatSeries";e.execution=="parallel"&&(i="concat"),g.shuffle&&(c=_.shuffle(c)),a[i](d(c),function(a,b){exports.runModule(c[a].name||a,c[a],g,b)},function(a,c){var d=(new Date).getTime();g.done(b.assertionList(c,d-h))})};var f=function(a,c,d){return function(e){var f={};if(c){var g=e.done;e.done=function(a){try{c.call(f,function(c){if(a&&c)return e._assertion_list.push(b.assertion({error:a})),g(c);g(a||c)})}catch(d){g(d)}}}a?a.call(f,function(a){if(a)return e.done(a);d.call(f,e)}):d.call(f,e)}},g=function(b){return b.length?function(c){var d=this,e=[];for(var f=0,g=b.length;f<g;f++)(function(a){e.push(function(){return b[a].apply(d,arguments)})})(f);return a.series(e,c)}:null},h=function(a,b,c){var e={},b=b?b.slice():[],c=c?c.slice():[];a.setUp&&(b.push(a.setUp),delete a.setUp),a.tearDown&&(c.unshift(a.tearDown),delete a.tearDown);var i=d(a);for(var j=0;j<i.length;j+=1){var k=i[j];typeof a[k]=="function"?e[k]=f(g(b),g(c),a[k]):typeof a[k]=="object"&&k.substr(0,1)!="_"?e[k]=h(a[k],b,c):e[k]=a[k]}return e};return exports.testCase=function(a){return a},exports})