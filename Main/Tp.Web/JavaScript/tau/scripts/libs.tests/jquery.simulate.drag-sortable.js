define(["jQuery"],function(jQuery){(function($){function createEvent(type,target,options){var evt,e=$.extend({target:target,preventDefault:function(){},stopImmediatePropagation:function(){},stopPropagation:function(){},isPropagationStopped:function(){return!0},isImmediatePropagationStopped:function(){return!0},isDefaultPrevented:function(){return!0},bubbles:!0,cancelable:type!="mousemove",view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:undefined},options||{});return $.isFunction(document.createEvent)?(evt=document.createEvent("MouseEvents"),evt.initMouseEvent(type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget||document.body.parentNode)):document.createEventObject&&(evt=document.createEventObject(),$.extend(evt,e),evt.button={0:1,1:4,2:2}[evt.button]||evt.button),evt}function dispatchEvent(el,type,evt){return el.dispatchEvent?el.dispatchEvent(evt):el.fireEvent&&el.fireEvent("on"+type,evt),evt}function findCenter(el){var el=$(el),o=el.offset();return{x:o.left+el.outerWidth()/2,y:o.top+el.outerHeight()/2}}$.fn.simulateDragSortable=function(options){var opts=$.extend({},$.fn.simulateDragSortable.defaults,options);return this.each(function(){var that=this,handle=opts.handle?$(this).find(opts.handle)[0]:$(this)[0],listItem=opts.listItem,placeHolder=opts.placeHolder,sibling=$(this),moveCounter=Math.floor(opts.move),direction=moveCounter>0?"down":"up",moveVerticalAmount=0,dragPastBy=0;if(moveCounter===0)return;while(moveCounter!==0)direction==="down"?(sibling.next(listItem).length&&(sibling=sibling.next(listItem),moveVerticalAmount+=sibling.outerHeight()),moveCounter-=1):(sibling.prev(listItem).length&&(sibling=sibling.prev(listItem),moveVerticalAmount-=sibling.outerHeight()),moveCounter+=1);var center=findCenter(handle),x=Math.floor(center.x),y=Math.floor(center.y);dispatchEvent(handle,"mousedown",createEvent("mousedown",handle,{clientX:x,clientY:y})),dispatchEvent(document,"mousemove",createEvent("mousemove",document,{clientX:x+1,clientY:y+1})),placeHolder=placeHolder&&$(this).parent().find(placeHolder),placeHolder&&placeHolder.length?(moveVerticalAmount+=(direction==="down"?-1:1)*Math.min($(this).outerHeight()/2,5),dragPastBy=(direction==="down"?1:-1)*$(this).outerHeight()):direction==="down"?($(this).outerHeight()>$(sibling).outerHeight()&&(moveVerticalAmount+=$(this).outerHeight()-$(sibling).outerHeight()),moveVerticalAmount+=$(sibling).outerHeight()/2):moveVerticalAmount-=Math.min($(this).outerHeight()/2,5);if(sibling[0]!==$(this)[0]){var targetOffset=moveVerticalAmount+dragPastBy;for(var offset=0;Math.abs(offset)<Math.abs(targetOffset);offset+=direction==="down"?10:-10)dispatchEvent(document,"mousemove",createEvent("mousemove",document,{clientX:x,clientY:y+offset}));dispatchEvent(document,"mousemove",createEvent("mousemove",document,{clientX:x,clientY:y+targetOffset}))}else window.console&&console.log("Could not move as at top or bottom already");setTimeout(function(){dispatchEvent(document,"mousemove",createEvent("mousemove",document,{clientX:x,clientY:y+moveVerticalAmount}))},5),setTimeout(function(){dispatchEvent(handle,"mouseup",createEvent("mouseup",handle,{clientX:x,clientY:y+moveVerticalAmount}))},10)})},$.fn.simulateDragSortable.defaults={move:0}})(jQuery)})