define(["tp/codemirror/lib/codemirror"],function(n){n.defineMode("smalltalk",function(n){function t(n,t,e){return t.tokenize=e,e(n,t)}function e(n,t){return c=n,t}function r(n,r){var u=n.next();return'"'==u?t(n,r,o(u)):"'"==u?t(n,r,i(u)):"#"==u?(n.eatWhile(/[\w\$_]/),e("string","string")):"$"==u?("<"==n.next()&&(n.eatWhile(/\d/),n.eat(/\>/)),e("string","string")):"^"==u||":"==u&&n.eat("=")?e("operator","operator"):/\d/.test(u)?(n.eatWhile(/[\w\.]/),e("number","number")):/[\[\]()]/.test(u)?e(u,null):(n.eatWhile(/[\w\$_]/),f&&f.propertyIsEnumerable(n.current())?e("keyword","keyword"):e("word","variable"))}function i(n){return function(t,i){for(var o,u=!1,a=!1;null!=(o=t.next());){if(o==n&&!u){a=!0;break}u=!u&&"\\"==o}return(a||!u)&&(i.tokenize=r),e("string","string")}}function o(n){return function(t,i){for(var o,u=!1;null!=(o=t.next());)if(o==n){u=!0;break}return u&&(i.tokenize=r),e("comment","comment")}}function u(n,t,e,r,i){this.indented=n,this.column=t,this.type=e,this.align=r,this.prev=i}function a(n,t,e){return n.context=new u(n.indented,t,e,null,n.context)}function l(n){return n.context=n.context.prev}var c,f={"true":1,"false":1,nil:1,self:1,"super":1,thisContext:1},s=n.indentUnit;return{startState:function(n){return{tokenize:r,context:new u((n||0)-s,0,"top",!1),indented:0,startOfLine:!0}},token:function(n,t){var e=t.context;if(n.sol()&&(null==e.align&&(e.align=!1),t.indented=n.indentation(),t.startOfLine=!0),n.eatSpace())return null;var r=t.tokenize(n,t);return"comment"==c?r:(null==e.align&&(e.align=!0),"["==c?a(t,n.column(),"]"):"("==c?a(t,n.column(),")"):c==e.type&&l(t),t.startOfLine=!1,r)},indent:function(n,t){if(n.tokenize!=r)return 0;var e=t&&t.charAt(0),i=n.context,o=e==i.type;return i.align?i.column+(o?0:1):i.indented+(o?0:s)},electricChars:"]"}}),n.defineMIME("text/x-stsrc",{name:"smalltalk"})});