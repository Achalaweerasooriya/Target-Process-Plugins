define(["tp/codemirror/lib/codemirror"],function(e){e.defineMode("rust",function(){function e(e,t){return F=e,t}function t(t,a){var o=t.next();if('"'==o)return a.tokenize=n,a.tokenize(t,a);if("'"==o)return F="atom",t.eat("\\")?t.skipTo("'")?(t.next(),"string"):"error":(t.next(),t.eat("'")?"string":"error");if("/"==o){if(t.eat("/"))return t.skipToEnd(),"comment";if(t.eat("*"))return a.tokenize=r(1),a.tokenize(t,a)}if("#"==o)return t.eat("[")?(F="open-attr",null):(t.eatWhile(/\w/),e("macro","meta"));if(":"==o&&t.match(":<"))return e("op",null);if(o.match(/\d/)||"."==o&&t.eat(/\d/)){var i=!1;return t.match(/^x[\da-f]+/i)||t.match(/^b[01]+/)||(t.eatWhile(/\d/),t.eat(".")&&(i=!0,t.eatWhile(/\d/)),t.match(/^e[+\-]?\d+/i)&&(i=!0)),t.match(i?/^f(?:32|64)/:/^[ui](?:8|16|32|64)/),e("atom","number")}return o.match(/[()\[\]{}:;,]/)?e(o,null):"-"==o&&t.eat(">")?e("->",null):o.match(N)?(t.eatWhile(N),e("op",null)):(t.eatWhile(/\w/),G=t.current(),t.match(/^::\w/)?(t.backUp(1),e("prefix","variable-2")):a.keywords.propertyIsEnumerable(G)?e(a.keywords[G],G.match(/true|false/)?"atom":"keyword"):e("name","variable"))}function n(n,r){for(var a,o=!1;a=n.next();){if('"'==a&&!o)return r.tokenize=t,e("atom","string");o=!o&&"\\"==a}return e("op","string")}function r(e){return function(n,a){for(var o,i=null;o=n.next();){if("/"==o&&"*"==i){if(1==e){a.tokenize=t;break}return a.tokenize=r(e-1),a.tokenize(n,a)}if("*"==o&&"/"==i)return a.tokenize=r(e+1),a.tokenize(n,a);i=o}return"comment"}}function a(){for(var e=arguments.length-1;e>=0;e--)Q.cc.push(arguments[e])}function o(){return a.apply(null,arguments),!0}function i(e,t){var n=function(){var n=Q.state;n.lexical={indented:n.indented,column:Q.stream.column(),type:e,prev:n.lexical,info:t}};return n.lex=!0,n}function u(){var e=Q.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function l(){Q.state.keywords=L}function c(){Q.state.keywords=K}function f(e,t){function n(r){return","==r?o(e,n):r==t?o():o(n)
}return function(r){return r==t?o():a(e,n)}}function m(e){return"}"==e?o():"let"==e?o(i("stat","let"),g,u,m):"fn"==e?o(i("stat"),z,u,m):"type"==e?o(i("stat"),W,d,u,m):"tag"==e?o(i("stat"),j,u,m):"mod"==e?o(i("stat"),E,u,m):"open-attr"==e?o(i("]"),f(s,"]"),u):"ignore"==e||e.match(/[\]\);,]/)?o(m):a(i("stat"),s,u,d,m)}function d(e){return";"==e?o():a()}function s(e){return"atom"==e||"name"==e?o(p):"{"==e?o(i("}"),h,u):e.match(/[\[\(]/)?B(e,s):e.match(/[\]\)\};,]/)?a():"if-style"==e?o(s,s):"else-style"==e||"op"==e?o(s):"for"==e?o(T,v,w,s,s):"alt"==e?o(s,C):"fn"==e?o(z):"macro"==e?o(q):o()}function p(e){return"."==G?o(k):"::<"==G?o(M,p):"op"==e||":"==G?o(s):"("==e||"["==e?B(e,s):a()}function k(){return G.match(/^\w+$/)?(Q.marked="variable",o(p)):a(s)}function h(e){if("op"==e){if("|"==G)return o(x,u,i("}","block"),m);if("||"==G)return o(u,i("}","block"),m)}return a("mutable"==G||G.match(/^\w+$/)&&":"==Q.stream.peek()&&!Q.stream.match("::",!1)?y(s):m)}function y(e){function t(n){return"mutable"==G||"with"==G?(Q.marked="keyword",o(t)):G.match(/^\w*$/)?(Q.marked="variable",o(t)):":"==n?o(e,t):"}"==n?o():o(t)}return t}function x(e){return"name"==e?(Q.marked="def",o(x)):"op"==e&&"|"==G?o():o(x)}function g(e){return e.match(/[\]\)\};]/)?o():"="==G?o(s,b):","==e?o(g):a(T,v,g)}function b(e){return e.match(/[\]\)\};,]/)?a(g):a(s,b)}function v(e){return":"==e?o(l,O,c):a()}function w(e){return"name"==e&&"in"==G?(Q.marked="keyword",o()):a()}function z(e){return"name"==e?(Q.marked="def",o(z)):"<"==G?o(M,z):"{"==e?a(s):"("==e?o(i(")"),f(I,")"),u,z):"->"==e?o(l,O,c,z):o(z)}function W(e){return"name"==e?(Q.marked="def",o(W)):"<"==G?o(M,W):"="==G?o(l,O,c):o(W)}function j(e){return"name"==e?(Q.marked="def",o(j)):"<"==G?o(M,j):"="==G?o(l,O,c,d):"{"==e?o(i("}"),l,$,c,u):o(j)}function $(e){return"}"==e?o():"("==e?o(i(")"),f(O,")"),u,$):(G.match(/^\w+$/)&&(Q.marked="def"),o($))}function E(e){return"name"==e?(Q.marked="def",o(E)):"{"==e?o(i("}"),m,u):a()}function M(){return">"==G?o():","==G?o(M):a(O,M)
}function I(e){return"name"==e?(Q.marked="def",o(I)):":"==e?o(l,O,c):a()}function O(e){return"name"==e?(Q.marked="variable-3",o(P)):"mutable"==G?(Q.marked="keyword",o(O)):"atom"==e?o(P):"op"==e||"obj"==e?o(O):"fn"==e?o(S):"{"==e?o(i("{"),y(O),u):B(e,O)}function P(){return"<"==G?o(M):a()}function S(e){return"("==e?o(i("("),f(O,")"),u,S):"->"==e?o(O):a()}function T(e){return"name"==e?(Q.marked="def",o(A)):"atom"==e?o(A):"op"==e?o(T):e.match(/[\]\)\};,]/)?a():B(e,T)}function A(e){return"op"==e&&"."==G?o():"to"==G?(Q.marked="keyword",o(T)):a()}function C(e){return"{"==e?o(i("}","alt"),U,u):a()}function U(e){return"}"==e?o():"|"==e?o(U):"when"==G?(Q.marked="keyword",o(s,_)):e.match(/[\]\);,]/)?o(U):a(T,_)}function _(e){return"{"==e?o(i("}","alt"),m,u,U):a(U)}function q(e){return e.match(/[\[\(\{]/)?B(e,s):a()}function B(e,t){return"["==e?o(i("]"),f(t,"]"),u):"("==e?o(i(")"),f(t,")"),u):"{"==e?o(i("}"),f(t,"}"),u):o()}function D(e,t,n){var r=e.cc;for(Q.state=e,Q.stream=t,Q.marked=null,Q.cc=r;;){var a=r.length?r.pop():m;if(a(F)){for(;r.length&&r[r.length-1].lex;)r.pop()();return Q.marked||n}}}var F,G,H=4,J=2,K={"if":"if-style","while":"if-style","else":"else-style","do":"else-style",ret:"else-style",fail:"else-style","break":"atom",cont:"atom","const":"let",resource:"fn",let:"let",fn:"fn","for":"for",alt:"alt",obj:"fn",lambda:"fn",type:"type",tag:"tag",mod:"mod",as:"op","true":"atom","false":"atom",assert:"op",check:"op",claim:"op","native":"ignore",unsafe:"ignore","import":"else-style","export":"else-style",copy:"op",log:"op",log_err:"op",use:"op",bind:"op"},L=function(){for(var e={fn:"fn",block:"fn",obj:"obj"},t="bool uint int i8 i16 i32 i64 u8 u16 u32 u64 float f32 f64 str char".split(" "),n=0,r=t.length;r>n;++n)e[t[n]]="atom";return e}(),N=/[+\-*&%=<>!?|\.@]/,Q={state:null,stream:null,marked:null,cc:null};return u.lex=l.lex=c.lex=!0,{startState:function(){return{tokenize:t,cc:[],lexical:{indented:-H,column:0,type:"top",align:!1},keywords:K,indented:0}},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation()),e.eatSpace())return null;
F=G=null;var n=t.tokenize(e,t);return"comment"==n?n:(t.lexical.hasOwnProperty("align")||(t.lexical.align=!0),"prefix"==F?n:(G||(G=e.current()),D(t,e,n)))},indent:function(e,n){if(e.tokenize!=t)return 0;var r=n&&n.charAt(0),a=e.lexical,o=a.type,i=r==o;return"stat"==o?a.indented+H:a.align?a.column+(i?0:1):a.indented+(i?0:"alt"==a.info?J:H)},electricChars:"{}"}}),e.defineMIME("text/x-rustsrc","rust")});