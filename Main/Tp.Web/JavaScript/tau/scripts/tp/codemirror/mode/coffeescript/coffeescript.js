define(["tp/codemirror/lib/codemirror"],function(e){e.defineMode("coffeescript",function(e){function t(e){return new RegExp("^(("+e.join(")|(")+"))\\b")}function n(e,t){if(e.sol()){var n=t.scopes[0].offset;if(e.eatSpace()){var o=e.indentation();return o>n?"indent":n>o?"dedent":null}n>0&&i(e,t)}if(e.eatSpace())return null;var f=e.peek();if("#"===f)return e.skipToEnd(),"comment";if(e.match(/^-?[0-9\.]/,!1)){var m=!1;if(e.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)&&(m=!0),e.match(/^-?\d+\.\d*/)&&(m=!0),e.match(/^-?\.\d+/)&&(m=!0),m)return"number";var g=!1;if(e.match(/^-?0x[0-9a-f]+/i)&&(g=!0),e.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)&&(g=!0),e.match(/^-?0(?![\dx])/i)&&(g=!0),g)return"number"}if(e.match(b))return t.tokenize=r(e.current(),"string"),t.tokenize(e,t);if(e.match(v)){if("/"!=e.current()||e.match(/^.*\//,!1))return t.tokenize=r(e.current(),"string-2"),t.tokenize(e,t);e.backUp(1)}return e.match(d)||e.match(p)?"punctuation":e.match(u)||e.match(a)||e.match(h)?"operator":e.match(s)?"punctuation":e.match(w)?"atom":e.match(k)?"keyword":e.match(l)?"variable":(e.next(),c)}function r(t,r){var o=new RegExp(t),i=1==t.length;return function(t,f){for(;!t.eol();)if(t.eatWhile(/[^'"\/\\]/),t.eat("\\")){if(t.next(),i&&t.eol())return r}else{if(t.match(o))return f.tokenize=n,r;t.eat(/['"\/]/)}return i&&(e.mode.singleLineStringErrors?r=c:f.tokenize=n),r}}function o(t,n,r){r=r||"coffee";var o=0;if("coffee"===r){for(var i=0;i<n.scopes.length;i++)if("coffee"===n.scopes[i].type){o=n.scopes[i].offset+e.indentUnit;break}}else o=t.column()+t.current().length;n.scopes.unshift({offset:o,type:r})}function i(e,t){if(1!=t.scopes.length){if("coffee"===t.scopes[0].type){for(var n=e.indentation(),r=-1,o=0;o<t.scopes.length;++o)if(n===t.scopes[o].offset){r=o;break}if(-1===r)return!0;for(;t.scopes[0].offset!==n;)t.scopes.shift();return!1}return t.scopes.shift(),!1}}function f(e,t){var n=t.tokenize(e,t),r=e.current();if("."===r)return n=t.tokenize(e,t),r=e.current(),"variable"===n?"variable":c;if("@"===r)return n=t.tokenize(e,t),r=e.current(),"variable"===n?"variable-2":c;"return"===r&&(t.dedent+=1),("->"!==r&&"=>"!==r||t.lambda||"coffee"!=t.scopes[0].type||""!==e.peek())&&"indent"!==n||o(e,t);var f="[({".indexOf(r);return-1!==f&&o(e,t,"])}".slice(f,f+1)),m.exec(r)&&o(e,t),"then"==r&&i(e,t),"dedent"===n&&i(e,t)?c:(f="])}".indexOf(r),-1!==f&&i(e,t)?c:(t.dedent>0&&e.eol()&&"coffee"==t.scopes[0].type&&(t.scopes.length>1&&t.scopes.shift(),t.dedent-=1),n))}var c="error",a=new RegExp("^[\\+\\-\\*/%&|\\^~<>!?]"),s=new RegExp("^[\\(\\)\\[\\]\\{\\}@,:`=;\\.]"),u=new RegExp("^((->)|(=>)|(\\+\\+)|(\\+\\=)|(\\-\\-)|(\\-\\=)|(\\*\\*)|(\\*\\=)|(\\/\\/)|(\\/\\=)|(==)|(!=)|(<=)|(>=)|(<>)|(<<)|(>>)|(//))"),p=new RegExp("^((\\.\\.)|(\\+=)|(\\-=)|(\\*=)|(%=)|(/=)|(&=)|(\\|=)|(\\^=))"),d=new RegExp("^((\\.\\.\\.)|(//=)|(>>=)|(<<=)|(\\*\\*=))"),l=new RegExp("^[_A-Za-z][_A-Za-z0-9]*"),h=t(["and","or","not","is","isnt","in","instanceof","typeof"]),m=["for","while","loop","if","unless","else","switch","try","catch","finally","class"],g=["break","by","continue","debugger","delete","do","in","of","new","return","then","this","throw","when","until"],k=t(m.concat(g));m=t(m);var b=new RegExp("^('{3}|\"{3}|['\"])"),v=new RegExp("^(/{3}|/)"),x=["Infinity","NaN","undefined","null","true","false","on","off","yes","no"],w=t(x),y={startState:function(e){return{tokenize:n,scopes:[{offset:e||0,type:"coffee"}],lastToken:null,lambda:!1,dedent:0}},token:function(e,t){var n=f(e,t);return t.lastToken={style:n,content:e.current()},e.eol()&&e.lambda&&(t.lambda=!1),n},indent:function(e){return e.tokenize!=n?0:e.scopes[0].offset}};return y}),e.defineMIME("text/x-coffeescript","coffeescript")});