define(["tp/codemirror/lib/codemirror"],function(a){a.defineMode("markdown",function(b,c){function u(a,b,c){return b.f=b.inline=c,c(a,b)}function v(a,b,c){return b.f=b.block=c,c(a,b)}function w(a,b){if(a.match(s))return a.skipToEnd(),f;if(a.eatSpace())return null;if(a.peek()==="#"||a.match(r))return a.skipToEnd(),e;if(a.eat(">"))return b.indentation++,g;if(a.peek()==="[")return u(a,b,D);if(o.test(a.peek())){var c=new RegExp("(?:s*["+a.peek()+"]){3,}$");if(a.match(c,!0))return i}var d;return(d=a.match(p,!0)||a.match(q,!0))?(b.indentation+=d[0].length,h):u(a,b,b.inline)}function x(a,b){var c=d.token(a,b.htmlState);return c==="tag"&&b.htmlState.type!=="openTag"&&!b.htmlState.context&&(b.f=A,b.block=w),c}function y(a){return a.strong?a.em?n:m:a.em?l:null}function z(a,b){return a.match(t,!0)?y(b):undefined}function A(a,b){var c=b.text(a,b);if(typeof c!="undefined")return c;var d=a.next();if(d==="\\")return a.next(),y(b);if(d==="`")return u(a,b,G(f,"`"));if(d==="[")return u(a,b,B);if(d==="<"&&a.match(/^\w/,!1))return a.backUp(1),v(a,b,x);var e=y(b);return d==="*"||d==="_"?a.eat(d)?(b.strong=!b.strong)?y(b):e:(b.em=!b.em)?y(b):e:y(b)}function B(a,b){while(!a.eol()){var c=a.next();c==="\\"&&a.next();if(c==="]")return b.inline=b.f=C,j}return j}function C(a,b){a.eatSpace();var c=a.next();return c==="("||c==="["?u(a,b,G(k,c==="("?")":"]")):"error"}function D(a,b){return a.match(/^[^\]]*\]:/,!0)?(b.f=E,j):u(a,b,A)}function E(a,b){return a.eatSpace(),a.match(/^[^\s]+/,!0),b.f=b.inline=A,k}function F(a){return F[a]||(F[a]=new RegExp("^(?:[^\\\\\\"+a+"]|\\\\.)*(?:\\"+a+"|$)")),F[a]}function G(a,b,c){return c=c||A,function(d,e){return d.match(F(b)),e.inline=e.f=c,a}}var d=a.getMode(b,{name:"xml",htmlMode:!0}),e="header",f="code",g="quote",h="list",i="hr",j="linktext",k="linkhref",l="em",m="strong",n="emstrong",o=/^[*-=_]/,p=/^[*-+]\s+/,q=/^[0-9]\.\s+/,r=/^(?:\={3,}|-{3,})$/,s=/^(k:\t|\s{4,})/,t=/^[^\[*_\\<>`]+/;return{startState:function(){return{f:w,block:w,htmlState:d.startState(),indentation:0,inline:A,text:z,em:!1,strong:!1}},copyState:function(b){return{f:b.f,block:b.block,htmlState:a.copyState(d,b.htmlState),indentation:b.indentation,inline:b.inline,text:b.text,em:b.em,strong:b.strong}},token:function(a,b){if(a.sol()){b.f=b.block;var c=b.indentation,d=0;while(c>0)if(a.eat(" "))c--,d++;else if(c>=4&&a.eat("\t"))c-=4,d+=4;else break;b.indentation=d;if(d>0)return null}return b.f(a,b)},getType:y}}),a.defineMIME("text/x-markdown","markdown")})