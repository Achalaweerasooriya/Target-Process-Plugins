define(["tp/codemirror/lib/codemirror"],function(t){t.defineMode("markdown",function(n){function e(t,n,e){return n.f=n.inline=e,e(t,n)}function r(t,n,e){return n.f=n.block=e,e(t,n)}function i(t,n){if(t.match(q))return t.skipToEnd(),x;if(t.eatSpace())return null;if("#"===t.peek()||t.match(R))return t.skipToEnd(),p;if(t.eat(">"))return n.indentation++,g;if("["===t.peek())return e(t,n,m);if(T.test(t.peek())){var r=new RegExp("(?:s*["+t.peek()+"]){3,}$");if(t.match(r,!0))return v}var i;return(i=t.match($,!0)||t.match(_,!0))?(n.indentation+=i[0].length,S):e(t,n,n.inline)}function o(t,n){var e=s.token(t,n.htmlState);return"tag"!==e||"openTag"===n.htmlState.type||n.htmlState.context||(n.f=u,n.block=i),e}function a(t){return t.strong?t.em?M:E:t.em?y:null}function f(t,n){return t.match(I,!0)?a(n):void 0}function u(t,n){var i=n.text(t,n);if("undefined"!=typeof i)return i;var f=t.next();if("\\"===f)return t.next(),a(n);if("`"===f)return e(t,n,h(x,"`"));if("["===f)return e(t,n,c);if("<"===f&&t.match(/^\w/,!1))return t.backUp(1),r(t,n,o);var u=a(n);return"*"===f||"_"===f?t.eat(f)?(n.strong=!n.strong)?a(n):u:(n.em=!n.em)?a(n):u:a(n)}function c(t,n){for(;!t.eol();){var e=t.next();if("\\"===e&&t.next(),"]"===e)return n.inline=n.f=l,b}return b}function l(t,n){t.eatSpace();var r=t.next();return"("===r||"["===r?e(t,n,h(w,"("===r?")":"]")):"error"}function m(t,n){return t.match(/^[^\]]*\]:/,!0)?(n.f=d,b):e(t,n,u)}function d(t,n){return t.eatSpace(),t.match(/^[^\s]+/,!0),n.f=n.inline=u,w}function k(t){return k[t]||(k[t]=new RegExp("^(?:[^\\\\\\"+t+"]|\\\\.)*(?:\\"+t+"|$)")),k[t]}function h(t,n,e){return e=e||u,function(r,i){return r.match(k(n)),i.inline=i.f=e,t}}var s=t.getMode(n,{name:"xml",htmlMode:!0}),p="header",x="code",g="quote",S="list",v="hr",b="linktext",w="linkhref",y="em",E="strong",M="emstrong",T=/^[*-=_]/,$=/^[*-+]\s+/,_=/^[0-9]\.\s+/,R=/^(?:\={3,}|-{3,})$/,q=/^(k:\t|\s{4,})/,I=/^[^\[*_\\<>`]+/;return{startState:function(){return{f:i,block:i,htmlState:s.startState(),indentation:0,inline:u,text:f,em:!1,strong:!1}},copyState:function(n){return{f:n.f,block:n.block,htmlState:t.copyState(s,n.htmlState),indentation:n.indentation,inline:n.inline,text:n.text,em:n.em,strong:n.strong}},token:function(t,n){if(t.sol()){n.f=n.block;for(var e=n.indentation,r=0;e>0;)if(t.eat(" "))e--,r++;else{if(!(e>=4&&t.eat("	")))break;e-=4,r+=4}if(n.indentation=r,r>0)return null}return n.f(t,n)},getType:a}}),t.defineMIME("text/x-markdown","markdown")});