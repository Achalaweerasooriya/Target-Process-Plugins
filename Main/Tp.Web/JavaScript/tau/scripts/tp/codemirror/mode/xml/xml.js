define(["tp/codemirror/lib/codemirror"],function(t){t.defineMode("xml",function(t,e){function n(t,e){function n(n){return e.tokenize=n,n(t,e)}var o=t.next();if("<"==o){if(t.eat("!"))return t.eat("[")?t.match("CDATA[")?n(a("atom","]]>")):null:t.match("--")?n(a("comment","-->")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),n(a("meta",">"))):null;if(t.eat("?"))return t.eatWhile(/[\w\._\-]/),e.tokenize=a("meta","?>"),"meta";h=t.eat("/")?"closeTag":"openTag",t.eatSpace(),x="";for(var i;i=t.eat(/[^\s\u00a0=<>\"\'\/?]/);)x+=i;return e.tokenize=r,"tag"}return"&"==o?(t.eatWhile(/[^;]/),t.eat(";"),"atom"):(t.eatWhile(/[^&<]/),null)}function r(t,e){var r=t.next();return">"==r||"/"==r&&t.eat(">")?(e.tokenize=n,h=">"==r?"endTag":"selfcloseTag","tag"):"="==r?(h="equals",null):/[\'\"]/.test(r)?(e.tokenize=o(r),e.tokenize(t,e)):(t.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function o(t){return function(e,n){for(;!e.eol();)if(e.next()==t){n.tokenize=r;break}return"string"}}function a(t,e){return function(r,o){for(;!r.eol();){if(r.match(e)){o.tokenize=n;break}r.next()}return t}}function i(){for(var t=arguments.length-1;t>=0;t--)k.cc.push(arguments[t])}function u(){return i.apply(null,arguments),!0}function c(t,e){var n=z.doNotIndent.hasOwnProperty(t)||k.context&&k.context.noIndent;k.context={prev:k.context,tagName:t,indent:k.indented,startOfLine:e,noIndent:n}}function f(){k.context&&(k.context=k.context.prev)}function l(t){if("openTag"==t)return k.tagName=x,u(m,d(k.startOfLine));if("closeTag"==t){var e=!1;return e=k.context?k.context.tagName!=x:!0,e&&(v="error"),u(s(e))}return"string"==t?(k.context&&"!cdata"==k.context.name||c("!cdata"),k.tokenize==n&&f(),u()):u()}function d(t){return function(e){return"selfcloseTag"==e||"endTag"==e&&z.autoSelfClosers.hasOwnProperty(k.tagName.toLowerCase())?u():"endTag"==e?(c(k.tagName,t),u()):u()}}function s(t){return function(e){return t&&(v="error"),"endTag"==e?(f(),u()):(v="error",u(arguments.callee))}}function m(t){return"word"==t?(v="attribute",u(m)):"equals"==t?u(g,m):"string"==t?(v="error",u(m)):i()}function g(t){return"word"==t&&z.allowUnquoted?(v="string",u()):"string"==t?u(p):i()}function p(t){return"string"==t?u(p):i()}var x,h,k,v,T=t.indentUnit,z=e.htmlMode?{autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0,"!cdata":!0},allowUnquoted:!0}:{autoSelfClosers:{},doNotIndent:{"!cdata":!0},allowUnquoted:!1},w=e.alignCDATA;return{startState:function(){return{tokenize:n,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(t,e){if(t.sol()&&(e.startOfLine=!0,e.indented=t.indentation()),t.eatSpace())return null;v=h=x=null;var n=e.tokenize(t,e);if(e.type=h,(n||h)&&"comment"!=n)for(k=e;;){var r=e.cc.pop()||l;if(r(h||n))break}return e.startOfLine=!1,v||n},indent:function(t,e){var n=t.context;if(n&&n.noIndent)return 0;if(w&&/<!\[CDATA\[/.test(e))return 0;for(n&&/^<\//.test(e)&&(n=n.prev);n&&!n.startOfLine;)n=n.prev;return n?n.indent+T:0},compareStates:function(t,e){if(t.indented!=e.indented||t.tokenize!=e.tokenize)return!1;for(var n=t.context,r=e.context;;n=n.prev,r=r.prev){if(!n||!r)return n==r;if(n.tagName!=r.tagName)return!1}},electricChars:"/"}}),t.defineMIME("application/xml","xml"),t.defineMIME("text/html",{name:"xml",htmlMode:!0})});