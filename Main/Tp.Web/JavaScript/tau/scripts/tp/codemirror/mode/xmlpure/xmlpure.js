define(["tp/codemirror/lib/codemirror"],function(n){n.defineMode("xmlpure",function(n){function t(n,t,e){return t.tokenize=e,e(n,t)}function e(n,t,e){return function(r,i){for(;!r.eol();){if(r.match(t)){o(i),i.tokenize=e;break}r.next()}return n}}function r(n,t){var e=S.hasOwnProperty(t)||n.context&&n.context.doIndent,r={tagName:t,prev:n.context,indent:n.context?n.context.indent+P:0,lineNumber:n.lineNumber,indented:n.indented,noIndent:e};n.context=r}function o(n){if(n.context){var t=n.context;return n.context=t.prev,t}return null}function i(n){return n.sol()||" "==n.string.charAt(n.start-1)||"	"==n.string.charAt(n.start-1)}function u(n,o){return n.eat("<")?n.eat("?")?(r(o,Z),o.tokenize=d,v):n.match("!--")?(r(o,I),t(n,o,e(g,"-->",u))):n.eatSpace()||n.eol()?(n.skipToEnd(),E):(o.tokenize=a,A):(n.skipToEnd(),E)}function a(n,t){var e=n.pos;if(n.match(/^[a-zA-Z_:][-a-zA-Z0-9_:.]*/)){var i=n.string.substring(e,n.pos);return r(t,i),t.tokenize=c,A}if(n.match(/^\/[a-zA-Z_:][-a-zA-Z0-9_:.]*( )*>/)){var a=n.string.substring(e+1,n.pos-1).trim(),l=o(t);return t.tokenize=null==t.context?u:f,null==l||a!=l.tagName?E:A}return t.tokenize=null==t.context?u:f,n.eatWhile(/[^>]/),n.eat(">"),E}function c(n,t){return n.match(/^\/>/)?(o(t),t.tokenize=null==t.context?u:f,A):n.eat(/^>/)?(t.tokenize=f,A):i(n)&&n.match(/^[a-zA-Z_:][-a-zA-Z0-9_:.]*( )*=/)?(t.tokenize=l,T):(t.tokenize=null==t.context?u:u,n.eatWhile(/[^>]/),n.eat(">"),E)}function l(n,t){var e=n.next();return'"'!=e&&"'"!=e?(n.skipToEnd(),t.tokenize=c,E):(t.tokParams.quote=e,t.tokenize=k,b)}function k(n,t){for(var e="";!n.eol();){if(e=n.next(),e==t.tokParams.quote)return t.tokenize=c,b;if("<"==e)return n.skipToEnd(),t.tokenize=c,E;if("&"==e){if(e=n.next(),";"==e)return n.skipToEnd(),t.tokenize=c,E;for(;!n.eol()&&";"!=e;){if("<"==e)return n.skipToEnd(),t.tokenize=c,E;e=n.next()}if(n.eol()&&";"!=e)return n.skipToEnd(),t.tokenize=c,E}}return b}function f(n,o){return n.eat("<")?n.match("?")?(r(o,Z),o.tokenize=d,v):n.match("!--")?(r(o,I),t(n,o,e(g,"-->",null==o.context?u:f))):n.match("![CDATA[")?(r(o,_),t(n,o,e(N,"]]>",null==o.context?u:f))):n.eatSpace()||n.eol()?(n.skipToEnd(),E):(o.tokenize=a,A):(r(o,M),o.tokenize=m,null)}function m(n,t){return n.eatWhile(/[^<]/),n.eol()||(o(t),t.tokenize=f),N}function d(n,t){return n.match("xml",!0,!0)?t.lineNumber>1||n.pos>5?(t.tokenize=u,n.skipToEnd(),E):(t.tokenize=s,v):i(n)||n.match("?>")?(t.tokenize=u,n.skipToEnd(),E):(t.tokenize=z,v)}function z(n,t){return n.eatWhile(/[^?]/),n.eat("?")&&n.eat(">")&&(o(t),t.tokenize=null==t.context?u:f),v}function s(n,t){return t.tokenize=x,i(n)&&n.match(/^version( )*=( )*"([a-zA-Z0-9_.:]|\-)+"/)?v:(n.skipToEnd(),E)}function x(n,t){return t.tokenize=p,i(n)&&n.match(/^encoding( )*=( )*"[A-Za-z]([A-Za-z0-9._]|\-)*"/)?v:null}function p(n,t){return t.tokenize=h,i(n)&&n.match(/^standalone( )*=( )*"(yes|no)"/)?v:null}function h(n,t){return t.tokenize=u,n.match("?>")&&n.eol()?(o(t),v):(n.skipToEnd(),E)}var E="error",v="comment",g="comment",A="tag",T="attribute",b="string",N="atom",Z="!instruction",_="!cdata",I="!comment",M="!text",S={"!cdata":!0,"!comment":!0,"!text":!0,"!instruction":!0},P=n.indentUnit;return{electricChars:"/",startState:function(){return{tokenize:u,tokParams:{},lineNumber:0,lineError:!1,context:null,indented:0}},token:function(n,t){if(n.sol()&&(t.lineNumber++,t.lineError=!1,t.indented=n.indentation()),n.eatSpace())return null;var e=t.tokenize(n,t);return t.lineError=t.lineError||"error"==e,e},blankLine:function(n){n.lineNumber++,n.lineError=!1},indent:function(n,t){if(n.context){if(1==n.context.noIndent)return;return t.match(/^<\/.*/)?n.context.indent:n.context.indent+P}return 0},compareStates:function(n,t){if(n.indented!=t.indented)return!1;for(var e=n.context,r=t.context;;e=e.prev,r=r.prev){if(!e||!r)return e==r;if(e.tagName!=r.tagName)return!1}}}}),n.defineMIME("application/xml","purexml"),n.defineMIME("text/xml","purexml")});