define(["tp/codemirror/lib/codemirror"],function(t){t.defineMode("stex",function(){function t(t,e){t.cmdState.push(e)}function e(t){return t.cmdState.length>0?t.cmdState[t.cmdState.length-1]:null}function n(t){if(t.cmdState.length>0){var e=t.cmdState.pop();e.closeBracket()}}function r(t){for(var e=t.cmdState,n=e.length-1;n>=0;n--){var r=e[n];if("DEFAULT"!=r.name)return r.styleIdentifier()}return null}function c(t,e,n,r){return function(){this.name=t,this.bracketNo=0,this.style=e,this.styles=r,this.brackets=n,this.styleIdentifier=function(){return this.bracketNo<=this.styles.length?this.styles[this.bracketNo-1]:null},this.openBracket=function(){return this.bracketNo++,"bracket"},this.closeBracket=function(){}}}function a(t,e){t.f=e}function i(n,c){if(n.match(/^\\[a-z]+/)){var i=n.current();i=i.substr(1,i.length-1);var f=u[i];return"undefined"==typeof f&&(f=u.DEFAULT),f=new f,t(c,f),a(c,s),f.style}var l=n.next();return"%"==l?(a(c,o),"comment"):"}"==l||"]"==l?(f=e(c))?(f.closeBracket(l),a(c,s),"bracket"):"error":"{"==l||"["==l?(f=u.DEFAULT,f=new f,t(c,f),"bracket"):/\d/.test(l)?(n.eatWhile(/[\w.%]/),"atom"):(n.eatWhile(/[\w-_]/),r(c))}function o(t,e){return t.skipToEnd(),a(e,i),"comment"}function s(t,r){var c=t.peek();if("{"==c||"["==c){{var o=e(r);o.openBracket(c)}return t.eat(c),a(r,i),"bracket"}return/[ \t\r]/.test(c)?(t.eat(c),null):(a(r,i),o=e(r),o&&n(r),i(t,r))}var u=new Array;return u.importmodule=c("importmodule","tag","{[",["string","builtin"]),u.documentclass=c("documentclass","tag","{[",["","atom"]),u.usepackage=c("documentclass","tag","[",["atom"]),u.begin=c("documentclass","tag","[",["atom"]),u.end=c("documentclass","tag","[",["atom"]),u.DEFAULT=function(){this.name="DEFAULT",this.style="tag",this.styleIdentifier=function(){},this.openBracket=function(){},this.closeBracket=function(){}},{startState:function(){return{f:i,cmdState:[]}},copyState:function(t){return{f:t.f,cmdState:t.cmdState.slice(0,t.cmdState.length)}},token:function(t,e){{var n=e.f(t,e);t.current()
}return n}}}),t.defineMIME("text/x-stex","stex")});