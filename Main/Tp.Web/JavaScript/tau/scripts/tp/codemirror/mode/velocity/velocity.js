CodeMirror.defineMode("velocity",function(a){function m(a,b){var c=0,d;while(d=a.next()){if(d=="#"&&c==2){b.tokenize=j;break}d=="]"?c++:d!=" "&&(c=0)}return"meta"}function l(a,b){var c=!1,d;while(d=a.next()){if(d=="#"&&c){b.tokenize=j;break}c=d=="*"}return"comment"}function k(a){return function(b,c){var d=!1,e,f=!1;while((e=b.next())!=null){if(e==a&&!d){f=!0;break}d=!d&&e=="\\"}f&&(c.tokenize=j);return"string"}}function j(a,b){var c=b.beforeParams;b.beforeParams=!1;var h=a.next();if(h!='"'&&h!="'"||!b.inParams){if(/[\[\]{}\(\),;\.]/.test(h)){h=="("&&c?b.inParams=!0:h==")"&&(b.inParams=!1);return null}if(/\d/.test(h)){a.eatWhile(/[\w\.]/);return"number"}if(h=="#"&&a.eat("*"))return i(a,b,l);if(h=="#"&&a.match(/ *\[ *\[/))return i(a,b,m);if(h=="#"&&a.eat("#")){a.skipToEnd();return"comment"}if(h=="$"){a.eatWhile(/[\w\d\$_\.{}]/);if(f&&f.propertyIsEnumerable(a.current().toLowerCase()))return"keyword";b.beforeParams=!0;return"builtin"}if(g.test(h)){a.eatWhile(g);return"operator"}a.eatWhile(/[\w\$_{}]/);var j=a.current().toLowerCase();if(d&&d.propertyIsEnumerable(j))return"keyword";if(e&&e.propertyIsEnumerable(j)||a.current().match(/^#[a-z0-9_]+ *$/i)&&a.peek()=="("){b.beforeParams=!0;return"keyword"}return null}return i(a,b,k(h))}function i(a,b,c){b.tokenize=c;return c(a,b)}function b(a){var b={},c=a.split(" ");for(var d=0;d<c.length;++d)b[c[d]]=!0;return b}var c=a.indentUnit,d=b("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}"),e=b("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}"),f=b("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent $velocityCount"),g=/[+\-*&%=<>!?:\/|]/,h=!0;return{startState:function(a){return{tokenize:j,beforeParams:!1,inParams:!1}},token:function(a,b){return a.eatSpace()?null:b.tokenize(a,b)}}}),CodeMirror.defineMIME("text/velocity","velocity")