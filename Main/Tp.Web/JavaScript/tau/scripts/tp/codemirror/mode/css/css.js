define(["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("css",function(config){function ret(style,tp){return type=tp,style}function tokenBase(stream,state){var ch=stream.next();if(ch=="@")return stream.eatWhile(/[\w\\\-]/),ret("meta",stream.current());if(ch=="/"&&stream.eat("*"))return state.tokenize=tokenCComment,tokenCComment(stream,state);if(ch=="<"&&stream.eat("!"))return state.tokenize=tokenSGMLComment,tokenSGMLComment(stream,state);if(ch!="=")return ch!="~"&&ch!="|"||!stream.eat("=")?ch=='"'||ch=="'"?(state.tokenize=tokenString(ch),state.tokenize(stream,state)):ch=="#"?(stream.eatWhile(/[\w\\\-]/),ret("atom","hash")):ch=="!"?(stream.match(/^\s*\w*/),ret("keyword","important")):/\d/.test(ch)?(stream.eatWhile(/[\w.%]/),ret("number","unit")):/[,.+>*\/]/.test(ch)?ret(null,"select-op"):/[;{}:\[\]]/.test(ch)?ret(null,ch):(stream.eatWhile(/[\w\\\-]/),ret("variable","variable")):ret(null,"compare");ret(null,"compare")}function tokenCComment(stream,state){var maybeEnd=!1,ch;while((ch=stream.next())!=null){if(maybeEnd&&ch=="/"){state.tokenize=tokenBase;break}maybeEnd=ch=="*"}return ret("comment","comment")}function tokenSGMLComment(stream,state){var dashes=0,ch;while((ch=stream.next())!=null){if(dashes>=2&&ch==">"){state.tokenize=tokenBase;break}dashes=ch=="-"?dashes+1:0}return ret("comment","comment")}function tokenString(quote){return function(stream,state){var escaped=!1,ch;while((ch=stream.next())!=null){if(ch==quote&&!escaped)break;escaped=!escaped&&ch=="\\"}return escaped||(state.tokenize=tokenBase),ret("string","string")}}var indentUnit=config.indentUnit,type;return{startState:function(base){return{tokenize:tokenBase,baseIndent:base||0,stack:[]}},token:function(stream,state){if(stream.eatSpace())return null;var style=state.tokenize(stream,state),context=state.stack[state.stack.length-1];if(type=="hash"&&context=="rule")style="atom";else if(style=="variable")if(context=="rule")style="number";else if(!context||context=="@media{")style="tag";return context=="rule"&&/^[\{\};]$/.test(type)&&state.stack.pop(),type=="{"?context=="@media"?state.stack[state.stack.length-1]="@media{":state.stack.push("{"):type=="}"?state.stack.pop():type=="@media"?state.stack.push("@media"):context=="{"&&type!="comment"&&state.stack.push("rule"),style},indent:function(state,textAfter){var n=state.stack.length;return/^\}/.test(textAfter)&&(n-=state.stack[state.stack.length-1]=="rule"?2:1),state.baseIndent+n*indentUnit},electricChars:"}"}}),CodeMirror.defineMIME("text/css","css")})