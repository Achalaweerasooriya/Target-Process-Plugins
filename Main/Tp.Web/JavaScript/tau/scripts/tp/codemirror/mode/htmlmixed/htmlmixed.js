define(["tp/codemirror/lib/codemirror"],function(a){a.defineMode("htmlmixed",function(b,c){function g(a,b){var c=d.token(a,b.htmlState);return c=="tag"&&a.current()==">"&&b.htmlState.context&&(/^script$/i.test(b.htmlState.context.tagName)?(b.token=i,b.localState=e.startState(d.indent(b.htmlState,"")),b.mode="javascript"):/^style$/i.test(b.htmlState.context.tagName)&&(b.token=j,b.localState=f.startState(d.indent(b.htmlState,"")),b.mode="css")),c}function h(a,b,c){var d=a.current(),e=d.search(b);return e>-1&&a.backUp(d.length-e),c}function i(a,b){return a.match(/^<\/\s*script\s*>/i,!1)?(b.token=g,b.curState=null,b.mode="html",g(a,b)):h(a,/<\/\s*script\s*>/,e.token(a,b.localState))}function j(a,b){return a.match(/^<\/\s*style\s*>/i,!1)?(b.token=g,b.localState=null,b.mode="html",g(a,b)):h(a,/<\/\s*style\s*>/,f.token(a,b.localState))}var d=a.getMode(b,{name:"xml",htmlMode:!0}),e=a.getMode(b,"javascript"),f=a.getMode(b,"css");return{startState:function(){var a=d.startState();return{token:g,localState:null,mode:"html",htmlState:a}},copyState:function(b){if(b.localState)var c=a.copyState(b.token==j?f:e,b.localState);return{token:b.token,localState:c,mode:b.mode,htmlState:a.copyState(d,b.htmlState)}},token:function(a,b){return b.token(a,b)},indent:function(a,b){return a.token==g||/^\s*<\//.test(b)?d.indent(a.htmlState,b):a.token==i?e.indent(a.localState,b):f.indent(a.localState,b)},compareStates:function(a,b){return d.compareStates(a.htmlState,b.htmlState)},electricChars:"/{}:"}}),a.defineMIME("text/html","htmlmixed")})