define(["tp/codemirror/lib/codemirror"],function(t){t.defineMode("htmlmixed",function(e){function n(t,e){var n=r.token(t,e.htmlState);return"tag"==n&&">"==t.current()&&e.htmlState.context&&(/^script$/i.test(e.htmlState.context.tagName)?(e.token=o,e.localState=c.startState(r.indent(e.htmlState,"")),e.mode="javascript"):/^style$/i.test(e.htmlState.context.tagName)&&(e.token=l,e.localState=m.startState(r.indent(e.htmlState,"")),e.mode="css")),n}function a(t,e,n){var a=t.current(),o=a.search(e);return o>-1&&t.backUp(a.length-o),n}function o(t,e){return t.match(/^<\/\s*script\s*>/i,!1)?(e.token=n,e.curState=null,e.mode="html",n(t,e)):a(t,/<\/\s*script\s*>/,c.token(t,e.localState))}function l(t,e){return t.match(/^<\/\s*style\s*>/i,!1)?(e.token=n,e.localState=null,e.mode="html",n(t,e)):a(t,/<\/\s*style\s*>/,m.token(t,e.localState))}var r=t.getMode(e,{name:"xml",htmlMode:!0}),c=t.getMode(e,"javascript"),m=t.getMode(e,"css");return{startState:function(){var t=r.startState();return{token:n,localState:null,mode:"html",htmlState:t}},copyState:function(e){if(e.localState)var n=t.copyState(e.token==l?m:c,e.localState);return{token:e.token,localState:n,mode:e.mode,htmlState:t.copyState(r,e.htmlState)}},token:function(t,e){return e.token(t,e)},indent:function(t,e){return t.token==n||/^\s*<\//.test(e)?r.indent(t.htmlState,e):t.token==o?c.indent(t.localState,e):m.indent(t.localState,e)},compareStates:function(t,e){return r.compareStates(t.htmlState,e.htmlState)},electricChars:"/{}:"}}),t.defineMIME("text/html","htmlmixed")});