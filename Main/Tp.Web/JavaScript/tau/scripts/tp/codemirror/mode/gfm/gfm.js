define(["tp/codemirror/lib/codemirror"],function(a){a.defineMode("gfm",function(b,c){function g(a,b){return a.sol()&&a.match(/^```([\w+#]*)/)?(b.localMode=f(RegExp.$1),b.localMode&&(b.localState=b.localMode.startState()),b.token=h,"code"):d.token(a,b.mdState)}function h(a,b){return a.sol()&&a.match(/^```/)?(b.localMode=b.localState=null,b.token=g,"code"):b.localMode?b.localMode.token(a,b.localState):(a.skipToEnd(),"code")}function i(a,b){var c;if(a.match(/^\w+:\/\/\S+/))return"linkhref";if(a.match(/^[^\[*\\<>` _][^\[*\\<>` ]*[^\[*\\<>` _]/))return d.getType(b);if(c=a.match(/^[^\[*\\<>` ]+/)){var e=c[0];return e[0]==="_"&&e[e.length-1]==="_"?(a.backUp(e.length),undefined):d.getType(b)}if(a.eatSpace())return null}var d=a.getMode(b,"markdown"),e={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp"},f=function(){var c,d={},f={},g,h=a.listModes();for(c=0;c<h.length;c++)d[h[c]]=h[c];var i=a.listMIMEs();for(c=0;c<i.length;c++)g=i[c].mime,f[g]=i[c].mime;for(var j in e)if(e[j]in d||e[j]in f)d[j]=e[j];return function(c){return d[c]?a.getMode(b,d[c]):null}}();return{startState:function(){var a=d.startState();return a.text=i,{token:g,mode:"markdown",mdState:a,localMode:null,localState:null}},copyState:function(b){return{token:b.token,mode:b.mode,mdState:a.copyState(d,b.mdState),localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null}},token:function(a,b){return b.token(a,b)}}})})