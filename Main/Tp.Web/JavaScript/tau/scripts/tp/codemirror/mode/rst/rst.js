define(["tp/codemirror/lib/codemirror"],function(a){a.defineMode("rst",function(b,c){function d(a,b,c){a.fn=b,e(a,c)}function e(a,b){a.ctx=b||{}}function f(a,b){if(b&&typeof b!="string"){var c=b.current();b=c[c.length-1]}d(a,y,{back:b})}function g(b){if(b){var c=a.listModes();for(var d in c)if(c[d]==b)return!0}return!1}function h(c){return g(c)?a.getMode(b,c):null}function y(a,b){function l(a){return e||!b.ctx.back||a.test(b.ctx.back)}function m(b){return a.eol()||a.match(b,!1)}function n(b){return a.match(b)&&l(/\W/)&&m(/\W/)}var c,e,g;if(a.eat(/\\/))return c=a.next(),f(b,c),null;e=a.sol();if(e&&(c=a.eat(k))){for(g=0;a.eat(c);g++);if(g>=3&&a.match(/^\s*$/))return f(b,null),"section";a.backUp(g+1)}if(e&&a.match(r))return a.eol()||d(b,A),"directive-marker";if(a.match(s)){if(!i)d(b,D);else{var h=i;d(b,D,{mode:h,local:h.startState()})}return"verbatim-marker"}if(e&&a.match(x,!1)){if(!j)return d(b,D),"verbatim-marker";var h=j;return d(b,D,{mode:h,local:h.startState()}),null}if(e&&(a.match(v)||a.match(w)))return f(b,a),"list";if(n(p))return f(b,a),"footnote";if(n(q))return f(b,a),"citation";c=a.next();if(l(t)){if(!(c!==":"&&c!=="|"||!a.eat(/\S/))){var o;return c===":"?o="role":o="replacement",d(b,z,{ch:c,wide:!1,prev:null,token:o}),o}if(c==="*"||c==="`"){var u=c,y=!1;c=a.next(),c==u&&(y=!0,c=a.next());if(c&&!/\s/.test(c)){var o;return u==="*"?o=y?"strong":"emphasis":o=y?"inline":"interpreted",d(b,z,{ch:u,wide:y,prev:null,token:o}),o}}}return f(b,c),null}function z(a,b){function g(a){return b.ctx.prev=a,e}var c=a.next(),e=b.ctx.token;if(c!=b.ctx.ch)return g(c);if(/\s/.test(b.ctx.prev))return g(c);if(b.ctx.wide){c=a.next();if(c!=b.ctx.ch)return g(c)}return!a.eol()&&!u.test(a.peek())?(b.ctx.wide&&a.backUp(1),g(c)):(d(b,y),f(b,c),e)}function A(a,b){var c=null;if(a.match(l))c="directive";else if(a.match(m))c="hyperlink";else if(a.match(n))c="footnote";else if(a.match(o))c="citation";else return a.eatSpace(),a.eol()?(f(b,a),null):(a.skipToEnd(),d(b,C),"comment");return d(b,B,{start:!0}),c}function B(a,b){var c="body";return!b.ctx.start||a.sol()?E(a,b,c):(a.skipToEnd(),e(b),c)}function C(a,b){return E(a,b,"comment")}function D(a,b){return i?a.sol()?(a.eatSpace()||f(b,a),null):i.token(a,b.ctx.local):E(a,b,"verbatim")}function E(a,b,c){return a.eol()||a.eatSpace()?(a.skipToEnd(),c):(f(b,a),null)}var i=h(c.verbatim),j=h("python"),k=/^[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/,l=/^\s*\w([-:.\w]*\w)?::(\s|$)/,m=/^\s*_[\w-]+:(\s|$)/,n=/^\s*\[(\d+|#)\](\s|$)/,o=/^\s*\[[A-Za-z][\w-]*\](\s|$)/,p=/^\[(\d+|#)\]_/,q=/^\[[A-Za-z][\w-]*\]_/,r=/^\.\.(\s|$)/,s=/^::\s*$/,t=/^[-\s"([{</:]/,u=/^[-\s`'")\]}>/:.,;!?\\_]/,v=/^\s*((\d+|[A-Za-z#])[.)]|\((\d+|[A-Z-a-z#])\))\s/,w=/^\s*[-\+\*]\s/,x=/^\s+(>>>|In \[\d+\]:)\s/;return{startState:function(){return{fn:y,ctx:{}}},copyState:function(a){return{fn:a.fn,ctx:a.ctx}},token:function(a,b){var c=b.fn(a,b);return c}}}),a.defineMIME("text/x-rst","rst")})