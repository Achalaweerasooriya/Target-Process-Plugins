define([],function(){var CodeMirror=function(){function CodeMirror(place,givenOptions){function keyMightStartIME(keyCode){return win&&(gecko&&keyCode==229||window.opera&&keyCode==197)||mac&&gecko}function isLine(l){return l>=0&&l<doc.size}function getLine(n){return getLineAt(doc,n)}function updateLineHeight(line,height){gutterDirty=!0;var diff=height-line.height;for(var n=line;n;n=n.parent)n.height+=diff}function setValue(code){var top={line:0,ch:0};updateLines(top,{line:doc.size-1,ch:getLine(doc.size-1).text.length},splitLines(code),top,top),updateInput=!0}function getValue(code){var text=[];return doc.iter(0,doc.size,function(line){text.push(line.text)}),text.join("\n")}function onMouseDown(e){function extend(e){var cur=posFromMouse(e,!0);if(cur&&!posEq(cur,last)){focused||onFocus(),last=cur,setSelectionUser(start,cur),updateInput=!1;var visible=visibleLines();if(cur.line>=visible.to||cur.line<visible.from)going=setTimeout(operation(function(){extend(e)}),150)}}for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==code&&n!=mover)return;for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==gutterText)return options.onGutterClick&&options.onGutterClick(instance,indexOf(gutterText.childNodes,n)+showingFrom,e),e_preventDefault(e);var start=posFromMouse(e);switch(e_button(e)){case 3:gecko&&!mac&&onContextMenu(e);return;case 2:start&&setCursor(start.line,start.ch,!0);return}if(!start){e_target(e)==scroller&&e_preventDefault(e);return}focused||onFocus();var now=+(new Date);if(lastDoubleClick&&lastDoubleClick.time>now-400&&posEq(lastDoubleClick.pos,start))return e_preventDefault(e),setTimeout(focusInput,20),selectLine(start.line);if(lastClick&&lastClick.time>now-400&&posEq(lastClick.pos,start))return lastDoubleClick={time:now,pos:start},e_preventDefault(e),selectWordAt(start);lastClick={time:now,pos:start};var last=start,going;if(dragAndDrop&&!posEq(sel.from,sel.to)&&!posLess(start,sel.from)&&!posLess(sel.to,start)){webkit&&(lineSpace.draggable=!0);var up=connect(targetDocument,"mouseup",operation(function(e2){webkit&&(lineSpace.draggable=!1),draggingText=!1,up(),Math.abs(e.clientX-e2.clientX)+Math.abs(e.clientY-e2.clientY)<10&&(e_preventDefault(e2),setCursor(start.line,start.ch,!0),focusInput())}),!0);draggingText=!0;return}e_preventDefault(e),setCursor(start.line,start.ch,!0);var move=connect(targetDocument,"mousemove",operation(function(e){clearTimeout(going),e_preventDefault(e),extend(e)}),!0),up=connect(targetDocument,"mouseup",operation(function(e){clearTimeout(going);var cur=posFromMouse(e);cur&&setSelectionUser(start,cur),e_preventDefault(e),focusInput(),updateInput=!0,move(),up()}),!0)}function onDoubleClick(e){for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==gutterText)return e_preventDefault(e);var start=posFromMouse(e);if(!start)return;lastDoubleClick={time:+(new Date),pos:start},e_preventDefault(e),selectWordAt(start)}function onDrop(e){e.preventDefault();var pos=posFromMouse(e,!0),files=e.dataTransfer.files;if(!pos||options.readOnly)return;if(files&&files.length&&window.FileReader&&window.File){function loadFile(file,i){var reader=new FileReader;reader.onload=function(){text[i]=reader.result,++read==n&&(pos=clipPos(pos),operation(function(){var end=replaceRange(text.join(""),pos,pos);setSelectionUser(pos,end)})())},reader.readAsText(file)}var n=files.length,text=Array(n),read=0;for(var i=0;i<n;++i)loadFile(files[i],i)}else try{var text=e.dataTransfer.getData("Text");if(text){var end=replaceRange(text,pos,pos),curFrom=sel.from,curTo=sel.to;setSelectionUser(pos,end),draggingText&&replaceRange("",curFrom,curTo),focusInput()}}catch(e){}}function onDragStart(e){var txt=getSelection();htmlEscape(txt),e.dataTransfer.setDragImage(escapeElement,0,0),e.dataTransfer.setData("Text",txt)}function onKeyDown(e){focused||onFocus();var code=e.keyCode;ie&&code==27&&(e.returnValue=!1);var mod=(mac?e.metaKey:e.ctrlKey)&&!e.altKey,anyMod=e.ctrlKey||e.altKey||e.metaKey;code==16||e.shiftKey?shiftSelecting=shiftSelecting||(sel.inverted?sel.to:sel.from):shiftSelecting=null;if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;if(code==33||code==34)return scrollPage(code==34),e_preventDefault(e);if(mod&&(code==36||code==35||mac&&(code==38||code==40)))return scrollEnd(code==36||code==38),e_preventDefault(e);if(mod&&code==65)return selectAll(),e_preventDefault(e);if(!options.readOnly){if(!anyMod&&code==13)return;if(!anyMod&&code==9&&handleTab(e.shiftKey))return e_preventDefault(e);if(mod&&code==90)return undo(),e_preventDefault(e);if(mod&&(e.shiftKey&&code==90||code==89))return redo(),e_preventDefault(e)}if(code==36&&options.smartHome)return smartHome(),e_preventDefault(e);curKeyId=(mod?"c":"")+(e.altKey?"a":"")+code;if(sel.inverted&&movementKeys[curKeyId]===!0){var range=selRange(input);range&&(reducedSelection={anchor:range.start},setSelRange(input,range.start,range.start))}!mod&&!e.altKey&&(curKeyId=null),fastPoll(curKeyId),options.pollForIME&&keyMightStartIME(code)&&(slowPollInterval=50)}function onKeyUp(e){if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;reducedSelection&&(reducedSelection=null,updateInput=!0),e.keyCode==16&&(shiftSelecting=null),slowPollInterval<2e3&&!alwaysPollForIME&&(slowPollInterval=2e3)}function onKeyPress(e){if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;if(options.electricChars&&mode.electricChars){var ch=String.fromCharCode(e.charCode==null?e.keyCode:e.charCode);mode.electricChars.indexOf(ch)>-1&&setTimeout(operation(function(){indentLine(sel.to.line,"smart")}),50)}var code=e.keyCode;code==13?(options.readOnly||handleEnter(),e_preventDefault(e)):!e.ctrlKey&&!e.altKey&&!e.metaKey&&code==9&&options.tabMode!="default"?e_preventDefault(e):fastPoll(curKeyId)}function onFocus(){if(options.readOnly=="nocursor")return;focused||(options.onFocus&&options.onFocus(instance),focused=!0,wrapper.className.search(/\bCodeMirror-focused\b/)==-1&&(wrapper.className+=" CodeMirror-focused"),leaveInputAlone||prepareInput()),slowPoll(),restartBlink()}function onBlur(){focused&&(options.onBlur&&options.onBlur(instance),focused=!1,wrapper.className=wrapper.className.replace(" CodeMirror-focused","")),clearInterval(blinker),setTimeout(function(){focused||(shiftSelecting=null)},150)}function updateLines(from,to,newText,selFrom,selTo){if(history){var old=[];doc.iter(from.line,to.line+1,function(line){old.push(line.text)}),history.addChange(from.line,newText.length,old);while(history.done.length>options.undoDepth)history.done.shift()}updateLinesNoUndo(from,to,newText,selFrom,selTo)}function unredoHelper(from,to){var change=from.pop();if(change){var replaced=[],end=change.start+change.added;doc.iter(change.start,end,function(line){replaced.push(line.text)}),to.push({start:change.start,added:change.old.length,old:replaced});var pos=clipPos({line:change.start+change.old.length-1,ch:editEnd(replaced[replaced.length-1],change.old[change.old.length-1])});updateLinesNoUndo({line:change.start,ch:0},{line:end-1,ch:getLine(end-1).text.length},change.old,pos,pos),updateInput=!0}}function undo(){unredoHelper(history.done,history.undone)}function redo(){unredoHelper(history.undone,history.done)}function updateLinesNoUndo(from,to,newText,selFrom,selTo){function updateLine(n){return n<=Math.min(to.line,to.line+lendiff)?n:n+lendiff}var recomputeMaxLength=!1,maxLineLength=maxLine.length;options.lineWrapping||doc.iter(from.line,to.line,function(line){if(line.text.length==maxLineLength)return recomputeMaxLength=!0,!0});var nlines=to.line-from.line,firstLine=getLine(from.line),lastLine=getLine(to.line);if(firstLine==lastLine)if(newText.length==1)firstLine.replace(from.ch,to.ch,newText[0]);else{lastLine=firstLine.split(to.ch,newText[newText.length-1]),firstLine.replace(from.ch,null,newText[0]),firstLine.fixMarkEnds(lastLine);var added=[];for(var i=1,e=newText.length-1;i<e;++i)added.push(Line.inheritMarks(newText[i],firstLine));added.push(lastLine),doc.insert(from.line+1,added)}else if(newText.length==1)firstLine.replace(from.ch,null,newText[0]),lastLine.replace(null,to.ch,""),firstLine.append(lastLine),doc.remove(from.line+1,nlines);else{var added=[];firstLine.replace(from.ch,null,newText[0]),lastLine.replace(null,to.ch,newText[newText.length-1]),firstLine.fixMarkEnds(lastLine);for(var i=1,e=newText.length-1;i<e;++i)added.push(Line.inheritMarks(newText[i],firstLine));nlines>1&&doc.remove(from.line+1,nlines-1),doc.insert(from.line+1,added)}if(options.lineWrapping){var perLine=scroller.clientWidth/charWidth()-3;doc.iter(from.line,from.line+newText.length,function(line){if(line.hidden)return;var guess=Math.ceil(line.text.length/perLine)||1;guess!=line.height&&updateLineHeight(line,guess)})}else doc.iter(from.line,i+newText.length,function(line){var l=line.text;l.length>maxLineLength&&(maxLine=l,maxLineLength=l.length,maxWidth=null,recomputeMaxLength=!1)}),recomputeMaxLength&&(maxLineLength=0,maxLine="",maxWidth=null,doc.iter(0,doc.size,function(line){var l=line.text;l.length>maxLineLength&&(maxLineLength=l.length,maxLine=l)}));var newWork=[],lendiff=newText.length-nlines-1;for(var i=0,l=work.length;i<l;++i){var task=work[i];task<from.line?newWork.push(task):task>to.line&&newWork.push(task+lendiff)}var hlEnd=from.line+Math.min(newText.length,500);highlightLines(from.line,hlEnd),newWork.push(hlEnd),work=newWork,startWorker(100),changes.push({from:from.line,to:to.line+1,diff:lendiff}),textChanged={from:from,to:to,text:newText},setSelection(selFrom,selTo,updateLine(sel.from.line),updateLine(sel.to.line)),code.style.height=doc.height*textHeight()+2*paddingTop()+"px"}function replaceRange(code,from,to){function adjustPos(pos){if(posLess(pos,from))return pos;if(!posLess(to,pos))return end;var line=pos.line+code.length-(to.line-from.line)-1,ch=pos.ch;return pos.line==to.line&&(ch+=code[code.length-1].length-(to.ch-(to.line==from.line?from.ch:0))),{line:line,ch:ch}}from=clipPos(from),to?to=clipPos(to):to=from,code=splitLines(code);var end;return replaceRange1(code,from,to,function(end1){return end=end1,{from:adjustPos(sel.from),to:adjustPos(sel.to)}}),end}function replaceSelection(code,collapse){replaceRange1(splitLines(code),sel.from,sel.to,function(end){return collapse=="end"?{from:end,to:end}:collapse=="start"?{from:sel.from,to:sel.from}:{from:sel.from,to:end}})}function replaceRange1(code,from,to,computeSel){var endch=code.length==1?code[0].length+from.ch:code[code.length-1].length,newSel=computeSel({line:from.line+code.length-1,ch:endch});updateLines(from,to,code,newSel.from,newSel.to)}function getRange(from,to){var l1=from.line,l2=to.line;if(l1==l2)return getLine(l1).text.slice(from.ch,to.ch);var code=[getLine(l1).text.slice(from.ch)];return doc.iter(l1+1,l2,function(line){code.push(line.text)}),code.push(getLine(l2).text.slice(0,to.ch)),code.join("\n")}function getSelection(){return getRange(sel.from,sel.to)}function slowPoll(){if(pollingFast)return;poll.set(slowPollInterval,function(){startOperation(),readInput(),focused&&slowPoll(),endOperation()})}function fastPoll(keyId){function p(){startOperation();var changed=readInput();changed&&keyId&&(changed=="moved"&&movementKeys[keyId]==null&&(movementKeys[keyId]=!0),changed=="changed"&&(movementKeys[keyId]=!1)),!changed&&!missed?(missed=!0,poll.set(80,p)):(pollingFast=!1,slowPoll()),endOperation()}var missed=!1;pollingFast=!0,poll.set(20,p)}function readInput(){function computeOffset(n,startLine){var pos=0;for(;;){var found=text.indexOf("\n",pos);if(found==-1||(text.charAt(found-1)=="\r"?found-1:found)>=n)return{line:startLine,ch:n-pos};++startLine,pos=found+1}}if(leaveInputAlone||!focused)return;var changed=!1,text=input.value,sr=selRange(input);if(!sr)return!1;var changed=editing.text!=text,rs=reducedSelection,moved=changed||sr.start!=editing.start||sr.end!=(rs?editing.start:editing.end);if(!moved&&!rs)return!1;if(changed){shiftSelecting=reducedSelection=null;if(options.readOnly)return updateInput=!0,"changed"}var from=computeOffset(sr.start,editing.from),to=computeOffset(sr.end,editing.from);if(rs){var head=sr.start==rs.anchor?to:from,tail=shiftSelecting?sel.to:sr.start==rs.anchor?from:to;(sel.inverted=posLess(head,tail))?(from=head,to=tail):(reducedSelection=null,from=tail,to=head)}from.line==to.line&&from.line==sel.from.line&&from.line==sel.to.line&&!shiftSelecting&&(updateInput=!1);if(changed){var start=0,end=text.length,len=Math.min(end,editing.text.length),c,line=editing.from,nl=-1;while(start<len&&(c=text.charAt(start))==editing.text.charAt(start))++start,c=="\n"&&(line++,nl=start);var ch=nl>-1?start-nl:start,endline=editing.to-1,edend=editing.text.length;for(;;){c=editing.text.charAt(edend);if(text.charAt(end)!=c){++end,++edend;break}c=="\n"&&endline--;if(edend<=start||end<=start)break;--end,--edend}var nl=editing.text.lastIndexOf("\n",edend-1),endch=nl==-1?edend:edend-nl-1;updateLines({line:line,ch:ch},{line:endline,ch:endch},splitLines(text.slice(start,end)),from,to);if(line!=endline||from.line!=line)updateInput=!0}else setSelection(from,to);return editing.text=text,editing.start=sr.start,editing.end=sr.end,changed?"changed":moved?"moved":!1}function prepareInput(){var text=[],from=Math.max(0,sel.from.line-1),to=Math.min(doc.size,sel.to.line+2);doc.iter(from,to,function(line){text.push(line.text)}),text=input.value=text.join(lineSep);var startch=sel.from.ch,endch=sel.to.ch;doc.iter(from,sel.from.line,function(line){startch+=lineSep.length+line.text.length}),doc.iter(from,sel.to.line,function(line){endch+=lineSep.length+line.text.length}),editing={text:text,from:from,to:to,start:startch,end:endch},setSelRange(input,startch,reducedSelection?startch:endch)}function focusInput(){options.readOnly!="nocursor"&&input.focus()}function scrollEditorIntoView(){if(!cursor.getBoundingClientRect)return;var rect=cursor.getBoundingClientRect(),winH=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(rect.top<0||rect.bottom>winH)&&cursor.scrollIntoView()}function scrollCursorIntoView(){var cursor=localCoords(sel.inverted?sel.from:sel.to),x=options.lineWrapping?Math.min(cursor.x,lineSpace.offsetWidth):cursor.x;return scrollIntoView(x,cursor.y,x,cursor.yBot)}function scrollIntoView(x1,y1,x2,y2){var pl=paddingLeft(),pt=paddingTop(),lh=textHeight();y1+=pt,y2+=pt,x1+=pl,x2+=pl;var screen=scroller.clientHeight,screentop=scroller.scrollTop,scrolled=!1,result=!0;y1<screentop?(scroller.scrollTop=Math.max(0,y1-2*lh),scrolled=!0):y2>screentop+screen&&(scroller.scrollTop=y2+lh-screen,scrolled=!0);var screenw=scroller.clientWidth,screenleft=scroller.scrollLeft,gutterw=options.fixedGutter?gutter.clientWidth:0;return x1<screenleft+gutterw?(x1<50&&(x1=0),scroller.scrollLeft=Math.max(0,x1-10-gutterw),scrolled=!0):x2>screenw+screenleft&&(scroller.scrollLeft=x2+10-screenw,scrolled=!0,x2>code.clientWidth&&(result=!1)),scrolled&&options.onScroll&&options.onScroll(instance),result}function visibleLines(){var lh=textHeight(),top=scroller.scrollTop-paddingTop(),from_height=Math.max(0,Math.floor(top/lh)),to_height=Math.ceil((top+scroller.clientHeight)/lh);return{from:lineAtHeight(doc,from_height),to:lineAtHeight(doc,to_height)}}function updateDisplay(changes){if(!scroller.clientWidth){showingFrom=showingTo=displayOffset=0;return}var visible=visibleLines();if(changes!==!0&&changes.length==0&&visible.from>=showingFrom&&visible.to<=showingTo)return;var from=Math.max(visible.from-100,0),to=Math.min(doc.size,visible.to+100);showingFrom<from&&from-showingFrom<20&&(from=showingFrom),showingTo>to&&showingTo-to<20&&(to=Math.min(doc.size,showingTo));var intact=changes===!0?[]:computeIntact([{from:showingFrom,to:showingTo,domStart:0}],changes),intactLines=0;for(var i=0;i<intact.length;++i){var range=intact[i];range.from<from&&(range.domStart+=from-range.from,range.from=from),range.to>to&&(range.to=to),range.from>=range.to?intact.splice(i--,1):intactLines+=range.to-range.from}if(intactLines==to-from)return;intact.sort(function(a,b){return a.domStart-b.domStart});var th=textHeight(),gutterDisplay=gutter.style.display;lineDiv.style.display=gutter.style.display="none",patchDisplay(from,to,intact),lineDiv.style.display="";var different=from!=showingFrom||to!=showingTo||lastHeight!=scroller.clientHeight;different&&(lastHeight=scroller.clientHeight),showingFrom=from,showingTo=to,displayOffset=heightAtLine(doc,from),mover.style.top=displayOffset*th+"px",code.style.height=doc.height*th+2*paddingTop()+"px";if(lineDiv.childNodes.length!=showingTo-showingFrom)throw new Error("BAD PATCH! "+JSON.stringify(intact)+" size="+(showingTo-showingFrom)+" nodes="+lineDiv.childNodes.length);if(options.lineWrapping){maxWidth=scroller.clientWidth;var curNode=lineDiv.firstChild;doc.iter(showingFrom,showingTo,function(line){if(!line.hidden){var height=Math.round(curNode.offsetHeight/th)||1;line.height!=height&&(updateLineHeight(line,height),gutterDirty=!0)}curNode=curNode.nextSibling})}else maxWidth==null&&(maxWidth=stringWidth(maxLine)),maxWidth>scroller.clientWidth?(lineSpace.style.width=maxWidth+"px",code.style.width="",code.style.width=scroller.scrollWidth+"px"):lineSpace.style.width=code.style.width="";gutter.style.display=gutterDisplay,(different||gutterDirty)&&updateGutter(),updateCursor()}function computeIntact(intact,changes){for(var i=0,l=changes.length||0;i<l;++i){var change=changes[i],intact2=[],diff=change.diff||0;for(var j=0,l2=intact.length;j<l2;++j){var range=intact[j];change.to<=range.from&&change.diff?intact2.push({from:range.from+diff,to:range.to+diff,domStart:range.domStart}):change.to<=range.from||change.from>=range.to?intact2.push(range):(change.from>range.from&&intact2.push({from:range.from,to:change.from,domStart:range.domStart}),change.to<range.to&&intact2.push({from:change.to+diff,to:range.to+diff,domStart:range.domStart+(change.to-range.from)}))}intact=intact2}return intact}function patchDisplay(from,to,intact){if(!intact.length)lineDiv.innerHTML="";else{function killNode(node){var tmp=node.nextSibling;return node.parentNode.removeChild(node),tmp}var domPos=0,curNode=lineDiv.firstChild,n;for(var i=0;i<intact.length;++i){var cur=intact[i];while(cur.domStart>domPos)curNode=killNode(curNode),domPos++;for(var j=0,e=cur.to-cur.from;j<e;++j)curNode=curNode.nextSibling,domPos++}while(curNode)curNode=killNode(curNode)}var nextIntact=intact.shift(),curNode=lineDiv.firstChild,j=from,sfrom=sel.from.line,sto=sel.to.line,inSel=sfrom<from&&sto>=from,scratch=targetDocument.createElement("div"),newElt;doc.iter(from,to,function(line){var ch1=null,ch2=null;inSel?(ch1=0,sto==j&&(inSel=!1,ch2=sel.to.ch)):sfrom==j&&(sto==j?(ch1=sel.from.ch,ch2=sel.to.ch):(inSel=!0,ch1=sel.from.ch)),nextIntact&&nextIntact.to==j&&(nextIntact=intact.shift()),!nextIntact||nextIntact.from>j?(line.hidden?scratch.innerHTML="<pre></pre>":scratch.innerHTML=line.getHTML(ch1,ch2,!0),lineDiv.insertBefore(scratch.firstChild,curNode)):curNode=curNode.nextSibling,++j})}function updateGutter(){if(!options.gutter&&!options.lineNumbers)return;var hText=mover.offsetHeight,hEditor=scroller.clientHeight;gutter.style.height=(hText-hEditor<2?hEditor:hText)+"px";var html=[],i=showingFrom;doc.iter(showingFrom,Math.max(showingTo,showingFrom+1),function(line){if(line.hidden)html.push("<pre></pre>");else{var marker=line.gutterMarker,text=options.lineNumbers?i+options.firstLineNumber:null;marker&&marker.text?text=marker.text.replace("%N%",text!=null?text:""):text==null&&(text=" "),html.push(marker&&marker.style?'<pre class="'+marker.style+'">':"<pre>",text);for(var j=1;j<line.height;++j)html.push("<br>&nbsp;");html.push("</pre>")}++i}),gutter.style.display="none",gutterText.innerHTML=html.join("");var minwidth=String(doc.size).length,firstNode=gutterText.firstChild,val=eltText(firstNode),pad="";while(val.length+pad.length<minwidth)pad+=" ";pad&&firstNode.insertBefore(targetDocument.createTextNode(pad),firstNode.firstChild),gutter.style.display="",lineSpace.style.marginLeft=gutter.offsetWidth+"px",gutterDirty=!1}function updateCursor(){var head=sel.inverted?sel.from:sel.to,lh=textHeight(),pos=localCoords(head,!0),globalY=pos.y+displayOffset*textHeight();inputDiv.style.top=Math.max(Math.min(globalY,scroller.offsetHeight),0)+"px",inputDiv.style.left=pos.x-scroller.scrollLeft+"px",posEq(sel.from,sel.to)?(cursor.style.top=pos.y+"px",cursor.style.left=(options.lineWrapping?Math.min(pos.x,lineSpace.offsetWidth):pos.x)+"px",cursor.style.display=""):cursor.style.display="none"}function setSelectionUser(from,to){var sh=shiftSelecting&&clipPos(shiftSelecting);sh&&(posLess(sh,from)?from=sh:posLess(to,sh)&&(to=sh)),setSelection(from,to)}function setSelection(from,to,oldFrom,oldTo){oldFrom==null&&(oldFrom=sel.from.line,oldTo=sel.to.line);if(posEq(sel.from,from)&&posEq(sel.to,to))return;if(posLess(to,from)){var tmp=to;to=from,from=tmp}from.line!=oldFrom&&(from=skipHidden(from,oldFrom,sel.from.ch)),to.line!=oldTo&&(to=skipHidden(to,oldTo,sel.to.ch)),posEq(from,to)?sel.inverted=!1:posEq(from,sel.to)?sel.inverted=!1:posEq(to,sel.from)&&(sel.inverted=!0),posEq(from,to)?posEq(sel.from,sel.to)||changes.push({from:oldFrom,to:oldTo+1}):posEq(sel.from,sel.to)?changes.push({from:from.line,to:to.line+1}):(posEq(from,sel.from)||(from.line<oldFrom?changes.push({from:from.line,to:Math.min(to.line,oldFrom)+1}):changes.push({from:oldFrom,to:Math.min(oldTo,from.line)+1})),posEq(to,sel.to)||(to.line<oldTo?changes.push({from:Math.max(oldFrom,from.line),to:oldTo+1}):changes.push({from:Math.max(from.line,oldTo),to:to.line+1}))),sel.from=from,sel.to=to,selectionChanged=!0}function skipHidden(pos,oldLine,oldCh){function getNonHidden(dir){var lNo=pos.line+dir,end=dir==1?doc.size:-1;while(lNo!=end){var line=getLine(lNo);if(!line.hidden){var ch=pos.ch;if(ch>oldCh||ch>line.text.length)ch=line.text.length;return{line:lNo,ch:ch}}lNo+=dir}}var line=getLine(pos.line);return line.hidden?pos.line>=oldLine?getNonHidden(1)||getNonHidden(-1):getNonHidden(-1)||getNonHidden(1):pos}function setCursor(line,ch,user){var pos=clipPos({line:line,ch:ch||0});(user?setSelectionUser:setSelection)(pos,pos)}function clipLine(n){return Math.max(0,Math.min(n,doc.size-1))}function clipPos(pos){if(pos.line<0)return{line:0,ch:0};if(pos.line>=doc.size)return{line:doc.size-1,ch:getLine(doc.size-1).text.length};var ch=pos.ch,linelen=getLine(pos.line).text.length;return ch==null||ch>linelen?{line:pos.line,ch:linelen}:ch<0?{line:pos.line,ch:0}:pos}function scrollPage(down){var linesPerPage=Math.floor(scroller.clientHeight/textHeight()),head=sel.inverted?sel.from:sel.to,target=heightAtLine(doc,head.line)+Math.max(linesPerPage-1,1)*(down?1:-1);setCursor(lineAtHeight(doc,target),head.ch,!0)}function scrollEnd(top){var pos=top?{line:0,ch:0}:{line:doc.size-1,ch:getLine(doc.size-1).text.length};setSelectionUser(pos,pos)}function selectAll(){var endLine=doc.size-1;setSelection({line:0,ch:0},{line:endLine,ch:getLine(endLine).text.length})}function selectWordAt(pos){var line=getLine(pos.line).text,start=pos.ch,end=pos.ch;while(start>0&&/\w/.test(line.charAt(start-1)))--start;while(end<line.length&&/\w/.test(line.charAt(end)))++end;setSelectionUser({line:pos.line,ch:start},{line:pos.line,ch:end})}function selectLine(line){setSelectionUser({line:line,ch:0},{line:line,ch:getLine(line).text.length})}function handleEnter(){replaceSelection("\n","end"),options.enterMode!="flat"&&indentLine(sel.from.line,options.enterMode=="keep"?"prev":"smart")}function handleTab(shift){function indentSelected(mode){if(posEq(sel.from,sel.to))return indentLine(sel.from.line,mode);var e=sel.to.line-(sel.to.ch?0:1);for(var i=sel.from.line;i<=e;++i)indentLine(i,mode)}shiftSelecting=null;switch(options.tabMode){case"default":return!1;case"indent":indentSelected("smart");break;case"classic":if(posEq(sel.from,sel.to)){shift?indentLine(sel.from.line,"smart"):replaceSelection("	","end");break};case"shift":indentSelected(shift?"subtract":"add")}return!0}function smartHome(){var firstNonWS=Math.max(0,getLine(sel.from.line).text.search(/\S/));setCursor(sel.from.line,sel.from.ch<=firstNonWS&&sel.from.ch?0:firstNonWS,!0)}function indentLine(n,how){if(how=="smart")if(!mode.indent)how="prev";else var state=getStateBefore(n);var line=getLine(n),curSpace=line.indentation(),curSpaceString=line.text.match(/^\s*/)[0],indentation;how=="prev"?n?indentation=getLine(n-1).indentation():indentation=0:how=="smart"?indentation=mode.indent(state,line.text.slice(curSpaceString.length)):how=="add"?indentation=curSpace+options.indentUnit:how=="subtract"&&(indentation=curSpace-options.indentUnit),indentation=Math.max(0,indentation);var diff=indentation-curSpace;if(!diff){if(sel.from.line!=n&&sel.to.line!=n)return;var indentString=curSpaceString}else{var indentString="",pos=0;if(options.indentWithTabs)for(var i=Math.floor(indentation/tabSize);i;--i)pos+=tabSize,indentString+="	";while(pos<indentation)++pos,indentString+=" "}replaceRange(indentString,{line:n,ch:0},{line:n,ch:curSpaceString.length})}function loadMode(){mode=CodeMirror.getMode(options,options.mode),doc.iter(0,doc.size,function(line){line.stateAfter=null}),work=[0],startWorker()}function gutterChanged(){var visible=options.gutter||options.lineNumbers;gutter.style.display=visible?"":"none",visible?gutterDirty=!0:lineDiv.parentNode.style.marginLeft=0}function wrappingChanged(from,to){if(options.lineWrapping){wrapper.className+=" CodeMirror-wrap";var perLine=scroller.clientWidth/charWidth()-3;doc.iter(0,doc.size,function(line){if(line.hidden)return;var guess=Math.ceil(line.text.length/perLine)||1;guess!=1&&updateLineHeight(line,guess)}),lineSpace.style.width=code.style.width=""}else wrapper.className=wrapper.className.replace(" CodeMirror-wrap",""),maxWidth=null,maxLine="",doc.iter(0,doc.size,function(line){line.height!=1&&!line.hidden&&updateLineHeight(line,1),line.text.length>maxLine.length&&(maxLine=line.text)});changes.push({from:0,to:doc.size})}function TextMarker(){this.set=[]}function markText(from,to,className){function add(line,from,to,className){mark=getLine(line).addMark(new MarkedText(from,to,className,tm.set))}from=clipPos(from),to=clipPos(to);var tm=new TextMarker;if(from.line==to.line)add(from.line,from.ch,to.ch,className);else{add(from.line,from.ch,null,className);for(var i=from.line+1,e=to.line;i<e;++i)add(i,null,null,className);add(to.line,null,to.ch,className)}return changes.push({from:from.line,to:to.line+1}),tm}function setBookmark(pos){pos=clipPos(pos);var bm=new Bookmark(pos.ch);return getLine(pos.line).addMark(bm),bm}function addGutterMarker(line,text,className){return typeof line=="number"&&(line=getLine(clipLine(line))),line.gutterMarker={text:text,style:className},gutterDirty=!0,line}function removeGutterMarker(line){typeof line=="number"&&(line=getLine(clipLine(line))),line.gutterMarker=null,gutterDirty=!0}function changeLine(handle,op){var no=handle,line=handle;return typeof handle=="number"?line=getLine(clipLine(handle)):no=lineNo(handle),no==null?null:(op(line,no)&&changes.push({from:no,to:no+1}),line)}function setLineClass(handle,className){return changeLine(handle,function(line){if(line.className!=className)return line.className=className,!0})}function setLineHidden(handle,hidden){return changeLine(handle,function(line,no){if(line.hidden!=hidden)return line.hidden=hidden,updateLineHeight(line,hidden?0:1),hidden&&(sel.from.line==no||sel.to.line==no)&&setSelection(skipHidden(sel.from,sel.from.line,sel.from.ch),skipHidden(sel.to,sel.to.line,sel.to.ch)),gutterDirty=!0})}function lineInfo(line){if(typeof line=="number"){if(!isLine(line))return null;var n=line;line=getLine(line);if(!line)return null}else{var n=lineNo(line);if(n==null)return null}var marker=line.gutterMarker;return{line:n,handle:line,text:line.text,markerText:marker&&marker.text,markerClass:marker&&marker.style,lineClass:line.className}}function stringWidth(str){return measure.innerHTML="<pre><span>x</span></pre>",measure.firstChild.firstChild.firstChild.nodeValue=str,measure.firstChild.firstChild.offsetWidth||10}function charFromX(line,x){function getX(len){return measure.innerHTML="<pre><span>"+lineObj.getHTML(null,null,!1,len)+"</span></pre>",measure.firstChild.firstChild.offsetWidth}if(x<=0)return 0;var lineObj=getLine(line),text=lineObj.text,from=0,fromX=0,to=text.length,toX,estimated=Math.min(to,Math.ceil(x/charWidth()));for(;;){var estX=getX(estimated);if(!(estX<=x&&estimated<to)){toX=estX,to=estimated;break}estimated=Math.min(to,Math.ceil(estimated*1.2))}if(x>toX)return to;estimated=Math.floor(to*.8),estX=getX(estimated),estX<x&&(from=estimated,fromX=estX);for(;;){if(to-from<=1)return toX-x>x-fromX?from:to;var middle=Math.ceil((from+to)/2),middleX=getX(middle);middleX>x?(to=middle,toX=middleX):(from=middle,fromX=middleX)}}function measureLine(line,ch){var extra="";if(options.lineWrapping){var end=line.text.indexOf(" ",ch+2);extra=line.text.slice(ch+1,end<0?line.text.length:end+(ie?5:0))}measure.innerHTML="<pre>"+line.getHTML(null,null,!1,ch)+'<span id="CodeMirror-temp-'+tempId+'">'+(line.text.charAt(ch)||" ")+"</span>"+extra+"</pre>";var elt=document.getElementById("CodeMirror-temp-"+tempId),top=elt.offsetTop,left=elt.offsetLeft;if(ie&&ch&&top==0&&left==0){var backup=document.createElement("span");backup.innerHTML="x",elt.parentNode.insertBefore(backup,elt.nextSibling),top=backup.offsetTop}return{top:top,left:left}}function localCoords(pos,inLineWrap){var x,lh=textHeight(),y=lh*(heightAtLine(doc,pos.line)-(inLineWrap?displayOffset:0));if(pos.ch==0)x=0;else{var sp=measureLine(getLine(pos.line),pos.ch);x=sp.left,options.lineWrapping&&(y+=Math.max(0,sp.top))}return{x:x,y:y,yBot:y+lh}}function coordsChar(x,y){function getX(len){var sp=measureLine(lineObj,len);if(tw){var off=Math.round(sp.top/th);return Math.max(0,sp.left+(off-innerOff)*scroller.clientWidth)}return sp.left}y<0&&(y=0);var th=textHeight(),cw=charWidth(),heightPos=displayOffset+Math.floor(y/th),lineNo=lineAtHeight(doc,heightPos);if(lineNo>=doc.size)return{line:doc.size-1,ch:0};var lineObj=getLine(lineNo),text=lineObj.text,tw=options.lineWrapping,innerOff=tw?heightPos-heightAtLine(doc,lineNo):0;if(x<=0&&innerOff==0)return{line:lineNo,ch:0};var from=0,fromX=0,to=text.length,toX,estimated=Math.min(to,Math.ceil((x+innerOff*scroller.clientWidth*.9)/cw));for(;;){var estX=getX(estimated);if(!(estX<=x&&estimated<to)){toX=estX,to=estimated;break}estimated=Math.min(to,Math.ceil(estimated*1.2))}if(x>toX)return{line:lineNo,ch:to};estimated=Math.floor(to*.8),estX=getX(estimated),estX<x&&(from=estimated,fromX=estX);for(;;){if(to-from<=1)return{line:lineNo,ch:toX-x>x-fromX?from:to};var middle=Math.ceil((from+to)/2),middleX=getX(middle);middleX>x?(to=middle,toX=middleX):(from=middle,fromX=middleX)}}function pageCoords(pos){var local=localCoords(pos,!0),off=eltOffset(lineSpace);return{x:off.left+local.x,y:off.top+local.y,yBot:off.top+local.yBot}}function textHeight(){var offsetHeight=lineDiv.offsetHeight;return offsetHeight==cachedFor?cachedHeight:(cachedFor=offsetHeight,measure.innerHTML="<pre>x<br>x<br>x<br>x<br>x<br>x<br>x<br>x<br>x<br>x</pre>",cachedHeight=measure.firstChild.offsetHeight/10||1)}function charWidth(){return scroller.clientWidth==cachedFor?cachedWidth:(cachedFor=scroller.clientWidth,cachedWidth=stringWidth("x"))}function paddingTop(){return lineSpace.offsetTop}function paddingLeft(){return lineSpace.offsetLeft}function posFromMouse(e,liberal){var offW=eltOffset(scroller,!0),x,y;try{x=e.clientX,y=e.clientY}catch(e){return null}if(!liberal&&(x-offW.left>scroller.clientWidth||y-offW.top>scroller.clientHeight))return null;var offL=eltOffset(lineSpace,!0);return coordsChar(x-offL.left,y-offL.top)}function onContextMenu(e){function rehide(){var newVal=splitLines(input.value).join("\n");newVal!=val&&operation(replaceSelection)(newVal,"end"),inputDiv.style.position="relative",input.style.cssText=oldCSS,leaveInputAlone=!1,prepareInput(),slowPoll()}var pos=posFromMouse(e);if(!pos||window.opera)return;(posEq(sel.from,sel.to)||posLess(pos,sel.from)||!posLess(pos,sel.to))&&operation(setCursor)(pos.line,pos.ch);var oldCSS=input.style.cssText;inputDiv.style.position="absolute",input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; "+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",leaveInputAlone=!0;var val=input.value=getSelection();focusInput(),setSelRange(input,0,input.value.length);if(gecko){e_stop(e);var mouseup=connect(window,"mouseup",function(){mouseup(),setTimeout(rehide,20)},!0)}else setTimeout(rehide,50)}function restartBlink(){clearInterval(blinker);var on=!0;cursor.style.visibility="",blinker=setInterval(function(){cursor.style.visibility=(on=!on)?"":"hidden"},650)}function matchBrackets(autoclear){function scan(line,from,to){if(!line.text)return;var st=line.styles,pos=forward?0:line.text.length-1,cur;for(var i=forward?0:st.length-2,e=forward?st.length:-2;i!=e;i+=2*d){var text=st[i];if(st[i+1]!=null&&st[i+1]!=style){pos+=d*text.length;continue}for(var j=forward?0:text.length-1,te=forward?text.length:-1;j!=te;j+=d,pos+=d)if(pos>=from&&pos<to&&re.test(cur=text.charAt(j))){var match=matching[cur];if(match.charAt(1)==">"==forward)stack.push(cur);else{if(stack.pop()!=match.charAt(0))return{pos:pos,match:!1};if(!stack.length)return{pos:pos,match:!0}}}}}var head=sel.inverted?sel.from:sel.to,line=getLine(head.line),pos=head.ch-1,match=pos>=0&&matching[line.text.charAt(pos)]||matching[line.text.charAt(++pos)];if(!match)return;var ch=match.charAt(0),forward=match.charAt(1)==">",d=forward?1:-1,st=line.styles;for(var off=pos+1,i=0,e=st.length;i<e;i+=2)if((off-=st[i].length)<=0){var style=st[i+1];break}var stack=[line.text.charAt(pos)],re=/[(){}[\]]/;for(var i=head.line,e=forward?Math.min(i+100,doc.size):Math.max(-1,i-100);i!=e;i+=d){var line=getLine(i),first=i==head.line,found=scan(line,first&&forward?pos+1:0,first&&!forward?pos:line.text.length);if(found)break}found||(found={pos:null,match:!1});var style=found.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",one=markText({line:head.line,ch:pos},{line:head.line,ch:pos+1},style),two=found.pos!=null&&markText({line:i,ch:found.pos},{line:i,ch:found.pos+1},style),clear=operation(function(){one.clear(),two&&two.clear()});autoclear?setTimeout(clear,800):bracketHighlighted=clear}function findStartLine(n){var minindent,minline;for(var search=n,lim=n-40;search>lim;--search){if(search==0)return 0;var line=getLine(search-1);if(line.stateAfter)return search;var indented=line.indentation();if(minline==null||minindent>indented)minline=search-1,minindent=indented}return minline}function getStateBefore(n){var start=findStartLine(n),state=start&&getLine(start-1).stateAfter;return state?state=copyState(mode,state):state=startState(mode),doc.iter(start,n,function(line){line.highlight(mode,state),line.stateAfter=copyState(mode,state)}),start<n&&changes.push({from:start,to:n}),n<doc.size&&!getLine(n).stateAfter&&work.push(n),state}function highlightLines(start,end){var state=getStateBefore(start);doc.iter(start,end,function(line){line.highlight(mode,state),line.stateAfter=copyState(mode,state)})}function highlightWorker(){var end=+(new Date)+options.workTime,foundWork=work.length;while(work.length){if(!getLine(showingFrom).stateAfter)var task=showingFrom;else var task=work.pop();if(task>=doc.size)continue;var start=findStartLine(task),state=start&&getLine(start-1).stateAfter;state?state=copyState(mode,state):state=startState(mode);var unchanged=0,compare=mode.compareStates,realChange=!1,i=start,bail=!1;doc.iter(i,doc.size,function(line){var hadState=line.stateAfter;if(+(new Date)>end)return work.push(i),startWorker(options.workDelay),realChange&&changes.push({from:task,to:i+1}),bail=!0;var changed=line.highlight(mode,state);changed&&(realChange=!0),line.stateAfter=copyState(mode,state);if(compare){if(hadState&&compare(hadState,state))return!0}else if(changed!==!1||!hadState)unchanged=0;else if(++unchanged>3)return!0;++i});if(bail)return;realChange&&changes.push({from:task,to:i+1})}foundWork&&options.onHighlightComplete&&options.onHighlightComplete(instance)}function startWorker(time){if(!work.length)return;highlight.set(time,operation(highlightWorker))}function startOperation(){updateInput=null,changes=[],textChanged=selectionChanged=!1}function endOperation(){var reScroll=!1;selectionChanged&&(reScroll=!scrollCursorIntoView()),changes.length?updateDisplay(changes):(selectionChanged&&updateCursor(),gutterDirty&&updateGutter()),reScroll&&scrollCursorIntoView(),selectionChanged&&(scrollEditorIntoView(),restartBlink()),focused&&!leaveInputAlone&&(updateInput===!0||updateInput!==!1&&selectionChanged)&&prepareInput(),selectionChanged&&options.matchBrackets&&setTimeout(operation(function(){bracketHighlighted&&(bracketHighlighted(),bracketHighlighted=null),matchBrackets(!1)}),20);var tc=textChanged;selectionChanged&&options.onCursorActivity&&options.onCursorActivity(instance),tc&&options.onChange&&instance&&options.onChange(instance,tc)}function operation(f){return function(){nestedOperation++||startOperation();try{var result=f.apply(this,arguments)}finally{--nestedOperation||endOperation()}return result}}function SearchCursor(query,pos,caseFold){this.atOccurrence=!1,caseFold==null&&(caseFold=typeof query=="string"&&query==query.toLowerCase()),pos&&typeof pos=="object"?pos=clipPos(pos):pos={line:0,ch:0},this.pos={from:pos,to:pos};if(typeof query!="string")this.matches=function(reverse,pos){if(reverse){var line=getLine(pos.line).text.slice(0,pos.ch),match=line.match(query),start=0;while(match){var ind=line.indexOf(match[0]);start+=ind,line=line.slice(ind+1);var newmatch=line.match(query);if(!newmatch)break;match=newmatch,start++}}else var line=getLine(pos.line).text.slice(pos.ch),match=line.match(query),start=match&&pos.ch+line.indexOf(match[0]);if(match)return{from:{line:pos.line,ch:start},to:{line:pos.line,ch:start+match[0].length},match:match}};else{caseFold&&(query=query.toLowerCase());var fold=caseFold?function(str){return str.toLowerCase()}:function(str){return str},target=query.split("\n");target.length==1?this.matches=function(reverse,pos){var line=fold(getLine(pos.line).text),len=query.length,match;if(reverse?pos.ch>=len&&(match=line.lastIndexOf(query,pos.ch-len))!=-1:(match=line.indexOf(query,pos.ch))!=-1)return{from:{line:pos.line,ch:match},to:{line:pos.line,ch:match+len}}}:this.matches=function(reverse,pos){var ln=pos.line,idx=reverse?target.length-1:0,match=target[idx],line=fold(getLine(ln).text),offsetA=reverse?line.indexOf(match)+match.length:line.lastIndexOf(match);if(reverse?offsetA>=pos.ch||offsetA!=match.length:offsetA<=pos.ch||offsetA!=line.length-match.length)return;for(;;){if(reverse?!ln:ln==doc.size-1)return;line=fold(getLine(ln+=reverse?-1:1).text),match=target[reverse?--idx:++idx];if(idx>0&&idx<target.length-1){if(line!=match)return;continue}var offsetB=reverse?line.lastIndexOf(match):line.indexOf(match)+match.length;if(reverse?offsetB!=line.length-match.length:offsetB!=match.length)return;var start={line:pos.line,ch:offsetA},end={line:ln,ch:offsetB};return{from:reverse?end:start,to:reverse?start:end}}}}}var options={},defaults=CodeMirror.defaults;for(var opt in defaults)defaults.hasOwnProperty(opt)&&(options[opt]=(givenOptions&&givenOptions.hasOwnProperty(opt)?givenOptions:defaults)[opt]);var targetDocument=options.document,wrapper=targetDocument.createElement("div");wrapper.className="CodeMirror"+(options.lineWrapping?" CodeMirror-wrap":""),wrapper.innerHTML='<div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 10000px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-'+options.theme+'">'+'<div style="position: relative">'+'<div style="position: relative">'+'<div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div>'+'<div class="CodeMirror-lines"><div style="position: relative">'+'<div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden"></div>'+'<pre class="CodeMirror-cursor">&#160;</pre>'+"<div></div>"+"</div></div></div></div></div>",place.appendChild?place.appendChild(wrapper):place(wrapper);var inputDiv=wrapper.firstChild,input=inputDiv.firstChild,scroller=wrapper.lastChild,code=scroller.firstChild,mover=code.firstChild,gutter=mover.firstChild,gutterText=gutter.firstChild,lineSpace=gutter.nextSibling.firstChild,measure=lineSpace.firstChild,cursor=measure.nextSibling,lineDiv=cursor.nextSibling;webkit||(lineSpace.draggable=!0),options.tabindex!=null&&(input.tabindex=options.tabindex),!options.gutter&&!options.lineNumbers&&(gutter.style.display="none");try{stringWidth("x")}catch(e){throw e.message.match(/unknown runtime/i)&&(e=new Error("A CodeMirror inside a P-style element does not work in Internet Explorer. (innerHTML bug)")),e}var poll=new Delayed,highlight=new Delayed,blinker,mode,doc=new BranchChunk([new LeafChunk([new Line("")])]),work,focused;loadMode();var sel={from:{line:0,ch:0},to:{line:0,ch:0},inverted:!1},shiftSelecting,reducedSelection,lastClick,lastDoubleClick,draggingText,updateInput,changes,textChanged,selectionChanged,leaveInputAlone,gutterDirty,displayOffset=0,showingFrom=0,showingTo=0,lastHeight=0,curKeyId=null,editing,bracketHighlighted,maxLine="",maxWidth;operation(function(){setValue(options.value||""),updateInput=!1})();var history=new History,slowPollInterval=2e3,alwaysPollForIME=!win&&!mac&&(gecko||window.opera);options.pollForIME&&alwaysPollForIME&&(slowPollInterval=50),connect(scroller,"mousedown",operation(onMouseDown)),connect(scroller,"dblclick",operation(onDoubleClick)),connect(lineSpace,"dragstart",onDragStart),connect(lineSpace,"selectstart",e_preventDefault),gecko||connect(scroller,"contextmenu",onContextMenu),connect(scroller,"scroll",function(){updateDisplay([]),options.fixedGutter&&(gutter.style.left=scroller.scrollLeft+"px"),options.onScroll&&options.onScroll(instance)}),connect(window,"resize",function(){updateDisplay(!0)}),connect(input,"keyup",operation(onKeyUp)),connect(input,"input",function(){fastPoll(curKeyId)}),connect(input,"keydown",operation(onKeyDown)),connect(input,"keypress",operation(onKeyPress)),connect(input,"focus",onFocus),connect(input,"blur",onBlur),connect(scroller,"dragenter",e_stop),connect(scroller,"dragover",e_stop),connect(scroller,"drop",operation(onDrop)),connect(scroller,"paste",function(){focusInput(),fastPoll()}),connect(input,"paste",function(){fastPoll()}),connect(input,"cut",function(){fastPoll()});var hasFocus;try{hasFocus=targetDocument.activeElement==input}catch(e){}hasFocus?setTimeout(onFocus,20):onBlur();var instance=wrapper.CodeMirror={getValue:getValue,setValue:operation(setValue),getSelection:getSelection,replaceSelection:operation(replaceSelection),focus:function(){focusInput(),onFocus(),fastPoll()},setOption:function(option,value){var oldVal=options[option];options[option]=value,option=="mode"||option=="indentUnit"?loadMode():option=="readOnly"&&value=="nocursor"?input.blur():option=="theme"?scroller.className=scroller.className.replace(/cm-s-\w+/,"cm-s-"+value):option=="lineWrapping"&&oldVal!=value?operation(wrappingChanged)():option=="pollForIME"&&alwaysPollForIME&&(slowPollInterval=value?50:2e3),(option=="lineNumbers"||option=="gutter"||option=="firstLineNumber"||option=="theme")&&operation(gutterChanged)()},getOption:function(option){return options[option]},undo:operation(undo),redo:operation(redo),indentLine:operation(function(n,dir){isLine(n)&&indentLine(n,dir==null?"smart":dir?"add":"subtract")}),historySize:function(){return{undo:history.done.length,redo:history.undone.length}},clearHistory:function(){history=new History},matchBrackets:operation(function(){matchBrackets(!0)}),getTokenAt:operation(function(pos){return pos=clipPos(pos),getLine(pos.line).getTokenAt(mode,getStateBefore(pos.line),pos.ch)}),getStateAfter:function(line){return line=clipLine(line==null?doc.size-1:line),getStateBefore(line+1)},cursorCoords:function(start){return start==null&&(start=sel.inverted),pageCoords(start?sel.from:sel.to)},charCoords:function(pos){return pageCoords(clipPos(pos))},coordsChar:function(coords){var off=eltOffset(lineSpace);return coordsChar(coords.x-off.left,coords.y-off.top)},getSearchCursor:function(query,pos,caseFold){return new SearchCursor(query,pos,caseFold)},markText:operation(markText),setBookmark:setBookmark,setMarker:operation(addGutterMarker),clearMarker:operation(removeGutterMarker),setLineClass:operation(setLineClass),hideLine:operation(function(h){return setLineHidden(h,!0)}),showLine:operation(function(h){return setLineHidden(h,!1)}),lineInfo:lineInfo,addWidget:function(pos,node,scroll,vert,horiz){pos=localCoords(clipPos(pos));var top=pos.yBot,left=pos.x;node.style.position="absolute",code.appendChild(node);if(vert=="over")top=pos.y;else if(vert=="near"){var vspace=Math.max(scroller.offsetHeight,doc.height*textHeight()),hspace=Math.max(code.clientWidth,lineSpace.clientWidth)-paddingLeft();pos.yBot+node.offsetHeight>vspace&&pos.y>node.offsetHeight&&(top=pos.y-node.offsetHeight),left+node.offsetWidth>hspace&&(left=hspace-node.offsetWidth)}node.style.top=top+paddingTop()+"px",node.style.left=node.style.right="",horiz=="right"?(left=code.clientWidth-node.offsetWidth,node.style.right="0px"):(horiz=="left"?left=0:horiz=="middle"&&(left=(code.clientWidth-node.offsetWidth)/2),node.style.left=left+paddingLeft()+"px"),scroll&&scrollIntoView(left,top,left+node.offsetWidth,top+node.offsetHeight)},lineCount:function(){return doc.size},getCursor:function(start){return start==null&&(start=sel.inverted),copyPos(start?sel.from:sel.to)},somethingSelected:function(){return!posEq(sel.from,sel.to)},setCursor:operation(function(line,ch){ch==null&&typeof line.line=="number"?setCursor(line.line,line.ch):setCursor(line,ch)}),setSelection:operation(function(from,to){setSelection(clipPos(from),clipPos(to||from))}),getLine:function(line){if(isLine(line))return getLine(line).text},setLine:operation(function(line,text){isLine(line)&&replaceRange(text,{line:line,ch:0},{line:line,ch:getLine(line).text.length})}),removeLine:operation(function(line){isLine(line)&&replaceRange("",{line:line,ch:0},clipPos({line:line+1,ch:0}))}),replaceRange:operation(replaceRange),getRange:function(from,to){return getRange(clipPos(from),clipPos(to))},coordsFromIndex:function(off){var lineNo=0,ch;return doc.iter(0,doc.size,function(line){var sz=line.text.length+1;if(sz>off)return ch=off,!0;off-=sz,++lineNo}),clipPos({line:lineNo,ch:ch})},operation:function(f){return operation(f)()},refresh:function(){updateDisplay(!0)},getInputField:function(){return input},getWrapperElement:function(){return wrapper},getScrollerElement:function(){return scroller},getGutterElement:function(){return gutter}},pollingFast=!1;TextMarker.prototype.clear=operation(function(){for(var i=0,e=this.set.length;i<e;++i){var mk=this.set[i].marked;if(!mk)continue;for(var j=0;j<mk.length;++j)mk[j].set==this.set&&mk.splice(j--,1)}changes.push({from:0,to:doc.size})}),TextMarker.prototype.find=function(){var from,to;for(var i=0,e=this.set.length;i<e;++i){var line=this.set[i],mk=line.marked;for(var j=0;j<mk.length;++j){var mark=mk[j];if(mark.set==this.set)if(mark.from!=null||mark.to!=null){var found=lineNo(line);found!=null&&(mark.from!=null&&(from={line:found,ch:mark.from}),mark.to!=null&&(to={line:found,ch:mark.to}))}}}return{from:from,to:to}};var tempId=Math.floor(Math.random()*16777215).toString(16),cachedHeight,cachedFor,cachedWidth,cachedFor=0,matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},nestedOperation=0;SearchCursor.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(reverse){function savePosAndFail(line){var pos={line:line,ch:0};return self.pos={from:pos,to:pos},self.atOccurrence=!1,!1}var self=this,pos=clipPos(reverse?this.pos.from:this.pos.to);for(;;){if(this.pos=this.matches(reverse,pos))return this.atOccurrence=!0,this.pos.match||!0;if(reverse){if(!pos.line)return savePosAndFail(0);pos={line:pos.line-1,ch:getLine(pos.line-1).text.length}}else{if(pos.line==doc.size-1)return savePosAndFail(doc.size);pos={line:pos.line+1,ch:0}}}},from:function(){if(this.atOccurrence)return copyPos(this.pos.from)},to:function(){if(this.atOccurrence)return copyPos(this.pos.to)},replace:function(newText){var self=this;this.atOccurrence&&operation(function(){self.pos.to=replaceRange(newText,self.pos.from,self.pos.to)})()}};for(var ext in extensions)extensions.propertyIsEnumerable(ext)&&!instance.propertyIsEnumerable(ext)&&(instance[ext]=extensions[ext]);return instance}function copyState(mode,state){if(state===!0)return state;if(mode.copyState)return mode.copyState(state);var nstate={};for(var n in state){var val=state[n];val instanceof Array&&(val=val.concat([])),nstate[n]=val}return nstate}function startState(mode,a1,a2){return mode.startState?mode.startState(a1,a2):!0}function StringStream(string){this.pos=this.start=0,this.string=string}function MarkedText(from,to,className,set){this.from=from,this.to=to,this.style=className,this.set=set}function Bookmark(pos){this.from=pos,this.to=pos,this.line=null}function Line(text,styles){this.styles=styles||[text,null],this.text=text,this.height=1,this.marked=this.gutterMarker=this.className=null,this.stateAfter=this.parent=this.hidden=null}function copyStyles(from,to,source,dest){for(var i=0,pos=0,state=0;pos<to;i+=2){var part=source[i],end=pos+part.length;state==0?(end>from&&dest.push(part.slice(from-pos,Math.min(part.length,to-pos)),source[i+1]),end>=from&&(state=1)):state==1&&(end>to?dest.push(part.slice(0,to-pos),source[i+1]):dest.push(part,source[i+1])),pos=end}}function LeafChunk(lines){this.lines=lines,this.parent=null;for(var i=0,e=lines.length,height=0;i<e;++i)lines[i].parent=this,height+=lines[i].height;this.height=height}function BranchChunk(children){this.children=children;var size=0,height=0;for(var i=0,e=children.length;i<e;++i){var ch=children[i];size+=ch.chunkSize(),height+=ch.height,ch.parent=this}this.size=size,this.height=height,this.parent=null}function getLineAt(chunk,n){for(;;){for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;break}n-=sz}if(chunk.lines)return chunk.lines[n]}}function lineNo(line){if(line.parent==null)return null;var cur=line.parent,no=indexOf(cur.lines,line);for(var chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent)for(var i=0,e=chunk.children.length;;++i){if(chunk.children[i]==cur)break;no+=chunk.children[i].chunkSize()}return no}function lineAtHeight(chunk,h){var n=0;e:do{for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],ch=child.height;if(h<ch){chunk=child;continue e}h-=ch,n+=child.chunkSize()}return n}while(!chunk.lines);for(var i=0,e=chunk.lines.length;i<e;++i){var line=chunk.lines[i],lh=line.height;if(h<lh)break;h-=lh}return n+i}function heightAtLine(chunk,n){var h=0;e:do{for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;continue e}n-=sz,h+=child.height}return h}while(!chunk.lines);for(var i=0;i<n;++i)h+=chunk.lines[i].height;return h}function History(){this.time=0,this.done=[],this.undone=[]}function stopMethod(){e_stop(this)}function addStop(event){return event.stop||(event.stop=stopMethod),event}function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}function e_target(e){return e.target||e.srcElement}function e_button(e){if(e.which)return e.which;if(e.button&1)return 1;if(e.button&2)return 3;if(e.button&4)return 2}function connect(node,type,handler,disconnect){function wrapHandler(event){handler(event||window.event)}if(typeof node.addEventListener=="function"){node.addEventListener(type,wrapHandler,!1);if(disconnect)return function(){node.removeEventListener(type,wrapHandler,!1)}}else{node.attachEvent("on"+type,wrapHandler);if(disconnect)return function(){node.detachEvent("on"+type,wrapHandler)}}}function Delayed(){this.id=null}function countColumn(string,end){end==null&&(end=string.search(/[^\s\u00a0]/),end==-1&&(end=string.length));for(var i=0,n=0;i<end;++i)string.charAt(i)=="	"?n+=tabSize-n%tabSize:++n;return n}function computedStyle(elt){return elt.currentStyle?elt.currentStyle:window.getComputedStyle(elt,null)}function eltOffset(node,screen){var bod=node.ownerDocument.body,x=0,y=0,skipBody=!1;for(var n=node;n;n=n.offsetParent){var ol=n.offsetLeft,ot=n.offsetTop;n==bod?(x+=Math.abs(ol),y+=Math.abs(ot)):(x+=ol,y+=ot),screen&&computedStyle(n).position=="fixed"&&(skipBody=!0)}var e=screen&&!skipBody?null:bod;for(var n=node.parentNode;n!=e;n=n.parentNode)n.scrollLeft!=null&&(x-=n.scrollLeft,y-=n.scrollTop);return{left:x,top:y}}function eltText(node){return node.textContent||node.innerText||node.nodeValue||""}function posEq(a,b){return a.line==b.line&&a.ch==b.ch}function posLess(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch}function copyPos(x){return{line:x.line,ch:x.ch}}function htmlEscape(str){return badTextContent?(escapeElement.innerHTML="",escapeElement.appendChild(document.createTextNode(str))):escapeElement.textContent=str,escapeElement.innerHTML}function editEnd(from,to){if(!to)return from?from.length:0;if(!from)return to.length;for(var i=from.length,j=to.length;i>=0&&j>=0;--i,--j)if(from.charAt(i)!=to.charAt(j))break;return j+1}function indexOf(collection,elt){if(collection.indexOf)return collection.indexOf(elt);for(var i=0,e=collection.length;i<e;++i)if(collection[i]==elt)return i;return-1}CodeMirror.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:!1,tabMode:"classic",enterMode:"indent",electricChars:!0,onKeyEvent:null,lineWrapping:!1,lineNumbers:!1,gutter:!1,fixedGutter:!1,firstLineNumber:1,readOnly:!1,smartHome:!0,onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:!1,workTime:100,workDelay:200,undoDepth:40,tabindex:null,pollForIME:!1,document:window.document};var modes={},mimeModes={};CodeMirror.defineMode=function(name,mode){!CodeMirror.defaults.mode&&name!="null"&&(CodeMirror.defaults.mode=name),modes[name]=mode},CodeMirror.defineMIME=function(mime,spec){mimeModes[mime]=spec},CodeMirror.getMode=function(options,spec){typeof spec=="string"&&mimeModes.hasOwnProperty(spec)&&(spec=mimeModes[spec]);if(typeof spec=="string")var mname=spec,config={};else if(spec!=null)var mname=spec.name,config=spec;var mfactory=modes[mname];return mfactory?mfactory(options,config||{}):(window.console&&console.warn("No mode "+mname+" found, falling back to plain text."),CodeMirror.getMode(options,"text/plain"))},CodeMirror.listModes=function(){var list=[];for(var m in modes)modes.propertyIsEnumerable(m)&&list.push(m);return list},CodeMirror.listMIMEs=function(){var list=[];for(var m in mimeModes)mimeModes.propertyIsEnumerable(m)&&list.push({mime:m,mode:mimeModes[m]});return list};var extensions={};CodeMirror.defineExtension=function(name,func){extensions[name]=func},CodeMirror.fromTextArea=function(textarea,options){function save(){textarea.value=instance.getValue()}options||(options={}),options.value=textarea.value,!options.tabindex&&textarea.tabindex&&(options.tabindex=textarea.tabindex);if(textarea.form){var rmSubmit=connect(textarea.form,"submit",save,!0);if(typeof textarea.form.submit=="function"){var realSubmit=textarea.form.submit;function wrappedSubmit(){save(),textarea.form.submit=realSubmit,textarea.form.submit(),textarea.form.submit=wrappedSubmit}textarea.form.submit=wrappedSubmit}}textarea.style.display="none";var instance=CodeMirror(function(node){textarea.parentNode.insertBefore(node,textarea.nextSibling)},options);return instance.save=save,instance.toTextArea=function(){save(),textarea.parentNode.removeChild(instance.getWrapperElement()),textarea.style.display="",textarea.form&&(rmSubmit(),typeof textarea.form.submit=="function"&&(textarea.form.submit=realSubmit))},instance},CodeMirror.copyState=copyState,CodeMirror.startState=startState,StringStream.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(match){var ch=this.string.charAt(this.pos);if(typeof match=="string")var ok=ch==match;else var ok=ch&&(match.test?match.test(ch):match(ch));if(ok)return++this.pos,ch},eatWhile:function(match){var start=this.pos;while(this.eat(match));return this.pos>start},eatSpace:function(){var start=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>start},skipToEnd:function(){this.pos=this.string.length},skipTo:function(ch){var found=this.string.indexOf(ch,this.pos);if(found>-1)return this.pos=found,!0},backUp:function(n){this.pos-=n},column:function(){return countColumn(this.string,this.start)},indentation:function(){return countColumn(this.string)},match:function(pattern,consume,caseInsensitive){if(typeof pattern!="string"){var match=this.string.slice(this.pos).match(pattern);return match&&consume!==!1&&(this.pos+=match[0].length),match}function cased(str){return caseInsensitive?str.toLowerCase():str}if(cased(this.string).indexOf(cased(pattern),this.pos)==this.pos)return consume!==!1&&(this.pos+=pattern.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},CodeMirror.StringStream=StringStream,MarkedText.prototype={attach:function(line){this.set.push(line)},detach:function(line){var ix=indexOf(this.set,line);ix>-1&&this.set.splice(ix,1)},split:function(pos,lenBefore){if(this.to<=pos&&this.to!=null)return null;var from=this.from<pos||this.from==null?null:this.from-pos+lenBefore,to=this.to==null?null:this.to-pos+lenBefore;return new MarkedText(from,to,this.style,this.set)},dup:function(){return new MarkedText(null,null,this.style,this.set)},clipTo:function(fromOpen,from,toOpen,to,diff){this.from!=null&&this.from>=from&&(this.from=Math.max(to,this.from)+diff),this.to!=null&&this.to>from&&(this.to=to<this.to?this.to+diff:from),fromOpen&&to>this.from&&(to<this.to||this.to==null)&&(this.from=null),toOpen&&(from<this.to||this.to==null)&&(from>this.from||this.from==null)&&(this.to=null)},isDead:function(){return this.from!=null&&this.to!=null&&this.from>=this.to},sameSet:function(x){return this.set==x.set}},Bookmark.prototype={attach:function(line){this.line=line},detach:function(line){this.line==line&&(this.line=null)},split:function(pos,lenBefore){if(pos<this.from)return this.from=this.to=this.from-pos+lenBefore,this},isDead:function(){return this.from>this.to},clipTo:function(fromOpen,from,toOpen,to,diff){(fromOpen||from<this.from)&&(toOpen||to>this.to)?(this.from=0,this.to=-1):this.from>from&&(this.from=this.to=Math.max(to,this.from)+diff)},sameSet:function(x){return!1},find:function(){return!this.line||!this.line.parent?null:{line:lineNo(this.line),ch:this.from}},clear:function(){if(this.line){var found=indexOf(this.line.marked,this);found!=-1&&this.line.marked.splice(found,1),this.line=null}}},Line.inheritMarks=function(text,orig){var ln=new Line(text),mk=orig.marked;if(mk)for(var i=0;i<mk.length;++i)if(mk[i].to==null&&mk[i].style){var newmk=ln.marked||(ln.marked=[]),mark=mk[i],nmark=mark.dup();newmk.push(nmark),nmark.attach(ln)}return ln},Line.prototype={replace:function(from,to_,text){!from&&(to_==null||to_==this.text.length)&&(this.className=this.gutterMarker=null);var st=[],mk=this.marked,to=to_==null?this.text.length:to_;copyStyles(0,from,this.styles,st),text&&st.push(text,null),copyStyles(to,this.text.length,this.styles,st),this.styles=st,this.text=this.text.slice(0,from)+text+this.text.slice(to),this.stateAfter=null;if(mk){var diff=text.length-(to-from);for(var i=0,mark=mk[i];i<mk.length;++i)mark.clipTo(from==null,from||0,to_==null,to,diff),mark.isDead()&&(mark.detach(this),mk.splice(i--,1))}},split:function(pos,textBefore){var st=[textBefore,null],mk=this.marked;copyStyles(pos,this.text.length,this.styles,st);var taken=new Line(textBefore+this.text.slice(pos),st);if(mk)for(var i=0;i<mk.length;++i){var mark=mk[i],newmark=mark.split(pos,textBefore.length);newmark&&(taken.marked||(taken.marked=[]),taken.marked.push(newmark),newmark.attach(taken))}return taken},append:function(line){var mylen=this.text.length,mk=line.marked,mymk=this.marked;this.text+=line.text,copyStyles(0,line.text.length,line.styles,this.styles);if(mymk)for(var i=0;i<mymk.length;++i)mymk[i].to==null&&(mymk[i].to=mylen);if(mk&&mk.length){mymk||(this.marked=mymk=[]);e:for(var i=0;i<mk.length;++i){var mark=mk[i];if(!mark.from)for(var j=0;j<mymk.length;++j){var mymark=mymk[j];if(mymark.to==mylen&&mymark.sameSet(mark)){mymark.to=mark.to==null?null:mark.to+mylen,mymark.isDead()&&(mymark.detach(this),mk.splice(i--,1));continue e}}mymk.push(mark),mark.attach(this),mark.from+=mylen,mark.to!=null&&(mark.to+=mylen)}}},fixMarkEnds:function(other){var mk=this.marked,omk=other.marked;if(!mk)return;for(var i=0;i<mk.length;++i){var mark=mk[i],close=mark.to==null;if(close&&omk)for(var j=0;j<omk.length;++j)if(omk[j].sameSet(mark)){close=!1;break}close&&(mark.to=this.text.length)}},addMark:function(mark){mark.attach(this),this.marked==null&&(this.marked=[]),this.marked.push(mark),this.marked.sort(function(a,b){return(a.from||0)-(b.from||0)})},highlight:function(mode,state){var stream=new StringStream(this.text),st=this.styles,pos=0,changed=!1,curWord=st[0],prevWord;this.text==""&&mode.blankLine&&mode.blankLine(state);while(!stream.eol()){var style=mode.token(stream,state),substr=this.text.slice(stream.start,stream.pos);stream.start=stream.pos,pos&&st[pos-1]==style?st[pos-2]+=substr:substr&&(!changed&&(st[pos+1]!=style||pos&&st[pos-2]!=prevWord)&&(changed=!0),st[pos++]=substr,st[pos++]=style,prevWord=curWord,curWord=st[pos]);if(stream.pos>5e3){st[pos++]=this.text.slice(stream.pos),st[pos++]=null;break}}return st.length!=pos&&(st.length=pos,changed=!0),pos&&st[pos-2]!=prevWord&&(changed=!0),changed||(st.length<5&&this.text.length<10?null:!1)},getTokenAt:function(mode,state,ch){var txt=this.text,stream=new StringStream(txt);while(stream.pos<ch&&!stream.eol()){stream.start=stream.pos;var style=mode.token(stream,state)}return{start:stream.start,end:stream.pos,string:stream.current(),className:style||null,state:state}},indentation:function(){return countColumn(this.text)},getHTML:function(sfrom,sto,includePre,endAt){function span(text,style){if(!text)return;first&&ie&&text.charAt(0)==" "&&(text=" "+text.slice(1)),first=!1,style?html.push('<span class="',style,'">',htmlEscape(text),"</span>"):html.push(htmlEscape(text))}var html=[],first=!0;includePre&&html.push(this.className?'<pre class="'+this.className+'">':"<pre>");var st=this.styles,allText=this.text,marked=this.marked;sfrom==sto&&(sfrom=null);var len=allText.length;endAt!=null&&(len=Math.min(endAt,len));if(!allText&&endAt==null)span(" ",sfrom!=null&&sto==null?"CodeMirror-selected":null);else if(!marked&&sfrom==null)for(var i=0,ch=0;ch<len;i+=2){var str=st[i],style=st[i+1],l=str.length;ch+l>len&&(str=str.slice(0,len-ch)),ch+=l,span(str,style&&"cm-"+style)}else{var pos=0,i=0,text="",style,sg=0,markpos=-1,mark=null;function nextMark(){marked&&(markpos+=1,mark=markpos<marked.length?marked[markpos]:null)}nextMark();while(pos<len){var upto=len,extraStyle="";if(sfrom!=null)if(sfrom>pos)upto=sfrom;else if(sto==null||sto>pos)extraStyle=" CodeMirror-selected",sto!=null&&(upto=Math.min(upto,sto));while(mark&&mark.to!=null&&mark.to<=pos)nextMark();mark&&(mark.from>pos?upto=Math.min(upto,mark.from):(extraStyle+=" "+mark.style,mark.to!=null&&(upto=Math.min(upto,mark.to))));for(;;){var end=pos+text.length,appliedStyle=style;extraStyle&&(appliedStyle=style?style+extraStyle:extraStyle),span(end>upto?text.slice(0,upto-pos):text,appliedStyle);if(end>=upto){text=text.slice(upto-pos),pos=upto;break}pos=end,text=st[i++],style="cm-"+st[i++]}}sfrom!=null&&sto==null&&span(" ","CodeMirror-selected")}return includePre&&html.push("</pre>"),html.join("")},cleanUp:function(){this.parent=null;if(this.marked)for(var i=0,e=this.marked.length;i<e;++i)this.marked[i].detach(this)}},LeafChunk.prototype={chunkSize:function(){return this.lines.length},remove:function(at,n){for(var i=at,e=at+n;i<e;++i){var line=this.lines[i];line.cleanUp(),this.height-=line.height}this.lines.splice(at,n)},collapse:function(lines){lines.splice.apply(lines,[lines.length,0].concat(this.lines))},insertHeight:function(at,lines,height){this.height+=height,this.lines.splice.apply(this.lines,[at,0].concat(lines));for(var i=0,e=lines.length;i<e;++i)lines[i].parent=this},iterN:function(at,n,op){for(var e=at+n;at<e;++at)if(op(this.lines[at]))return!0}},BranchChunk.prototype={chunkSize:function(){return this.size},remove:function(at,n){this.size-=n;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height;child.remove(at,rm),this.height-=oldHeight-child.height,sz==rm&&(this.children.splice(i--,1),child.parent=null);if((n-=rm)==0)break;at=0}else at-=sz}if(this.size-n<25){var lines=[];this.collapse(lines),this.children=[new LeafChunk(lines)]}},collapse:function(lines){for(var i=0,e=this.children.length;i<e;++i)this.children[i].collapse(lines)},insert:function(at,lines){var height=0;for(var i=0,e=lines.length;i<e;++i)height+=lines[i].height;this.insertHeight(at,lines,height)},insertHeight:function(at,lines,height){this.size+=lines.length,this.height+=height;for(var i=0,e=this.children.length;i<e;++i){var child=this.children[i],sz=child.chunkSize();if(at<=sz){child.insertHeight(at,lines,height);if(child.lines&&child.lines.length>50){while(child.lines.length>50){var spilled=child.lines.splice(child.lines.length-25,25),newleaf=new LeafChunk(spilled);child.height-=newleaf.height,this.children.splice(i+1,0,newleaf),newleaf.parent=this}this.maybeSpill()}break}at-=sz}},maybeSpill:function(){if(this.children.length<=10)return;var me=this;do{var spilled=me.children.splice(me.children.length-5,5),sibling=new BranchChunk(spilled);if(!me.parent){var copy=new BranchChunk(me.children);copy.parent=me,me.children=[copy,sibling],me=copy}else{me.size-=sibling.size,me.height-=sibling.height;var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling)}sibling.parent=me.parent}while(me.children.length>10);me.parent.maybeSpill()},iter:function(from,to,op){this.iterN(from,to-from,op)},iterN:function(at,n,op){for(var i=0,e=this.children.length;i<e;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var used=Math.min(n,sz-at);if(child.iterN(at,used,op))return!0;if((n-=used)==0)break;at=0}else at-=sz}}},History.prototype={addChange:function(start,added,old){this.undone.length=0;var time=+(new Date),last=this.done[this.done.length-1];if(time-this.time>400||!last||last.start>start+added||last.start+last.added<start-last.added+last.old.length)this.done.push({start:start,added:added,old:old});else{var oldoff=0;if(start<last.start){for(var i=last.start-start-1;i>=0;--i)last.old.unshift(old[i]);last.added+=last.start-start,last.start=start}else last.start<start&&(oldoff=start-last.start,added+=oldoff);for(var i=last.added-oldoff,e=old.length;i<e;++i)last.old.push(old[i]);last.added<added&&(last.added=added)}this.time=time}},Delayed.prototype={set:function(ms,f){clearTimeout(this.id),this.id=setTimeout(f,ms)}};var dragAndDrop=function(){if(/MSIE [1-8]\b/.test(navigator.userAgent))return!1;var div=document.createElement("div");return"draggable"in div}(),gecko=/gecko\/\d{7}/i.test(navigator.userAgent),ie=/MSIE \d/.test(navigator.userAgent),webkit=/WebKit\//.test(navigator.userAgent),lineSep="\n";(function(){var te=document.createElement("textarea");te.value="foo\nbar",te.value.indexOf("\r")>-1&&(lineSep="\r\n")})();var tabSize=8,mac=/Mac/.test(navigator.platform),win=/Win/.test(navigator.platform),movementKeys={};for(var i=35;i<=40;++i)movementKeys[i]=movementKeys["c"+i]=!0;document.documentElement.getBoundingClientRect!=null&&(eltOffset=function(node,screen){try{var box=node.getBoundingClientRect();box={top:box.top,left:box.left}}catch(e){box={top:0,left:0}}if(!screen)if(window.pageYOffset==null){var t=document.documentElement||document.body.parentNode;t.scrollTop==null&&(t=document.body),box.top+=t.scrollTop,box.left+=t.scrollLeft}else box.top+=window.pageYOffset,box.left+=window.pageXOffset;return box});var escapeElement=document.createElement("pre"),badTextContent=htmlEscape("	")!="	";CodeMirror.htmlEscape=htmlEscape;var splitLines,selRange,setSelRange;return"\n\nb".split(/\n/).length!=3?splitLines=function(string){var pos=0,nl,result=[];while((nl=string.indexOf("\n",pos))>-1)result.push(string.slice(pos,string.charAt(nl-1)=="\r"?nl-1:nl)),pos=nl+1;return result.push(string.slice(pos)),result}:splitLines=function(string){return string.split(/\r?\n/)},CodeMirror.splitLines=splitLines,window.getSelection?(selRange=function(te){try{return{start:te.selectionStart,end:te.selectionEnd}}catch(e){return null}},webkit?setSelRange=function(te,start,end){start==end?te.setSelectionRange(start,end):(te.setSelectionRange(start,end-1),window.getSelection().modify("extend","forward","character"))}:setSelRange=function(te,start,end){try{te.setSelectionRange(start,end)}catch(e){}}):(selRange=function(te){try{var range=te.ownerDocument.selection.createRange()}catch(e){return null}if(!range||range.parentElement()!=te)return null;var val=te.value,len=val.length,localRange=te.createTextRange();localRange.moveToBookmark(range.getBookmark());var endRange=te.createTextRange();endRange.collapse(!1);if(localRange.compareEndPoints("StartToEnd",endRange)>-1)return{start:len,end:len};var start=-localRange.moveStart("character",-len);for(var i=val.indexOf("\r");i>-1&&i<start;i=val.indexOf("\r",i+1),start++);if(localRange.compareEndPoints("EndToEnd",endRange)>-1)return{start:start,end:len};var end=-localRange.moveEnd("character",-len);for(var i=val.indexOf("\r");i>-1&&i<end;i=val.indexOf("\r",i+1),end++);return{start:start,end:end}},setSelRange=function(te,start,end){var range=te.createTextRange();range.collapse(!0);var endrange=range.duplicate(),newlines=0,txt=te.value;for(var pos=txt.indexOf("\n");pos>-1&&pos<start;pos=txt.indexOf("\n",pos+1))++newlines;range.move("character",start-newlines);for(;pos>-1&&pos<end;pos=txt.indexOf("\n",pos+1))++newlines;endrange.move("character",end-newlines),range.setEndPoint("EndToEnd",endrange),range.select()}),CodeMirror.defineMode("null",function(){return{token:function(stream){stream.skipToEnd()}}}),CodeMirror.defineMIME("text/plain","null"),CodeMirror}();return CodeMirror})