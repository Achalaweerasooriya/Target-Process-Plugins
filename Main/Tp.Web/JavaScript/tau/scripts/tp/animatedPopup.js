define(["jQuery","tp/jquery.utils"],function(){(function($){$.widget("ui.animatedPopup",{_create:function(){this.element.modal(),this.resizeHandler=$.proxy(this._onResize,this),this.closeLink=$('<a href="#" class="close"></a>').appendTo(this.element.find(".popup-header")),this.closeLink.click($.proxy(this.hide,this)),$(document).keydown($.proxy(this._keydown,this))},_keydown:function(e){switch(e.which){case 27:this.hide()}},_onResize:function(){this._trigger("resize"),this._center()},_center:function(){var offset=this._getOffset();this.element.offset(offset)},_getOffset:function(){var $body=$("body"),width=$body.width(),height=$body.height(),left=(width-this.options.fixedWidth)/2,top=Math.max((height-this._getPopupWidth())/2,50);return{top:top,left:left}},_getPopupWidth:function(){return 200+this.options.fixedWidth},show:function(){var self=this;$(window).bind("resize",self.resizeHandler),self.element.modal("show"),self.options.content.hide();var offset=self._getOffset(),options={target:self.options.sourceElement,callback:function(){self.options.content.show(),self._onResize()},settings:{left:offset.left,top:offset.top,width:self.options.fixedWidth,height:self.options.fixedHeight}};self.element.maximizeFrom(options)},hide:function(){var self=this;$(window).unbind("resize",self.resizeHandler);var options={target:this.options.sourceElement,callback:function(){self.element.modal("hide")}};self.options.content.hide(),self.element.minimizeTo(options)}})})(jQuery)})