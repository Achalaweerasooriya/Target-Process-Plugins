define("tp/mashups",["jQuery","Underscore","tau/core/class"],function(e,t,n){var r=function(e,t){window.console&&window.console.error?(window.console.error(e),window.console.error(t)):window.alert(e+":\n"+t)};e(window).one({beforeunload:function(){r=e.noop}});var o={},s=e({}),a=n.extend({init:function(){this.basePath=null,this.mashupPath=null,this.currentPlaceholder=null,this.libs=[]},controls:{view:{}},subscriptions:{view:{}},mashupDeferreds:[],setPlaceholder:function(e,t,n,r){if(this.currentPlaceholder=e,this.basePath=t,this.mashupPath=n,this.filePath=r,n){var s=n.toLowerCase();o[s]||(o[s]=[]),o[s].push({path:r||"",placeholder:(e||"none").toLowerCase()})}},getRegisteredMashups:function(){return o},onAddMashup:function(e){s.on("addMashup",e)},addMashup:function(n){var o=this.basePath,a=this.mashupPath,i=this.currentPlaceholder,u=this.libs;this.libs=[];var h=e.Deferred();h.mashup={path:a,libs:t.clone(u)},h.done(function(e){s.trigger("addMashup",[e])}),this.mashupDeferreds.push(h),e(function(){require(u,function(){var e=Array.prototype.slice.call(arguments);e.push({placeholderId:i,basePath:o,mashupPath:a});var t;try{t=n.apply(null,e)}catch(s){r('Error in mashup "'+a+'"',s),t={message:"mashup contains js errors"}}return h.resolve(),t},function(e){r('Error loading dependencies for mashup "'+a+'"',e),h.resolve()})})},findMashupDeferreds:function(e){var n=[];return t.each(this.mashupDeferreds,function(t){e(t.mashup)&&n.push(t)}),n},onMashupsLoaded:function(t){return e.whenList(this.findMashupDeferreds(t))},addDependency:function(e){return this.libs.push(e),this},addText:function(e){return this.libs.push("text!"+this.mashupPath+e),this},addHtml:function(e){return this.addText(e+"!strip")},addModule:function(e,t){var n=this.libs;if(this.libs=[],!e)throw new Error("tau.mashups.addModule: name should be specified");define(e,n,function(){return"function"!=typeof t?t:t.apply(null,arguments)})},addCSS:function(e){var n=this.mashupPath+e,r=document.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href",n);var o=(r.href||"").toLowerCase(),s=document.styleSheets,a=t.any(s,function(e){var t=(e.href||"").toLowerCase();return t===o});return a||document.getElementsByTagName("head")[0].appendChild(r),this}});a.GENERAL_TYPE="general";var i=["project","bug","userStory","testPlan","release","iteration","build","testCase","request","testPlanRun","task","feature","impediment",a.GENERAL_TYPE],u=function(e){this.config=e||{type:""}};u.prototype={addControl:function(n,r,o,s,i){var u={type:this.config.type||"notype",options:i,control:r,name:n||"Noname",onCreateContent:o||e.noop,onCreateHeader:s||e.noop},h=t.uniqueId("custom control:"+u.control+":"+u.name+":"+u.type);a.prototype.controls.view[h]=t.extend(u,{id:h})},onRender:function(e,t){var n=this.config.type.toLowerCase(),r=a.prototype.subscriptions.view;return r.hasOwnProperty(n)||(r[n]=[]),r[n].push({callback:e,options:t}),this},addTab:function(e,t,n,r){return this.addControl(e,"tab",t,n,r),this},addBlock:function(e,t,n,r){return this.addControl(e,"block",t,n,r),this}};for(var h=function(e){var t="tp/"+e+"/view";define(t,[],function(){return new u({type:e})})},d=0;d<i.length;d++)h(i[d]);return a});