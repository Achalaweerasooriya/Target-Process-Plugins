define(["tp/bus","tp/plugins/navigator","tp/status","tp/plugins/errorMessageContainer","tp/plugins/activityLogging/activityViewer","jQuery","tp/jquery.utils"],function(e,s,i,t,r,a){function o(e){this._ctor(e)}return o.prototype={_ctor:function(o){this.template='<div class="controls">\n    <div class="main-controls left">\n        <a href="javascript:void(0);" id="save" class="button success x-big">Save</a>\n        <a href="javascript:void(0);" id="cancel" style="color: #666; padding-left: 10px;">Back to plugins</a>\n    </div>\n    <div class="additional-controls right">\n    </div>\n    <div style="clear:both;" />\n</div>\n<div class="controls-widgets">\n</div> ',this.placeholder=o.placeholder,this.bus=e,this.navigator=s,this.status=i,this.errorMessageContainer=new t({placeholder:this.placeholder,generalErrorMessage:"Unable to save profile"}),this.activityLog=new r({placeHolder:this.placeholder}),this.bus.subscribe("ProfileControlsBlock",{onProfileSaveSucceed:a.proxy(this._onProfileSaveSucceed,this),onProfileSaveFailed:a.proxy(this._onProfileSaveFailed,this)},!0)},render:function(){var e=a(this.template),s=this;e.find("#save").click(function(){a(this).enabled()&&(s.errorMessageContainer.clearErrors(),a(this).enabled(!1),s.status.saving(),s.bus.publish("SaveProfile"))}),e.find("#cancel").click(function(){s.navigator.backToPlugins()}),this.placeholder.find(".controls-block").html(""),e.appendTo(this.placeholder.find(".controls-block")),this.errorMessageContainer.setOnFocusEvent(),this.activityLog.render(),this.bus.publish("ProfileControlsRendered",[{placeholder:this.placeholder}])},_onProfileSaveSucceed:function(){this.status.profileSavedSuccessfully(),this.placeholder.find("#save").enabled(!0),this.activityLog.render()},_onProfileSaveFailed:function(e){this.placeholder.find("#save").enabled(!0),this.status.error(this._getErrorMessage(e)),e&&(e.data&&(this.errorMessageContainer.addRange(e.data),this.errorMessageContainer.render()),e.message||e.data||!e.rawResponse||(this.errorMessageContainer.add({FieldName:null,Message:e.rawResponse.responseText}),this.errorMessageContainer.render()))
},_getErrorMessage:function(e){var s="Unable to save profile";return e&&e.message&&(s=e.Message),s}},o});