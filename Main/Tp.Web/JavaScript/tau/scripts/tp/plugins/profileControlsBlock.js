define(["tp/bus","tp/plugins/navigator","tp/status","tp/plugins/errorMessageContainer","tp/plugins/activityLogging/activityViewer","jQuery","tp/jquery.utils"],function(bus,navigator,status,errorMessageContainer,activityLog,$){function ProfileControlsBlock(config){this._ctor(config)}return ProfileControlsBlock.prototype={_ctor:function(config){this.template='<div class="controls">\n    <div class="main-controls left">\n        <a href="javascript:void(0);" id="save" class="button success x-big">Save</a>\n        <a href="javascript:void(0);" id="cancel" style="color: #666; padding-left: 10px;">Back to plugins</a>\n    </div>\n    <div class="additional-controls right">\n    </div>\n    <div style="clear:both;" />\n</div>\n<div class="controls-widgets">\n</div> ',this.placeholder=config.placeholder,this.bus=bus,this.navigator=navigator,this.status=status,this.errorMessageContainer=new errorMessageContainer({placeholder:this.placeholder,generalErrorMessage:"Unable to save profile"}),this.activityLog=new activityLog({placeHolder:this.placeholder}),this.bus.subscribe("ProfileControlsBlock",{onProfileSaveSucceed:$.proxy(this._onProfileSaveSucceed,this),onProfileSaveFailed:$.proxy(this._onProfileSaveFailed,this)},!0)},render:function(){var template=$(this.template),that=this;template.find("#save").click(function(){if(!$(this).enabled())return;that.errorMessageContainer.clearErrors(),$(this).enabled(!1),that.status.saving(),that.bus.publish("SaveProfile")}),template.find("#cancel").click(function(){that.navigator.backToPlugins()}),this.placeholder.find(".controls-block").html(""),template.appendTo(this.placeholder.find(".controls-block")),this.errorMessageContainer.setOnFocusEvent(),this.activityLog.render(),this.bus.publish("ProfileControlsRendered",[{placeholder:this.placeholder}])},_onProfileSaveSucceed:function(){this.status.profileSavedSuccessfully(),this.placeholder.find("#save").enabled(!0),this.activityLog.render()},_onProfileSaveFailed:function(error){this.placeholder.find("#save").enabled(!0),this.status.error(this._getErrorMessage(error));if(!error)return;error.data&&(this.errorMessageContainer.addRange(error.data),this.errorMessageContainer.render()),!error.message&&!error.data&&error.rawResponse&&(this.errorMessageContainer.add({FieldName:null,Message:error.rawResponse.responseText}),this.errorMessageContainer.render())},_getErrorMessage:function(error){var errorMessage="Unable to save profile";return error&&error.message&&(errorMessage=error.Message),errorMessage}},ProfileControlsBlock})