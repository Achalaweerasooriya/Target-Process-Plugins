define(["jQuery","tp/plugins/profileNameSource","tp/bus","tp/gateway","app.path"],function($,profileNameSource,bus,gateway,appPath){function ProfileRepository(){this._create()}return ProfileRepository.prototype={_requestUrlBase:"/api/v1/Plugins.asmx/{PluginName}/Profiles/{ProfileName}",_pluginName:null,_create:function(){this.profileNameSource=profileNameSource,this._pluginName=this.profileNameSource.getPluginName(),this.bus=bus,this.gateway=gateway},_getUrl:function(profileName){var relativeUrl=this._requestUrlBase.replace(/{PluginName}/g,this._pluginName).replace(/{ProfileName}/g,profileName);return(new appPath.tp.WebServiceURL(relativeUrl)).url},setPluginName:function(pluginName){this._pluginName=pluginName},getCurrentProfile:function(success){this.getProfile(this.getCurrentProfileName(),success)},getProfile:function(profileName,success){profileName?this.gateway.getJSON(this._getUrl(profileName),success):success(null)},save:function(profileName,data){this.gateway.postJSON(this._getUrl(profileName),data,$.proxy(function(){this.bus.publish("ProfileSaveSucceed",[data])},this),$.proxy(function(response){this.bus.publish("ProfileSaveFailed",[{data:JSON.parse(response.responseText),rawResponse:response}])},this),$.proxy(function(response){this.bus.publish("ProfileSaveFailed",[{rawResponse:response}])},this))},create:function(data){this.save("",data)},update:function(data){this.save(this.getCurrentProfileName(),data)},getCurrentProfileName:function(){return this.profileNameSource.getProfileName()}},new ProfileRepository})