define(["libs/jquery/jquery","tp/plugins/profileNameSource","tp/bus","tp/gateway"],function($,a,b,c){function d(){this._create()}return d.prototype={_requestUrlBase:"/api/v1/Plugins.asmx/{PluginName}/Profiles/{ProfileName}",_pluginName:null,_create:function(){this.profileNameSource=a,this._pluginName=this.profileNameSource.getPluginName(),this.bus=b,this.gateway=c},_getUrl:function(a){var b=this._requestUrlBase.replace(/{PluginName}/g,this._pluginName).replace(/{ProfileName}/g,a);return(new Tp.WebServiceURL(b)).url},getCurrentProfile:function(a){var b=this.getCurrentProfileName();b?this.gateway.getJSON(this._getUrl(b),a):a(null)},save:function(a,b){this.gateway.postJSON(this._getUrl(a),b,$.proxy(function(){this.bus.publish("ProfileSaveSucceed",[b])},this),$.proxy(function(a){this.bus.publish("ProfileSaveFailed",[{data:JSON.parse(a.responseText),rawResponse:a}])},this),$.proxy(function(a){this.bus.publish("ProfileSaveFailed",[{rawResponse:a}])},this))},create:function(a){this.save("",a)},update:function(a){this.save(this.getCurrentProfileName(),a)},getCurrentProfileName:function(){return this.profileNameSource.getProfileName()}},new d})