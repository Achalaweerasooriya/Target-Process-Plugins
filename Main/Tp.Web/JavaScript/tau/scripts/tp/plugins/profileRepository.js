define(["jQuery","tp/plugins/profileNameSource","tp/bus","tp/gateway","app.path"],function(e,i,t,r,l){function n(){this._create()}return n.prototype={_basePluginProfilesUrl:"/api/v1/Plugins.asmx/{PluginName}/Profiles",_pluginProfileUrl:null,_pluginName:null,_create:function(){this._pluginProfileUrl=this._basePluginProfilesUrl+"/{ProfileName}",this.profileNameSource=i,this._pluginName=this.profileNameSource.getPluginName(),this.bus=t,this.gateway=r},_getAbsoluteUrl:function(e){var i=new l.tp.WebServiceURL(e).url;return i},_getUrl:function(e){var i=this._pluginProfileUrl.replace(/{PluginName}/g,this._pluginName).replace(/{ProfileName}/g,e);return this._getAbsoluteUrl(i)},setPluginName:function(e){this._pluginName=e},getCurrentProfile:function(e){this.getProfile(this.getCurrentProfileName(),e)},getProfile:function(e,i){e?this.gateway.getJSON(this._getUrl(e),i):i(null)},save:function(i,t){this.gateway.postJSON(this._getUrl(i),t,e.proxy(function(){this.bus.publish("ProfileSaveSucceed",[t])},this),e.proxy(function(e){this.bus.publish("ProfileSaveFailed",[{data:JSON.parse(e.responseText),rawResponse:e}])},this),e.proxy(function(e){this.bus.publish("ProfileSaveFailed",[{rawResponse:e}])},this))},create:function(e){this.save("",e)},update:function(e){this.save(this.getCurrentProfileName(),e)},getCurrentProfileName:function(){return this.profileNameSource.getProfileName()},getAllProfiles:function(e,i){var t=this._basePluginProfilesUrl.replace(/{PluginName}/g,e);this.gateway.getJSON(this._getAbsoluteUrl(t),function(e){i(e)})}},new n});