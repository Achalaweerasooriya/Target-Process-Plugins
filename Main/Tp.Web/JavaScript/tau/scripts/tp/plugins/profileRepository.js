define(["libs/jquery/jquery","tp/plugins/profileNameSource","tp/bus","tp/gateway"],function(a,b,c,d){function e(){this._create()}e.prototype={_requestUrlBase:"/api/v1/Plugins.asmx/{PluginName}/Profiles/{ProfileName}",_pluginName:null,_create:function(){this.profileNameSource=b,this._pluginName=this.profileNameSource.getPluginName(),this.bus=c,this.gateway=d},_getUrl:function(a){var b=this._requestUrlBase.replace(/{PluginName}/g,this._pluginName).replace(/{ProfileName}/g,a);return(new Tp.WebServiceURL(b)).url},getCurrentProfile:function(a){var b=this.getCurrentProfileName();b?this.gateway.getJSON(this._getUrl(b),a):a(null)},save:function(b,c){this.gateway.postJSON(this._getUrl(b),c,a.proxy(function(){this.bus.publish("ProfileSaveSucceed",[c])},this),a.proxy(function(a){this.bus.publish("ProfileSaveFailed",[{data:JSON.parse(a.responseText),rawResponse:a}])},this),a.proxy(function(a){this.bus.publish("ProfileSaveFailed",[{rawResponse:a}])},this))},create:function(a){this.save("",a)},update:function(a){this.save(this.getCurrentProfileName(),a)},getCurrentProfileName:function(){return this.profileNameSource.getProfileName()}};return new e})