define(["tp/codemirror/lib/codemirror","jQuery","tp/popup","tp/codemirror/mode/diff/diff","tp/codemirror/mode/clike/clike","tp/codemirror/mode/css/css","tp/codemirror/mode/htmlmixed/htmlmixed","tp/codemirror/mode/javascript/javascript","tp/codemirror/mode/perl/perl","tp/codemirror/mode/php/php","tp/codemirror/mode/python/python","tp/codemirror/mode/ruby/ruby","tp/codemirror/mode/xml/xml"],function(a,$){function b(){this._ctor()}return b.prototype={_ctor:function(){this.placeholder=$('<div class="_viewSourcePopup viewSourcePopup" />'),this.emptyText="No data to display",this.codeViewer=a(this.placeholder[0],{readOnly:!0,lineNumbers:!0});var b=this;this.popup=this.placeholder.popup({zIndex:2e4,autoOpen:!1,minWidth:300,open:function(){b.resizeCodeViewer()},resize:function(){b.resizeCodeViewer()}}),this.placeholder.parent().addClass("vcsSource")},resizeCodeViewer:function(){var a=$("._viewSourcePopup").height(),b=$("._viewSourcePopup").width();$(".CodeMirror-scroll").css("height",a),$(".CodeMirror-scroll").css("width",b)},view:function(a,b,c){var d=b||this.emptyText,e="File: "+c+'<br /><span class="subTitle">Revision: '+a+"</span>";this.placeholder.removeClass("_refreshing"),this.placeholder.find(".ui-wait-icon").remove(),this._setModeByFileExtension(c),this.codeViewer.setValue(d),this.popup.popup("option","title",e),this.popup.popup("open"),this.codeViewer.refresh()},loading:function(){this.placeholder.addClass("_refreshing"),this.placeholder.append('<div class="ui-wait-icon" />'),this.popup.popup("option","title",""),this.popup.popup("open")},_getExtension:function(a){return a.substr(a.lastIndexOf(".")+1)},_setModeByFileExtension:function(a){var b=this._getExtension(a),c="clike";switch(b){case"css":c="text/css";break;case"cs":c="text/x-csharp";break;case"c":case"h":c="text/x-csrc";break;case"cpp":c="text/x-c++src";break;case"html":case"htm":case"shtml":c="text/html";break;case"js":c="text/javascript";break;case"java":c="text/x-java";break;case"perl":c="text/x-perl";break;case"php":case"phtml":case"phl":c="application/x-httpd-php";break;case"py":c="text/x-python";break;case"rb":c="text/x-ruby";break;case"xml":case"config":c="application/xml";break;default:c="null"}this.codeViewer.setOption("mode",c)}},new b})