define(["libs/aceEditor/aceEditor","jQuery","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tp/popup"],function(e,t,s){var p=function(e){this._ctor(e)};return p.prototype={emptyText:"No data to display",_ctor:function(s){this.placeholder=t('<div class="_viewSourcePopup viewSourcePopup" />'),this.codeViewer=e.setEditor(t(this.placeholder),s.bus,{readOnly:!0,highlightSelectedWord:!1})},_createPopup:function(){this.popup||(this.popup=this.placeholder.popup({autoOpen:!1,minWidth:300,parentClassName:"vcsSource"}))},openPopup:function(e,t){this.codeViewer.then(function(s){s.setValue(t,1),this._createPopup(),this.popup.popup("option","title",e),this.popup.popup("open")}.bind(this))},view:function(e,t,p){t=t||this.emptyText;var o="File: "+p+'<br /><span class="subTitle">Revision: '+e+"</span>";this.placeholder.removeClass("_refreshing"),s.get(this.placeholder).hide(),this._setModeByFileExtension(p),this.openPopup(o,t)},loading:function(){this.placeholder.addClass("_refreshing"),s.get(this.placeholder).show(),this.openPopup("","")},_getExtension:function(e){return e.substr(e.lastIndexOf(".")+1)},_setModeByFileExtension:function(e){var t=this._getExtension(e),s="text";switch(t){case"css":s="css";break;case"cs":s="csharp";break;case"c":case"h":case"cpp":s="c_cpp";break;case"html":case"htm":case"shtml":s="html";break;case"js":s="javascript";break;case"java":s="java";break;case"perl":s="perl";break;case"php":case"phtml":case"phl":s="php";break;case"py":s="python";break;case"rb":s="ruby";break;case"xml":case"config":s="xml";break;default:s="text"}this.codeViewer.then(function(e){e.setOption("mode","ace/mode/"+s)})}},p});