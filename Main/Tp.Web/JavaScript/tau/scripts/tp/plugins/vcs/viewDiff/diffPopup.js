define(["jQuery","tp/popup"],function($){function a(){this._ctor()}return a.prototype={placeholder:$('<div class="_viewDiffPopup viewDiffPopup">\n    <div class="diffHeader">\n        <div class="_legend legend">\n            <span class="lineAdded">line added</span>&nbsp;&nbsp;\n            <span class="lineUpdated">line changed</span>&nbsp;&nbsp;\n            <span class="lineDeleted">line deleted</span>\n        </div>\n        <div class="revisionsContainer">\n            <div class="revisionContainer right">\n                <div class="_rightRevision revision"></div>\n            </div>\n            <div class="revisionContainer left">\n                <div class="_leftRevision revision"></div>\n            </div>\n        </div>\n    </div>\n    <div class="diffContainer _diffContainer">\n        <div class="_rightContainer sourceContainer right">\n            <pre>\n                <div class="_rightPan"></div>\n            </pre>\n        </div>\n        <div class="_leftContainer sourceContainer left">\n            <pre>\n                <div class="_leftPan"></div>\n            </pre>\n        </div>\n        <div style="clear:both;"></div>\n    </div>\n    <div class="scrollers">\n        <div class="_rightScroller rightScroller right">\n            <div class="_scrollerInternals scrollerInternals"></div>\n        </div>\n        <div class="_leftScroller leftScroller left">\n            <div class="_scrollerInternals scrollerInternals"></div>\n        </div>\n    </div>\n</div>'),lineTemplate:'<div {{if line.Action}}class="line${actions[line.Action]}"{{/if}}>${line.LineNumber}  ${line.Line}</div>',actions:{0:"None",10:"Added",20:"Updated",30:"Deleted"},_ctor:function(){this.emptyText="No data to display";var a=$.proxy(this._getSyncFunction("left","right"),this),b=$.proxy(this._getSyncFunction("right","left"),this),c=this,d=$.proxy(function(){c._processScroller("right"),c._processScroller("left")},this);this.popup=this.placeholder.popup({autoOpen:!1,zIndex:2e4,minWidth:300,open:function(){c._processScroller("right").bind("scroll",b),c._processScroller("left").bind("scroll",a),$(window).bind("resize",d)},close:function(){c.placeholder.find("._rightScroller").unbind("scroll",b),c.placeholder.find("._leftScroller").unbind("scroll",a),$(window).unbind("resize",d)},resize:function(){d()}}),this.placeholder.parent().addClass("vcsDiff")},_getSyncFunction:function(a,b){var c=this;return function(){var d=c.placeholder.find("._"+a+"Scroller");c.placeholder.find("._"+b+"Scroller").scrollLeft(d.scrollLeft()),c.placeholder.find("._"+b+"Container").scrollLeft(d.scrollLeft()),c.placeholder.find("._"+a+"Container").scrollLeft(d.scrollLeft())}},_processScroller:function(a){var b=$("._"+a+"Pan").width(),c=this.placeholder.find("._"+a+"Container"),d=c.width(),e=this.placeholder.find("._"+a+"Scroller"),f=this.placeholder.find("._diffContainer");return c.height()<f.height()?(c.height(f.height()),e.css("right",0)):(c.css("height","auto"),e.css("right","17px")),e.find("._scrollerInternals").width(b),e.width(d),d<b?e.show():e.hide(),e},view:function(a,b,c){var d="Changed file: "+c;this.placeholder.removeClass("_refreshing"),this.placeholder.find(".ui-wait-icon").remove(),this.placeholder.find("._leftRevision").text("Revision "+b.LeftPanRevisionId),this.placeholder.find("._rightRevision").text("Revision "+b.RightPanRevisionId),this._processPan(this.placeholder.find("._leftPan").html(""),b.LeftPan),this._processPan(this.placeholder.find("._rightPan").html(""),b.RightPan),this.popup.popup("option","title",d),this.popup.popup("open")},loading:function(){this.placeholder.addClass("_refreshing"),this.placeholder.append('<div class="ui-wait-icon" />'),this.popup.popup("option","title",""),this.popup.popup("open")},_processPan:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.LineNumber=this._normalizeLineNumber(d.LineNumber),d.Line=d.Line.replace(/\t/g,"&#9;")||"&nbsp;",a.append($.tmpl(this.lineTemplate,{line:d,actions:this.actions}))}},_normalizeLineNumber:function(a){var b=a;if(b<0)return"     ";var c=new String(b+1);while(c.length<5)c=" "+c;return c}},new a})