!function(){var e=["tp/mashups","tau/core/global.bus","Underscore","tau/core/bus.reg","tau/core/event"];window.tauFeatures&&!window.tauFeatures["mashups.loader"]&&e.push("user/mashups"),define("tp/ui/mashupsForViews",e,function(e,n,t,o,i){var a=new e,r=!1,s={element:{addClass:function(){}},view:{config:{context:{entity:{id:null,entityType:{name:null}}}}}},c=function(e){for(var n=0,t=e.dependencies.length;t>n;n++){var o=e.dependencies[n],i=o.toLowerCase();if(i.indexOf("/view")>0||i.indexOf("iew")>0)return!0}return!1},l={init:function(){C()},onInit:function(e){a.onMashupsLoaded(c).done(e)}},u=function(e){return{header:[{name:e.id,type:"label",text:e.name}],items:[{name:e.id,type:"container"}]}},d=function(e,n){var o={label:e.name,name:"parent:"+e.id};n.tabs.push(t.extend(o,u(e)))},f=function(e,n){var o={type:"collapsible",name:"parent:"+e.id,collapsed:!0,stateName:e.name.toLowerCase().replace(" ","")},i=t.extend(o,u(e));e.options&&e.options.positionToInsert&&n.children.length&&n.children[0].children&&n.children[0].children.length>=e.options.positionToInsert?n.children[0].children.splice(e.options.positionToInsert,0,i):n.children.push(i)},p=function(e){var n=t.jsonSelect(e.children,':has(:root>.type:val("tabs"))');return 0===n.length&&(n=[{tabs:[]}]),n=n[0]},h=function(e){var n=t.jsonSelect(e.children,':has(:root>.name:val("additional info column container"))');return 0===n.length&&(n=[{children:[]}]),n=n[0]},v=function(e,n){var t=n&&n.getViewIsSuitablePromiseCallback;return t?t({entity:e}):null},y=function(n,o){var i=a.subscriptions.view,r=o.type.toLowerCase(),s=(i[r]||[]).concat(i[e.viewTypes.GENERAL]||[]),c=[],l=[];t.forEach(s,function(e){var n=v(o,e.options);n?(l.push(n),n.done(t.bind(function(e,n){n&&c.push(e)},this,e))):c.push(e)});var u=t.bind(function(e,n){t.forEach(c,function(t){t.callback(e,{entity:n})})},this,n,o);l.length>0?$.when.apply(this,l).then(function(){u()}):u()},m=function(e,n,o){var i=w(e,n),a=t.bind(o,this,e);i.length>0?$.whenList(i).done(a):a()},w=function(n,o){for(var i=t.values(o),a=[],r=i.length,s=new Array(r),c=0;r>c;c++){var l=i[c],u=n.context.entity;
if(l.type.toLowerCase()===u.entityType.name.toLowerCase()||l.type.toLowerCase()===e.viewTypes.GENERAL.toLowerCase()){var d=v(u,l.options);if(d){var f=$.Deferred();a.push(f.promise()),d.done(t.bind(function(e,n,t){t&&(s[e]=n)},this,c,l)).always(f.resolve)}else s[c]=l}}return $.whenList(a).done(t.bind(function(){b(n,t.compact(s))},this)),a},b=function(e,n){var o=null,i=null;t.forEach(n,function(n){"tab"===n.control&&(o||(o=p(e)),d(n,o)),"block"===n.control&&(i||(i=h(e)),f(n,i))})},g=function(e,n){var o=n.view.config.context.entity,i={entity:t.extend(o,{type:o.entityType.name})},a="label"===n.view.config.type,r=a?"onCreateHeader":"onCreateContent";a||n.element.addClass("ui-custom-control-content"),e[r](n.element,i)},C=function(){if(!r){r=!0,o.getByName("entity component",function(e){var n={bus:e,"bus before_contextRetrieved":function(e){e.suspendMain(),l.onInit(function(){e.resumeMain()})}};i.subscribeOn(n)});var e=n.get();e.on("afterRenderAll",function(e){var n=e.caller.name,o=e.data||s;if("entity component"===n){var i=o.element,a=o.view.config.entity,r=t.extend(a,{entityType:{name:a.type}});y(i,r)}}),e.on("afterRender",function(e){var n=a.controls.view,t=e.caller.name,o=e.data||s;n.hasOwnProperty(t)&&g(n[t],o)}),e.on("configReadyForIntegration",function(e){var n=a.controls.view,t=$.Deferred();e.data.integrationReadyPromise=t.promise(),m(e.data,n,function(e){t.resolve(e)})})}};return l})}();