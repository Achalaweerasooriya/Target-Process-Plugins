define(["jQuery","libs/jquery/jquery.ui","libs/jquery/jquery.tmpl"],function($){return typeof $.ui.bubblePopupShared=="undefined"&&($.ui.bubblePopupShared={dialogs:{}}),$.widget("ui.bubblePopup",{options:{content:"",autoOpen:!1,key:"_defaultBubblePopup",top:20,left:20,open:$.noop,close:$.noop},_create:function(){this.wrapper=$("<div></div>").addClass("_bubblePopup");if(typeof $.ui.bubblePopupShared.dialogs[this.options.key]=="undefined"){var a=$.proxy(this._onClick,this),b=this;$.ui.bubblePopupShared.dialogs[this.options.key]=this.wrapper.dialog({draggable:!1,autoOpen:!1,closeText:"",open:function(c){c.stopPropagation(),$(this).parent().find(".ui-dialog-titlebar").hide(),$(this).parent().removeClass("ui-widget-content"),$("body").click(a),b.options.open()},close:function(){b.options.close(),b.wrapper.html(""),$("body").unbind("click",a)}})}this.options.autoOpen&&this.open()},open:function(){this._closeAllOpenedExceptThis();if(!this.isOpen()){var a=this.element.offset(),b=this._getPageScroll();this.content(this.options.content),$.ui.bubblePopupShared.dialogs[this.options.key].dialog("option","position",[a.left-b[0]+this.options.left,a.top-b[1]+this.options.top]),$.ui.bubblePopupShared.dialogs[this.options.key].dialog("open")}},close:function(){$.ui.bubblePopupShared.dialogs[this.options.key].dialog("close")},content:function(a){if(typeof a=="undefined")return this.wrapper;this.options.content=a,this.wrapper.html(this.options.content)},_closeAllOpenedExceptThis:function(){for(var a in $.ui.bubblePopupShared.dialogs)a!=this.options.key&&$.ui.bubblePopupShared.dialogs[a].dialog("isOpen")&&$.ui.bubblePopupShared.dialogs[a].dialog("close")},_onClick:function(a){this.isOpen()&&!this._isDialog($(a.target))&&this.close()},isOpen:function(){return $.ui.bubblePopupShared.dialogs[this.options.key].dialog("isOpen")},_isDialog:function(a){return a.hasClass("_bubblePopup")||a.parents("._bubblePopup").length>0},_getPageScroll:function(){var a,b;return self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft),new Array(a,b)},destroy:function(){$.ui.bubblePopupShared.dialogs[this.options.key].dialog("destroy"),delete $.ui.bubblePopupShared.dialogs[this.options.key]}}),$})