define(["libs/d3/d3","Underscore","tp/reports/chart.layout","tau/core/tau"],function(t,n,r,e){var u=function(t){return t*t},i=function(t,n){return u(t.x-n.x)+u(t.y-n.y)},o=n.contains([10,11],e.ieVersion);return{links:function(r){var e=function(t){var n=r.x(t.x),e=r.y(t.y),u=10;return[{x:n-t.size[0]/2,y:e},{x:n+t.size[0]/2,y:e},{x:n,y:e-t.size[1]/2},{x:n,y:e+u+t.size[1]/2}]},u=function(r,u){var o=e(r),c=e(u);return n.flatten(o.map(function(t){return c.map(function(n){return{source:t,target:n}})})).sort(function(n,r){return t.ascending(i(n.source,n.target),i(r.source,r.target))})[0]};return function(){this.each(function(t){t.line=u(t.source,t.target)}).attr("x1",function(t){return t.line.source.x}).attr("y1",function(t){return t.line.source.y}).attr("x2",function(t){return t.line.target.x}).attr("y2",function(t){return t.line.target.y}),o&&this.each(function(){this.parentNode.insertBefore(this,this)})}},nodes:function(t){return function(){this.style("left",function(n){return Math.round(t.x(n.x)-n.size[0]/2)+"px"}).style("top",function(n){return Math.round(t.y(n.y)-n.size[1]/2)+"px"})}}}});