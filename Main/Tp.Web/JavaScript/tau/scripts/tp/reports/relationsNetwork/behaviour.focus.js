define(["libs/d3/d3"],function(d3){function placeholder(context){return d3.select(context.placeholder.parentNode.parentNode.parentNode)}function buildPath(path,current){return path.push(current),current.links.forEach(function(link){path.indexOf(link)==-1&&path.push(link),path.indexOf(link.source)==-1&&buildPath(path,link.source),path.indexOf(link.target)==-1&&buildPath(path,link.target)}),path}function focused(d3selection){return!d3selection.selectAll(".tau-chart-focused").empty()}function focus(val){return function(){this.each(function(){d3.select(this).classed("tau-chart-focused",val),d3.select(this).style("z-index",val?100:undefined)})}}function resetFocus(placeholder){placeholder.classed("tau-chart-focus",!1),placeholder.selectAll(".tau-chart-focused").call(focus(!1))}function setFocus(placeholder,nodes){function selectById(id){return placeholder.selectAll('[data-entity-id="'+id+'"]')}resetFocus(placeholder),placeholder.classed("tau-chart-focus",!0),nodes.forEach(function(node){selectById(node.id).call(focus(!0))})}return{"dragstart.behavior":function(d,context){focused(d3.select(this))||resetFocus(placeholder(context))},click:function(d,context){var classAttr=d3.select(d3.event.target).attr("class");if(!classAttr||classAttr.indexOf("tau-id")>-1)return;focused(d3.select(this))?resetFocus(placeholder(context)):d3.select(this).classed("i-trigger-set-focus")?setFocus(placeholder(context),buildPath([],d)):d3.select(this).classed("i-trigger-reset-focus")&&resetFocus(placeholder(context))}}})