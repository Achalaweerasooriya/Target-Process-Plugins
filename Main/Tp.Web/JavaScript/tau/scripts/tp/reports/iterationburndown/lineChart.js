define(["jQuery","libs/d3/d3","libs/jquery/jquery.tmpl","tp/bubblepopup","libs/date.js/build/date","libs/jquery/jquery.ui","tp/reports/iterationburndown/summaryPopup"],function($,a){var b=function(b,d){var e=b.createGroup("chart"),f=a.svg.line().x(function(a,c){return b.x(c)}).y(function(a){return b.y(d.getYValue(a))});e.append("path").attr("d",f(d.data.filter(function(a){return a.total!=null}))).attr("class","lineChart"),c(b,d)},c=function(b,c){var d=.95,e=function(a,b,c){var e=b-c*d/2;return a==0&&(e=b),e},f=function(a,c){var e=c*d;if(a==0||a==b.xAxis.max)e/=2;return e},g=function(a){a.attr("r",7).attr("stroke-width",7)},h=function(a){a.attr("r",4).attr("stroke-width",0)},i=b.createGroup("yMarker"),j=i.append("rect").attr("class","lineChartPointYCoordinateRect").attr("x",0).attr("width",b.margin).attr("height",20).attr("rx",5).attr("ry",5).style("display","none"),k=i.append("text").attr("class","lineChartPointYCoordinate").attr("x",b.margin/2).attr("y",0).attr("width",b.margin).attr("height",b.margin).style("display","none"),l=k.append("tspan").attr("dy",0),m=i.append("line").attr("class","lineChartPointYLine").attr("x1",b.x(0)).style("display","none"),n=function(a,d){j.attr("y",b.y(c.getYValue(a))-j.attr("height")/2).style("display",null),k.attr("y",b.y(c.getYValue(a))+5).style("display",null),l.text(Math.round(c.getYValue(a))),d>0&&m.attr("x2",b.x(d)-7).attr("y1",b.y(c.getYValue(a))).attr("y2",b.y(c.getYValue(a))).style("display",null)},o=function(){k.style("display","none"),m.style("display","none"),j.style("display","none")},p=b.createGroup("points");p.selectAll("circle").data(c.data.filter(function(a){return a.total!=null})).enter().append("circle").attr("class","lineChartPoint").attr("cx",function(a,c){return b.x(c)}).attr("cy",function(a){return b.y(c.getYValue(a))}).attr("r",4).attr("stroke-width",0).each(function(d,i){var j=$(this),k=b.width/b.xAxis.count;p.append("rect").attr("x",e(i,j.attr("cx"),k)).attr("y",b.y(b.yAxis.max)).attr("class","lineChartPointHover").attr("width",f(i,k)).attr("height",b.y(0)-b.y(b.yAxis.max)).attr("opacity",0).on("mouseover",function(){g(j),a.select(this).attr("opacity",.1),n(d,i)}).on("mouseout",function(){h(j),a.select(this).attr("opacity",0),o()}).on("click",function(){d.effort&&c.getDetails(d,function(a){j.summaryPopup({index:i,data:a}).summaryPopup("open")})})})};return{render:b}})