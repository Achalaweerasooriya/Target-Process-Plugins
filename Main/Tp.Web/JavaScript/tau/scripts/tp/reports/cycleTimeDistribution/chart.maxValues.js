define(["jQuery","Underscore","libs/d3/d3"],function(t,e,n){function r(t){this.contextProvider=t.contextProvider}return r.prototype={data:function(e,r){var a=e.nodes,u=a.map(function(e){var r=n.max(e.values,function(t){return t.length}),a=e.values.filter(function(t){return t.length==r});return t.extend(a[0],{key:e.key,count:e.values.count})});u=n.nest().key(function(t){return t.x}).rollup(function(t){return t.sort(function(t,e){return n.descending(t.y,e.y)})}).entries(u);var o=n.select(r.placeholder).selectAll("text.max-val").data(u,function(t){return t.key});o.enter().append("text").attr("class","max-val"),o.attr("y",function(t){return r.scales.y(t.values[0].y)}),o.exit().remove();var c=o.selectAll("tspan").data(function(t){return t.values});c.enter().append("tspan"),c.exit().remove();var l=this;c.attr("class",function(t){return r.scales.fill(t.key)}).text(function(t){return t.length+" of "+t.count+" "+l.contextProvider.getTerm(t.key,t.all).toLowerCase()}).transition().attr("x",function(t){return r.scales.x(t.x)}).attr("dy",function(t,e){return-5-9*e}).attr("dx",2)}},r});