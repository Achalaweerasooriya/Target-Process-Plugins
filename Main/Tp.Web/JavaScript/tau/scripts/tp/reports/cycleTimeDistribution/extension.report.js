define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tp/reports/chart.plot","tp/reports/cycleTimeDistribution/chart.scales","tp/reports/cycleTimeDistribution/chart.histogram","tp/reports/cycleTimeDistribution/chart.maxValues","tp/reports/cycleTimeDistribution/chart.probability","tp/reports/cycleTimeDistribution/chart.hover","libs/d3/d3","tp/reports/cycleTimeDistribution/chart.axes","tp/reports/cycleTimeDistribution/behaviour.hover.bars","tp/reports/cycleTimeDistribution/behaviour.hover.probability"],function(_,$,ExtensionBase,Plot,Scales,HistogramChart,MaxValuesChart,ProbabilityChart,HoverChart,d3,Axes,BarsHover,ProbabilityHover){return ExtensionBase.extend({"bus afterRender + contextProvider.ready + configurator.ready:last":function(evt,data,contextProvider,configurator){var probabilityHover=ProbabilityHover.create({placeholder:data.element}),barsHover=BarsHover.create({placeholder:data.element,contextProvider:contextProvider}),plot=new Plot({scales:new Scales,placeholder:data.element.find(".tau-chart-plot").get(0),axes:[Axes.x,Axes.y],size:configurator.service("chart.size"),charts:[new MaxValuesChart({contextProvider:contextProvider}),new ProbabilityChart,new HoverChart({handlers:[probabilityHover]}),new HistogramChart({handlers:[barsHover,probabilityHover]})]});this.fire("plot.ready",plot)},"bus afterRender:last + plot.afterRender":function(e,data){var $probabilityChart=data.element.find(".chart:has(g.probability)"),probabilityChart=d3.select($probabilityChart[0]);data.element.find(".chart").on("mouseover",function(){probabilityChart.transition().attr("opacity",1)}),data.element.find(".chart").on("mouseout",function(){probabilityChart.transition().attr("opacity",0)})},_hist:function(data){var bins=d3.range(0,Math.min(Math.round(d3.max(data,function(d){return d.y}))+1,Scales.xMax+1)+1),histogram=d3.layout.histogram().bins(bins).frequency(!1).value(function(d){return d.y});return d3.nest().key(function(d){return d.fill}).rollup(function(leaves){return $.extend(histogram(leaves),{count:leaves.length})}).entries(data)},"bus plot.ready:last + beforeLoad":function(e,plot){plot.loading(!0)},"bus plot.ready:last + afterLoad":function(e,plot){plot.loading(!1)},"bus plot.ready:last + data.ready":function(e,plot,loadedData){plot.data(this._hist(loadedData.data),loadedData.settings),this.fire("plot.afterRender",plot)}})})