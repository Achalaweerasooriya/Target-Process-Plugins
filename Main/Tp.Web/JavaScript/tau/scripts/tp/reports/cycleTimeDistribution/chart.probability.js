define(["jQuery","Underscore","libs/d3/d3","tp/reports/chart.behaviour"],function(t,n,e){function r(){}return r.prototype={init:function(t){this.handlers=this.initHandlers(t.handlers||[])},_cumulative:function(t){var n=e.layout.stack();return t.map(function(t){return n(t.values.map(function(n){return[{x:n.x,y:n.y,dx:n.dx,fill:t.key}]}))})},_join:function(t){return t[0].map(function(n,e){return{x:n[0].x,values:t.map(function(t){return t[e][0]})}})},data:function(t,n){var r=t.nodes,t=this._join(this._cumulative(r)),a=e.select(n.placeholder).attr("opacity",0).selectAll("g.probability").data(t);a.enter().append("g").attr("class",function(t){return"probability data-x-"+t.x}),a.exit().remove();var i=a.selectAll("path").data(function(t){return t.values},function(t){return t.fill});i.enter().append("path"),i.exit().remove(),i.attr("class",function(t){return n.scales.fill(t.fill)}).transition().attr("d",function(t){return"M"+n.scales.x(t.x)+","+n.scales.probability(t.y0)+"L"+n.scales.x(t.x)+","+n.scales.probability(t.y+t.y0)+"L"+n.scales.x(t.x+t.dx)+","+n.scales.probability(t.y+t.y0)})}},r});