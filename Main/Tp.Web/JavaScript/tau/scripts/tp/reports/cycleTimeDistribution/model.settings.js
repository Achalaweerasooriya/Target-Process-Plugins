define(["Underscore","tp/reports/settings/model.settings","tp/reports/settings/definitionBuilder","tp/reports/settings/templateDataBuilder"],function(_,BaseModel,DefinitionBuilder,templateDataBuilder){return BaseModel.extend({NAME_CHART:"Cycle Time Distribution",DESCRIPTION:["Distribution bars show how many entities were completed with a given cycle time."," Cumulative line shows how many days it will take to complete a user story or other entity with desired probability."].join(""),defaultData:{scale:"cycleTime",entities:["userstory","bug"],filter:"?EndDate > Today - 180(days)"},saveSettings:function(storage,data){var settings={scale:data.time.key,filter:data.filter,entities:JSON.stringify(_.reduce(data.entities,function(memo,d){return memo.push(d.id),memo},[]))};storage({scope:"Public",userData:settings}).done(),this._super(storage,settings)},setSettings:function(data,acid){function prop(key){return function(d){return d[key]}}function fnProperty(key,label){return{map:prop(key),label:label}}function fnNothing(label){return{map:$.noop,label:label}}var settings={strategy:"all",parameters:DefinitionBuilder.getWithLeadAndCycleTime(data,acid),mapping:{y:fnProperty(data.time.key,"% of all entities"),x:fnNothing(data.time.label),fill:fnProperty("type")}};this.fire("settings.changed",settings)},"bus model.ready":function(e,model){this.fire("dataBind",{times:templateDataBuilder.times(model),types:templateDataBuilder.assignables(model),isShowSettings:model.isShowSettings,name:this.NAME_CHART,description:this.DESCRIPTION,filter:templateDataBuilder.filter(model,"?EndDate > Today - 180(days)")})}})})