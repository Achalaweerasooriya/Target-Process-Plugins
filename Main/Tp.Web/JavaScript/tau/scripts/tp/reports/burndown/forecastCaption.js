define(["Underscore","tau/utils/utils.date","tp/reports/chart.format","libs/jquery/jquery.inputMaskEditor"],function(i,t,e){function n(){}return n.prototype={initialize:function(i){this.filter=i.filter},render:function(n,o){var c=e.precision(1),l=function(i){var t="release"==o.filter.burnDownType?"Weekly":"Daily";return i?t.toLowerCase():t},s=function(){var i=o.velocity?c(o.velocity)+""+o.filter.units+".&nbsp;&nbsp;":"n/a.";return"Calculated "+l(!0)+" velocity: "+i},r=function(){return o.forecast?"Estimated finish: "+t.convertToTimezone(o.forecast).toString("d MMM")+".":""},a=function(){return'<div class="forecast-section"><a href="javascript:void(0)" class="show-velocity-section ui-link">Forecast using new velocity</a><div class="velocity-section" style="display: '+(o.manuallySetVelocity?"block":"none")+'"><span>'+l(!1)+' velocity:</span> <input id="input-forecast" class="velocity-input" type="text" value="'+o.manuallySetVelocity+'" /> '+o.filter.units+' <button class="_show-new-forecasted tau-btn" onclick="return false;">Forecast</button> <a href="javascript:void(0)" class="_discard-velocity ui-link">Discard</a></div></div>'};n.caption.html("<div>"+s()+r()+(o.isPlannableFinished?"":a())+"</div>");var u=function(){return n.placeholder.find(".velocity-input")};u().inputMaskEditor({mask:"^[0-9]*([\\"+o.decimalSeparator+"][0-9]{0,2})?$"}),u().keypress(i.bind(function(i){i.which==$.ui.keyCode.ENTER&&this.filter.update()},this)),n.placeholder.find("._show-new-forecasted").click(i.bind(this.filter.update,this.filter)),n.placeholder.find("._discard-velocity").click(i.bind(function(){u().val(""),this.filter.update()},this)),n.placeholder.find(".show-velocity-section").click(i.bind(function(){u().val("");var t=function(){return n.placeholder.find(".velocity-section")};t().slideToggle(400,i.bind(function(){t().is(":visible")||this.filter.update()},this))},this))}},n});