define(["jQuery","libs/d3/d3"],function($,d3){function LineChart(){}return LineChart.prototype={render:function(chart,dataProvider){var self=this,marker=chart.createGroup("marker"),yRect=marker.append("rect").attr("class","lineChartPointYCoordinateRect").attr("x",0).attr("width",chart.margin).attr("height",20).attr("rx",5).attr("ry",5).style("display","none"),yText=marker.append("text").attr("class","lineChartPointYCoordinate").attr("x",chart.margin/2).attr("y",0).attr("width",chart.margin).attr("height",chart.margin).style("display","none"),yTextSpan=yText.append("tspan").attr("dy",0),yLine=marker.append("line").attr("class","lineChartPointYLine").attr("x1",chart.x(0)).style("display","none"),showYValue=function(d,i){yRect.attr("y",chart.y(dataProvider.getYValue(d))-yRect.attr("height")/2).style("display",null),yText.attr("y",chart.y(dataProvider.getYValue(d))+5).style("display",null),yTextSpan.text(Math.round(dataProvider.getYValue(d))),i>0&&yLine.attr("x2",chart.x(i)-7).attr("y1",chart.y(dataProvider.getYValue(d))).attr("y2",chart.y(dataProvider.getYValue(d))).style("display",null)},hideYValue=function(){yText.style("display","none"),yLine.style("display","none"),yRect.style("display","none")},emphasizeLine=function(line){line.attr("stroke-width",5)},regularizeLine=function(line){line.attr("stroke-width",3)};chart.createGroup("chart").selectAll("line.lineChart").data(dataProvider.data).enter().append("g").attr("class",function(d,i){return"item"+i}).each(function(d,i){if(d.total==null)return;var group=d3.select(this),popupPointer=group.append("circle").attr("cx",chart.x(i+.5)).attr("cy",chart.y((d.total.remained+d.total.remainedForNextDay)/2)).attr("r",1).attr("stroke","#3BCAFF").attr("stroke-width",1),line=group.append("line").attr("class","lineChart").attr("x1",chart.x(i)).attr("y1",chart.y(d.total.remained)).attr("x2",chart.x(i+1)).attr("y2",chart.y(d.total.remainedForNextDay)).attr("stroke","#3BCAFF").attr("stroke-width",3),circle=group.append("circle").attr("class","lineChartPoint").attr("cx",chart.x(i)).attr("cy",chart.y(d.total.remained)).attr("r",4);d.last&&group.append("circle").attr("class","lineChartPoint").attr("cx",chart.x(i+1)).attr("cy",chart.y(d.total.remainedForNextDay)).attr("r",4);var rectangle=group.append("rect").attr("x",chart.x(i)).attr("y",chart.y(chart.yAxis.max)).attr("class","lineChartPointHover").attr("width",chart.xCellSize).attr("height",chart.y(0)-chart.y(chart.yAxis.max)).attr("opacity",0).on("mouseover",function(){d3.select(this).attr("opacity",.1),showYValue(d,i),emphasizeLine(line)}).on("mouseout",function(){d3.select(this).classed("lineChartPointHoverSelected")||d3.select(this).attr("opacity",0),hideYValue(),regularizeLine(line)});$(rectangle[0]).click(function(event){$(self).trigger("click",{name:"lineChart",$pointer:$(popupPointer[0]),data:d,$rect:$(this),origin:event})})})},fadeOut:function(element){d3.select(element).attr("opacity",.1),d3.select(element).attr("class","lineChartPointHoverSelected")},fadeIn:function(element){d3.select(element).attr("class","lineChartPointHover"),d3.select(element).attr("opacity",0)}},LineChart})