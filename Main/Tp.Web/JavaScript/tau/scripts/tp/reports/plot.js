define(["jQuery","libs/d3/d3","app.path"],function(t,i){function s(t){this.height=t.height||600,this.margin=t.margin||30,this.mode=t.mode||"simple",this.detalization=t.detalization||"full",this.charts=t.charts||[],this.captions=t.captions||[],this.legend='<div class="legend-wrapper">\n    <div class="legend-element"><p><i class="img img-actual-progress" />Actual progress</p></div>\n    <div class="legend-element"><p><i class="img img-ideal-line" />Ideal line</p></div>\n    <div class="legend-element"><p><i class="img img-forecast" />Forecast</p></div>\n</div>'}return s.prototype={_initialize:function(t){this.xAxis=t.getXAxis(),this.yAxis=t.getYAxis(),this.yCellSize=this._getYCellSize(this.yAxis.count),this.xCellSize=this._getXCellSize(this.placeholder.width(),this.xAxis.count,this.yCellSize),this.width=this.xAxis.count*this.xCellSize+2*this.margin,this.x=i.scale.linear().domain([0,this.xAxis.max]).range([0+this.margin+5,this.width-this.margin]),this.y=i.scale.linear().domain([0,this.yAxis.max]).range([this.height-this.margin-35,0+this.margin])},_getYCellSize:function(t){return(this.height-this.margin)/t},_getXCellSize:function(t,i,s){var e=s,a=i*e+2*this.margin;return a>t&&(e=t>.75*a?(t-2*this.margin)/i:.75*s),e},render:function(t){return this._initialize(t),this.placeholder.html(""),0==this.xAxis.count||null==t.filter?void this.placeholder.html('<div class="_empty empty">\n    <div class="empty-text">\n        <div class="first-line">Not enough data to build this beautiful chart</div>\n        <div class="second-line">Add Release or Iteration and complete some user stories</div>\n    </div>\n</div>').find(".empty").height(this.height).width(1e3):(this._renderPlot(t),this._renderCaptions(t),this._renderCharts(t),void this.placeholder.append(this.legend))},_renderPlot:function(t){this._createPlot(),this._renderAxes(),this._renderGrid(),this._renderLabels(t)},_renderAxes:function(){var t=this.createGroup("axes");t.append("line").attr("class","yAxis").attr("y1",this.y(this.yAxis.values[0])).attr("x1",this.x(this.xAxis.values[0])).attr("y2",this.y(this.yAxis.max)).attr("x2",this.x(this.xAxis.values[0])),t.append("line").attr("class","xAxis").attr("x1",this.x(this.xAxis.values[0])).attr("y1",this.y(this.xAxis.values[0])).attr("x2",this.x(this.xAxis.max)).attr("y2",this.y(this.yAxis.values[0]))
},_renderGrid:function(){var t=this.createGroup("grid");t.selectAll(".yLine").data(this.y.ticks(this.yAxis.count+1)).enter().append("line").attr("class","yLine").attr("y1",this.y).attr("x1",this.x(this.xAxis.values[0])).attr("y2",this.y).attr("x2",this.x(this.xAxis.max)),t.selectAll(".xLine").data(this.x.ticks(this.xAxis.count)).enter().append("line").attr("class","xLine").attr("x1",this.x).attr("y1",this.y(this.yAxis.values[0])).attr("x2",this.x).attr("y2",this.y(this.yAxis.max))},_renderLabels:function(){var t=this.createGroup("labels"),i=this;t.selectAll(".xLabel").data(this.x.ticks(this.xAxis.count)).enter().append("text").attr("class","xLabel").attr("x",i.x).attr("y",this.y(0)+.9*this.margin).text(this.xAxis.xLabel).call(this.xAxis.transform({x:i.x,y:i.y})),t.selectAll(".yLabel").data(this.y.ticks(this.yAxis.count+1)).enter().append("text").attr("class","yLabel").text(this.yAxis.label).attr("x",this.margin-10).attr("y",this.y).attr("dy",4)},_createPlot:function(){this.placeholder.width(i.max([this.width,this.optimalWidth])),this.caption=i.select(this.placeholder[0]).append("div").attr("id","report-caption").attr("class","caption").style("width",i.max([this.width,this.optimalWidth/3])+"px"),this.plot=i.select(this.placeholder[0]).append("div").attr("class","report-caption__wrap").style({height:this.height+"px"}).append("svg").attr("width",this.width).attr("height",this.height)},createGroup:function(t){return this.plot.append("g").attr("class","_"+t)},getLastBurnDownPoint:function(){return t(this.plot.selectAll("line.lineChart")[0]).last()[0]},_renderCaptions:function(t){for(var i=0;i<this.captions.length;i++)this.captions[i].render(this,t)},_renderCharts:function(t){for(var i=0;i<this.charts.length;i++)this.charts[i].render(this,t)}},s});