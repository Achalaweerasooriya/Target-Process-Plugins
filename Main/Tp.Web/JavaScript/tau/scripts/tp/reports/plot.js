define(["jQuery","libs/d3/d3"],function($,a){function b(a){this.height=a.height||600,this.margin=a.margin||30,this.mode=a.mode||"simple",this.detalization=a.detalization||"full",this.charts=a.charts||[],this.placeholder=a.placeholder}return b.prototype={_initialize:function(b){this.xAxis=b.getXAxis(),this.yAxis=b.getYAxis(),this.yCellSize=this._getYCellSize(this.yAxis.count),this.xCellSize=this._getXCellSize(this.placeholder.width(),this.xAxis.count,this.yCellSize),this.width=this.xAxis.count*this.xCellSize+this.margin*2,this.x=a.scale.linear().domain([0,this.xAxis.max]).range([0+this.margin,this.width-this.margin]),this.y=a.scale.linear().domain([0,this.yAxis.max]).range([this.height-this.margin,0+this.margin])},_getYCellSize:function(a){return(this.height-this.margin)/a},_getXCellSize:function(a,b,c){var d=c,e=b*d+this.margin*2;return e>a&&(e*.75<a?d=(a-this.margin*2)/b:d=.75*c),d},render:function(a){this._initialize(a),this.placeholder.html("");if(this.xAxis.count==0){this.placeholder.html('<div class="_empty empty">No data to display</div>');return}this._renderPlot(),this._renderCharts(a)},_renderPlot:function(){this._createPlot(),this._renderAxes(),this._renderGrid(),this._renderLabels()},_renderAxes:function(){var a=this.createGroup("axes");a.append("line").attr("class","yAxis").attr("y1",this.y(this.yAxis.values[0])).attr("x1",this.x(this.xAxis.values[0])).attr("y2",this.y(this.yAxis.max)).attr("x2",this.x(this.xAxis.values[0])),a.append("line").attr("class","xAxis").attr("x1",this.x(this.xAxis.values[0])).attr("y1",this.y(this.xAxis.values[0])).attr("x2",this.x(this.xAxis.max)).attr("y2",this.y(this.yAxis.values[0]))},_renderGrid:function(){var a=this.createGroup("grid");a.selectAll(".yLine").data(this.y.ticks(this.yAxis.count+1)).enter().append("line").attr("class","yLine").attr("y1",this.y).attr("x1",this.x(this.xAxis.values[0])).attr("y2",this.y).attr("x2",this.x(this.xAxis.max)),a.selectAll(".xLine").data(this.x.ticks(this.xAxis.count)).enter().append("line").attr("class","xLine").attr("x1",this.x).attr("y1",this.y(this.yAxis.values[0])).attr("x2",this.x).attr("y2",this.y(this.yAxis.max))},_renderLabels:function(){var a=this.createGroup("labels");a.selectAll(".xLabel").data(this.x.ticks(this.xAxis.count)).enter().append("text").attr("class","xLabel").text(this.xAxis.label).attr("x",this.x).attr("y",this.y(0)+this.margin*.9),a.selectAll(".yLabel").data(this.y.ticks(this.yAxis.count+1)).enter().append("text").attr("class","yLabel").text(this.yAxis.label).attr("x",this.margin-10).attr("y",this.y).attr("dy",4)},_createPlot:function(){this.plot=a.select("#"+this.placeholder.attr("id")).append("svg").attr("width",this.width).attr("height",this.height)},createGroup:function(a){return this.plot.append("g").attr("class","_"+a)},_renderCharts:function(a){for(var b=0;b<this.charts.length;b++)this.charts[b].render(this,a)}},b})