define(["jQuery","libs/d3/d3","tp/reports/timeDistribution/chart.axes.format","tp/reports/timeDistribution/chart.scales"],function($,d3,format,Scales){function setAlign(val){return function(config){return config.my=val,config}}var formatDaysForCount=function(number,term){switch(number){case 0:return"less than 1 day";case 1:return"1 day";case Scales.xMax:return"more than "+number+" days";default:return number+" days"}};return{create:function(config){var tooltip=$('<div class="tau-chart-tooltip" style="position:absolute"></div>').appendTo(config.placeholder).tauBubble({content:"",className:"tau-chart-tooltip",onPositionConfig:setAlign("left bottom"),onBeforeShow:function($popup){function content(){return["<div>"+formatDaysForCount(d.values[0].x,"d")+"</div>"].concat(d.values.map(function(d){return'<div><span class="'+context.scales.fill(d.fill)+'"><strong>'+format.y(d.y)+"</strong> of all "+config.contextProvider.getTerms(d.fill).names.toLowerCase()+"</span>"+"<span> ("+d.length+" of "+d.count+")</span></div>"})).join("")}var d=this.$target.data("d"),context=this.$target.data("context");$popup.find('[role="content"]').html(content())}});return{mouseover:function(d,context){var bars=d3.select(this).select("rect"),offset=$(this).offset(),width=bars[0][0].width.animVal.value;offset.top+=1,offset.left+=width/2,tooltip.data("d",d3.select(this).datum()),tooltip.data("context",context),tooltip.offset(offset).tauBubble("show")},mouseout:function(d){tooltip.tauBubble("hide")}}}}})