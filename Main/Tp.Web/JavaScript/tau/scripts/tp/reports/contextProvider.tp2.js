define(["jQuery","tp/gateway","tau/core/termProcessor","app.path"],function(e,t,r,n){function s(){this.context=null,this.gateway=t,this.loading=!1}return s.prototype={isTP3:!1,_getContextUrl:function(){return this._getUrl("/api/v1/Context/?acid="+new n.tp.URL(location.href).getAcid())},_getTeamsUrl:function(){return this._getUrl("/api/v1/Teams?include=[id,name]")},_getUrl:function(e){return new n.tp.WebServiceURL(e).url},onReady:function(){var t=e.Deferred(),r=this;return this.gateway.getJSON(this._getContextUrl(),function(e){r.context=e,r.loading=!1,r._selectedProjects=r.context.SelectedProjects.Items,0===r.context.SelectedTeams.Items.length?r.gateway.getJSON(r._getTeamsUrl(),function(e){r._selectedTeams=e.Items,t.resolve()}):(r._selectedTeams=r.context.SelectedTeams.Items,t.resolve())}),t},getProjectIds:function(){return e.map(this._selectedProjects,function(e){return e.Id})},getTeamIds:function(){return[]},getTermProcessorForCurrentProject:function(){var e=this,t=this._selectedProjects.filter(function(t){return t.Id==e.currentProjectId}).map(function(e){return e.Process.Id})[0];null==t&&(t=this._selectedProjects[0].Process.Id);var n=this.context.Processes.Items.filter(function(e){return e.Id==t})[0];return new r(n.Terms.Items.map(function(e){return{name:e.Name,value:e.Value}}))},getBugsTerm:function(){return this.getTermProcessorForCurrentProject().getTerms("Bug").names},getIterationTerm:function(){return this.getTermProcessorForCurrentProject().getTerms("Iteration").name},setCurrentProject:function(e){this.currentProjectId=e},isPracticeAvailable:function(e){var t=this.context.Processes.Items.filter(function(t){var r=t.Practices.Items.filter(function(t){return t.Name==e});return r.length>0});return t.length>0},getReleaseTerm:function(){return this.getTermProcessorForCurrentProject().getTerms("Release").name}},s});