define(["jQuery","tp/gateway","tau/core/termProcessor","app.path"],function($,gateway,TermProcessor,appPath){function ContextProvider(){this.context=null,this.gateway=gateway,this.loading=!1}return ContextProvider.prototype={_getContextUrl:function(){return this._getUrl("/api/v1/Context/?acid="+(new appPath.tp.URL(location.href)).getAcid())},_getTeamsUrl:function(){return this._getUrl("/api/v1/Teams?include=[id,name]")},_getUrl:function(relativeUrl){return(new appPath.tp.WebServiceURL(relativeUrl)).url},onReady:function(success){var that=this;this.gateway.getJSON(this._getContextUrl(),function(data){that.context=data,that.loading=!1,that._selectedProjects=that.context.SelectedProjects.Items,that.context.SelectedTeams.Items.length==0?that.gateway.getJSON(that._getTeamsUrl(),function(data){that._selectedTeams=data.Items,success()}):(that._selectedTeams=that.context.SelectedTeams.Items,success())})},getProjectIds:function(){return $.map(this._selectedProjects,function(project){return project.Id})},getTeamIds:function(){return[]},getTermProcessorForCurrentProject:function(){var that=this,processId=this._selectedProjects.filter(function(project){return project.Id==that.currentProjectId}).map(function(project){return project.Process.Id})[0];processId==null&&(processId=this._selectedProjects[0].Process.Id);var process=this.context.Processes.Items.filter(function(process){return process.Id==processId})[0];return new TermProcessor(process.Terms.Items.map(function(t){return{name:t.Name,value:t.Value}}))},getBugsTerm:function(){return this.getTermProcessorForCurrentProject().getTerms("Bug").names},getIterationTerm:function(){return this.getTermProcessorForCurrentProject().getTerms("Iteration").name},setCurrentProject:function(id){this.currentProjectId=id},isPracticeAvailable:function(name){var practices=this.context.Processes.Items.filter(function(process){var iterationPractices=process.Practices.Items.filter(function(practice){return practice.Name==name});return iterationPractices.length>0});return practices.length>0},getReleaseTerm:function(){return this.getTermProcessorForCurrentProject().getTerms("Release").name}},ContextProvider})