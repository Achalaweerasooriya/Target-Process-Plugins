define(["jQuery","libs/d3/d3","tp/reports/service.chart.size"],function($,d3,ServiceChartSize){function Plot(config){var defaultSizeService=new ServiceChartSize;this.defaultSize=defaultSizeService.size(),$.extend(this,config),this.size=this.size||defaultSizeService,this.empty=$(config.placeholder).find(".empty"),this.plot=d3.select(config.placeholder).select("svg"),$(this.placeholder).height(this.defaultSize.height),this.loader=$('<div class="loader-container"></div>').prependTo($(this.placeholder)).css({width:"100%",height:this.defaultSize.height,position:"absolute",top:0}).tauProgressIndicator(),this.plot.append("defs");var groups=this.plot.selectAll("g.axis").data(this.axes).enter().append("g").attr("class","axis");groups.append("text").attr("class","axisLabel axisTitle"),this.plot.selectAll("g.chart").data(this.charts).enter().append("g").attr("class","chart")}return Plot.prototype={loading:function(isLoading){isLoading?(this.loader.tauProgressIndicator("show"),this._hideEmpty()):this.loader.tauProgressIndicator("hide")},_hideEmpty:function(){this.empty.addClass("invisible")},_showEmpty:function(){this.empty.removeClass("invisible")},data:function(data,settings){var that=this,hidePlot=function(){$(that.plot[0][0]).hide(),that.setSize(that.defaultSize),that._showEmpty()},showPlot=function(){that._hideEmpty(),$(that.plot[0][0]).show()};if(!data||!data.length){$(this).trigger("nodata"),hidePlot();return}var box=this.getBox(data);this.setSize(box),showPlot();var scales=this.scales.get(data,settings,box),context={scales:scales,extend:function(extension){return $.extend(extension,this)},plot:box};this.plot.selectAll("g.axis").data(this.axes).each(function(axis){axis.render(context.extend({placeholder:this}))}),this.plot.selectAll("g.chart").data(this.charts).each(function(chart){chart.data(data,context.extend({placeholder:this}))})},getBox:function(data){var size=this.size?this.size.size(data):this.defaultSize;return $.extend(size,{margin:60})},setSize:function(box){$(this.placeholder).height(box.height),$(this.plot).height(box.height),$(this.empty).height(box.height)}},Plot})