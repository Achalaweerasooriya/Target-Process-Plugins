define(["jQuery","libs/d3/d3"],function($,d3){function Plot(config){this.axes=config.axes,this.scales=config.scales,this.charts=config.charts,this.placeholder=config.placeholder,this.width=config.width,this.height=config.height,$(config.placeholder).height(this.height),this.plot=d3.select(config.placeholder).select("svg").attr("height",this.height).attr("width",this.width),this.empty=$(config.placeholder).find(".empty").width(this.width).height(this.height);var groups=this.plot.selectAll("g.axis").data(this.axes).enter().append("g").attr("class","axis");groups.append("text").attr("class","axisLabel axisTitle"),groups.append("line").attr("class","additionalAxis"),this.plot.selectAll("g.chart").data(this.charts).enter().append("g").attr("class","chart")}return Plot.prototype={getBoxSettings:function(){return{width:this.width,height:this.height,margin:60}},loading:function(isLoading){isLoading?($(this.placeholder).addClass("loader"),this._hideEmpty()):$(this.placeholder).removeClass("loader")},_hideEmpty:function(){this.empty.addClass("invisible")},_showEmpty:function(){this.empty.removeClass("invisible")},data:function(data,settings){var that=this,hidePlot=function(){$(that.plot[0][0]).hide(),that._showEmpty()},showPlot=function(){that._hideEmpty(),$(that.plot[0][0]).show()};if(!data||!data.length){hidePlot();return}showPlot();var boxSettings=this.getBoxSettings(),scales=this.scales.get(data,settings,boxSettings),context={scales:scales,extend:function(extension){return $.extend(extension,this)},plot:boxSettings};this.plot.selectAll("g.axis").data(this.axes).each(function(axis){axis.render(context.extend({placeholder:this}))}),this.plot.selectAll("g.chart").data(this.charts).each(function(chart){chart.data(data,context.extend({placeholder:this}))})}},Plot})