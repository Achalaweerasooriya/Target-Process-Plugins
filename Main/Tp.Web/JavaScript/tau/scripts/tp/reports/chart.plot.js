define(["jQuery","libs/d3/d3","tp/reports/service.chart.size"],function(t,e,i){function s(s){var h=new i;this.defaultSize=h.size(),t.extend(this,s),this.size=this.size||h,this.empty=t(s.placeholder).find(".empty"),this.plot=e.select(s.placeholder).select("svg"),t(this.placeholder).height(this.defaultSize.height),this.loader=t('<div class="loader-container"></div>').prependTo(t(this.placeholder)).css({width:"100%",height:this.defaultSize.height,position:"absolute",top:0}).tauProgressIndicator(),this.plot.append("defs");var a=this.plot.selectAll("g.axis").data(this.axes).enter().append("g").attr("class","axis");a.append("text").attr("class","axisLabel axisTitle"),this.plot.selectAll("g.chart").data(this.charts).enter().append("g").attr("class","chart")}return s.prototype={loading:function(t){t?(this.loader.tauProgressIndicator("show"),this._hideEmpty()):this.loader.tauProgressIndicator("hide")},_hideEmpty:function(){this.empty.addClass("invisible")},_showEmpty:function(){this.empty.removeClass("invisible")},data:function(e,i){var s=this,h=e?e.nodes:[],a=function(){t(s.plot[0][0]).hide(),s.setSize(s.defaultSize),s._showEmpty()},l=function(){s._hideEmpty(),t(s.plot[0][0]).show()};if(!h||!h.length)return t(this).trigger("nodata"),void a();var n=this.getBox(h);this.setSize(n),l();var o=this.scales.get(h,i,n),r={scales:o,extend:function(e){return t.extend(e,this)},plot:n};this.plot.selectAll("g.axis").data(this.axes).each(function(t){t.render(r.extend({placeholder:this}))}),this.plot.selectAll("g.chart").data(this.charts).each(function(t){t.data(e,r.extend({placeholder:this}))})},getBox:function(e){var i=this.size?this.size.size(e):this.defaultSize;return t.extend(i,{margin:60})},setSize:function(e){t(this.placeholder).height(e.height),t(this.plot).height(e.height),t(this.empty).height(e.height)}},s});