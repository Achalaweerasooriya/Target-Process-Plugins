define(["Underscore"],function(_){var getTypeGroup=function(type){switch(type){case"feature":case"userstory":case"task":case"bug":case"request":return"assignable";case"solution":return;default:return type}},cell={relations:function(){return"masterRelations.Select({Master.id as id, Master.name as name,Master.entityType.name as type,RelationType.name as relationType,id as relationId}) as masters,slaveRelations.Select({Slave.id as id,Slave.name as name, Slave.entityType.name as type,RelationType.name as relationType,id as relationId}) as slaves"},data:function(type){switch(getTypeGroup(type)){case"assignable":return"id,name,entityType.name as type,entityState.IsFinal as isFinalState,effort,tags,assignedUser.Select({id,firstName,lastName,email,avatarUri}) as assignedUsers";case"testplanrun":return"id,name,entityType.name as type,entityState.IsFinal as isFinalState";case"impediment":return"id,name,entityType.name as type,entityState.IsFinal as isFinalState,{responsible.avatarUri as avatarURI,responsible.lastName,responsible.firstName,responsible.id} as responsible";default:return"id,name,entityType.name as type"}}};return{getTypeGroup:getTypeGroup,cell:cell,getWithRelations:function(data,acid){return{base64:!0,take:100,where:null,definition:{global:{acid:acid},x:null,y:null,cells:{items:_.chain(data.entities).map(function(item){return{id:item.id,data:"{"+cell.data(item.id)+","+cell.relations()+"}",ordering:null}}).value(),filter:data.filter},user:{cardFilter:data.onlyWithRelations?"?(MasterRelations.Count > 0) or (SlaveRelations.Count > 0)":""}}}},getWithLeadAndCycleTime:function(filter,acid){return{base64:!0,take:1e3,where:null,definition:{global:{acid:acid},x:{id:"entitystate",filter:"?IsFinal is True",ordering:null},y:{id:"startdate",filter:filter.time.startDateFilter,ordering:null},cells:{items:_.chain(filter.entities).map(function(item){return{id:item.id,data:"{id,name,entityType.name as type,endDate,leadTime,cycleTime}",filter:null,ordering:null}}).value(),filter:filter.filter},user:{cardFilter:"?EndDate is not None"}}}}}})