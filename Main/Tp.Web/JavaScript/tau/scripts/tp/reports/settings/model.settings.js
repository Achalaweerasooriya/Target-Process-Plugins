define(["Underscore","tau/core/extension.base"],function(t,e){return e.extend({defaultData:{},scopeData:"userData",initialSettings:function(e){return e.data&&e.data.userData?t.defaults(e.data.userData,this.defaultData):this.defaultData},getStorage:function(e,a){var i=a.getRestStorage();return t.bind(i.data,i,"settings",e.config.storageName)},"bus beforeInit":function(t,e){var a=e.config.context.configurator;this.fire("configurator.ready",a);var i=this.getStorage(e,a);this.fire("storageSettings.ready",i),i().then(this.initialSettings.bind(this)).done(function(t){this.fire("model.ready",t)}.bind(this))},"bus configurator.ready:last > storageSettings.ready:last > formData.changed":function(e,a,i,n){this.saveSettings(i,n),this.getAcid(a).done(t.bind(function(t){this.setSettings(n,t,a)},this))},"bus saveSettings:last + storageSettings.ready:last + saveSetting":function(e,a,i,n){this.saveToStorage(i,t.extend(a,n))},saveToStorage:function(t,e){t({scope:"Public",userData:e}).done()},getAcid:function(t){var e=$.Deferred();return t.getAppStateStore().get({fields:["acid"],callback:function(t){e.resolve(t.acid)}}),e},saveSettings:function(t,e){var a=this.processSettings(e);this.saveToStorage(t,a),this.fire("saveSettings",a)},setSettings:function(){},processSettings:function(){}})});