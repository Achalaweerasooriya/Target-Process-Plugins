define(["Underscore","tau/core/extension.base"],function(_,BaseModel){return BaseModel.extend({defaultData:{},"bus beforeInit":function(e,initData){var configurator=initData.config.context.configurator;this.fire("configurator.ready",configurator);var storage=configurator.getRestStorage();storage=_.bind(storage.data,storage,"settings",initData.config.storageName),this.fire("storageSettings.ready",storage),storage().done(_.bind(function(data){!data.data||!data.data.userData?this.fire("model.ready",this.defaultData):this.fire("model.ready",_.defaults(data.data.userData,this.defaultData))},this))},"bus configurator.ready:last > storageSettings.ready:last > formData.changed":function(e,configurator,storage,data){this.saveSettings(storage,data),this.getAcid(configurator).done(_.bind(function(acid){this.setSettings(data,acid)},this))},"bus saveSettings:last + storageSettings.ready:last + saveSetting":function(evt,lastData,storage,data){storage({scope:"Public",userData:_.extend(lastData,data)}).done()},getAcid:function(configurator){var deferred=$.Deferred();return configurator.getAppStateStore().get({fields:["acid"],callback:function(r){deferred.resolve(r.acid)}}),deferred},saveSettings:function(storage,data){this.fire("saveSettings",data)},setSettings:function(data,acid){}})})