define(["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/overlay/ui.behaviour.overlay","libs/jquery/jquery.placeholder","libs/jquery/jquery.toggleFilter","libs/jquery/jquery.tau.resetableInput"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $form=renderData.element,$filters=$form.find(".i-role-filter-input");$filters.placeholder(),$filters.each(function(){$(this).data("default",$(this).val())}),$form.find(".i-role-filter-control").find("button").addClass("tau-checked").end().toggleFilter({defaultExpand:!0}),this.fire("$form.ready",$form),this.fire("view.dom.ready",$form),$form.trigger("_change")},"bus $el.ready:last + error":function(evt,$el){$el.tauOverlay("hide")},"bus $form.ready":function(evt,$form){var self=this;$form.delegate(".tau-chart-time-switch button","click",function(e){$form.find(".tau-chart-time-switch button").removeClass("tau-checked"),$(this).addClass("tau-checked"),$form.trigger("_change",{$input:$(this),sourceEvent:e})}),$form.delegate("[name=entities]","change",function(e){$form.find("input:checked").next().addClass("tau-checked"),$form.find("input:not(:checked)").next().removeClass("tau-checked"),$form.trigger("_change",{$input:$(this),sourceEvent:e})});var filterSelector="[name=data_filter]";$form.delegate(filterSelector,"keydown",function(e){if(e.which==$.ui.keyCode.ENTER){var $input=$(this);$input.blur()}}),$form.on("_change",function(e,source){var data=self.bindForm($form),$filter=$form.find(filterSelector);self._enableFilter(data.entities.length,$filter),self.fire("formData.changed",data)})},_enableFilter:function(enabled,$filter){$filter.prop("disabled",!enabled);var $control=$filter.closest(".i-role-filter-control");$control.find(".i-role-help").prop("disabled",!enabled),$control.find(".i-role-filter-toggle").prop("disabled",!enabled&&!$control.hasClass("i-role-filter-control_on"))},bindTime:function($element){return{key:$element.data("val"),label:$element.data("axislabel"),startDateFilter:$element.data("startdatefilter")}},bindForm:function($form){return{time:this.bindTime($form.find(".tau-chart-time-switch button.tau-checked")),entities:$form.find("[name=entities]:checked").map(function(){return{id:$(this).val()}}),filter:$form.find("[name=data_filter]").val()}}})})