define(["Underscore","tau/core/extension.base","tau/models/board.editor/board.filter.suggestionManager"],function(_,BaseModel,SuggestionManager){var Model=BaseModel.extend({"bus beforeInit":function(e,initData){var configurator=initData.config.context.configurator;this.fire("configurator.ready",configurator),this.fire("suggestionManager.ready",new SuggestionManager(configurator))},getTypes:function(settings){return _.map(settings.parameters.definition.cells.items,function(x){return x.id})},"bus filter.autocomplete.preload + suggestionManager.ready:last + settings.changed:last":function(evt,data,suggestionManager,rs){var types=this.getTypes(rs);if(types.length==0)return;var prefix=data.value;if(!prefix||prefix.length===0||prefix[0]!="?")return;var values=[prefix.trim()+" ",prefix.trim()+"."];_.each(values,function(value){var querySet={query:{resourceTypes:types,script:value}};suggestionManager.get(querySet)})},"bus filter.autocomplete.resolve + suggestionManager.ready:last + settings.changed:last":function(evt,data,suggestionManager,rs){var $input=data.$input,types=this.getTypes(rs);if(types.length==0){data.next([]);return}var term=data.request.term.slice(0,$input[0].selectionStart),positive=function(res){var items=res.Suggestions?res.Suggestions.Items:[];items=_.map(items,function(item){return item.Source=res.Source,item.Position=res.Position,item}),data.next(items)},negative=function(){data.next([])},querySet={query:{resourceTypes:types,script:term}};suggestionManager.get(querySet).done(positive).fail(negative)}});return Model})