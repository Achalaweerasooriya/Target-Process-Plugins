define(["tp/reports/dataRepository","tau/components/extensions/component.extension.base"],function(DataRepository,ExtensionBase){function select(key){return function(d){return d[key]}}function selectMany(mapping){return function(d){var obj={id:d.id,data:d};for(var key in mapping)obj[key]=mapping[key].map(d);return obj}}var dataRepository=new DataRepository({url:"/slice/v1/matrix/list"});return ExtensionBase.extend({_error:function(e,data){this.fire("afterLoad"),this.fire("error",JSON.parse(e.responseText).Message)},"bus settings.changed":function(evt,settings){function getdataFrom(response){return response.items[0].dynamic.items.map(select("data")).map(selectMany(settings.mapping))}function getMetadataFrom(response){var hasMore=!1;if(response.items.length>0){var metaDataItems=response.items[0].fixed.items;hasMore=metaDataItems.length>0&&metaDataItems.filter(function(item){return item.type=="cellpaging"}).length>0}return{hasMore:hasMore}}function ready(d,metadata){self.fire("data.ready",{data:d,metaData:metadata,settings:settings}),self.fire("clearError"),self.fire("afterLoad")}function requestData(parameters,next,args){dataRepository.get(parameters,function(response){next(parameters,response,args)},$.proxy(self._error,self),$.proxy(self._error,self))}var self=this;this.fire("beforeLoad");var next={page:function(parameters,response){ready(getdataFrom(response),getMetadataFrom(response))},all:function(parameters,response,acc){acc=acc||[],acc=acc.concat(getdataFrom(response)),getMetadataFrom(response).hasMore?(parameters.skip=parameters.skip||0,parameters.skip+=parameters.take,requestData(parameters,next.all,acc)):ready(acc,null)}};requestData(settings.parameters,next[settings.strategy],null)}})})