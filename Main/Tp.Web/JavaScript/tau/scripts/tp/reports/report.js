define(["jQuery","Underscore","tp/reports/plot","template!tp/reports/burndown/template.empty","tp/reports/burndown/summaryPopup"],function(t,e,i,h){var r=function(e){this.name=e.name,this.placeholder=t(e.placeholder),this.dataProvider=e.dataProvider,this.aspectRatio=.6,this.height=e.height,this.width=e.width,this.width&&(this.height=this.height||this._calculateHeight(this.width)),this.height=this.height||600,this.plot=new i({charts:e.charts,captions:e.captions,height:this.height,width:this.width,aspectRatio:this.aspectRatio,margin:e.margin||50,showLegend:e.showLegend,showLabels:e.showLabels,axes:e.axes}),this.navigator=e.navigator,this.contextProvider=e.contextProvider,this.emptyTemplate=e.emptyTemplate||h.render(),this.loaderTemplate=e.loaderTemplate,t(e.charts).on("click",this._chartClick.bind(this)),this._renderLoader()};return r.prototype={_calculateHeight:function(t){return this.aspectRatio*t},getTermProcessor:function(){return this.contextProvider.getTermProcessorForCurrentProject()},update:function(e){this._renderLoader(),this.dataProvider.initialize(e,function(e){this.placeholder.removeClass("loader"),e.isEmpty()?this._renderEmpty():this.plot.render(e),t(this).trigger("afterRender")}.bind(this))},_renderEmpty:function(){this.placeholder.empty().append(this.emptyTemplate),this.placeholder.find(".tau-role-status-placeholder").height(this.height).width(this.width)},_renderLoader:function(){this.placeholder.empty(),this.loaderTemplate?this.placeholder.height(this.height).append(this.loaderTemplate):this.placeholder.height("").width("").addClass("loader")},resize:function(e){e.width&&(this.width=e.width,e.height||(this.height=this._calculateHeight(e.width))),e.height&&(this.height=e.height),this.plot.hasData()?this.plot.resize({width:this.width,height:this.height}):this._renderEmpty(),t(this).trigger("afterRender")},render:function(){t(this).trigger("afterInit"),this.plot.placeholder=this.placeholder},_chartClick:function(e,i){if(i.data.effort){var h=i.$rect;if(h.data("summaryPopup")&&h.summaryPopup("popup").is(":visible"))return void i.origin.stopPropagation();
var r=this,a=this.navigator;this.dataProvider.getDetails(i.data,function(s){h.summaryPopup({alignTo:i.$pointer,termProcessor:r.getTermProcessor(),hideOnScrollContainer:r.contextProvider.isTP3?h.scrollParent():null,index:i.index,data:s,show:function(){e.target.fadeOut(i.rect)},hide:function(){e.target.fadeIn(i.rect)},navigate:function(t){a.navigate(t)}}).summaryPopup("show"),t(r).trigger("details.afterRender",[h.summaryPopup("popup")])})}}},r});