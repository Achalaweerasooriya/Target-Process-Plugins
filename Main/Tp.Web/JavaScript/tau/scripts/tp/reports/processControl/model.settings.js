define(["Underscore","tp/reports/settings/model.settings","tau/utils/utils.date","tp/reports/settings/definitionBuilder","tp/reports/settings/templateDataBuilder"],function(e,t,r,i,n){return t.extend({NAME_CHART:"Process Ð¡ontrol",defaultData:{scale:"cycleTime",entities:["userstory","bug"],filter:"?EndDate > Today - 180(days)"},processSettings:function(t){return{scale:t.time.key,filter:t.filter,useFilter:t.useFilter,entities:JSON.stringify(e.reduce(t.entities,function(e,t){return e.push(t.id),e},[]))}},setSettings:function(e,t){function n(e,t){return function(r){var i=r[e];return"undefined"==typeof t||"undefined"!=typeof i&&null!=i||(i=t),i}}function s(e,t,r){return{map:n(e,r),label:t}}function o(e,t){return{map:function(t){return n(e)(t)?r.convertToTimezone(n(e)(t))[0]:void 0},label:t}}function a(e){return{map:function(){return e}}}var u={strategy:"page",parameters:i.getWithLeadAndCycleTime(e,t),mapping:{x:o("endDate","End Date"),y:s(e.time.key,e.time.label,0),r:a(4),stroke:s("type","Entity Type")}};this.fire("settings.changed",u)},"bus model.ready + contextProvider.ready":function(t,r,i){this.fire("dataBind",{times:n.times(r),types:n.assignables(r),isShowSettings:r.isShowSettings,name:this.NAME_CHART,description:this.getDescription(i),filter:n.filter(r,"?EndDate > Today - 180(days)"),useFilter:e.isUndefined(r.useFilter)?!0:r.useFilter,termProcessor:i.getTermProcessorForCurrentProject()})},getDescription:function(e){return["Process control chart shows distribution of cycle time of all completed entities (",e.getTerms("userStory").names.toLowerCase(),", ",e.getTerms("feature").names.toLowerCase(),", ",e.getTerms("bug").names.toLowerCase(),", tasks, requests) for a given time frame."].join("")}})});