define(["Underscore","tp/reports/settings/model.settings","tp/date.utils","tp/reports/settings/definitionBuilder","tp/reports/settings/templateDataBuilder"],function(_,BaseModel,du,DefinitionBuilder,templateDataBuilder){return BaseModel.extend({NAME_CHART:"Process Ð¡ontrol",DESCRIPTION:["Process control chart shows distribution of cycle time of all completed entities (user stories, features, bugs, tasks, requests) for a given time frame."].join(""),defaultData:{scale:"cycleTime",entities:["userstory","bug"],filter:"?EndDate > Today - 180(days)"},saveSettings:function(storage,data){var settings={scale:data.time.key,filter:data.filter,entities:JSON.stringify(_.reduce(data.entities,function(memo,d){return memo.push(d.id),memo},[]))};storage({scope:"Public",userData:settings}).done(),this._super(storage,settings)},setSettings:function(data,acid){function prop(key,defaultValue){return function(d){var result=d[key];return typeof defaultValue!="undefined"&&(typeof result=="undefined"||result==null)&&(result=defaultValue),result}}function fnProperty(key,label,defaultValue){return{map:prop(key,defaultValue),label:label}}function date(key,label){return{map:function(d){if(prop(key)(d))return du.parseFromJSON(prop(key)(d))[0]},label:label}}function fnStatic(value){return{map:function(d){return value}}}var settings={strategy:"page",parameters:DefinitionBuilder.getWithLeadAndCycleTime(data,acid),mapping:{x:date("endDate","End Date"),y:fnProperty(data.time.key,data.time.label,0),r:fnStatic(4),stroke:fnProperty("type","Entity Type")}};this.fire("settings.changed",settings)},"bus model.ready":function(e,model){this.fire("dataBind",{times:templateDataBuilder.times(model),types:templateDataBuilder.assignables(model),isShowSettings:model.isShowSettings,name:this.NAME_CHART,description:this.DESCRIPTION,filter:templateDataBuilder.filter(model,"?EndDate > Today - 180(days)")})}})})