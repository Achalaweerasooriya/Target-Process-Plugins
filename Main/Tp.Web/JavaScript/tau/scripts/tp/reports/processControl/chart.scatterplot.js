define(["jQuery","Underscore","libs/d3/d3","tp/reports/chart.behaviour"],function($,_,d3,BaseChart){var highlight=function(cx,cy,xrange,yrange){return function(d){var line=d3.svg.line().x(function(d){return d[0]}).y(function(d){return d[1]});d.attr("d",line([[xrange[0],cy],[cx,cy],[cx,yrange[0]]])).attr("fill","none")}},hoverHandler={mouseover:function(d,context){d3.select(this).classed("hover",!0),d3.select(context.placeholder).insert("path",":first-child").classed("highlighter",!0).classed(context.scales.stroke(d.stroke),!0).call(highlight(context.scales.x(d.x),context.scales.y(d.y),[context.scales.x.range()[0]-context.scales.axisMargin,context.scales.x.range()[1]],[context.scales.y.range()[0]+context.scales.axisMargin,context.scales.y.range()[1]]))},mouseout:function(d,context){d3.select(this).classed("hover",!1),d3.select(context.placeholder).selectAll("path.highlighter").remove()}};return BaseChart.extend({initHandlers:function(handlers){return handlers.concat(hoverHandler)},data:function(data,context){d3.select(context.placeholder).classed("_scatterPlot scatterPlot",!0);var items=d3.select(context.placeholder).selectAll("circle").data(data,function(d){return d.id});items.enter().append("circle"),items.exit().remove(),items.attr("class",function(d){return context.scales.stroke(d.stroke)}).transition().attr("cx",function(d){return context.scales.x(d.x)}).attr("cy",function(d){return context.scales.y(d.y)}).attr("r",function(d){return d.r}).attr("data-id",function(d){return d.id}).attr("fill","none"),this._subscribe(items,["click","mouseover","mouseout"],context)}})})