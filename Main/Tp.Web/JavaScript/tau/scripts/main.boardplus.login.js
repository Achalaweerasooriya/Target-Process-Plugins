define(["Underscore","jQuery","tau/core/class","tau/app.resolver","tau/components/component.video-intro.popup"],function(e,t,i,s,r){return i.extend({init:function(e,t){this.configurator=e,this.applicationId=t},process:function(){var e=this.configurator.getWindow(),t=!e.appIsInDebugMode&&e.tauUserInfo&&e.tauUserInfo.isFirstTimeTp3Login;return t?this.firstTimeLogin():this.notFirstTimeLogin()},notFirstTimeLogin:function(){var i=this.configurator.getHashService(),r=!i.getHash();if(r&&e.has(i.getHrefParsed().queryKey,"start"))this.setHash("start/start");else if(r&&e.has(i.getHrefParsed().queryKey,"invite"))this.setHash("invite");else{var o=this.applicationId;s.resolvePageInfo({appId:this.applicationId,configurator:this.configurator},{type:"board",id:"last"},function(e){this.setHashParam(o,e.type+"/"+e.id)})}return t.Deferred().resolve()},showCallAdminPopup:function(){var e=this.configurator.getGlobalBus();r.create({url:"//www.youtube.com/embed/Lxl2sTEyYaE",showNextButton:!1}),e.fire("contentRendered")},firstTimeLogin:function(){var e=this.configurator.getLoggedUser().isAdministrator,i=window.tauUserInfo&&window.tauUserInfo.Tp3Available,s=this._isSsoWelcomePage(),r=!0,o=t.Deferred();if(e?this.setHash("start/start"):i?s||this.setHash("invite"):i||(this.showCallAdminPopup(),r=!1),r)if(s)o.resolve();else{var n=this.configurator.getGlobalSettingsService();n.sendRequest("GlobalSettingsService","FirstTimeLoginTP3",null).done(o.resolve).fail(function(){throw new Error("First time login operation is failed")})}else o.reject();return o},_isSsoWelcomePage:function(){var e=this.configurator.getHashService();return"sso/welcome"==e.getHashParam("page")},setHash:function(e){this.configurator.getHashService().setHash(this.applicationId+"="+e)}})});