(function($){module("changeLogPopup",{setup:function(){jQuery.fx.off=!0,this.source=[{Version:{Number:"1"},Url:"http://link1"},{Version:{Number:"2"},Url:"http://link2"},{Version:{Number:"3"},Url:"http://link3"},{Version:{Number:"4"},Url:"http://link4"},{Version:{Number:"5"},Url:"http://link5"}],this.iterator=new changeLogIterator(this.source),this.form=$('<div style="display:none"/>'),this.container=$('<div style="display:none"><div class="popup-header"></div></div>'),this.prev=$('<a class="prev" id="uniqueprevid">${Version.Number}</a>'),this.prev.appendTo(this.container),this.next=$('<a class="next" id="uniquenextid">${Version.Number}</a>'),this.next.appendTo(this.container),this.targetElement=$('<a id="whatsNewLink">What\'s new</a>'),this.targetElement.appendTo(this.container),this.iframe=new iframeMock;var config={form:this.form,iterator:this.iterator,iframe:this.iframe,header:$("<div>header</div>"),sourceElement:this.targetElement};this.container.changeLogPopup(config),this.widget=this.container.data("changeLogPopup")},teardown:function(){this.widget.hide(),delete this.source,delete this.iterator,this.container.remove(),delete this.container,this.prev.remove(),delete this.prev,this.next.remove(),delete this.next,this.targetElement.remove(),delete this.targetElement,delete this.iframe,this.widget.destroy(),delete this.widget}}),test("creation",function(){equals(this.widget.prevLink.id(),this.prev.id()),equals(this.widget.nextLink.id(),this.next.id())}),test("show",function(){this.widget.show(),equals(this.iframe.src,this.iterator.current().Url,"source should be set to iterator.current()"),this.iframe.load(),equals(this.container.css("display")=="none",!1,"popup should be shown when content is loaded"),equals($(".modalBackground").length,1,"popup should be shown as modal"),equals(this.next.css("display")!="none",!0,"Next button should be shown"),equals(this.prev.css("display")!="none",!0,"Previous button should be shown"),this.widget.hide(),equals($(".modalBackground").length,0,"popup should be hidden as modal")}),test("paging",function(){this.widget.show(),this.iframe.load(),equals(this.next.text(),"2","next version should be shown on next button"),this.next.click(),equals(this.iframe.src,"http://link2","next version url should be in iframe.src when moving forward"),equals(this.next.text(),"3","next version should be updated when next button clicked"),equals(this.prev.text(),"1","previous version should be updated when next button clicked"),this.prev.click(),equals("http://link1",this.iframe.src),equals(this.next.text(),"2","next version should be updated when previous button clicked")}),test("close",function(){this.widget.show(),this.iframe.load(),this.container.find(".close").click(),equals(this.container.css("display"),"none","popup should be hidden when close clicked")}),test("positioning",function(){this.widget.show(),this.iframe.load()}),test("singlePage",function(){var source=[{Version:{Number:"1"},Url:"http://link1"}],iterator=new changeLogIterator(source),container=$('<div style="display:none"/>'),close=$('<a class="close" id="uniquecloseid">close</a>');close.appendTo(container);var prev=$('<a class="prev" id="uniqueprevid">${Version.Number}</a>');prev.appendTo(container);var next=$('<a class="next" id="uniquenextid">${Version.Number}</a>');next.appendTo(container);var iframe=new iframeMock;container.changeLogPopup({iterator:iterator,iframe:iframe,header:$("<div>header</div>"),form:container}),equals(next.css("display")=="none",!0,"Next button should be hidden"),equals(prev.css("display")=="none",!0,"Previous button should be hidden")})})(jQuery)