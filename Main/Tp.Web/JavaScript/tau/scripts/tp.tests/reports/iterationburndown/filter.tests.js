require(["tp/reports/iterationburndown/filter","tp/date.utils"],function(a,b){(function(){module("filter tests",{setup:function(){this.filter=new a,this.filter.context=new ContextMock,this.filter._retrieveIterations=function(a,b){b({Items:[{Id:98,Name:"Sprint #2.3",StartDate:"/Date(1335301200000+0300)/",EndDate:"/Date(1336424400000+0300)/",Project:{Id:13,Name:"Tau Product Web Site - Scrum #1"}},{Id:51,Name:"Sprint #2.2",StartDate:"/Date(1334091600000+0300)/",EndDate:"/Date(1335214800000+0300)/",Project:{Id:13,Name:"Tau Product Web Site - Scrum #1"}},{Id:41,Name:"Sprint #2.1",StartDate:"/Date(1332882000000+0300)/",EndDate:"/Date(1334005200000+0300)/",Project:{Id:13,Name:"Tau Product Web Site - Scrum #1"}},{Id:30,Name:"Sprint #1.2",StartDate:"/Date(1331672400000+0300)/",EndDate:"/Date(1332795600000+0300)/",Project:{Id:13,Name:"Tau Product Web Site - Scrum #1"}},{Id:15,Name:"Sprint #1.1",StartDate:"/Date(1330462800000+0300)/",EndDate:"/Date(1331586000000+0300)/",Project:{Id:13,Name:"Tau Product Web Site - Scrum #1"}}]})},this.oldGetNow=b.getNow,b.getNow=function(){return new Date("2012-04-20")},this.placeholder=$("<div></div>")},teardown:function(){this.placeholder.find("._startDate").datepicker("destroy"),this.placeholder.remove(),b.getNow=this.oldGetNow}}),test("should retrieve iterations",function(){var a=this;this.filter.initialize({placeholder:this.placeholder,update:function(){equals(a.filter.iterations.length,5,"iterations retrieved"),equals(a.filter.currentIterations.length,1,"current iterations determined")}})}),test("should render filter",function(){var a=this;this.filter.initialize({placeholder:this.placeholder,update:function(){ok(a.placeholder.html(),"filter rendered")}})}),test("should get data",function(){var a=this;this.filter.initialize({placeholder:this.placeholder,update:function(){var c=a.filter.getData();equals(c.iterationId,51,"current iteration is correct"),ok(b.sameDay(c.startDate,new Date("2012-04-11")),"start date is correct"),ok(c.includeWeekends,"weekends are included")}})}),test("should change start date",function(){var a=this;this.filter.initialize({placeholder:this.placeholder,update:function(){var c=new Date("2012-04-30");a.filter.placeholder.find("._startDate").datepicker("setDate",c);var d=a.filter.getData();ok(b.sameDay(d.startDate,c),"start date is correct")}})})})()})