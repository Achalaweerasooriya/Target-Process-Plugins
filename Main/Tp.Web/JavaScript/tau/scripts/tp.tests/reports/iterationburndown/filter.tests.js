require(["tp/reports/burndown/filter","tp/reports/burndown/dataProvider","tp/date.utils","tau/utils/utils.date","tp/reports/contextProvider.tp2"],function(Filter,DataProvider,du,dateUtils,ContextProvider){(function(){module("filter tests",{setup:function(){this.filter=new Filter,this.filter.filterProvider.storage.findFilter=function(callback){callback()};var iterations=[{id:98,name:"Sprint #2.3",startDate:"/Date(1335301200000+0300)/",endDate:"/Date(1336424400000+0300)/",projectId:13,projectName:"Tau Product Web Site - Scrum #1",entityType:"Iteration"},{id:51,name:"Sprint #2.2",startDate:"/Date(1334091600000+0300)/",endDate:"/Date(1335214800000+0300)/",projectId:13,projectName:"Tau Product Web Site - Scrum #1",project:{id:13,name:"Tau Product Web Site - Scrum #1"},entityType:"Iteration"},{id:41,name:"Sprint #2.1",startDate:"/Date(1332882000000+0300)/",endDate:"/Date(1334005200000+0300)/",projectId:13,projectName:"Tau Product Web Site - Scrum #1",entityType:"Iteration"},{id:30,name:"Sprint #1.2",startDate:"/Date(1331672400000+0300)/",endDate:"/Date(1332795600000+0300)/",projectId:13,projectName:"Tau Product Web Site - Scrum #1",entityType:"Iteration"},{id:15,name:"Sprint #1.1",startDate:"/Date(1330462800000+0300)/",endDate:"/Date(1331586000000+0300)/",projectId:13,projectName:"Tau Product Web Site - Scrum #1",entityType:"Iteration"}];this.filter.filterProvider.burnDownTypeProvider=new BurnDownTypeProviderMock(this.filter.filterProvider,iterations[1]),this.filter.filterProvider.storage.saveFilter=function(){},this.filter.filterProvider._retrieveIterations=function(projects,teams,success){success(iterations)},this.oldGetNow=du.getNow,du.getNow=function(){return new Date("2012-04-20")},this.placeholder=$("<div></div>")},teardown:function(){this.placeholder.find("._startDate").datepicker("destroy"),this.placeholder.remove(),du.getNow=this.oldGetNow}}),test("should retrieve iterations",function(){var that=this;this.filter.initialize({placeholder:this.placeholder,contextProvider:new ContextProviderMock,dataProvider:new DataProvider,update:function(){equals(that.filter.filterProvider.iterations.length,5,"iterations retrieved"),equals(that.filter.filterProvider.currentIterations.length,1,"current iterations determined")}})}),test("should render filter",function(){var that=this;this.filter.initialize({placeholder:this.placeholder,contextProvider:new ContextProviderMock,dataProvider:new DataProvider,update:function(){ok(that.placeholder.html(),"filter rendered")}})}),test("should get data",function(){var that=this;this.filter.initialize({placeholder:this.placeholder,contextProvider:new ContextProviderMock,dataProvider:new DataProvider,update:function(){var data=that.filter.getData();equals(data.iterationId,51,"current iteration is correct"),equals(data.startDate,"11-Apr-2012","start date is correct"),ok(data.includeWeekends,"weekends are included")}})}),test("should change start date",function(){var that=this;this.filter.initialize({placeholder:this.placeholder,contextProvider:new ContextProviderMock,dataProvider:new DataProvider,update:function(){var date=new Date("2012-04-30");that.placeholder.find("._startDate").datepicker("setDate",date);var data=that.filter.getData();equals(data.startDate,"30-Apr-2012","start date is correct")}})})})()})