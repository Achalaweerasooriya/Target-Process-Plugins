require(["tp/plugins/activitylogging/activityViewer"],function(activityViewer){(function(){module("activity log test",{setup:function(){this._placeHolder=$('<div><div class="additional-controls" /><div class="controls-widgets" /></div>');var that=this;this._createViewer=function(){var viewer=new activityViewer({placeHolder:that._placeHolder});return viewer.profileNameSource=new ActivityNameSourceMock,viewer.repository=new ActivityRepositoryMock,viewer}},teardown:function(){}}),test("activity log should not be visible during profile creation",function(){var viewer=this._createViewer();viewer.profileNameSource.setProfileName(null),viewer.render(),equal(this._placeHolder.find(".activityLog").length,0,"activity log is invisible during profile creation")}),test("activity log should be visible during profile editing",function(){var viewer=this._createViewer();viewer.render(),notEqual(this._placeHolder.find(".log").html(),"","activity log is visible during profile editing")}),test("activity log should contain first page of log records after it is loaded",function(){var viewer=this._createViewer();viewer.render(),equal(this._placeHolder.find(".log>div").length,10,"activity log contains first page of log records")}),test('after "Show More" is clicked records from log\'s next page should be added',function(){var viewer=this._createViewer();viewer.render(),this._placeHolder.find("#linkMoreActivity").click(),equal(this._placeHolder.find(".log>div").length,20,"records from next page added")}),test('activity log should be empty after "Clear log" is clicked',function(){var viewer=this._createViewer();viewer.render(),this._placeHolder.find("#linkClear").click(),equal(this._placeHolder.find(".log").children().length,0,"log is cleared")}),test("activity log should contain 11 items after auto-refresh",function(){var viewer=this._createViewer();viewer.render(),viewer._getLatestActivityLog(),equal(this._placeHolder.find(".log>div").length,11,"new records added after auto-refresh")}),test('error log should be displayed after "Show errors" is clicked',function(){var viewer=this._createViewer();viewer.render(),this._placeHolder.find("#linkShowErrors").click(),equal(this._placeHolder.find(".log>div").length,1,"error log records are displayed"),equal(this._placeHolder.find("#linkShowErrors").css("display"),"none","link 'Show Errors' is hidden"),notEqual(this._placeHolder.find("#linkShowAll").css("display"),"none","link 'Show All' is visible")}),test('activity log should be displayed after "Show all" is clicked',function(){var viewer=this._createViewer();viewer.render(),this._placeHolder.find("#linkShowErrors").click(),this._placeHolder.find("#linkShowAll").click(),equal(this._placeHolder.find(".log>div").length,10,"activity log records are displayed"),notEqual(this._placeHolder.find("#linkShowErrors").css("display"),"none","link 'Show Errors' is visible"),equal(this._placeHolder.find("#linkShowAll").css("display"),"none","link 'Show All' is hidden")}),test("last sync date should be visible and have value after successful synchronization",function(){var viewer=this._createViewer();viewer.render(),notEqual(this._placeHolder.find(".lastSyncDate").parent().css("display"),"none","'Last Updated' is visible"),notEqual(this._placeHolder.find(".lastSyncDate").text(),"","Last Updated time is shown")}),test("last sync date should not be updated if synchronization failed",function(){var viewer=this._createViewer();viewer.render();var lastSyncDate=this._placeHolder.find(".lastSyncDate").text();viewer.repository.getActivityLog=function(profileName,data,success,error){error({})},viewer._getLatestActivityLog(),equal(lastSyncDate,this._placeHolder.find(".lastSyncDate").text(),"last sync date has not changed if synchronization failed")}),test("should roll log over size",function(){var viewer=this._createViewer();viewer.capacity=10,viewer.render(),equal(this._placeHolder.find(".log>div").length,10,"activity log contains first page of log records"),viewer._getLatestActivityLog(),equal(this._placeHolder.find(".log>div").length,10,"activity log was rolled over size")})})()})