require(["tp/plugins/profileControlsBlock","tp/jquery.utils"],function(ProfileControlsBlock){(function(){module("profile controls block tests",{setup:function(){this.placeholder=$('<div><div class="controls-block" /></div>'),this.block=new ProfileControlsBlock({placeholder:this.placeholder});var that=this;this.oldPublish=this.block.bus.publish,this.block.bus.publish=function(message,args){that.publishedMessage=message,that.publishedArgs=args},this.odSetProfileName=this.block.navigator.profileNameSource.setProfileName,this.block.navigator.profileNameSource.setProfileName=function(profileName){that.profileNameSet=profileName}},teardown:function(){this.block.bus.publish=this.oldPublish,this.block.navigator.profileNameSource.setProfileName=this.odSetProfileName}}),test("should render create and back buttons",function(){this.block.render(),ok(this.placeholder.find("#save").length>0,"save button rendered"),ok(this.placeholder.find("#cancel").length>0,"back button rendered")}),test("should publish SaveProfile message and disable save button when save button clicked",function(){this.block.render();var that=this;this.placeholder.find("#save").click(),equal(this.publishedMessage,"SaveProfile","SaveProfile message published"),ok(!that.placeholder.find("#save").enabled(),"save button disabled")}),test("should navigate to plugins list when clicked cancel button",function(){this.block.render(),expect(1),this.block.navigator.backToPlugins=function(){ok(!0,"navigated to plugins list")},this.placeholder.find("#cancel").click()}),test("should enable save button on ProfileSaveSucceed message",function(){var profileName="profile name";this.block.render(),this.placeholder.find("#save").click(),this.block._onProfileSaveSucceed({Name:profileName}),ok(this.placeholder.find("#save").enabled(),"save button enabled")}),test("should enable save button, show failure status on ProfileSaveFailed",function(){this.block.render(),this.placeholder.find("#save").click(),this.block._onProfileSaveFailed({rawResponse:{status:500,responseText:"some text"}}),ok(this.placeholder.find("#save").enabled(),"save button enabled")})})()})