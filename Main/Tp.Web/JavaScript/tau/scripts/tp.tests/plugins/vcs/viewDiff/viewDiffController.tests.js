require(["tp/plugins/vcs/viewDiff/viewDiffController"],function(a){(function(){module("view diff controller",{setup:function(){this.prm={add_pageLoaded:function(a){this.savedCallback=a},pageLoaded:function(){if(this.savedCallback){var a={get_panelsCreated:function(){return[{id:"revisionsGrid"},{id:"revisionsGrid1"}]}};this.savedCallback(null,a)}}};var b=this;Sys={WebForms:{PageRequestManager:{getInstance:function(){return b.prm}}}},this.placeholder=$('<div id="viewDiffContainer">\n    <table id="_revisionsGrid">\n        <tr>\n            <td>\n                <img onclick="toggleRowVisibility(\'ctl00_mainArea_taskView_tabControl_revisionsInnerList_revisionsGrid_ctl118\', this);__doPostBack(\'ctl00$mainArea$taskView$tabControl$revisionsInnerList$ctl00\',\'19\')"\n                     style="cursor:pointer;" src="../../../JavaScript/tau/css/images/icons/minus-small.png">\n            </td>\n            <td>\n                <b>#\n                    123\n                </b>\n            </td>\n            <td>\n                06-Jul-2010 6:00 PM\n                by <b>\n                <span><span>unknown</span></span>\n            </b>\n            </td>\n            <td>\n                <span id="ctl00_mainArea_taskView_tabControl_revisionsInnerList_revisionsGrid_ctl04_descriptionLabel">#255 state:invaliden comment:next com</span>\n            </td>\n        </tr>\n        <tr>\n            <td>\n                <div class="expandedList">\n                    <input type="hidden" class="_revisionID" value="123"/>\n                    <table class="generalTable">\n                        <tr>\n                            <td colspan="3"></td>\n                        </tr>\n                        <tr id="textrb">\n                            <td><a href="#" class="view">/text.rb</a></td>\n                            <td>Modify</td>\n                            <td></td>\n                        </tr>\n                        <tr id="sourcecs">\n                            <td><a href="#" class="view">/source.cs</a></td>\n                            <td>Add</td>\n                            <td></td>\n                        </tr>\n                    </table>\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>').hide().appendTo($("body")),this.controller=new a({pluginName:"vcs",placeholder:this.placeholder}),this.controller.drawingInProgress=!1,this.controller.pluginsRepository={pluginStartedAndHasAtLeastOneProfile:function(a,b){b()}},this.controller.commandGateway={execute:function(a,b,c){a=="ViewDiff"?c({data:"diff"}):a=="GetImportedRevisions"?c([123]):c({Content:"source"})}},this.controller.viewSourcePopup={view:function(a,b,c){this.revision=a,this.content=b,this.path=c},loading:function(){}},this.controller.viewDiffPopup={view:function(a,b,c){this.revision=a,this.data=b,this.path=c},loading:function(){}}},teardown:function(){$("#viewDiffContainer").remove()}}),test("should view source",function(){this.prm.pageLoaded(),this.placeholder.find("#textrb a.view").click(),equal(this.controller.viewSourcePopup.content,"source","proper content is displayed"),equal(this.controller.viewSourcePopup.revision,"123","proper revision detected"),equal(this.controller.viewSourcePopup.path,"/text.rb","proper path passed"),this.placeholder.find("#sourcecs a.view").click(),equal(this.controller.viewSourcePopup.content,"source","proper content is displayed"),equal(this.controller.viewSourcePopup.revision,"123","proper revision detected"),equal(this.controller.viewSourcePopup.path,"/source.cs","proper path passed")}),test("should view diff",function(){this.prm.pageLoaded(),this.placeholder.find("#textrb a._diff").click(),equal(this.controller.viewDiffPopup.data.data,"diff","diff is displayed"),equal(this.controller.viewDiffPopup.revision,"123","proper revision detected"),equal(this.controller.viewDiffPopup.path,"/text.rb","proper path passed")}),test("should display error if unable to connect to a remote repository",function(){this.controller.showError=function(b){equal(b,a,"error message has been displayed")},this.prm.pageLoaded();var a="Error occured";this.controller.commandGateway.execute=function(b,c,d,e,f){f(a)},this.placeholder.find("#textrb a.view").click()})})()})